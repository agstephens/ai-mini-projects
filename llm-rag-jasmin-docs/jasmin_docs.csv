title,contents,page_url,char_count,word_count
About this site,"**We hope you like our new-look help docs** which make use of richer formatting to make the articles easier to read, particularly those with code snippets or command-line instructions. We've also changed the way we manage the source content so it's easier for us to maintain. There's still more to do, to re-organise some of the content and add new pages to reflect how JASMIN is evolving.
This site should redirect you from any previous URLs you may have stored, but please use the following features to help you navigate around the site:
- main navigation bar along the top of the site, including search tool
- breadcrumbs menu, to show you where you are in the site
- collapsible sidebar, left side panel (docs pages only)
- icons, to identify articles within the same section
- table of contents, right side panel
- hover over sub-headings to reveal a bookmark-able link to that heading
- {{< icon fas tag >}} {{<link url=""/tags""  >}}tags{{</link>}} to group together articles covering similar topics
- links between articles
",https://help.jasmin.ac.uk/docs/about-this-site#about-this-site,1030,175
Issues with this site,"If you spot any broken links or incorrect information, please let us know by opening an issue in the GitHub repository for this site's source code:
{{<button icon=""fab github"" cue=false order=""first"" href=""https://github.com/cedadev/jasmin-help-hugo-hinode/issues"" >}}Report issues with this site{{</button>}}
The date of update date and commit message for each page should be just above the footer of each page.
",https://help.jasmin.ac.uk/docs/about-this-site#issues-with-this-site,413,57
Other issues,"For all other reports of problems, or for any information you can't find (don't forget the other JASMIN sites linked in the footer!), please use the contact form via ""Ask"" in the JASMIN Help beacon (bottom right, orange button) and use the contact form to send a message to the helpdesk: this is the best method to get in touch.
Note that the beacon no longer contains the links to the help docs themselves, but still provides the contact form. Hopefully the other navigation features described above should enable you to find what you need.
",https://help.jasmin.ac.uk/docs/about-this-site#other-issues,542,95
'Example Job 2,"This page records some early CEDA usage of the LOTUS cluster for various
relatively simple tasks. Others may wish to use these examples as a starting
point for developing their own workflows on LOTUS.
## Case 1: Calculating MD5 Checksums on many files
This is a simple case because:
1. the archive only needs to be read by the code and
2. the code that we need to run involves only the basic linux commands so there are no issues with picking up dependencies from elsewhere.
### Case Description**
- we want to calculate the MD5 checksums of about 220,000 files. It will take a day or two to run them all in series.
- we have a text file that contains 220,000 lines - one file per line.
### Solution under LOTUS
- Split the 220,000 lines into 22 files of 10,000 lines.
- Write a template script to: 
- Read a text file full of file paths
- Run the `md5sum` command on each file and log the result.
- Write a script to create 22 new scripts (based on the template script), each of which takes one of the input files and works through it.
### And this is how it looks
Log in to the `sci` server (from a `login` server):
{{<command user=""user"" host=""login1"">}}
ssh -A <username>@sci1.jasmin.ac.uk
{{</command>}}
Split the big file
{{<command user=""user"" host=""sci1"">}}
split -l 10000 -d file_list.txt # Produces 22 files called ""x00""...""x21""
{{</command>}}
Create the template file: `scan_files_template.sh`
#!/bin/bash
#SBATCH -e %J.e
infile=/home/users/astephen/sst_cci/to_scan/__INSERT_FILE__  
while read f ; do         
    /usr/bin/md5sum $f >> /home/users/astephen/sst_cci/output/scanned___INSERT_FILE__.log
done < $infile
Run a script to generate all the script files:
for i in `ls /home/users/astephen/sst_cci/to_scan/` ; do
    cp scan_files_template.txt bin/scan_files_${i}.sh 
    perl -p -i -w -e 's/__INSERT_FILE__/'${i}'/g;' bin/scan_files_${i}.sh 
done
Submit all 22 jobs to LOTUS:
for i in `ls /home/users/astephen/sst_cci/to_scan/` ; do      
    echo $i     
    sbatch -p short-serial -o /home/users/astephen/sst_cci/output/$i /home/users/astephen/sst_cci/bin/scan_files_${i}.sh  
done
Watch the jobs running:
{{<command user=""user"" host=""sci1"">}}
squeue -u <username>
{{</command>}}
### And the result
All jobs ran within about an hour.
## Case 2: Checksumming CMIP5 Data
A variation on Case 2 has been used for checksumming datasets in the CMIP5
archive. The Python code below will find all NetCDF files in a DRS dataset and
generate a checksums file and error log. Each dataset is submitted as a
separate bsub job.
"""""" 
Checksum a CMIP5 dataset
usage: checksum_dataset.py dataset_id ...
    where dataset_id is a full drs id including version 
    e.g. cmip5.output1.MOHC.HadGEM2-ES.historical.6hr.atmos.6hrLev.r1i1p1.v20110921
""""""
import os
import os.path as op
import sys
import optparse
DRS_ROOT = '/badc/cmip5/data'
def submit_job(dataset):
    # Assume version is in the dataset-id for now
    parts = dataset.split('.')
    path = op.join(DRS_ROOT, '/'.join(parts))
    if not op.exists(path):
        raise Exception('%s does not exist' % path)
    job_name = dataset
    cmd = ('bsub -q lotus -J {job_name} '
            '-o {job_name}.checksums -e {job_name}.err '
            ""/usr/bin/md5sum '{path}/*/*.nc'"").format(job_name=job_name,
                                                    path=path)
    print(cmd)
    os.system(cmd)
def main():
    parser = optparse.OptionParser(description='Checksum DRS datasets')
    (options, args) = parser.parse_args()
    datasets = args
    for dataset in datasets:
        submit_job(dataset)
if __name__ == '__main__':
    main()
If you have a file containing a list of dataset ids you can submit each as a
separate job by invoking the above script as follows:
{{<command user=""user"" host=""sci1"">}}
./checksum_dataset.py $(cat datasets_to_checksum.dat)
sbatch-q short-serial -J cmip5.output1.MOHC.HadGEM2-ES.rcp85.day.seaIce.day.r1i1p1.v20111128 -o cmip5.output1.MOHC.HadGEM2-ES.rcp85.day.seaIce.day.r1i1p1.v20111128.checksums -e cmip5.output1.MOHC.HadGEM2-ES.rcp85.day.seaIce.day.r1i1p1.v20111128.err /usr/bin/md5sum '/badc/cmip5/data/cmip5/output1/MOHC/HadGEM2-ES/rcp85/day/seaIce/day/r1i1p1/v20111128/*/*.nc'
(out)Job <745307> is submitted to queue <lotus>.  ...
{{</command>}}
",https://help.jasmin.ac.uk/docs/batch-computing/example-job-2-calc-md5s,4256,543
Job information,"Information on all running and pending batch jobs managed by Slurm can be
obtained from the Slurm command `squeue`. Note that information on completed
jobs is only retained for a limited period. Information on jobs that ran in
the past is via `sacct`. An example of the output `squeue` is shown below.
{{<command user=""user"" host=""sci1"">}}
squeue
(out)JOBID PARTITION     NAME   USER ST       TIME  NODES NODELIST(REASON)
(out)18957 short-ser     mean   user1  R       0:01      1 host147
(out)18956 short-ser     calc   user2  R      48:38      1 host146
(out)18967      test     wrap   user1  R      14:25      1 host146
{{</command>}}
where the field `ST` is the job state and the `TIME` is the time used by the
job.
A batch job evolves in several states in the course of its execution. The
typical job states are defined in Table 1
Table 1: Job states
Symbol | Job state  |  Description  
---|---|---
PD  |  Pending  |  The job is waiting in a queue for allocation of resources
R  |  Running  |  The job currently is allocated to a node and is running
CG  |  Completing  |  The job is finishing but some processes are still active
CD  |  Completed  |  The job has completed successfully
F  |  Failed  |  Failed with non-zero exit value
TO  |  Terminated  |  Job terminated by Slurm after reaching its runtime limit
S  |  Suspended  |  A running job has been stopped with its resources released to other jobs
ST  |  Stopped  |  A running job has been stopped with its resources retained
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-monitor-slurm-jobs#job-information,1514,248
Slurm commands for monitoring jobs,"A list of the most commonly used commands and their options for monitoring
batch jobs are listed in Table 2, below:
Table 2. List of important Slurm commands and their options for monitoring
jobs
Slurm Command  |  Description  
---|---  
`squeue` |  To view information for all jobs running and pending on the cluster  
`squeue --user=username` |  Displays running and pending jobs per individual user  
`squeue --states=PD` |  Displays information for pending jobs (PD state) and their reasons  
`squeues --states=all` |  Shows a summary of the number of jobs in different states  
`scontrol show job JOBID` |  Shows detailed information about your job (JOBID = job number) by searching the current event log file  
`sacct -b` |  Shows a brief listing of past jobs
`sacct -l -j JOBID` |  Shows detailed historical job information of a past job with jobID  
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-monitor-slurm-jobs#slurm-commands-for-monitoring-jobs,882,141
Inspection of job output files,"An example of the job output file from a simple job submitted to Slurm:
{{<command shell=""bash"">}}
sbatch -p test  --wrap=""sleep 2m""
(out)Submitted batch job 18973  
{{</command>}}
{{<command shell=""bash"">}}
scontrol show job 18973
(out)JobId=18973 JobName=wrap
(out)   UserId=fchami(26458) GroupId=users(26030) MCS_label=N/A
(out)   Priority=1 Nice=0 Account=jasmin QOS=normal
(out)   JobState=RUNNING Reason=None Dependency=(null)
(out)   Requeue=1 Restarts=0 BatchFlag=1 Reboot=0 ExitCode=0:0
(out)   RunTime=00:00:08 TimeLimit=01:00:00 TimeMin=N/A
(out)  SubmitTime=2020-05-20T14:10:28 EligibleTime=2020-05-20T14:10:28
(out)   AccrueTime=2020-05-20T14:10:28
(out)   StartTime=2020-05-20T14:10:32 EndTime=2020-05-20T15:10:32 Deadline=N/A
(out)   SuspendTime=None SecsPreSuspend=0 LastSchedEval=2020-05-20T14:10:32
(out)   Partition=test AllocNode:Sid=sci2-test:18286
(out)   ReqNodeList=(null) ExcNodeList=(null)
(out)   NodeList=host147
(out)   BatchHost=host147
(out)   NumNodes=1 NumCPUs=1 NumTasks=1 CPUs/Task=1 ReqB:S:C:T=0:0:*:*
(out)   TRES=cpu=1,mem=128890M,node=1,billing=1
(out)   Socks/Node=*NtasksPerN:B:S:C=0:0:*:* CoreSpec=*
(out)   MinCPUsNode=1 MinMemoryNode=128890M MinTmpDiskNode=0
(out)   Features=(null) DelayBoot=00:00:00
(out)   OverSubscribe=OK Contiguous=0 Licenses=(null) Network=(null)
(out)   Command=(null)
(out)   WorkDir=/home/users/fchami
(out)   StdErr=/home/users/fchami/slurm-18973.out
(out)   StdIn=/dev/null
(out)   StdOut=/home/users/fchami/slurm-18973.out
(out)   Power=
{{</command>}}
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-monitor-slurm-jobs#inspection-of-job-output-files,1527,116
History of jobs,"{{<command shell=""bash"">}}
sacct
(out)        JobID    JobName  Partition    Account  AllocCPUS      State ExitCode
(out)------------ ---------- ---------- ---------- ---------- ---------- --------
(out)18963              wrap par-single     jasmin          1  COMPLETED      0:0
(out)18964              wrap short-ser+     jasmin          1  COMPLETED      0:0
(out)18965              wrap par-single     jasmin          1  COMPLETED      0:0
(out)18966              wrap short-ser+     jasmin          1  COMPLETED      0:0
{{</command>}}
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-monitor-slurm-jobs#history-of-jobs,541,47
How to submit a job,"This article explains how to submit a batch job to the new scheduler Slurm.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job,76,14
What is a batch job?,"A batch job is controlled by a script written by the user who submits the job
to the batch system Slurm. The batch system then selects the resources for the
job and decides when to run the job. Note: the term ""job"" is used throughout
this documentation to mean a ""batch job"".
There are two ways of submitting a job to Slurm:
  1. Submit via a Slurm job script - create a bash script that includes directives to the Slurm scheduler
  2. Submit via command-line options - provide directives to Slurm via command-line arguments
Both options are described below.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#what-is-a-batch-job?,559,99
Which servers can you submit jobs from?,"Jobs can be submitted to Slurm from the following Sci machines:
sci1.jasmin.ac.uk 
sci2.jasmin.ac.uk 
sci3.jasmin.ac.uk 
sci4.jasmin.ac.uk 
sci5.jasmin.ac.uk 
sci6.jasmin.ac.uk 
sci8.jasmin.ac.uk
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#which-servers-can-you-submit-jobs-from?,196,18
Method 1: Submit via a Slurm job script,"The Slurm job submission command is:
{{<command user=""user"" host=""sci1"">}}
sbatch myjobscript
{{</command>}}
The job script is a Bash script of user's application and includes a list of
Slurm directives, prefixed with `#SBATCH` as shown in this example:
#!/bin/bash 
#SBATCH --partition=short-serial 
#SBATCH -o %j.out 
#SBATCH -e %j.err
#SBATCH --time=05:00
# executable 
sleep 5m
For job specification of resources please refer to Table 2 of the help article
[LSF to Slurm quick reference]({{< ref ""lsf-to-slurm-quick-reference"" >}})
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#method-1:-submit-via-a-slurm-job-script,536,74
Method 2: Submit via command-line options,"If you have an existing script, written in any language, that you wish to
submit to LOTUS then you can do so by providing Slurm directives as command-
line arguments. For example, if you have a script ""my-script.py"" that takes a
single argument ""-f <filepath>"", you can submit it using ""sbatch"" as follows:
sbatch -p short-serial -t 03:00 -o job01.out -e job01.err my-script.py -f myfile.txt
This approach allows you to submit jobs without writing additional job scripts
to wrap your existing code.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#method-2:-submit-via-command-line-options,499,82
Method 3: Submit an interactive session via salloc,"Testing a job on LOTUS can be carried out in an interactive manner by
obtaining a Slurm job allocation or resources (a set of nodes) via the Slurm
command `salloc` . The code/application is executed and the allocation are
released after a specific time -default 1 hour - when the testing is finished.
There are two ways:
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#method-3:-submit-an-interactive-session-via-salloc,321,57
Interactive execution with pseudo-shell terminal on the compute LOTUS node,"The job is executed on the LOTUS compute node by invoking the Slurm command
srun after allocating resources with `salloc`. See example below.
salloc -p par-single --ntasks-per-node=2
salloc: Pending job allocation 23506
salloc: job 23506 queued and waiting for resources
salloc: job 23506 has been allocated resources
salloc: Granted job allocation 23506
The job allocation ID 23506 has 2 CPUs on the compute node host580 as shown
below:
squeue -u train001-o""%.18i %.9P %.11j %.8u %.2t %.10M %.6D %.6C %R""
JOBID PARTITION        NAME        USER   ST       TIME  NODES   CPUS NODELIST(REASON)
23506 par-singl    interactive   usertest  R       1:32      1      2 host580
To launch an interactive shell session on the compute node host580, use the
following srun command (from a sci server).
srun --pty /bin/bash
@host580 ~]$
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#interactive-execution-with-pseudo-shell-terminal-on-the-compute-lotus-node,825,122
Interactive execution with no shell,"A code/application can be executed on the LOTUS compute node without a shell
session on the node itself. For example the command 'hostname' is executed
twice as there are 2 CPUs and this outputs the name of the node
srun hostname
host580.jc.rl.ac.uk
host580.jc.rl.ac.uk
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#interactive-execution-with-no-shell,270,43
Job array submission,"Job arrays are groups of jobs with the same executable and resource
requirements, but different input files. Job arrays can be submitted,
controlled, and monitored as a single unit or as individual jobs or groups of
jobs. Each job submitted from a job array shares the same job ID as the job
array and is uniquely referenced using an array index. This approach is useful
for ‘high throughput' tasks, for example where you want to run your simulation
with different driving data or run the same processing task on multiple data
files.
Important note: The maximum job array size that Slurm is configured for is
MaxArraySize = 10000. If a Job array of size is greater than 10000 is
submitted, Slurm will reject the job submission with the following error
message: ""Job array index too large. Job not submitted.""
Taking a simple R submission script as an example:
#!/bin/bash 
#SBATCH --partition=short-serial 
#SBATCH --job-name=myRtest
#SBATCH -o %j.out 
#SBATCH -e %j.err 
#SBATCH --time=30:00
module add jasr
Rscript TestRFile.R dataset1.csv
If you want to run the same script `TestRFile.R ` with input file `dataset2.csv` through  to `dataset10.csv`, you could create and submit a job script for each dataset. However, by setting up an array job, you could create and submit a single job script.
The corresponding job array script to process 10 input files in a single job
submission would look something like this:
#!/bin/bash 
#SBATCH --partition=short-serial 
#SBATCH --job-name=myRarray
#SBATCH -o %A_%a.out
#SBATCH -e %A_%a.err
#SBATCH --time=30:00
#SBATCH --array=1-10
module add jasr
Rscript TestRFile.R datset${Slurm_ARRAY_TASK_ID}.csv
Here the important differences are :
- The array is created by Slurm directive `--array=1-10` by including elements numbered `[1-10]`to represent our 10 variations
- The error and output file have the array  index `%a` included  in the name and `%A` is the job ID.
- The environment variable `$Slurm_ARRAY_TASK_ID` in the `Rscript` command is expanded to give the job index
When the job is submitted, Slurm will create 10 tasks under the single job
ID. The job array script is submitted in the usual way:
sbatch myRarray.sbatch
If you use  the `squeue -u <username>` command  to list your active jobs, you
will see 10 tasks with the same Job ID. The tasks can be distinguished by  the
`[index] ` e.g. jobID_index. Note that individual tasks may be allocated to a
range of different hosts on LOTUS.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-a-job#job-array-submission,2443,389
How to submit an MPI parallel job,"This article explains the submission of an MPI parallel job to Slurm/ LOTUS.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-an-mpi-parallel-job,77,13
What is an MPI parallel job?,"An MPI parallel job runs on more than one core and more than one host using
the Message Passing Interface (MPI) library for communication between all
cores. A simple script, such as the one given below ""my_script_name.sbatch  ""
#!/bin/bash
#SBATCH -p par-multi
#SBATCH -n 36
#SBATCH -t 30
#SBATCH -o %j.log
#SBATCH -e %j.err
# Load a module for the gcc OpenMPI library  (needed for mpi_myname.exe)
module load eb/OpenMPI/gcc/4.0.0
# Start the job running using OpenMPI's ""mpirun"" job launcher
mpirun ./mpi_myname.exe
`-n` refers to the number of processors or cores you wish to run on. The rest
of  the `#SBATCH` input  options, and many more besides, can be found in  the
`sbatch` manual  page or in the related articles. You must only use the par-
multi queue for parallel jobs using MPI.
For those familiar with LOTUS running Platform MPI and Platform LSF, please
note that the job is started using the OpenMPI native ""mpirun"" command not the
""mpirun.lotus"" wrapper script that was previously required. We have provided
an mpirun.lotus script for backward compatiblity but it just runs the native
mpirun
To submit the job, do not run the script, but rather use it as the standard
input to sbatch, like so:
sbatch --exclusive my_script_name.sbatch
The `--exclusive` flag  is used to group the parallel jobs onto hosts which
are allocated only to run this job. This ensures the best MPI communication
consistency and bandwidth/latency for the job and ensures no interference from
other users' jobs that might otherwise be running on those hosts.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-an-mpi-parallel-job#what-is-an-mpi-parallel-job?,1547,253
MPI implementation and Slurm,"The OpenMPI library is the only supported MPI library on the cluster. OpenMPI
v3.1.1 and v4.0.0 are provided which are fully MPI3 compliant. MPI I/O
features are fully supported *only* on the LOTUS /work/scratch-pw* volumes as
these use a Panasas fully parallel file system. The MPI implementation on
CentOS7 LOTUS/Slurm is available via the module environment for each compiler
as listed below:
eb/OpenMPI/gcc/3.1.1 
eb/OpenMPI/gcc/4.0.0       
eb/OpenMPI/intel/3.1.1
**Note:** OPenMPI Intel compiler is due shortly as is 4.0.3  
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-an-mpi-parallel-job#mpi-implementation-and-slurm,531,75
Parallel MPI compiler with OpenMPI,"Compile and link to OpenMPI libraries using the mpif90, mpif77, mpicc, mpiCC
wrapper scripts which are in the default unix path. The scripts will detect
which compiler you are using (Gnu, Intel) by the compiler environment loaded
and add the relevant compiler library switches. For example:
module load intel/20.0.0
module load eb/OpenMPI/intel/3.1.1
mpif90
will use the Intel Fortran compiler `ifort` and OpenMPI/3.1.1.  Whereas
module load eb/OpenMPI/gcc/3.1.1
mpicc
will call the GNU C compiler `gcc` and  OpenMPI/3.1.1.
The OpenMPI User Guides can be found at <https://www.open-mpi.org/doc/>.
",https://help.jasmin.ac.uk/docs/batch-computing/how-to-submit-an-mpi-parallel-job#parallel-mpi-compiler-with-openmpi,597,85
Current cluster specification,"LOTUS is a cluster of over 300 nodes/hosts and 19000 CPU cores. A node/host is
an individual computer in the cluster with more than 1 processor. Each
node/host belongs to a specific host group. The number of processors (CPUs or
cores) per host is listed in Table 1 with the corresponding processor model
and the size of the physical memory RAM available per node/host.
**Table 1**. LOTUS cluster specification
**Current** host groups
Host group name |  Number of nodes/hosts  |  Processor model |  CPUs per host |  RAM 
---|---|---|---|---  
broadwell256G  |  37  |  Intel Xeon E5-2640-v4 ""Broadwell""  |  20  |  256 GB  
skylake348G  |  151  |  Intel Xeon Gold-5118 ""Skylake""  |  24  |  348 GB  
epyctwo1024G  | 200  |  AMD  |  48  |  1024 GB | 
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-cluster-specification#current-cluster-specification,770,128
Selection of specific processor model,"To select a node/host with a specific processor model and memory, add the
following Slurm directive to your job script 
#SBATCH --constraint=""<host-group-name>""
For example 
#SBATCH --constraint=""skylake348G""
{{< alert type=""info"" >}}
Further notes
`intel` and `amd` node types are defined in the Slurm configuration as a feature:
- For any Intel node type use `#SBATCH --constraint=""intel""`
- For a specific Intel CPU model use the host group name (see Table 1)
  - e.g. `#SBATCH --constraint=""skylake348G""`
- For AMD use ` #SBATCH --constraint=""amd""`
- There are 10 nodes of node type `skylake348G` with SSD disk mounted on /tmp 
- LOTUS nodes of node type `epyctwo1024` are not available yet on the `par-multi` queue
{{< /alert >}}
{{< alert type=""danger"" >}}
If you choose to compile code for specific architectures, do not expect it to run elsewhere in the system.
{{< /alert >}}
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-cluster-specification#selection-of-specific-processor-model,885,140
Retired host groups no longer in use,"(For reference only)
Host group name |  Number of nodes/hosts |  Processor model |  CPUs per host |  RAM  
---|---|---|---|---  
~~haswell256G~~ |  ~~7~~ retired |  ~~Intel Xeon E5-2650-v3 ""Haswell""~~  |  ~~20~~  | ~~256 GB~~
~~ivybridge2000G~~  |  ~~3~~  -retired |  ~~Intel Xeon E7-4860-v2 ""Ivy Bridge""~~  |  ~~48~~  | ~~2048 GB~~
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-cluster-specification#retired-host-groups-no-longer-in-use,357,51
LOTUS overview,"This article gives an overview of the LOTUS batch computing cluster which is
part of JASMIN. It covers:
- What LOTUS is and what it can be used for
- Where LOTUS can be accessed from
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-overview,183,36
What is LOTUS,"LOTUS is not, in itself, a High-Performance Computing (HPC) facility, but
provides the batch and parallel processing component of the JASMIN data-
intensive scientific analysis environment. LOTUS is a cluster of physical
machines, running the [Slurm workload manager]({{< ref ""slurm-scheduler-overview"" >}}), enabling efficient scheduling of larger data analysis tasks
across nodes in the cluster as a single unit -see Figure 1.
Each node in the
cluster is connected by 10Gbit/s Ethernet to JASMIN's high-performance
40Gbit/s core network. Although not its primary function, LOTUS also
facilitates MPI-based parallel processing.
JASMIN provides both interactive and batch computing environments,
recognising  that scientists often need to develop and test workflows
interactively before running those workflows efficiently at scale. Nodes
within LOTUS run the same stack of software and can access the same high-
performance storage as the JASMIN Scientific Analysis servers, ensuring a
consistent working environment for all phases of users' workflows.
See [LOTUS Hardware]({{< ref ""lotus-cluster-specification"" >}}) for details of
the current LOTUS environment summarised in this schematic presentation
**Figure 1** shows a schematic presentation of the LOTUS cluster and its
environment
{{< image src=""img/docs/lotus-overview/file-QPxolXD1Tu.png"" caption=""LOTUS schematic"" >}}
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-overview#what-is-lotus,1380,185
When to use LOTUS,"LOTUS is ideally suited to workflows which need to process or compare entire
datasets, stored either in Group Workspaces or in the CEDA archives. The
latter are directly accessible read-only so can be processed in-place without
the need to copy files. Intermediate working files (within batch jobs) should
be stored temporarily in `/work/scratch-pw*` and ` /work/scratch-nopw*`
volumes which are shared across the cluster, while persistent outputs can be
written efficiently to Group Workspaces and shared with collaborators for the
duration of a project.
See [Access to Storage]({{< ref path=""/docs/getting-started/storage"" >}}) for details about which file
systems are appropriate to use and how to access them.
LOTUS currently has around 19,000 cores, but is heavily used and implements a
fair-share scheduling system between users. It is not intended as a substitute
for dedicated HPC facilities, rather as a complementary environment in which
model outputs can be analyzed and compared with observational data. Users with
large-scale compute-heavy requirements (in particular those requiring large-
scale parallel processing) should look to access other parts of the national
HPC infrastructure such as [ARCHER2](http://www.archer2.ac.uk/) or
[MONSooN](http://collab.metoffice.gov.uk/twiki/bin/view/Support/MONSooN).
In order to maintain a safe and reliable working environment for all within
LOTUS and more widely within JASMIN, users are expected to follow [the best
practice outlined in this documentation]({{< ref ""tips-for-new-users"" >}}).
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-overview#when-to-use-lotus,1550,214
How to gain access to LOTUS,"LOTUS is accessible via the batch scheduler system SLURM that is running
across all JASMIN scientific analysis servers `sci[1-8].jasmin.ac.uk`.
From the above servers, it is possible to submit, monitor, and control batch
jobs using the SLURM commands.
Please note that if you have only recently requested access to [JASMIN login
services]({{< ref ""get-login-account"" >}}) and had this approved, there can
sometimes be a delay (typically up to a day, but in rare cases can be longer)
before the necessary configuration is created for you on LOTUS. You will not
be able to submit jobs to LOTUS queues until this has been completed.
Typically you would see an error message such as this, in this case after an
unsuccessful attempt to submit to the `short-serial` queue:
sbatch: error: Batch job submission failed: Invalid account or account/partition combination specified
If this occurs, please try again in 24 hours before contacting the JASMIN helpdesk.
",https://help.jasmin.ac.uk/docs/batch-computing/lotus-overview#how-to-gain-access-to-lotus,954,151
Slurm quick reference,"This article shows the Slurm commands and their equivalent to the LSF
scheduler (LSF was replaced by Slurm in September 2020): [this webinar](https://www.ceda.ac.uk/events/transitioning-to-slurm-webinar) gave details of the transition.
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference,236,28
The Slurm Scheduler,"[Slurm](https://slurm.schedmd.com/) is the job scheduler deployed on JASMIN. It
allows users to submit, monitor, and control jobs on the LOTUS (cpu) and ORCHID (gpu) clusters.
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference#the-slurm-scheduler,176,25
Essential LSF/Slurm commands,"**LSF** |  **Slurm** |  **Description**  
---|---|---  
bsub < _script_file_ |  sbatch _script_file_ |  Submit a job script to the scheduler  
bqueues  |  sinfo  |  Show available scheduling queues  
bjobs  |  squeue -u _\<username\>_ |  List user's pending and running jobs  
bsub -n 1 -q test -Is /bin/bash |  srun -n 1 -p test --pty /bin/bash  | Request an interactive session on LOTUS
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference#essential-lsf/slurm-commands,413,64
Job specification,"**LSF** |  **Slurm** |  **Description**  
---|---|---  
#BSUB  |  #SBATCH  |  Scheduler directive  
-q _queue_name_ |  \--partition=_queue_name or_ -p _queue_name_ |  Specify the scheduling queue   
-W _hh:mm:ss_ |  \--time=_hh:mm:ss_ or -t _hh:mm:ss_  |  Set the maximum runtime limit  
-We _hh:mm:ss_ |  \--time-min=_hh:mm:ss_  |  Set an estimated runtime  
-J _job_name_ |  \--job-name=_jobname_  |  Specify a name for the job  
-o _filename_, -e _filename_  |  \--output=_filename_ or  -o filename,  \--error=_filename_ or -e _filename_. The default file name is ""slurm-%j.out"", where ""%j""is replaced by the job ID | Standard job output and error output. Default append.
-oo/-eo _filename_  | **For job arrays** , the default file name is ""slurm-%A_%a.out"", ""%A"" is replaced by the job ID and ""%a"" with the array index. 
&#xfeff; | \--open-mode=append\|truncate  |  Write mode for error/output files .
%J |  %j  | Job ID for -oo/eo filename
%I |  %a | Job array index  
-R ""rusage[mem= _XXX_ ]"" |  \--mem=_XXX_ |  Memory XXX is required for the job. Default units are megabytes  
-J _job_name_ [index_list]  |  \--array= _index_  (e.g. --array=1-10) |  specify a job array  
-J _job_name_ [index_list]% _number-of-simultaneous-jobs_ |  \--array=index% _ArrayTaskThrottle_  _e.g._ \--array _=1-15%4_ will limit the number of simultaneously running tasks from this job array to 4 |  A maximum number of simultaneously running tasks from the job array may be specified using a ""%"" separator.  
-cwd directory  |  -D, --chdir=<directory> |  Set the working directory of the batch script to < _directory >_ before it is executed.   
-x  |  \--exclusive  |  Exclusive execution mode   
-w '_dependency_expression_'  |  \--dependency= _\<dependency_list\>_ |  Defer the start of this job until the specified dependencies have been satisfied completed   
-n _number-of-cores_ |  \--ntasks=_number-of-cores or -n_ _number-of-cores_ |  Number of CPU cores   
-m <host-group-name> |  \--constraint=""_\< host-group-name\>_""  |  To select a node with a specific processor model   
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference#job-specification,2096,296
Job control commands,"**LSF** |  **Slurm** |  **Description**  
---|---|---  
bkill _\<jobid\>_ |  scancel _\<jobid\>_ |  Kill a job  
bjobs -l _\<jobid\>_ |  scontrol show job _\<jobid\>_ |  Show details job information  
bmod _\<jobid\>_ |  scontrol update job _\<jobid\>_ |  Modify a pending job  
bkill 0  |  scancel --user=_\<username\>_ |  Kill all jobs owned by a user
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference#job-control-commands,378,55
Job environment variables,"**LSF** |  **Slurm** |  **Description**  
---|---|---  
$LSB_JOBID  |  $SLURM_JOBID  |  Job identifier number  
$LSB_JOBID  |  $SLURM_ARRAY_JOB_ID  |  Job Array  
$LSB_JOBINDEX  |  $SLURM_ARRAY_TASK_ID  |  Job array index  
$LSB_JOBINDEX_END  |  $SLURM_ARRAY_TASK_MAX  |  Last index number within a job array  
$LSB_MAX_NUM_PROCESSORS  |  $SLURM_NTASKS  |  Number of processors allocated  
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/batch-computing/lsf-to-slurm-quick-reference#job-environment-variables,414,47
Orchid GPU cluster,"This article provides details on JASMIN's GPU
cluster, named **ORCHID**.
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster,73,10
GPU cluster spec,"The JASMIN GPU cluster is composed of 16 GPU nodes:
- 14 x standard GPU nodes with 4 GPU Nvidia A100 GPU cards each
- 2 x large GPU nodes with 8 Nvidia A100 GPU cards
{{< image src=""img/docs/gpu-cluster-orchid/file-NZmhCFPJx9.png"" caption=""ORCHID GPU cluster"" >}}
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#gpu-cluster-spec,264,43
Request access to ORCHID,"Before using ORCHID on JASMIN, you will need: 
1. An existing JASMIN account and valid `jasmin-login` access role: {{<button size=""sm"" href=""https://accounts.jasmin.ac.uk/services/login_services/jasmin-login/"">}}Apply here{{</button>}}
2. **Subsequently** (once `jasmin-login` has been approved and completed), the `orchid` access role: {{<button size=""sm"" href=""https://accounts.jasmin.ac.uk/services/additional_services/orchid/"">}}Apply here{{</button>}}
The `jasmin-login` access role ensures that your account is set up with access to the LOTUS batch processing cluster, while the `orchid` role grants access to the special LOTUS partition used by ORCHID.
Holding the `orchid` role also gives access to the GPU interactive node.
**Note:** In the supporting info on the `orchid` request form, please provide details
on the software and the workflow that you will use/run on ORCHID.
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#request-access-to-orchid,885,109
Test a GPU job,"Testing a job on the JASMIN ORCHID GPU cluster can be carried out in an
interactive mode by launching a pseudo-shell terminal Slurm job from a JASMIN
scientific server e.g. `sci2`:
{{<command user=""user"" host=""sci2"">}}
srun --gres=gpu:1 --partition=orchid --account=orchid --pty /bin/bash
(out)srun: job 24096593 queued and waiting for resources
(out)srun: job 24096593 has been allocated resources
{{</command>}}
{{<command user=""user"" host=""gpuhost16"">}}
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#test-a-gpu-job,457,59
you are now on gpuhost16,"{{</command>}}
The GPU node gpuhost016 is allocated for this interactive session on LOTUS
Note that for batch mode, a GPU job is submitted using the Slurm command
'sbatch':
{{<command user=""user"" host=""sci2"">}}
sbatch --gres=gpu:1 --partition=orchid --account=orchid gpujobscript.sbatch
{{</command>}}
or by adding the following preamble in the job script file
#SBATCH --partition=orchid
#SBATCH --account=orchid
#SBATCH --gres=gpu:1
Note 1: `gpuhost015` and `gpuhost016` are the two largest nodes with 64 CPUs and
8 GPUs.
Note 2: **CUDA Version: 11.6**
Note 3: The Slurm batch partition/queue `orchid` has a maximum runtime of 24 hours and
the default runtime is 1 hour. The maximum number of CPU cores per user is
limited to 8 cores. If the limit is exceeded then the job is expected to be in
a pending state with the reason being {{<mark>}}QOSGrpCpuLimit{{</mark>}}
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#you-are-now-on-gpuhost16,869,130
GPU interactive node,"There is an interactive GPU node `gpuhost001.jc.rl.ac.uk`, with the same spec as
other Orchid nodes, that you can access via a login server to prototype and
test your GPU code prior to running as a batch job.
{{<command user=""user"" host=""login1"">}}
ssh -A gpuhost001.jc.rl.ac.uk
{{</command>}}
{{<command user=""user"" host=""gpuhost001"">}}
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#gpu-interactive-node,338,47
you are now on gpuhost001,"{{</command>}}
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#you-are-now-on-gpuhost001,15,1
Software Installed on the GPU cluster (to be updated),"- CUDA drivers 10.1, and CUDA libraries 10.0, 10.1 and 11.4  
- CUDA DNN (Deep Neural Network Library)  
- NVIDIA container runtime (see notes below)  
- NGC client (GPU software hub for NVIDIA)  
- Singularity 3.7.0 - which supports NVIDIA/GPU containers
- SCL Python 3.6
",https://help.jasmin.ac.uk/docs/batch-computing/orchid-gpu-cluster#software-installed-on-the-gpu-cluster-(to-be-updated),273,45
Slurm queues,"This article introduces the Slurm scheduler queues/partitions for batch job
submissions to the LOTUS and ORCHID clusters.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues,122,17
Queue names,"The Slurm queues in the LOTUS cluster are:
- `test`
- `short-serial`
- `long-serial`
- `par-single`
- `par-multi`
- `high-mem`
- `short-serial-4hr`
Each queue is has attributes of run-length limits (e.g. short, long) and
resources. A full breakdown of each queue and its associated resources is
shown below in Table 1.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#queue-names,319,51
Queue details,"Queues represent a set of pending jobs, lined up in a defined order, and
waiting for their opportunity to use resources. The queue is specified in the
job script file using Slurm scheduler directive like this:
#SBATCH -p <partition=queue_name>`
where `<queue_name>` is the name of the queue/partition (Table 1. column 1)
Table 1 summarises important specifications for each queue such as run time
limits and the number of CPU core limits. If the queue is not specified, Slurm
will schedule the job to the queue `short-serial` by default.
Table 1. LOTUS/Slurm queues and their specifications
Queue name  |  Max run time  |  Default run time  |  Max CPU cores per job  |  MaxCpuPerUserLimit  |  Priority  
---|---|---|---|---|---  
`test` |  4 hrs  |  1hr  |  8  |  8  |  30  
`short-serial` |  24 hrs  |  1hr  |  1  |  2000  |  30  
`par-single` |  48 hrs  |  1hr  |  16  |  300  |  25  
`par-multi` |  48 hrs  |  1hr  |  256  |  300  |  20  
`long-serial` |  168 hrs  |  1hr  |  1  |  300  |  10  
`high-mem` |  48 hrs  |  1hr  |  1  |  75  |  30  
`short-serial-4hr`<br>(**Note 3**)  |  4 hrs  |  1hr  |  1  |  1000  |  30
{.table .table-striped}
**Note 1** : Resources requested by a job must be within the resource
allocation limits of the selected queue.
**Note 2:** The default value for `--time=[hh:mm:ss]` (predicted maximum wall
time) is 1 hour for the all queues. If you do not specify this option
and/or your job exceeds the default maximum run time limit then it will be
terminated by the Slurm scheduler.
**Note 3** : A user must specify the Slurm job account `--account=short4hr`
when submitting a batch job to the `short-serial-4hr` queue.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#queue-details,1654,287
State of queues,"The Slurm command `sinfo` reports the state of queues and nodes
managed by Slurm. It has a wide variety of filtering, sorting, and formatting
options.
{{<command shell=""bash"">}}
sinfo   
(out)PARTITION     AVAIL  TIMELIMIT  NODES  STATE NODELIST
(out)test             up    4:00:00     48   idle host[146-193]
(out)short-serial*    up 1-00:00:00     48   idle host[146-193]
(out)long-serial      up 7-00:00:00     48   idle host[146-193]
(out)par-single       up 2-00:00:00     48   idle host[146-193]
(out)par-multi        up 2-00:00:00     48   idle host[146-193]
(out)high-mem         up 2-00:00:00     48   idle host[146-193]
(out)lotus_gpu        up 7-00:00:00     48   idle host[146-193]
(out)copy             up 7-00:00:00     48   idle host[146-193]
(out)cpom-comet       up 7-00:00:00     48   idle host[146-193]
(out)...
{{</command>}}
{{< alert type=""info"" >}}
Queues other than the standard queues `test` , `short-serial` ,
`long-serial`, `par-single`, `par-multi` and `high-mem` should be ignored
as they implement different job scheduling and control policies.
{{< /alert >}}
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#state-of-queues,1090,124
'sinfo' Output field description:,"By default, the Slurm command 'sinfo' displays the following information:
- **PARTITION** : Partition name followed by **\*** for the default queue/partition
- **AVAIL** : State/availability of a queue/partition. Partition state: up or down.
- **TIMELIMIT** : The maximum run time limit per job in each queue/partition is shown in TIMELIMIT in days- hours:minutes  :seconds . e.g. 2-00:00:00 is two days maximum runtime limit 
- **NODES** : Count of nodes with this particular configuration e.g. 48 nodes
- **STATE** : State of the nodes. Possible states include: allocated, down, drained, and idle. For example, the state ""idle"" means that the node is not allocated to any jobs and is available for use.
- **NODELIST** List of node names associated with this queue/partition
The `sinfo` example below, reports more complete information about the
partition/queue short-serial
{{<command>}}
sinfo --long --partition=short-serial
(out)Tue May 12 18:04:54 2020
(out)PARTITION    AVAIL TIMELIMIT JOB_SIZE  ROOT  OVERSUBS  GROUPS NODES    STATE NODELIST
(out)short-serial* up  1-00:00:00  1-infinite  no  NO    all     48  idle host[146-193]
{{</command>}}
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#'sinfo'-output-field-description:,1152,164
How to choose a Slurm queue/partition,,https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#how-to-choose-a-slurm-queue/partition,0,0
Test queue,"The `test` queue can be used to test new workflows and also to help new
users to familiarise themselves with the Slurm batch system. Both serial and
parallel code can be tested on the `test`queue. The maximum runtime is 4 hrs
and the maximum number of jobs per user is 8 job slots. The maximum number of
cores for a parallel job e.g. MPI, OpenMP, or multi-threads is limited to 8
cores. The `test`queue should be used when unsure of the job resource
requirements and behavior at runtime because it has a confined set of LOTUS
nodes (Intel node type) not shared with the other standard LOTUS queues.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#test-queue,599,108
Serial queues,"Serial and array jobs with a single CPU core should be submitted to one of the
following serial queues depending on the job duration and the memory
requirement. The default queue is `short-serial`
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#serial-queues,197,33
short-serial,"Serial and/or array jobs with a single CPU core each and run time less than 24
hrs should be submitted to the `short-serial` queue . This queue has the
highest priority of 30. The maximum number of jobs that can be scheduled to
start running from  the `short-serial` is 2000 jobs whilst  both job's
resources are available and user' priority is high
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#short-serial,350,62
long-serial,"Serial or array jobs with a single CPU core and run time greater than 24 hrs
and less than 168 hrs (7 days) should be submitted to the queue `long-serial`
.  This queue has the lowest priority of 10 and hence jobs might take longer
to be scheduled to run relatively to other jobs in higher priority queues.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#long-serial,307,58
high-mem,"Serial or array jobs with a single CPU core and high memory requirement (> 64
GB) should be submitted to the `high-mem` queue and the required memory must
be specified `--mem=XXX` (XXX is in MB units). The job should not exceed the
maximum run time limit of 48hrs. This queue is not configured to accept
exclusive jobs.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#high-mem,320,57
Parallel queues,"Jobs requiring more than one CPU core should be submitted to one of the
following parallel queues depending on the type of parallelisms such as shared
memory or distributed memory jobs.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#parallel-queues,186,31
par-single,"Shared memory multi-threaded jobs with  a maximum  of 16 threads should be
submitted to  the `par-single` queue . Each thread should be allocated one CPU
core. Oversubscribing the number of threads to the CPU cores will cause the
job to run very slow. The number of CPU cores should be specified via the
submission command line `sbatch -n <number of CPU cores>` or  by adding the
Slurm directive `#SBATCH -n <number of CPU cores>`in the job script file. An
example is shown below:
{{<command>}}
sbatch --ntasks=4 --partition=par-single < myjobscript
{{</command>}}
Note: Jobs submitted with a number of CPU cores greater than 16 will be
terminated (killed) by the Slurm scheduler with the following statement in the
job output file:
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#par-single,733,119
par-multi,"Distributed memory jobs with inter-node communication using the MPI library
should be submitted to  the `par-multi` queue . A single MPI process (rank)
should be allocated  a  single CPU core. The number of CPU cores should be
specified via the Slurm submission command  flag `sbatch -n <number of CPU
cores>` or  by adding the Slurm directive `#SBATCH -n <number of CPU cores>`
to  the job script file. An example is shown below:
{{<command>}}
sbatch --ntasks=4 --partition=par-multi < myjobscript
{{</command>}}
Note 1: The number of CPU cores gets passed from Slurm submission  flag `-n` .
Do not add  the `-np` flag  to `mpirun` command  .
Note 2: Slurm will reject a job that requires a number of CPU cores greater
than the limit of 256.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-queues#par-multi,743,124
What is a Job Scheduler?,"A job or batch scheduler, is a tool that manages how user jobs
are queued and run on a set of compute resources. In the case of LOTUS the
compute resources are the set of compute nodes that make up the [LOTUS hardware]({{< ref ""lotus-cluster-specification"" >}}). Each user can submit
jobs to the scheduler which then decides which jobs to run and where to
execute them. The scheduler manages the jobs to ensure that the compute
resources are being used efficiently and that users get appropriate access to
those resources.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#what-is-a-job-scheduler?,523,90
The Slurm Scheduler,"[Slurm](https://slurm.schedmd.com) is the job
scheduler deployed on JASMIN. It allows users to submit, monitor, and control
jobs on the LOTUS cluster.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#the-slurm-scheduler,151,21
General principles for working with Slurm,"Before learning how to use Slurm, it is worthwhile becoming familiar with the
basic principles of scheduler operation in order to get the best use out of
the LOTUS cluster. Scheduler software exists simply because the amount of jobs
that users wish to run on a cluster at any given time is usually greatly in
excess of the amount of resources available. This means that the scheduler
must queue jobs and work out how to run them efficiently.
Several factors are taken into account during scheduling, such as job duration
and size, but the basic principles remain the same throughout - every user
gets a fair share of the cluster based on the jobs that they have submitted.
This leads to a small number of important principles:
- Do not try to second guess the scheduler! Submit all of your jobs when you want to run them and let the scheduler figure it out for you. You will get a fair share, and if you don't then we need to adjust the scheduler (so get in touch and let us know).
- Give the scheduler as much information as possible. There are a number of optional parameters (see ""[How to submit jobs]({{< ref ""how-to-submit-a-job-to-slurm"" >}})"") such as job duration, and if you put these in then you have an even better chance of getting your jobs to run.
- It is very difficult for one user to monopolise the cluster, even if they submit thousands of jobs. The scheduler will still aim to give everyone else a fair share, so long as there are other jobs waiting to be run.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#general-principles-for-working-with-slurm,1480,270
Fair share for all users,"{{<image src=""img/docs/slurm-scheduler-overview/Screenshot-2023-02-20-at-21.32.28.png"" caption=""Example of scheduling"">}}
In the example above, three users (left column) have jobs in the queue (middle column)
which are waiting to run on the cluster (right column). As the blue user's job
finishes (middle row), all three users could potentially use the two job slots
that become available. However, the orange and purple users already have jobs
running, whereas the blue user does not, and as such it is the blue user's
jobs that are run (bottom row).
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#fair-share-for-all-users,552,81
LOTUS queues,"There are five standard Slurm queues (also known as ""partitions"" in Slurm terminology) for batch job submissions to the LOTUS
cluster: `short-serial`, `long-serial`, `par-single`, `par-multi` and `high-mem`.
The default queue is `short-serial`. For testing new workflows, the
additional queue `test`is recommended. The specification of each queue is
described in detail in this article: [Slurm queues on LOTUS]({{< ref ""slurm-queues"" >}})
Queues other than the five standard queues with the test queue should be
ignored unless you have been specifically instructed to use them.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#lotus-queues,578,83
The typical workflow for LOTUS jobs,"One of the great advantages of using JASMIN is the ability to create batch
jobs that run simultaneously on multiple LOTUS nodes. However, users familiar
with running interactively on a single machine often take time to adapt to
this new way of working. The change involves moving from a ""watching your job
run"" approach to ""submitting your job and coming back later"".
The typical workflow for setting up and running LOTUS jobs is as follows:
  1. Login to one of the [scientific analysis servers]({{< ref ""sci-servers"" >}}).
  2. Install/write/configure your processing code.
  3. Test your code interactively: run it locally in a single-process test case.
  4. Create a wrapper script for your code that allows multiple versions to run independently: e.g. running for different dates or processing different spatial regions/variables.
  5. [Submit your jobs]({{< ref ""how-to-submit-a-job-to-slurm"" >}}) via the batch script.
  6. [Monitor your jobs]({{< ref ""how-to-monitor-slurm-jobs"" >}}).
  7. Gather/analyse/review the outputs as required.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#the-typical-workflow-for-lotus-jobs,1045,154
Project-specific LOTUS queues,"Occasionally a project has a specific requirement for a collection of compute
nodes that involve the provision of a project-specific queue. If you are
working on such a project your project lead will provide guidance on which
queue to use. Please contact the helpdesk if
you are interested in setting up a project-specific queue.
",https://help.jasmin.ac.uk/docs/batch-computing/slurm-scheduler-overview#project-specific-lotus-queues,330,54
bbcp,"This article provides information about the bbcp data transfer tool.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp,69,10
What is bbcp?,"[bbcp](http://www.slac.stanford.edu/~abh/bbcp/) is a simple command-line tool
which can use your SSH connection to transfer data in and out of JASMIN
efficiently. It works in a similar way to [GridFTP over SSH]({{< ref ""gridftp-ssh-auth"" >}}) in that it connects to the transfer
server using your usual SSH credentials but then can set up parallel data
streams for transferring data. One advantage of `bbcp` that it is provided as
a single binary executable which is easy to download and use.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#what-is-bbcp?,493,78
Using bbcp on JASMIN,"Check with your local administrator to see if it is installed centrally on
your own system. If it isn't, you may need to download the correct binary from
the [bbcp download site](http://www.slac.stanford.edu/~abh/bbcp/bin/) and
simply place it in your path on your local filesystem: this can be done as a
regular/unprivileged user. At the JASMIN end, you can put the same executable
in your home directory (somewhere in your `$PATH` e.g. in your `~/bin`
directory, and make sure you give the file execute permission). Once you have
the `bbcp` command you can access any file which is readable by you when
logged into JASMIN, or write to a Group Workspace that you have access to.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#using-bbcp-on-jasmin,680,114
Configuring bbcp for JASMIN,"When contacting `hpxfer[12].jasmin.ac.uk` you will need to set a couple of
important options for it to work. The exact options depend on whether you are
moving data into or out of JASMIN, and from where the transfer is initiated.
The `bbcp` protocol, in common with most high-bandwidth transfer tools,
requires a set of ports to be open at one or both ends in order to establish
data connections. Due to firewall restrictions this range of ports needs to be
agreed in advance. In the case of `hpxfer[12].jasmin.ac.uk` the range of ports
is **50000:51000**. Therefore all `bbcp` commands must contain the option
`--port 50000:51000`.
Also, `hpxfer[12]` will only allow incoming connections on these ports,
therefore `hpxfer[12]` must be the server which listens for data connections.
By default `bbcp` will listen for data connections at the end receiving data
and connect from the end sending data. Therefore, with the default options,
`bbcp` will succeed when pushing data to `hpxfer[12]` but fail when pulling
data from it. In order to pull data, with the transfer initiated on the remote
server, you must include the `-z` flag. Therefore the recommended commands for
transferring in either direction are:
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#configuring-bbcp-for-jasmin,1208,193
Initiate on JASMIN: Pull Data from remote server,"{{<command user=""user"" host=""hpxfer1"">}}
bbcp -v -4 -P 5 -F --port 50000:51000 username@remote-server:<PATH-TO-SOURCE-FILE> <PATH-TO-TARGET-FILE>
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#initiate-on-jasmin:-pull-data-from-remote-server,161,14
Initiate on JASMIN: Push Data,"{{<command user=""user"" host=""hpxfer1"">}}
bbcp -v -4 -P 5 --port 50000:51000 <PATH-TO-SOURCE-FILE> username@remote-server:<PATH-TO-TARGET-FILE>
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#initiate-on-jasmin:-push-data,158,13
Initiate on remote server: Pull Data from JASMIN,"{{<command user=""user"" host=""remote"">}}
bbcp -v -z -4 -P 5 --port 50000:51000 username@hpxfer1.jasmin.ac.uk:<PATH-TO-SOURCE-FILE> <PATH-TO-TARGET-FILE>
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#initiate-on-remote-server:-pull-data-from-jasmin,167,14
Initiate on remote server: Push Data to JASMIN,"{{<command user=""user"" host=""remote"">}}
bbcp -v -4 -P 5 -F --port 50000:51000 <PATH-TO-SOURCE-FILE> username@hpxfer1.jasmin.ac.uk:<PATH-TO-TARGET-FILE>
{{</command>}}
In this case the `-v` flag produces verbose output .`-V` can be used for even
more verbose output. The `-4` option forces use of IP version 4 instead of
IPv6 (essential for transfers to and from `hpxfer1` or other JASMIN hosts.
Note: this option may not be available in some older versions of `bbcp`), and
the `-P` <n> option reports the status of the transfer every n seconds. The
default behaviour will print nothing. The `-F` option skips a check on the
target host to check if there is enough disk space. This overcomes occasional
problems where free space is not correctly reported to bbcp by the JASMIN file
system.
For the full set of options, see: <https://www.slac.stanford.edu/~abh/bbcp/>
Note: the `bbcp` command must be in your `$PATH` on both the source and target
machine.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#initiate-on-remote-server:-push-data-to-jasmin,954,148
"Initiate on JASMIN: Pull Data from remote server, specifying SSH command to start bbcp","{{<command user=""user"" host=""hpxfer1"">}}
bbcp -v -4 -P 5 -F --port 50000:51000 -S ""/usr/bin/ssh %I -l %U %H /path/to/bbcp"" username@remote-server:<PATH-TO-SOURCE-FILE> <PATH-TO-TARGET-FILE>
{{</command>}}
The path `/path/to/bbcp` can be replaced by `module load bbcp; bbcp` (or
whatever is the appropriate local requirement) in environments where `bbcp` is
a module which needs to be loaded first.
{{<command user=""user"" host=""hpxfer1"">}}
bbcp -v -4 -P 5 -F --port 50000:51000 -S ""/usr/bin/ssh %I -l %U %H module load bbcp; bbcp"" username@remote-server:<PATH-TO-SOURCE-FILE> <PATH-TO-TARGET-FILE>
{{</command>}}
For specifying the SSH command to start bbcp on the TARGET node, use the `-T`
option.
The [bbcp site](http://www.slac.stanford.edu/~abh/bbcp/) has good
documentation on further options, including the `-r` option for recursive
transfers. A number of useful tutorials are also available elsewhere on the
web.
","https://help.jasmin.ac.uk/docs/data-transfer/bbcp#initiate-on-jasmin:-pull-data-from-remote-server,-specifying-ssh-command-to-start-bbcp",919,120
Tuning Recommendations,"We recommend you tune your connection by trying various different options on a
few GBs of data.
1. By default 4 streams are opened. Try 1 stream first, particularly on fast connections, it may be faster. This is achieved with the option `-s 1`.
2. We ask users of JASMIN to tune up to a **maximum of 16 streams** (`-s 16`). If you believe you need to open more streams please contact the [JASMIN Helpdesk](mailto:support@jasmin.ac.uk).
3. Do not tune the window size unless you continue to get very poor bandwidth after adjusting the number of streams. Most modern operating systems will auto-tune this parameter.
4. `bbcp` is not ideal for large directory trees of small files. If you have thousands of small files you may be better off with rsync or possibly GridFTP/Globus, depending on the network. Another simpler option is tarring/zipping the data first before transferring.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#tuning-recommendations,881,147
Troubleshooting,"- `bbcp` uses SSH to establish the control connection so you need to set up your SSH key in the same way as you would to SSH into `hpxfer[12].jasmin.ac.uk`. If `bbcp` isn't working you should first check you can SSH to `hpxfer[12].jasmin.ac.uk`. If you can't, please review the steps in the [Getting Started](../getting-started/get-started-with-jasmin) section before contacting the [JASMIN Helpdesk](mailto:support@jasmin.ac.uk).
- Make that you have logged in (via SSH) to both the JASMIN transfer server and the remote server with the `-A` option (agent-forwarding enabled), to ensure that your credentials are used by SSH as it invokes `bbcp` on the other server.
- Try adding the `-F`option to disable `bbcp`'s filesystem checking if you get the following error:
bbcp: Insufficient space to copy all the files from <hostname>.
- If you see the following error message:
Address family not supported by protocol creating inet socket
this is most likely because the `-4` flag was not specified. This may happen with commands that once worked, as a previously installed version of `bbcp` on JASMIN defaulted to IPv4. Currently there is no support for IPv6 on JASMIN. If the version of `bbcp` you have available on your system is old and does not have the `-4` option, consider downloading the appropriate (newer) version from the link above. It is also possible to compile the executable from source.
",https://help.jasmin.ac.uk/docs/data-transfer/bbcp#troubleshooting,1402,224
Data transfer overview,"This article introduces the topic of data transfer to/from JASMIN.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview,67,10
Introduction to Data Transfer on JASMIN,"As a JASMIN user you are very likely to be involved in data transfer. You
might need to copy data files/directories from JASMIN to remote sites (such as
your own PC, MONSooN or ARCHER2) or bring new data on to JASMIN. These data
transfer articles explain how to use the basic [transfer tools]({{< ref ""data-transfer-tools"" >}}) such as `rsync` and `scp` as well as more sophisticated
methods such as GridFTP. They also cover which transfer services and servers
are available to JASMIN users.
For many users, moving small amounts of data over short distances, the basic
tools will meet their requirements. However, data transfer is a complicated
topic so we also provide articles about how you can improve your transfer
rates to make the most of the available bandwidth. We include details about
transfers over connections to specific sites (such as the Met Office). Advice
is also provided about automating and scheduling data transfers, along with
tips for different transfer workflows.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#introduction-to-data-transfer-on-jasmin,988,161
Transfers to/from JASMIN,,https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#transfers-to/from-jasmin,0,0
1\. Transfers initiated from JASMIN,"When initiating a transfer from a transfer server on JASMIN you would usually
start by logging on to the server (via SSH). Once you are logged in you can
initiate a connection to the outside world in order to push/pull the data you
require.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#1\.-transfers-initiated-from-jasmin,241,44
2\. Transfers initiated from elsewhere,"When initiating a transfer from elsewhere you will transfer data files to/from
a source machine (which may be inside or outside JASMIN) to the transfer
server.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#2\.-transfers-initiated-from-elsewhere,160,26
Transfer directories,"You will typically transfer data to/from a Group Workspace that you have been
granted access to. If you are copying data from JASMIN you might want to copy
data from the CEDA archive (mounted on JASMIN) to a remote site. You might
also wish to copy small volumes of data to/from your $HOME directory. All of
these locations are available on the transfer servers.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#transfer-directories,363,64
JASMIN Transfer servers,"JASMIN provides specific [servers for managing data transfers]({{< ref
""transfer-servers"" >}}). Please read about the different servers available for
particular data transfer needs, and about the various [data transfer
tools]({{< ref ""data-transfer-tools"" >}}) available.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#jasmin-transfer-servers,272,34
Improving your transfer rates,"To achieve better transfer rates, for large transfers or where speed and reliability are important, you are recommended to:
- use the {{<link ""globus-transfers-with-jasmin"">}}Globus data transfer service{{</link>}} (recommended), or
- use the high-performance data transfer servers ({{<link ""hpxfer-access-role"">}}hpxfer access role required{{</link>}})
- use other parallel-capable transfer tools such as bbcp, lftp (parallel-capable ftp client), or gridftp: see {{<link ""data-transfer-tools"">}}Data transfer tools{{</link>}}
Transfer rates depend on many factors, so try to consider all of these:
- **do you really need to transfer some/all of the data?**
  - is the data in the CEDA Archive already (don't copy it, if so, just process it in-place!)
  - can your workflow deal with processing just smaller ""chunks"" at a time (streaming)?
  - do you really need to have/keep all the source data, if it's stored somewhere else?
- **the network path all the way from where the source data resides, to the destination file system**
  - high-performance data transfer tools are great, but is the ""last mile"" over WiFi to your laptop?
  - what is the length of the network path? If it's international or intercontinental, SSH-based methods won't work well. Consider Globus.
- **the host at each end**
  - what sort of host is it (laptop, departmental server, virtual machine, physical machine) and what is its network connectivity?
- **the file systems at each end**
  - not all file systems perform the same, for given types of data or transfer methods
- **the size and number of files involved**
  - large numbers of small files can take a long time to transfer
  - are the data in deep directory trees? These can take a long time to recreate on the destination file system
  - consider creating a tar/zip archive to transfer fewer but larger files, or at least a method that copes well with many files in parallel or ""in flight"" at once.
- **checking data integrity**
  - some methods will verify data integrity at source and destination to ensure integrity. This can be resource-heavy and slow.
- **time of day**
  - would scheduling your transfer to happen at quieter times, mean that it completes more efficiently and/or without impacting others? Consider source and destination time zones!
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-overview#improving-your-transfer-rates,2293,364
Data Transfer Tools,"This article lists the data transfer tools available on JASMIN and provides
links to articles that describe them in more detail.
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-tools,129,21
Data Transfer tools,"The are many tools that you can use for transferring data to/from JASMIN. See
the articles linked below for more details.
Tool | Info
---|---
{{<link ""globus-transfers-with-jasmin"">}}Globus{{</link>}} | An efficient, secure data transfer service available to all JASMIN users **(recommended)**. Includes capability to schedule, repeat and orchestrate transfers between third-party hosts and receive notifications of job status. Has web and command-line interfaces. Efficient for moving large volumes and/or numbers of files, especially over long distances.
[scp]({{< ref ""rsync-scp-sftp"" >}}) |  A basic transfer tool that works over the SSH protocol. Similar to ""cp"" but copies between remote servers.  
[rsync (over SSH)]({{< ref ""rsync-scp-sftp"" >}})  |  Like scp but slightly more sophisticated. Allows synchronisation between remote directory trees.  
[sftp]({{< ref ""rsync-scp-sftp"" >}}) |  SSH FTP - works over SSH.  
[bbcp]({{< ref ""bbcp"" >}}) |  A command-line tool that allows the user to specify parallel transfer over multiple streams, using SSH authentication.
[GridFTP (over SSH)]({{< ref ""gridftp-ssh-auth"" >}}) |  An old but comprehensive data transfer tool. Highly configurable and able to transfer over multiple parallel streams. Used over SSH in this case. Superceded by {{<link ""globus-transfers-with-jasmin"">}}Globus{{</link>}}
[GridFTP (certificate-based)]({{< ref ""gridftp-cert-based-auth"" >}}) |  As above, but using certificate-based authentication instead of SSH credentials. Efficient for moving large volumes and/or numbers of files, especially over long distances.  Superceded by {{<link ""globus-transfers-with-jasmin"">}}Globus{{</link>}} 
[FTP]({{< ref ""ftp-and-lftp"" >}}) |  File Transfer Protocol. An aged transfer protocol suitable for small file transfers but limited.
[LFTP]({{< ref ""ftp-and-lftp"" >}}) |  Parallel-capable FTP client.  
wget, curl  |  Download tools for accessing resources over HTTP primarily. (see 3rd party documentation)
[sharing GWS data via http]({{< ref ""share-gws-data-via-http"" >}}) | for exposing part(s) of a Group Workspace via HTTP to users without JASMIN accounts.
Python transfer tools  |  Methods of managing/scripting data transfer tasks using Python. You can use libraries such as `requests` in a Python 3 virtual environment on the transfer servers.  
{{<link ""../mass/external-access-to-mass-faq"">}}MASS client (Met Office){{</link>}}|  A specific command-line tool installed on the mass-cli1.ceda.ac.uk server on JASMIN. Enables extractions from the Met Office MASS Archive directly on to OPeNDAP  |  A transfer protocol for extracting subsets of files from a remote server (over HTTP)  
[rclone]({{< ref ""rclone"" >}}) |  A 3rd party, open-source command-line utility which can interface to, and synchronise data between, a wide variety of cloud and other storage backends, such as Google Drive and AWS S3 compatible object stores. It can also sync data over SSH.   This utility is not installed on JASMIN but is well-documented and trivial for users to download and configure themselves on one of the [data transfer servers]({{< ref ""transfer-servers"" >}})) **Please note [install instructions](../rclone/#installing-rclone-for-yourself-on-jasmin), and [dos and don'ts](../rclone/#dos-and-donts) for rclone on JASMIN**.
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/data-transfer/data-transfer-tools#data-transfer-tools,3318,442
'ftp and lftp',"This article provides information about FTP (File Transfer Protocol) as a data
transfer tool. In particular:
- what is FTP?
- where and how can I use FTP on JASMIN?
- what are its limitations?
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp,193,35
What is FTP?,"[FTP](https://en.wikipedia.org/wiki/File_Transfer_Protocol) is a well-established
transfer protocol enabling connections from a client to download
files from, or upload files to, a server, although limited in security. A wide variety of client tools are
available to the user, 2 implementations of which are available on the JASMIN
transfer servers, although no server is provided. `ftp` is also the name of
the basic FTP client program, see below.
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp#what-is-ftp?,449,65
Where and how can I use FTP on JASMIN?,"FTP can only be used as a client on JASMIN, to pull data from external FTP
servers to local storage on JASMIN, for example a Group Workspace or your home
directory. **There is no FTP server within JASMIN providing the ability to
upload files to these locations.** Please use an alternative, more secure
method instead. See other [Data Transfer Tools]({{< ref ""data-transfer-tools"">}}) such as [scp/rsync/sftp]({{< ref ""rsync-scp-sftp"">}}), [bbcp]({{< ref ""bbcp"" >}}) or GridFTP ([over SSH]({{< ref ""gridftp-ssh-auth"" >}}), [certificate-based]({{< ref ""gridftp-cert-based-auth"" >}}) or using [Globus Online]({{< ref ""globus-transfers-with-jasmin"">}}))
On the [transfer servers]({{< ref ""transfer-servers"" >}}), you can use one of
the installed FTP clients to download data from elsewhere. These are:
- `ftp` basic ftp client. Usage details
- `lftp` parallel-capable ftp client. Usage details
CEDA however runs 2 FTP servers within the JASMIN environment providing
download-only access to the CEDA archive. Access to these is controlled by
your CEDA account and any dataset-specific privileges which are associated
with that account.
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp#where-and-how-can-i-use-ftp-on-jasmin?,1132,161
What are its limitations?,"- FTP was never designed as a secure protocol and has [several limitations](https://en.wikipedia.org/wiki/File_Transfer_Protocol#Security) affecting how it can be used safely within an environment like JASMIN.
- Some external sites offer anonymous FTP download. In this case, no username or password needs to be exchanged and (as long as the data resources do not need to be protected in any way) this can provide a simple but effective data transfer method.
- Few external sites now provide FTP access to protected data resources, hence many data-intensive institutions are now focussing on more sophisticated data delivery methods which can meet the demands of security and performance in a multi-user environment.
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp#what-are-its-limitations?,717,108
Basic client usage: ftp,"The `ftp` client is available on the transfer servers `xfer[123].jasmin.ac.uk`
Example 1: Downloading a file to a location on JASMIN from a remote FTP
server.
This involves setting up an interactive client session. Once logged in (in
this case, using anonymous FTP), you use FTP commands to interact with the
remote server and locate and download the data you require. The session is
terminated with `bye`.
{{<command user=""user"" host=""xfer1"">}}
ftp someserver.somesite.ac.uk
(out)Trying 123.456.78.123...
(out)Connected to someserver.somesite.ac.uk (123.456.78.123).
(out)220----------------------------------------------------------------------------
(out)220-Welcome message from somesite.ac.uk
(out)220----------------------------------------------------------------------------
(out)220 
(out)Name (123.456.78.123:username): anonymous
(out)331 Please specify the password.
(out)Password:
{{</command>}}
Once connected, the prompt changes to `ftp>`:
{{<command prompt=""ftp>"">}}
(out)230 Login successful.
Remote system type is UNIX.
(out)Using binary mode to transfer files.
cd /sites/pub/testdir/
(out)(out)(out)250-
250-This is the somesite ftp repository.
250-
(out)250 Directory successfully changed.
get md5.sum
(out)local: md5.sum remote: md5.sum
(out)227 Entering Passive Mode.
(out)150 Opening BINARY mode data connection for md5.sum (45 bytes).
(out)226 Transfer complete.
(out)45 bytes received in 0.00267 secs (16.83 Kbytes/sec)
bye
(out)221 Goodbye.
{{</command>}}
Full details of commands available within an interactive session with the
`ftp` client are available via the man page (`man ftp`).
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp#basic-client-usage:-ftp,1612,187
Parallel-capable client usage: lftp,"The alternative client `lftp` is less verbose, but the basic workflow is the
same.
{{<command user=""user"" host=""xfer1"">}}
lftp someserver.somesite.ac.uk
{{</command>}}
Once connected, the prompt changes to `lftp` and the name of the remote server:
{{<command prompt=""lftp someserver.somesite.ac.uk:~>"">}}
cd /sites/pub/testdir
(out)cd ok, cwd=/sites/pub/testdir/
get md5.sum
(out)45 bytes transferred
bye
{{</command>}}
The interactive shell provided by `lftp` also benefits from tab completion and
use of up/down arrows for command history.
In fact, lftp can also be used as an SFTP client, with the added benefit that
it can handle multiple SFTP transfers in parallel.
In the following example, we connect to a remote SFTP server using the `sftp://`
syntax. Once logged in to the remote server, the prompt changes and you can
enter lftp-specific commands like `mirror`, in this case with `-P 4` as the option
to use 4 `sftp` processes in parallel. Try other values but please consider
other users so a suggested limit is 16.
{{<command user=""user"" host=""xfer1"">}}
lftp sftp://username@someserver.somesite.ac.uk
Password: (enter password when prompted)
{{</command>}}
{{<command prompt=""lftp username@ftp.cnag.cat:~>"">}}
mirror -P 4 sourcedata
bye
{{</command>}}
Note that if you're connecting **_to_** a JASMIN transfer server in this way,
then you would need to make your JASMIN private key available in an ssh agent
locally, and you would not be prompted for the password.
",https://help.jasmin.ac.uk/docs/data-transfer/ftp-and-lftp#parallel-capable-client-usage:-lftp,1477,213
'Globus Command-Line Interface',"{{<alert type=""info"">}}
Updated for new JASMIN Default Collection (replaces previous JASMIN Globus Endpoint)
{{</alert>}}
Please read {{<link ""globus-transfers-with-jasmin""/>}} first for a wider introduction to Globus on JASMIN.
This article describes
- how to transfer data using the Globus Command Line Interface. It covers:
  - how an end-user can set up their host (laptop, desktop or home directory on their departmental server) with the Globus Command-Line Interface (CLI)
  - examples of common tasks using the CLI
It is not necessary to use the Globus CLI on a JASMIN server: it is a tool
that you can use anywhere (for example your own desktop/laptop) to interact
with the Globus service, to orchestrate a transfer between 2 endpoints (collections, in new Globus terminology). The
CLI is not centrally installed on JASMIN, and does not need to be in the same
place as either of the 2 collections involved in the transfer. You could use the CLI on your own
laptop/desktop, even if the 2 collections were 2 institutional Globus collections
on opposite sides of the world. You could of course decide to install the CLI
in your home directory on JASMIN if that were useful as part of your
processing/data transfer workflow.
The [Globus CLI is fully documented here](https://docs.globus.org/cli/) with
[examples](https://docs.globus.org/cli/examples/). It provides a command-line
interface for managed transfers via the Globus cloud-based transfer service,
which usually achieves the best possible transfer rate over a given route
compared to other methods. Typically this will be significantly faster than
can be achieved over scp, rsync or sftp transfers, particularly if the
physical network path is long.
The Globus CLI is designed for use either interactively within an interactive
shell or in scripts. An alternative [Python software development kit
(SDK)](https://globus-sdk-python.readthedocs.io/en/stable/) is also available
and should be considered for more sophisticated workflows.
Alternatively, the Globus web interface at <https://app.globus.org> can be
used as an easy-to-use interface to orchestrate transfers interactively.
Whichever method is used: CLI, SDK or web interface, transfers are invoked as
asynchronous, managed tasks which can then be monitored, and if need be set to
retry automatically until some pre-set deadline.
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface,2351,347
Prerequisites,"- Linux environment with normal user privileges, **or**
- Mac environment with ability to install applications, **or**
- Windows environment with ability to install applications
- Python environment for that platform, with ability to create virtual environments (to enable installation of additional packages)
- For use of the JASMIN Default Collection: 
  - An active JASMIN user account, with “jasmin-login” role
- You may also wish to [set up your own Globus endpoint using Globus Connect Personal]({{< ref ""globus-connect-personal"" >}}), though this is not needed for these examples.
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#prerequisites,588,87
Initial Setup,,https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#initial-setup,0,0
Get a Globus identity,"Go to https://app.globus.org and either:
- choose one of the listed identity providers (e.g. GitHub, Google, ...)
- follow the link at the bottom to ""use Globus ID to sign in""
See also https://docs.globus.org/how-to/get-started/
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#get-a-globus-identity,229,34
Set up the Globus CLI on your machine,"Do the following on your own (local) machine.
Make a Python virtual environment and activate it:
{{<command host=""localhost"" user=""localuser"">}}
python3 -m venv ./venv
source ./venv/bin/activate
{{</command>}}
Download the Globus CLI and install it into the virtual environment ( `venv`).
{{<command host=""localhost"" user=""localuser"">}}
pip install globus-cli
{{</command>}}
Try the `globus login` command. The first time you run this, you will be
prompted to authorise the Globus CLI to carry out operations on behalf of your
Globus ID. The URL will open in your default browser, where you should
authenticate with your Globus ID credentials. If you prefer, you can
copy/paste the URL from the command-line to a browser of your choice. Either
way, you then need to click ""Allow"" in the browser window, then copy/paste the
resulting ""Native App Authorization Code"" back to the terminal window where
you issued the `globus login` command:
{{<command host=""localhost"" user=""localuser"">}}
globus login --no-local-server
(out)Please authenticate with Globus here:
(out)------------------------------------
(out)https://auth.globus.org/v2/oauth2/authorize?client_id=abc1234-9c3c-4ad42-be31-8d6c87101239014&redirect_uri=https%3A%2F%2Fauth.globus.org%2Fv2%2Fweb%2Fauth-code&scope=openid+profile+email+urn%3Aglobus%3Aauth%3Ascope%3Aauth.globus.org%3Aview_identity_set+urn%3Aglobus%3Aauth%3Ascope%3Atransfer.api.globus.org%3Aall+urn%3Aglobus%3Aauth%3Ascope%3Agroups.api.globus.org%3Aall+urn%3Aglobus%3Aauth%3Ascope%3Asearch.api.globus.org%3Aall&state=_default&response_type=code&access_type=offline&prompt=login
(out)------------------------------------ 
(out)Enter the resulting Authorization Code here:
{{</command>}}
You should then see the following:
{{<command>}}
(out)You have successfully logged in to the Globus CLI!
(out)
(out)You can check your primary identity with
(out)  globus whoami
(out)
(out)For information on which of your identities are in session use
(out)  globus session show
(out)Logout of the Globus CLI with
(out)  globus logout
{{</command>}}
You can now use the Globus CLI commands as listed by the following command:
{{<command>}}
globus  --help
(out)  Usage: globus [OPTIONS] COMMAND [ARGS]...
(out)  
(out)    Interact with Globus from the command line
(out)  
(out)    All `globus` subcommands support `--help` documentation.
(out)  
(out)    Use `globus login` to get started!
(out)  
(out)    The documentation is also online at https://docs.globus.org/cli/
(out)  
(out)  Options:
(out)    -v, --verbose                  Control level of output
(out)    -h, --help                     Show this message and exit.
(out)    -F, --format [unix|json|text]  Output format for stdout. Defaults to text
(out)    --jmespath, --jq TEXT          A JMESPath expression to apply to json
(out)                                    output. Takes precedence over any specified '
(out)                                    --format' and forces the format to be json
(out)                                    processed by this expression
(out)    --map-http-status TEXT         Map HTTP statuses to any of these exit codes:
(out)                                    0,1,50-99. e.g. ""404=50,403=51""
(out)  
(out)  Commands:
(out)    bookmark        Manage endpoint bookmarks
(out)    collection      Manage your Collections
(out)    delete          Submit a delete task (asynchronous)
(out)    endpoint        Manage Globus endpoint definitions
(out)    get-identities  Lookup Globus Auth Identities
(out)    group           Manage Globus Groups
(out)    list-commands   List all CLI Commands
(out)    login           Log into Globus to get credentials for the Globus CLI
(out)    logout          Logout of the Globus CLI
(out)    ls              List endpoint directory contents
(out)    mkdir           Create a directory on an endpoint
(out)    rename          Rename a file or directory on an endpoint
(out)    rm              Delete a single path; wait for it to complete
(out)    search          Use Globus Search to store and query for data
(out)    session         Manage your CLI auth session
(out)    task            Manage asynchronous tasks
(out)    transfer        Submit a transfer task (asynchronous)
(out)    update          Update the Globus CLI to its  latest version
(out)    version         Show the version and exit
(out)    whoami          Show the currently logged-in identity
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#set-up-the-globus-cli-on-your-machine,4417,503
Examples,"  1. **Find an endpoint (aka collection)**
We will use the `globus endpoint search` subcommand. Find help on the
particular options for that with
{{<command>}}
globus endpoint search --help
(out)Usage: globus endpoint search [OPTIONS] [FILTER_FULLTEXT]
(out)
(out)  Search for Globus endpoints with search filters. If --filter-scope is set to
(out)  the default of 'all', then FILTER_FULLTEXT is required.
(out)
(out)  If FILTER_FULLTEXT is given, endpoints which have attributes (display name,
(out)  legacy name, description, organization, department, keywords) that match the
(out)  search text will be returned. The result size limit is 100 endpoints.
(out)
(out)Options:
(out)  --filter-scope [all|administered-by-me|my-endpoints|my-gcp-endpoints|recently-used|in-use|shared-by-me|shared-with-me]
(out)                                  The set of endpoints to search over.
(out)                                  [default: all]
(out)  --filter-owner-id TEXT          Filter search results to endpoints owned by
(out)                                  a specific identity. Can be the Identity ID,
(out)                                  or the Identity Username, as in
(out)                                  ""go@globusid.org""
(out)  --limit INTEGER RANGE           The maximum number of results to return.
(out)                                  [default: 25; 1<=x<=1000]
(out)  -v, --verbose                   Control level of output
(out)  -h, --help                      Show this message and exit.
(out)  -F, --format [unix|json|text]   Output format for stdout. Defaults to text
(out)  --jmespath, --jq TEXT           A JMESPath expression to apply to json
(out)                                  output. Takes precedence over any specified
(out)                                  '--format' and forces the format to be json
(out)                                  processed by this expression
(out)  --map-http-status TEXT          Map HTTP statuses to any of these exit
(out)                                  codes: 0,1,50-99. e.g. ""404=50,403=51""
{{</command>}}
Search for the collections matching the search term ""tutorial"":
{{<command>}}
globus endpoint search ""tutorial""
(out)ID                                   | Owner                                                        | Display Name                                  
(out)------------------------------------ | ------------------------------------------------------------ | ----------------------------------------------
(out)6c54cade-bde5-45c1-bdea-f4bd71dba2cc | 6df1b656-c953-40a3-91a9-e9e8ad5173ea@clients.auth.globus.org | Globus Tutorial Collection 1                  
(out)31ce9ba0-176d-45a5-add3-f37d233ba47d | 6df1b656-c953-40a3-91a9-e9e8ad5173ea@clients.auth.globus.org | Globus Tutorial Collection 2 
{{</command>}}
The 2 globus tutorial collections actually ""see"" the same filesystem, so we'll
just use the first one.
For convenience, let's set environment variables representing the ID of this collection:
{{<command>}}
export c1=6c54cade-bde5-45c1-bdea-f4bd71dba2cc
echo $c1
(out)6c54cade-bde5-45c1-bdea-f4bd71dba2cc
{{</command>}}
Let's try listing that collection, so that we know we can interact with it. We are prompted to grant consent first:
{{<command>}}
globus ls $c1
(out)The collection you are trying to access data on requires you to grant consent for the Globus CLI to access it.
(out)
(out)Please run:
(out)
  (out)globus session consent 'urn:globus:auth:scope:transfer.api.globus.org:all[*https://auth.globus.org/scopes/6c54cade-bde5-45c1-bdea-f4bd71dba2cc/data_access]'
(out)
(out)to login with the required scopes.
{{</command>}}
Copy & paste the command it gives you (don't copy the one above) and run it, which should open a web browser window. Follow the instructions which should complete the process, then return to your terminal session.
Now let's find another collection, this time a public test collection which can be used for performance testing:
{{<command>}}
globus endpoint search ""star dtn""
(out)ID                                   | Owner              | Display Name                                     
(out)------------------------------------ | ------------------ | -------------------------------------------------
(out)ff2ee779-54fb-4dac-ade2-57568c587ae3 | esnet@globusid.org | ESnet STAR DTN private collection                
(out)ece400da-0182-4777-91d6-27a1808f8371 | esnet@globusid.org | ESnet Starlight DTN (Anonymous read only testing)
(out)e9e0d9f4-c419-44e0-8198-017fd61bf0c4 | esnet@globusid.org | ESnet Starlight DTN (read-write testing)  
{{</command>}}
We'll use the one labelled {{< mark >}}Anonymous read only testing{{</mark>}}.
Set `stardtn` to the ID of this endpoint:
{{<command>}}
export stardtn=ece400da-0182-4777-91d6-27a1808f8371
{{</command>}}
{{<alert type=""info"">}}
None of the endpoints mentioned so far require **authentication** in
order to use them. This makes demonstrating basic functionality simpler, but
we'll look at how to use one that does, later.
{{</alert>}}
  2. **Listing files at a path on an collection**
Use the `endpoint ls` command to list the contents of the `stardtn` endpoint,
at the path `/`
{{<command>}}
globus ls $stardtn:/
(out)500GB-in-large-files/
(out)50GB-in-medium-files/
(out)5GB-in-small-files/
(out)5MB-in-tiny-files/
(out)Climate-Huge/
(out)Climate-Large/
(out)Climate-Medium/
(out)Climate-Small/
(out)bebop/
(out)logs/
(out)write-testing/
(out)100G.dat
(out)100M.dat
(out)10G.dat
(out)10M.dat
(out)1G.dat
(out)1M.dat
(out)500G.dat
(out)50G.dat
(out)50M.dat
{{</command>}}
These are files and directories containing dummy data which can be used for
test purposes.
  3. **Copy a file from one endpoint to another**
Let's transfer the file `1M.dat` from the `stardtn` endpoint to `c1`:
{{<command>}}
globus transfer $stardtn:/1M.dat $c1:/~/1M.dat
(out)Message: The transfer has been accepted and a task has been created and queued for execution
(out)Task ID: 74cb181c-bf63-11ee-a90e-032e06ca0965
{{</command>}}
The transfer task is a separate activity and does not require any connection
from the CLI client to either of the 2 endpoints: the Globus transfer service
manages the transfer for us. We can check on the progress of this transfer
task with:
{{<command>}}
globus task show 74cb181c-bf63-11ee-a90e-032e06ca0965
(out)Label:                        None
(out)Task ID:                      74cb181c-bf63-11ee-a90e-032e06ca0965
(out)Is Paused:                    False
(out)Type:                         TRANSFER
(out)Directories:                  0
(out)Files:                        1
(out)Status:                       SUCCEEDED
(out)Request Time:                 2024-01-30T11:33:58+00:00
(out)Faults:                       0
(out)Total Subtasks:               2
(out)Subtasks Succeeded:           2
(out)Subtasks Pending:             0
(out)Subtasks Retrying:            0
(out)Subtasks Failed:              0
(out)Subtasks Canceled:            0
(out)Subtasks Expired:             0
(out)Subtasks with Skipped Errors: 0
(out)Completion Time:              2024-01-30T11:34:01+00:00
(out)Source Endpoint:              ESnet Starlight DTN (Anonymous read only testing)
(out)Source Endpoint ID:           ece400da-0182-4777-91d6-27a1808f8371
(out)Destination Endpoint:         Globus Tutorial Collection 1
(out)Destination Endpoint ID:      6c54cade-bde5-45c1-bdea-f4bd71dba2cc
(out)Bytes Transferred:            1000000
(out)Bytes Per Second:             421388
{{</command>}}
We can also list the destination collection to check that the file has reached
its destination:
{{<command>}}
globus ls $c1:/~/
(out)  1M.dat
{{</command>}}
We can also make a subdirectory with `mkdir`:
{{<command>}}
globus mkdir $c1:/~/mydata/
(out)    The directory was created successfully
{{</command>}}
We can move our `1M.dat` into that directory with a `globus rename` command
{{<command>}}
globus rename $c1 /~/1M.dat /~/mydata/1M.dat
(out)    File or directory renamed successfully
{{</command>}}
We now have a directory `mydata` containing files `1M.dat`:
{{<command>}}
globus ls $c1:/~/mydata/
(out)    1M.dat
{{</command>}}
  4. **Recursively copy a directory and its contents, from one endpoint to another**
Now Let's copy a directory from the `stardtn` collection which contains some small
files, to our destination endpoint `c1` (The Globus tutorial collections only
provide very limited storage space).
The files we want to copy are at the path `/5MB-in-tiny-files/a/a/` on
the `stardtn` endpoint, and are small, as their names suggest:
{{<command>}}
globus ls $stardtn:/5MB-in-tiny-files/a/a/
(out)a-a-1KB.dat
(out)a-a-2KB.dat
(out)a-a-5KB.dat
{{</command>}}
Copy the parent directory recursively to `ep1`:
{{<command>}}
globus transfer -r $stardtn:/5MB-in-tiny-files/a/a $c1:/~/star-data
(out)Message: The transfer has been accepted and a task has been created and queued for execution
(out)Task ID: 4ae9bab0-7d40-11ec-bef3-a18800fa5978
{{</command>}}
Check destination content:
{{<command>}}
globus ls $c1
(out)mydata1/
(out)star-data/
(out)
globus ls $c1:/~/star-data
(out)a-a-1KB.dat
(out)a-a-2KB.dat
(out)a-a-5KB.dat
{{</command>}}
We could now delete one of the small files using the `globus delete` command:
{{<command>}}
globus delete $c1:/~/star-data/a-a-2KB.dat
(out)Message: The delete has been accepted and a task has been created and queued for execution
(out)Task ID: be4d6934-7d40-11ec-891f-939ceb6dfaf1
{{</command>}}
And list contents again, to verify that it has been deleted:
{{<command>}}
globus ls $c1:/~/star-data
(out)a-a-1KB.dat
(out)a-a-5KB.dat
{{</command>}}
  5. **Sync a source directory to a target (repeatable)**
We could now repeat the copying of the source data, but this time using the
`-s` or `--sync-level exists` command so that we only copy the data that is
now missing from the destination. The full set of sync options is
`[exists|size|mtime|checksum]`.
{{<command>}}
globus transfer -s exists -r $stardtn:/5MB-in-tiny-files/a/a $c1:/~/star-data
(out)Message: The transfer has been accepted and a task has been created and queued for execution
(out)Task ID: 759a3cac-7d41-11ec-bef3-a18800fa5978
{{</command>}}
This should only copy the data that do not already exist at the desination: We
end up with the same set of files at the destination:
{{<command>}}
globus ls $c1:/~/star-data
(out)a-a-1KB.dat
(out)a-a-2KB.dat
(out)a-a-5KB.dat
{{</command>}}
But we can see that only 2000 bytes were transferred (so we know it only
copied that one file, which is what we wanted):
{{<command>}}
globus task show 759a3cac-7d41-11ec-bef3-a18800fa5978
(out)Label:                        None
(out)Task ID:                      759a3cac-7d41-11ec-bef3-a18800fa5978
(out)Is Paused:                    False
(out)Type:                         TRANSFER
(out)Directories:                  1
(out)Files:                        3
(out)Status:                       SUCCEEDED
(out)Request Time:                 2022-01-24T18:14:24+00:00
(out)Faults:                       0
(out)Total Subtasks:               5
(out)Subtasks Succeeded:           5
(out)Subtasks Pending:             0
(out)Subtasks Retrying:            0
(out)Subtasks Failed:              0
(out)Subtasks Canceled:            0
(out)Subtasks Expired:             0
(out)Subtasks with Skipped Errors: 0
(out)Completion Time:              2022-01-24T18:14:58+00:00
(out)Source Endpoint:              ESnet Starlight DTN (Anonymous read only testing)
(out)Source Endpoint ID:           ece400da-0182-4777-91d6-27a1808f8371
(out)Destination Endpoint:         Globus Tutorial Collection 1
(out)Destination Endpoint ID:      6c54cade-bde5-45c1-bdea-f4bd71dba2cc
(out)Bytes Transferred:            2000
(out)Bytes Per Second:             60
{{</command>}}
This task could be repeated in a shell script, cron job or even using the
Globus timer functionality, for either a source or destination directory that
is expected to change.
  6. **Interact with a collection that requires authentication**
Most Globus Connect Server endpoints are configured to require some form of authentication & authorization process. 
In the case of the JASMIN Default Collection, you link your Globus identity to your JASMIN identity.
This may be different for other collections that you use elsewhere.
Let's find, then set up an alias to the JASMIN Default Collection Endpoint. We can search for that name:
{{<command>}}
globus endpoint search ""jasmin default""
(out)ID                                   | Owner                                                        | Display Name
(out)------------------------------------ | ------------------------------------------------------------ | -------------------------
(out)a2f53b7f-1b4e-4dce-9b7c-349ae760fee0 | a77928d3-f601-40bb-b497-2a31092f8878@clients.auth.globus.org | JASMIN Default Collection
{{</command>}}
Set up an alias for this collection:
{{<command>}}
export jdc=a2f53b7f-1b4e-4dce-9b7c-349ae760fee0
{{</command>}}
If you've already interacted with this collection recently, you should find that you can list
it with the CLI already. If not, you will be prompted to authenticate. Follow through all the
steps until you complete the process, then return to the terminal session.
If successful, you can now interact with the JASMIN endpoint, for example
listing your home directory:
{{<command>}}
globus ls $jdc:/~/
(out)...
(out)(file listing of your JASMIN home directory)
(out)...
{{</command>}}
The authentication via your JASMIN account lasts for 30 days, so you can run and re-run transfers during that period without
needing to repeat the process (hence without any human interaction, if you have scheduled/automated transfers, see below).
If this needs to be renewed, then:
the simple way to do this is to either:
- (manually) visit the Globus web interface and access the JASMIN Default Collection again
- (manuall) use the CLI to list the collection again
In either case, if the authentication has timed out, you will be prompted to follow instructions to renew it,
then the action (listing the directory) should complete successfully.
There are ways to do use a ""refresh token"" programatically to renew the authentication. Watch this space for 
details of how to do that (or f)
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#examples,14187,1593
Automation,"The functionality demonstrated above can be combined into scripts which can perform
useful, repeatable tasks such as:
- recursively syncing the contents of directories between 2 endpoints
Globus provide 2 implementations of this here:
[Examples of automation using the Globus CLI](https://github.com/globus/automation-examples), specifically:
- [cli-sync.sh](https://github.com/globus/automation-examples/blob/master/cli-sync.sh) : bash script using the Globus CLI as demonstrated above
- [globus_folder_sync.py](https://github.com/globus/automation-examples/blob/master/globus_folder_sync.py) : Python code using the Globus Python Software Development Kit (SDK)
We have not covered the Python SDK here, but this is a useful example of how you could integrate Globus transfer functionality into your own code and workflows. You would need to install and authorise this SDK first.
Taking the first of these examples, we can adapt it slightly:
1\. Select the JASMIN endpoint at the destination, and set the destination
path. Modify the corresponding variables in the script to these values:
{{<command>}}
DESTINATION_COLLECTION='a2f53b7f-1b4e-4dce-9b7c-349ae760fee0' ##JASMIN Default Collection ID
DESTINATION_PATH='/home/users/<username>/sync-demo/' ##replace <username> with your JASMIN username
{{</command>}}
{{<alert type=""info"">}}
For **STFC users only** where the other collection in the transfer is within the STFC network, an additional collection is provided [""JASMIN STFC Internal Collection""](https://app.globus.org/file-manager/collections/591d44ac-adbb-43db-9931-977708d07450/overview) and has ID `9efc947f-5212-4b5f-8c9d-47b93ae676b7`.
{{</alert>}}
2\. If you haven't already, activate the Python virtual environment where you
have the CLI installed, and login:
{{<command>}}
source ~/.globus-cli-venv/bin/activate
globus login
{{</command>}}
3\. Check that you can interact with the JASMIN collection from the CLI, by trying to list it
Follow any instructions needed, if you need to renew your authentication.
4\. Run the script to sync the data from the Globus Tutorial Endpoint to the
destination directory.
You should see output similar to that shown below.
{{<command>}}
./cli-sync.sh
(out)Checking for a previous transfer
(out)Last transfer f5db7238-8f06-11ec-8fe0-dfc5b31adbac SUCCEEDED, continuing
(out)Verified that source is a directory
(out)Submitted sync from 6c54cade-bde5-45c1-bdea-f4bd71dba2cc:/share/godata/ to a2f53b7f-1b4e-4dce-9b7c-349ae760fee0:/~/sync-demo/
(out)Link:
(out)https://app.globus.org/activity/04e277f4-8f07-11ec-811e-493dd0cf73a1/overview
(out)Saving sync transfer ID to last-transfer-id.txt
{{</command>}}
5\. Check on the status of the task. You could do this by
- following the URL to https://app.globus.org to view the task under ""activities"", or
{{<command>}}
globus task show <taskid>
{{</command>}}
6\. You could then make some change to either source or destination directory,
and simply re-run the script
{{<command>}}
./cli-sync.sh
{{</command>}}
7\. Experiment by changing the `SYNCTYPE`. Other options are:
See [here for descriptions of the available sync levels](https://docs.globus.org/cli/reference/transfer/#sync_levels):
- `EXISTS`
- `SIZE`
- `MTYPE`
- `CHECKSUM`
8\. Automating repeats of the sync operation
You could then consider how to repeat the task automatically. For example:
- **triggering** a re-run of the `cli-sync.sh` command according to some condition that's met in your workflow.
- **scheduling** the running of the `cli-sync.sh` command on your own machine using cron on your own machine.
  - Remember: the invocation of the command does NOT need to be done on JASMIN, it can be done wherever you have the CLI installed, for example your local machine.
- use the web interface (go to ""Transfer & Timer Options"") to configure repeating tasks initiated there.
- Learn about how to [use timers with Globus](https://www.globus.org/blog/globus-now-supports-recurring-and-scheduled-transfers): these can be set up using the web interface or using an additional CLI [globus-timer-cli](https://pypi.org/project/globus-timer-cli/) which can be installed into the same `virtualenv` as the main globus cli.
- Learn about [Globus Flows](https://docs.globus.org/api/flows/) to create fully automated workflows. Globus have created a number of pre-canned workflow actions (e.g. ""make directory"", ""transfer"", ""delete"", ..) which you can chain together in your own workflow, or combine with your own to create custom workflows. A useful example might be:
  - watching a directory for arrival/creation of a certain file
  - triggering a compute/analysis step on files in the directory (using a [Globus Compute](https://www.globus.org/compute) endpoint of your own?)
  - transferring the output of that analysis to elsewhere, and cleaning up
",https://help.jasmin.ac.uk/docs/data-transfer/globus-command-line-interface#automation,4804,602
Introduction,"This article describes how to create your own Globus collection using Globus Connect Personal.
Please read {{<link ""globus-transfers-with-jasmin""/>}} first for a wider introduction to Globus.
Using {{<link ""https://www.globus.org/globus-connect-personal"">}}Globus Connect Personal (GCP){{</link>}} would enable you to transfer files to/from another Globus collection using
any of the Globus Online transfer tools ([Web app](https://app.globus.org),
[CLI](https://docs.globus.org/cli/) or [Python SDK](https://globus-sdk-python.readthedocs.io/en/stable/)).
The term ""endpoint"" has changed meaning with version 5 of Globus, so users now interact with ""collections"". 
but see {{<link ""https://docs.globus.org/cli/collections_vs_endpoints/#:~:text=The%20Endpoint%20is%20used%20for%20some%20operations%20like%20collection%20listing,management%20capabilities%20and%20data%20transfers."">}}Endpoints vs Collections{{</link>}} for a fuller explanation of these entities.
For example, if you set up GCP on your desktop/laptop, you could transfer data files to/from your home directory or
other storage on JASMIN.
{{<alert type=""info"">}}
- You may not need to do this if your institution already has a Globus endpoint available to you.
- You should NOT install this on a JASMIN server, as a Globus endpoint is already provided for you.
- If you plan to install it in your user area on your departmental server, check with your local IT administrator whether that's an OK thing to do. Point them at the relevant Globus documentation but note that you should be able to do the install with regular/user privileges and that the software does not usually need to be left running: it can be started for the duration of any data transfer tasks, then stopped once they have completed.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/data-transfer/globus-connect-personal#introduction,1780,229
Set up Globus Connect Personal on end-user machine,"Installers are available for Linux, Mac and Windows operating systems:  
- Linux (command-line) <https://docs.globus.org/how-to/globus-connect-personal-linux/#globus-connect-personal-cli>
- Mac <https://docs.globus.org/how-to/globus-connect-personal-mac/>
- Windows <https://docs.globus.org/how-to/globus-connect-personal-windows/>
The instructions below show the process for Linux (command-line):
These commands should be executed on YOUR OWN MACHINE (not JASMIN):
{{<command>}}
wget https://downloads.globus.org/globus-connect-personal/linux/stable/globusconnectpersonal-latest.tgz
tar xzf globusconnectpersonal-latest.tgz
{{</command>}}
This will produce a versioned globusconnectpersonal directory
Replace `x.y.z` in the line below with the version number you see
{{<command>}}
cd globusconnectpersonal-x.y.z
./globusconnectpersonal
{{</command>}}
(see links above for details of how to install without the graphical user interface, if you need to)
Complete the installation using the setup key. If a graphical environment is
detected, a window will appear, to guide you through the steps. If not, text
prompts will appear.
**(Please see the relevant installation guide for your platform, linked above,
for further details)**
",https://help.jasmin.ac.uk/docs/data-transfer/globus-connect-personal#set-up-globus-connect-personal-on-end-user-machine,1230,132
Start Globus Connect Personal (Linux),"{{<command>}}
./globusconnectpersonal -start
{{</command>}}
If you use the web application at <https://app.globus.org>, you should now be
able to see your GCP endpoint listed under ""Collections"" when you filter by
""Administered by you"". You can now try listing the files on it and
perhaps transferring a file to/from one of the Globus Tutorial endpoints using
the web interface.
The setup process will have prompted you for a name for your endpoint. It is
assigned a unique ID, too.
**If you have the Globus Command-Line Interface installed** ([see here]({{<ref ""globus-command-line-interface"" >}})), you can find
the ID of your own endpoint with the CLI command:
{{<command>}}
globus endpoint search <name> --filter-owner-id <your globus id>
{{</command>}}
If successful, you should now be able to interact with your endpoint via any
of the Globus tools (web app, CLI and Python SDK).
For example, you could list the files on the endpoint:
{{<command>}}
globus ls <endpoint_id>:<path>
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/globus-connect-personal#start-globus-connect-personal-(linux),1001,151
Set directory permissions,"**Don't forget** to configure which directory paths on your system can be accessed by GCP. By default these may NOT be accessible, so you need to allow access.
- Windows: GCP icon in taskbar, then Options / Access
- Mac: menu bar icon / Preferences / Access
- Linux: by editing the config file `~/.globusonline/lta/config-paths`, see {{<link ""https://docs.globus.org/globus-connect-personal/install/linux/#config-paths"">}}here{{</link>}} for syntax.",https://help.jasmin.ac.uk/docs/data-transfer/globus-connect-personal#set-directory-permissions,449,60
Globus transfers with JASMIN,"This article describes how to do data transfers using JASMIN's **new** Globus
endpoint (now called a **collection** ), based on the most recent version of
[Globus Connect Server](https://www.globus.org/globus-connect-server).
JASMIN's old Globus endpoint, based on
the previous version of the Globus service, ceased operating on 18
December 2023 as support was discontinued by Globus. We have implemented a
new endpoint, based on Globus Connect Server v5.4, with equivalent (but better!)
functionality.
The new collection can be used as a drop-in replacement for the previous
endpoint, aside from a few differences in terminology, and a change to the
authentication process.
",https://help.jasmin.ac.uk/docs/data-transfer/globus-transfers-with-jasmin,675,98
Main differences,"There are some differences to how the new (v5) version of Globus works on JASMIN compared to previously:
- Users now interact with a **collection**
  - **Most users**: please use [""JASMIN Default Collection""](https://app.globus.org/file-manager/collections/a2f53b7f-1b4e-4dce-9b7c-349ae760fee0/overview) with ID `a2f53b7f-1b4e-4dce-9b7c-349ae760fee0`
  - For **STFC users only** where the other collection (either {{<link ""globus-connect-personal"">}}GCP{{</link>}} or {{<link ""https://www.globus.org/globus-connect-server"">}}GCS{{</link>}}) is within STFC, an additional collection is provided [""JASMIN STFC Internal Collection""](https://app.globus.org/file-manager/collections/591d44ac-adbb-43db-9931-977708d07450/overview) and has ID `9efc947f-5212-4b5f-8c9d-47b93ae676b7`.
- You now use the JASMIN Accounts Portal to authenticate (using your JASMIN account credentials) via OpenID Connect (OIDC). 
- During the authentication process, you are redirected to the JASMIN Accounts Portal to link your Globus identity with your JASMIN account.
- Consent needs to be granted at a number of points in the process to allow the Globus service to carry out actions on your behalf.
- The default lifetime of the authentication granted to your JASMIN account is now **30 days**. After this, you may need to refresh the consent for your ""session"".
- This service is now available to **all** users of JASMIN: you no longer need to hold the `hpxfer` access role.
The following examples show you how to authenticate with the new JASMIN
Default Collection and list the contents of your home directory. As before,
however, the following file systems are available via this collection
File system  |  Access  
---|---  
`$HOME` (`/home/users/<username>`)  |  Read-write  
`/gws` (group workspaces)  |  Read-write  
`/work/xfc` (transfer cache)  |  Read-write  
`/badc` (CEDA Archive)  
`/neodc` |  Read-only  |  
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/data-transfer/globus-transfers-with-jasmin#main-differences,1921,245
List your home directory using the web app,"1\. Navigate to <https://app.globus.org>
2\. Log in with your Globus identity (this could be a globusid.org or other
identity)
{{<image src=""img/docs/globus-transfers-with-jasmin/file-qEk9SPARZN.png"" caption=""log in"">}}
3\. In File Manager, use the search tool to search for ""JASMIN Default
Collection"". Select it.
{{<image src=""img/docs/globus-transfers-with-jasmin/file-LtMk6bD3Wz.png"" caption=""Find JASMIN Default Collection"">}}
4\. In the transfer pane, you are told that Authentication/Consent is
required. Click Continue.
{{<image src=""img/docs/globus-transfers-with-jasmin/file-pprxjkRNiw.png"" caption=""Consent"">}}
5\. Click the link to use the JASMIN Accounts Portal OIDC server to link your
JASMIN identity
6\. You are taken to a page on the JASMIN Accounts portal, where you are
invited to ""Authorise"" the external application to authenticate and access
your essential account information.
{{<image src=""img/docs/globus-transfers-with-jasmin/file-LEssDTYdfN.png"" caption=""Authorise application"">}}
7\. If successful, you are taken back to the Globus web app, where you are
invited to ""Allow"" the app to use the listed information and services.
{{<image src=""img/docs/globus-transfers-with-jasmin/file-lYBGlLIk9A.png"" caption=""Allow the app to use the info"">}}
8\. The directory listing of your home directory should now appear in the
transfer pane.
9\. Try navigating to another collection known to you (previously known as
endpoint) in the other pane and transferring some data. If you have Globus
Connect Personal running locally, you should be able to transfer files to/from
that.
",https://help.jasmin.ac.uk/docs/data-transfer/globus-transfers-with-jasmin#list-your-home-directory-using-the-web-app,1594,201
List your home directory using the command-line interface (CLI),"1\. Load the virtual environment where you have the Globus CLI installed:
(in this example, a Python virtual environment named `~/.globus-cli-venv`
already exists. If it doesn't create one with the command `python3 -m venv
~/.globus-cli-venv` on your local machine). Activate this virtual environment
as follows:
{{<command>}}
source ~/.globus-cli-venv/bin/activate
{{</command>}}
2\. It's recommended to update to the latest version of the CLI by doing the
following:
{{<command>}}
pip install -U globus-cli
{{</command>}}
3\. Check that you have an active globus session and follow any instructions
given, e.g.
{{<command>}}
globus login
globus session show
{{</command>}}
4\. Use the ""globus ls"" command to list the collection using its ID, starting
at the path of your home directory (/~/)
{{<command>}}
globus ls a2f53b7f-1b4e-4dce-9b7c-349ae760fee0:/~/
{{</command>}}
TIP: you can set the ID of the collection to be an environment variable like
this, for convenience:
{{<command>}}
export JASMIN_GLOBUS=a2f53b7f-1b4e-4dce-9b7c-349ae760fee0
globus ls $JASMIN_GLOBUS:/~/
{{</command>}}
6\. You will be taken through an equivalent set of steps to those needed for
the web app. First off, you will be asked to copy/paste a URL into your
browser and copy/paste back the resulting authentication code.
7\. Once the authentication/consent process has been completed, you should see
a listing of your home directory.
8\. Use the `globus transfer` command to copy data to/from another
**collection** (previously known as endpoint) to your home directory, within
the JASMIN Default Collection. (see `globus transfer --help` for details)
",https://help.jasmin.ac.uk/docs/data-transfer/globus-transfers-with-jasmin#list-your-home-directory-using-the-command-line-interface-(cli),1633,231
'GridFTP (certificate-based authentication)',"This article describes how to transfer data using gridftp with certificate-
based authentication.
{{<alert type=""info"">}}The `globus-url-copy` command used here should not be confused with the Globus online data transfer service. They used to be associated, but no longer. If you are starting out and looking for a reliable, high-performance transfer method, the recommendation now is to learn about [Globus Transfers with JASMIN](../globus-transfers-with-jasmin) (using the Globus online data transfer service) instead of command-line gridftp as described in this document.{{</alert>}}
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth,587,78
Basics of certificate-based authentication,"Gridftp servers commonly use a network of ""trust"" based on electronic
certificates. In order to make use of a gridftp server at one end of your
proposed transfer, you will need to use a certificate which identifies you as
the user, and which is issued by an identity provider which is ""trusted"" by
the servers at both ends. The trust between the servers is maintained by the
administrators of the service who will ensure that the necessary certificates
are in place.
The presentation of a valid credential which is trusted by the server at the
other end is merely the authentication step (proving who you are).
Authorisation also needs to follow: you, as a user (identified by the
credential you present) need to be authorised to use the resource at the other
end. You should check with the operator of the other gridftp server to see
what additional steps are required before you can actually perform a transfer.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#basics-of-certificate-based-authentication,914,158
Getting a short-term credential,"In order to access the JASMIN gridftp server, you can now use your JASMIN
portal account to gain a short-term credential which the server will recognise
to authenticate you. This is the same username and password you would use to
log in to <https://accounts.jasmin.ac.uk> to administer your JASMIN account.
**IT IS NOT YOUR SSH PASSPHRASE.**
Here's what to do:
  1. Download tools to interact with JASMIN's Online Certificate Authority (OnlineCA). You can use these to interact with other OnlineCAs too (not just JASMIN's. These replace the ""myproxy-logon"" tool previously mentioned here)
  2. Use these tools to: 
    1. ""Bootstrap trust"" i.e. to setup your local certificate store with those needed to interact with the JASMIN server [First time use only]
    2. Obtain a short-term credential using your JASMIN account details [First time, and to renew your short-term credendial as needed]
  3. Use this short-term credential to authenticate with a remote gridftp server which trusts this credential (for example, the JASMIN gridftp server)
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#getting-a-short-term-credential,1045,161
Download OnlineCA tools,"On the machine you intend to use as the transfer client, e.g.
`xfer1.jasmin.ac.uk`, in your JASMIN home directory, download 2 shell scripts
which will interact with the Online CA for you. Make them executable:
{{<command user=""user"" host=""xfer1"">}}
wget https://raw.githubusercontent.com/cedadev/online_ca_client/master/contrail/security/onlineca/client/sh/onlineca-get-cert-wget.sh
wget https://raw.githubusercontent.com/cedadev/online_ca_client/master/contrail/security/onlineca/client/sh/onlineca-get-trustroots-wget.sh
chmod u+x onlineca-get-*.sh
{{</command>}}
View help information for the shell scripts:
{{<command user=""user"" host=""xfer1"">}}
./onlineca-get-trustroots-wget.sh -h
./onlineca-get-cert-wget.sh -h
{{</command>}}
Bootstrap trust between your own machine and the JASMIN gridftp server: (First time only)
{{<command user=""user"" host=""xfer1"">}}
./onlineca-get-trustroots-wget.sh -U https://slcs.jasmin.ac.uk/trustroots/ -b
(out)Bootstrapping Short-Lived Credential Service root of trust.
(out)Trust roots have been installed in /home/users/USERNAME/.globus/certificates.
{{</command>}}
Obtain a credential, to be written to an output file `credfile` using your
JAMSIN Accounts Portal username USERNAME:
{{<command user=""user"" host=""xfer1"">}}
./onlineca-get-cert-wget.sh -U https://slcs.jasmin.ac.uk/certificate/ -l USERNAME -o ./cred.jasmin
{{</command>}}
When prompted, enter the password associated with your **JASMIN** account
**(NOT your SSH passphrase)**
Change the permissions on your newly-created `cred.jasmin` file so that it's
only readable by you (client software may insist on this):
{{<command user=""user"" host=""xfer1"">}}
chmod 600 ./cred.jasmin
{{</command>}}
This credential obtained by this method is valid by default for 720 hours (30
days), as you can see by inspecting the certificate using the following
command:
{{<command user=""user"" host=""xfer1"">}}
openssl x509 -in cred.jasmin -noout -startdate -enddate
(out)    notBefore=Mar 11 17:32:59 2022 GMT
(out)    notAfter=Apr 10 17:32:59 2022 GMT
{{</command>}}
After the `notAfter` date, it will no longer be valid, but you can
repeat this process at any time (e.g. before it expires) to update it.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#download-onlineca-tools,2185,243
Example Gridftp usage,"(General case, or with a JASMIN host as gridftp client)
Once you have obtained a valid short-term credential on the client transfer
server, and assuming that the gridftp server at the remote end of the
transfer recognises and is able to authorize you via this credential, then
you should be able to transfer data between the remote server and local
client with commands such as shown below:
Please consult the documentation for the `globus-url-copy` command for the
full range of options and arguments.
Please note that the examples below use a fictitious client `gridftp-client.localsite.ac.uk` and server `gridftp-server.remotesite.ac.uk` which need to be replaced in your commands with the hostname of the actual gridftp server and client you are actually using.
Check help documentation for the globus-url-copy command:
{{<command user=""user"" host=""gridftp-client"">}}
globus-url-copy -help
{{</command>}}
**NOTE:** On some systems, you have to load a relevant module to get access to the globus-url-copy command, however not on the JASMIN \[hp\]xfer servers.
It is recommended to try things out using the regular xfer servers xfer[12] but to perform ""real"" transfers using hpxfer[12] for better performance, but to use the latter you will need the {{<link ""hpxfer-access-role"">}}hpxfer access role{{</link>}}.
1\. Remote directory listing issued by client on `gridftp-
client.localsite.ac.uk` to server `gridftp-server.remotesite.ac.uk` where you
have a home directory `/home/users/USERNAME`:
{{<command user=""user"" host=""gridftp-client"">}}
globus-url-copy -cred cred.jasmin -vb -list gsiftp://gridftp-server.remotesite.ac.uk/home/users/USERNAME/
{{</command>}}
2\. Download a file from remote directory `/home/users/USERNAME` to
destination on the client machine:
{{<command>}}
globus-url-copy -cred cred.jasmin -vb gsiftp://gridftp-server.remotesite.ac.uk/home/users/USERNAME/myfile file:///path/to/localdir/myfile
{{</command>}}
The `-p N` and `-fast` options can additionally be used in combination to
enable `N` parallel streams at once, as shown below. You can experiment with N
in the range 4 to 16 to obtain the best performance, but please be aware that
many parallel transfers can draw heavily on shared resources and degrade
performance for other users:
{{<command>}}
globus-url-copy -cred cred.jasmin -vb -p 16 -fast gsiftp://gridftp-server.remotesite.ac.uk/home/users/USERNAME/myfile file:///path/to/localdir/myfile
{{</command>}}
3\. Recursively download the contents of a directory on a remote location to a
local destination.
{{<command>}}
globus-url-copy -cred cred.jasmin -vb -p 4 -fast -cc 4 -cd -r gsiftp://gridftp-server.remotesite.ac.uk/home/users/USERNAME/mydir/ file:///path/to/localdir/mydir/
{{</command>}}
Where:
  - `-cc N` requests `N` concurrent transfers (in this case, each with `p=4` parallel streams)
  - `-cd` requests creation of the destination directory if this does not already exist
  - `-r` denotes recursive transfer of directories
  * `-sync` and `-sync-level` options can be used to synchronise data between the two locations, where destination files do not exist or differ - y criteria that can be selected) from corresponding source files. See `-help` option for details.
  - the `file:///` URI is used to specify the destination on the local file system.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#example-gridftp-usage,3306,436
Uploading data,"The above commands can also be adapted to invoke transfers from a local source
to a remote destination, i.e. uploading data, since the commands all take the
following general form:
{{<command>}}
globus-url-copy [OPTIONS] source-uri desination-uri
{{</command>}}
You can use the above examples by replacing the local machine `gridftp-client.localsite.ac.uk` with one of the jasmin transfer hosts
`xfer[12].jasmin.ac.uk` as a client, To do this, you first need to be logged in via SSH to one of these hosts and can initiate a transfer by invoking `globus-url-copy` in one of the ways above.
- For high-performance transfer (large volumes and/or longer distances), use `hpxfer[12].jasmin.ac.uk` for which you will need to have the {{<link ""hpxfer-access-role"">}}hpxfer access role{{</link>}}. `hpxfer[12].jasmin.ac.uk` are also recommended for transfers to/from ARCHER2 if initiated at the JASMIN end, but if you are initiating the transfer from the ARCHER2 end, you will need to connect to the JASMIN GridFTP server as described below, see also {{<link ""transfers-from-archer2"">}}{{</link>}}.
- `hpxfer2.jasmin.ac.uk` is tuned for very long path transfers (e.g. Western US or Australia/NZ)
- For remote hosts using JASMIN's dedicated network link (Met Office only) use `xfer[12].jasmin.ac.uk` as the client (These are virtual machines so have limited performance, but your transfer will be over a dedicated network connection)
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#uploading-data,1425,204
Connecting to the JASMIN GridFTP server,"In order to do a transfer using a JASMIN host as the gridftp server (rather than
client), you would need to interact with the JASMIN GridFTP server
`gridftp1.jasmin.ac.uk`. You cannot log in to this server directly via SSH:
you only initiate GridFTP transfers to and from it from another client.
In the following example, a client is initiated on a fictitious remote host
`client.remotesite.ac.uk` and tests the connection by transferring from
/dev/zero on the local machine (at `remotesite` ) to /dev/null on the JASMIN
gridftp server. Note that you can use the SLCS server at JASMIN to obtain the
short-term credential required ( **but the first time, you will need to
download and use the OnlineCA tools as described above** ). You can renew your
credential and perform the test transfer as follows:
{{<command user=""user"" host=""remoteclient"">}}
./onlineca-get-cert-wget.sh -U https://slcs.jasmin.ac.uk/certificate/ -l USERNAME -o ./cred.jasmin
globus-url-copy -cred cred.jasmin -vb -p 8 -fast /dev/zero gsiftp://gridftp1.jasmin.ac.uk/dev/null
(out)    Source: file:///dev/
(out)    Dest:   gsiftp://gridftp1.jasmin.ac.uk/dev/
(out)      zero  ->  null
(out)
(out)    4153409536 bytes       792.20 MB/sec avg       792.20 MB/sec inst
{{</command>}}
This server is also used as the JASMIN GridFTP Server globus endpoint, see
[GridFTP transfers using Globus Online]({{< ref ""globus-command-line-interface"" >}}) (however you can only currently use your CEDA
SLCSs credential with Globus Online. The JASMIN team is working on a solution
for this).
Please note that the servers `xfer[12].jasmin.ac.uk` and
`hpxfer[12].ceda.ac.uk` are not gridftp **servers**. They have the `globus-
url-copy` client installed, so can be used as clients to connect to remote
gridftp servers, and also support [gridftp over SSH]({{< ref ""gridftp-ssh-auth"" >}}) (both incoming and outgoing), but do not act as
servers for certificate-based gridftp as shown in these examples. The JASMIN
gridftp server for read-write access to home directories and group workspaces
is `gridftp1.jasmin.ac.uk`. Access to this requires the {{<link ""hpxfer-access-role"">}}hpxfer access role{{</link>}}. See
also [Transfer Servers]({{< ref ""transfer-servers"" >}}).
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#connecting-to-the-jasmin-gridftp-server,2222,306
Third-party transfers,"It should be possible, with the correct configuration at each site, to
initiate on host `A` a transfer of data between two other gridftp servers `B` and
`C` (a third party transfer). Both URIs would use `gsiftp:` as the protocol:
{{<command>}}
globus-url-copy -vb -p 4 gsiftp://B/source gsiftp://C/destination
{{</command>}}
Further information can be found in the documentation for globus-url-copy.
This is the basis of the [Globus Online](https://www.globus.org/app/transfer) 
managed service to orchestrate and monitor transfers between gridftp endpoints
in a more user-friendly way. It has evolved considerably since diverging from 
the ""traditional"" gridftp setup described in this article and is recommended as 
it provides a much easier user experience and better reliability.
See {{<link ""globus-transfers-with-jasmin"" />}}.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#third-party-transfers,833,114
Future plans,"As [support for the open-source Globus Toolkit (including globus-url-copy) has
now been withdrawn by Globus](https://www.globus.org/blog/support-open-source-
globus-toolkit-ends-january-2018), the future of direct gridftp transfers is
uncertain. It is currently maintained by the Grid Community Forum. 
**We advise users to spend some time understanding and testing
transfer workflows with the {{<link ""globus-transfers-with-jasmin"" >}}Globus Online{{</link>}} transfer service,
including the command-Line, web interfaces and (for advanced users) a Python SDK, as these
are likely to replace direct gridftp on JASMIN in due course.**
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-cert-based-auth#future-plans,634,78
'GridFTP (SSH authentication)',"This article describes how to transfer data using GridFTP with SSH
authentication.
{{<alert type=""info"">}}The `globus-url-copy` command used here should not be confused with the Globus online data transfer service. They used to be associated, but no longer. If you are starting out and looking for a reliable, high-performance transfer method, the recommendation now is to learn about [Globus Transfers with JASMIN](../globus-transfers-with-jasmin) (using the Globus online data transfer service) instead of command-line gridftp as described in this document.{{</alert>}}
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth,572,77
Introduction,"GridFTP is the recommended tool for transferring large files or groups of
files across high-speed Wide-Area Networks (WANs). It is commonly used with
certificate-based authentication, but can also take place between suitably
configured* server and client using SSH as the authentication mechanism.
The client may need to have certain ports enabled on the host or institutional firewall if present. Consult your local IT support desk for details and direct them to {{< link ""https://gridcf.org/gct-docs/6.2/gridftp/admin/index.html#gridftp-config-overview"" >}}Configuring GridFTP{{</link>}}.
SSH-based GridFTP does not enable the full feature set provided by
certificate-based GridFTP and in particular does not work with Globus Online,
which provides useful interfaces and APIs for managing large-scale data
transfers, but still provides a major step up in performance by ""filling the
pipe"" more efficiently than scp/rsync/sftp, particularly over longer distances
and can do verification and sync operations as part of the transfer.
See also:
- [Transfer servers]({{< ref ""transfer-servers"" >}}) for details on which servers within JASMIN have GridFTP available.
- [Transfers from ARCHER2]({{< ref ""transfers-from-archer2"" >}}) for details of different routes affecting your choice of server (since this is the one of the most likely places to which JASMIN users will want to transfer data to/from)
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth#introduction,1399,197
Establishing a connection,"Since you will be using SSH as the authentication mechanism, you should ensure
that your initial connection to the JASIMN transfer server is made with the -A
option enabled, to enable agent forwarding:
{{<command user=""user"" host=""localhost"">}}
ssh -A username1@hpxfer1.jasmin.ac.uk
{{</command>}}
Note that in order to use `hpxfer[12].jasmin.ac.uk` you will need to have
[high-performance data transfer access]({{< ref ""hpxfer-access-role"" >}}) on
your JASMIN account. An alternative to try out beforehand, is to use `jasmin-
xfer1.ceda.ac.uk`.
Use the `globus-url-copy` command to list the contents of your home directory
on the remote server (This will only work if you already know that that server
supports GridFTP over SSH). In this case, we are making the connection to a
fictitious server `gridftp.remotesite.ac.uk`:
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -vb -list sshftp://username2@gridftp.remotesite.ac.uk/
{{</command>}}
If `username` and `username2` are the same (on the different systems, the
`username@` part of the sshftp URI can be omitted.
Note that the URI of the server, in this case
`sshftp://username2@gridftp.remotesite.ac.uk` must come immediately after (as
it is an argument to) the `-list` option. This is particularly important if
you are combining this command with other options.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth#establishing-a-connection,1332,184
Example GridFTP usage,"Once you have successfully established that you can connect to the server (as
above), then you should be able to transfer data between the remote end
(server) and local end (client) with commands such as shown below:
As above, if you have the same username on both local and remote systems, then
the `username@` part of the sshftp URI can be omitted.
Please consult the documentation for the `globus-url-copy` command for the
full range of options and arguments.
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -help
{{</command>}}
See also <http://toolkit.globus.org/toolkit/docs/latest-
stable/gridftp/user/#gridftp-user-basic>
2\. Download a file from remote directory `/home/users/USERNAME` to
destination on the local (client) machine, for example a group workspace on
JASMIN:
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -vb sshftp://username@gridftp.remotesite.ac.uk/home/users/USERNAME/myfile /group_workspaces/jasmin/myworkspace/myfile
{{</command>}}
The `-p N` and `-fast` options can additionally be used in combination to
enable `N` parallel streams at once, as shown below. You can experiment with N
in the range 4 to 32 to obtain the best performance, but please be aware that
many parallel transfers can draw heavily on shared resources and degrade
performance for other users:
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -vb -p 16 -fast sshftp://username@gridftp.remotesite.ac.uk/home/users/USERNAME/myfile /group_workspaces/jasmin/myworkspace/myfile
{{</command>}}
3\. Test performance with large files by downloading from /dev/zero on the
remote server to /dev/null locally. This excludes any interaction with either
filesystem and gives an upper limit to the performance that can be achieved at
the time. Repeat with values of N in the range 4 to 32 to compare rates. Note
that the performance takes a while to ""ramp up"", so you will not see the best
rates if transferring small files individually as the process never gets up to
full speed:
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -vb -p 16 -fast sshftp://username@gridftp.remotesite.ac.uk/dev/zero /dev/null
{{</command>}}
Press CTRL-C to interrupt the transfer. Alternatively you can specify that the
transfer should continue for a fixed duration in seconds using the `-t`
option. In this example, data is transferred from the remote host
gridftp.remotesite.ac.uk to jasmin-xfer2.ceda.ac.uk.
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -p 16 -fast -t 10 -vb sshftp://username2@gridftp.remotesite.ac.uk/dev/zero /dev/null
(out)    Source: sshftp://username2@gridftp.remotesite.ac.uk/dev/
(out)    Dest:   file:///dev/
(out)      zero  ->  null
(out)    
(out)       7797473280 bytes       929.52 MB/sec avg      1024.49 MB/sec inst
(out)    Cancelling copy...
{{</command>}}
Note the transfer rate achieved in Megabytes/second (MB/sec), although for
various reasons this is not to be relied upon as an accurate expectation of
speed for real transfers. However, **you are unlikely to achieve even half of
this data rate via`scp`, `rsync` or `sftp` over the same route**. [Bbcp]({{<
ref ""bbcp"" >}}) may achieve similar rates, however, and
this is considered by some as easier to use.
4\. Recursively download the contents of a directory on a remote location to a
local destination.
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy -vb -p 4 -fast -cc 4 -cd -r sshftp://username2@gridftp.remotesite.ac.uk/home/users/USERNAME/mydir/ /group_workspaces/jasmin/myworkspace/mydir/
{{</command>}}
Where:
- `-cc N` requests `N` concurrent transfers (in this case, each with `p=4` parallel streams)
- `-cd` requests creation of the destination directory if this does not already exist
- `-r` denotes recursive transfer of directories
- `-sync` and `-sync-level` options can be used to synchronise data between the two locations, where destination files do not exist or differ (by criteria that can be selected) from corresponding source files. See `-help` option for details.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth#example-gridftp-usage,4031,530
Upload data (push data from JASMIN to remote server),"The above commands can also be adapted to invoke transfers from a local source
to a remote destination, i.e. uploading data, since the commands all take the
following general form:
{{<command user=""username"" host=""hpxfer1"">}}
globus-url-copy [OPTIONS] source-uri desination-uri
{{</command>}}
Be sure to check your connection with the remote machine via a simple SSH
login and then a directory listing as shown above.
",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth#upload-data-(push-data-from-jasmin-to-remote-server),418,61
JASMIN host as remote server,"So far the examples have used a server within JASMIN as the client in the
GridFTP transfer. The transfer can be reversed so that the client is elsewhere
and the JASMIN host is the server specified in the destination URI. The
following command should work connecting to one of the following transfer
servers: (see also [Transfer Servers]({{< ref ""transfer-servers"" >}}))
- `xfer[12].jasmin.ac.uk`
- `xfer3.jasmin.ac.uk` ([additional access role](https://accounts.jasmin.ac.uk/services/additional_services/xfer-sp) required)
- `hpxfer[12].jasmin.ac.uk` ([high-performance data transfer access]({{< ref ""hpxfer-access-role"" >}}) required)
Push data to JASMIN from a remote server:
{{<command user=""username2"" host=""remotehost"">}}
globus-url-copy -vb -p 8 -fast mydir/myfile sshftp://username@hpxfer1.jasmin.ac.uk/group_workspaces/jasmin/myworkspace/mydir/
{{</command>}}
Note that for this to work, you need to be able to authenticate over SSH to the JASMIN host. This should be possible if you can log in interactively, but will NOT work if you are using the command in a cron job or other situation where your ssh-agent (on the host remote to JASMIN) is not running and/or does not have access to your private key. For those situations, consider using either
- {{<link ""globus-transfers-with-jasmin"" >}}Globus (recommended){{</link>}}, or
- {{<link ""gridftp-cert-based-auth"">}}Gridftp using certificate-based authentication{{</link>}})",https://help.jasmin.ac.uk/docs/data-transfer/gridftp-ssh-auth#jasmin-host-as-remote-server,1434,182
'hpxfer access role',"This article explains about access to high-performance data transfer services.
",https://help.jasmin.ac.uk/docs/data-transfer/hpxfer-access-role,79,10
Applying for access,"Some data transfer services are hosted in the JASMIN Data Transfer Zone (a special area of JASMIN's network, located optimally for connections to the outside world via {{<link href=""https://www.jisc.ac.uk/janet"" cue=""true"">}}JANET{{</link>}}) for increased performance. However, to
maintain security in this zone, access to some services is controlled via an additional access
role `hpxfer`. If you have a login account already, you can apply here for
this additional role:
{{< button href=""https://accounts.jasmin.ac.uk/account/login/?next=/services/additional_services/hpxfer/"" >}}Apply for hpxfer{{< /button >}}
",https://help.jasmin.ac.uk/docs/data-transfer/hpxfer-access-role#applying-for-access,615,75
Additional information required,"If you will be connecting from your home institution directly via ssh or ssh-
based gridftp to one of the servers in the JASMIN Data Transfer Zone, the
specific IP address of your machine will need to be added to an allow-list.
Please supply this as part of the application process above.
However, this should not be necessary if you are accessing the server from a
remote server which is already allowed.
{{<alert type=""info"">}}If your **only** reason for applying for `hpxfer` is in order to use the **Globus** service on JASMIN, this is no longer required. You only need this role for accessing the hpxfer servers or for using certificate-based gridftp with the `globus-url-copy` command.
{{</alert>}}
**Inward** pulls of data (to JASMIN) are possible by logging in to
`hpxfer[1,2].jasmin.ac.uk` **via the login servers** and pulling data from
external data sources. So if you're not sure what IP address to use when
applying for access above, it is OK to quote the IP address of
`login1.jasmin.ac.uk`, i.e. `130.246.130.28` as a ""dummy"" value if you will
only be accessing them via this route, and not directly from outside.
",https://help.jasmin.ac.uk/docs/data-transfer/hpxfer-access-role#additional-information-required,1129,186
'rclone',"This article provides information about the rclone data transfer tool. In
particular:
- what is rclone?
- installing rclone for yourself on JASMIN.
- configuring rclone
- Dos and Don'ts
",https://help.jasmin.ac.uk/docs/data-transfer/rclone,186,30
What is rclone?,"rclone is a command-line utility which enables access to lots of different
storage systems including object stores and cloud-based storage. It can also
move data between directories act as an SFTP client so could be used to access
files on JASMIN.
It is very well [documented](https://rclone.org/) already, so rather than
repeat that information here, this article highlights aspects relevant to its
use on JASMIN.
Further information will follow in due course as our experience with this tool
develops.
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#what-is-rclone?,504,78
Installing rclone for yourself on JASMIN,"First off, **do not attempt to follow the documented instructions for
installing on Linux**. As a regular user, **you do not have root/administrator
permission and are not permitted to run scripts using sudo**. Normally most
utilities are already installed for you on JASMIN, but in this case you need
to adapt the documented instructions so that you can safely install this in
your OWN home directory. [That may change in the future if this tool proves
useful].
The recommended procedure for installation on JASMIN is as follows:
Fetch and unpack the Linux binary distribution: (in your home directory on an
**xfer** server)
{{<command>}}
curl -O https://downloads.rclone.org/rclone-current-linux-amd64.zip
unzip rclone-current-linux-amd64.zip
cd rclone-*-linux-amd64
{{</command>}}
Next, move the `rclone` executable to your own `bin` directory. You may need
to create that directory if it does not exist already, and add it to your
`PATH` environment variable in your `~/.bash_profile` file.
{{<command shell=""bash"">}}
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#installing-rclone-for-yourself-on-jasmin,1022,148
only need these if these aren't in place already in your own setup:,"mkdir ~/bin # comment here
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#only-need-these-if-these-aren't-in-place-already-in-your-own-setup:,27,5
add this to your PATH (add to your ~/.bash_profile to make this permanent),"export PATH=""~/bin:$PATH""
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#add-this-to-your-path-(add-to-your-~/.bash_profile-to-make-this-permanent),26,2
move the rclone executable,"mv rclone ~/bin/
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#move-the-rclone-executable,17,3
make the permissions on the file executable by you,"chmod 700 ~/bin/rclone
{{</command>}}
Note that you will not have installed the man pages, so these will not be
available: please consult the online documentation instead.
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#make-the-permissions-on-the-file-executable-by-you,172,26
Configuring rclone,"Configuring rclone is covered in the rclone documentation. Essentially you
need to configure a **""remote""** representing each storage system you want to
interact with. You can then use rclone to manage data between those ""remotes"".
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#configuring-rclone,232,35
Dos and Don'ts,"- Please **DO NOT use the following features on JASMIN** (at least until further notice). Some of these features look useful, but more work is needed to understand if/how they can be used safely on JASMIN without causing problems. 
  - `rclone mount` (mounting a remote as a filesystem) - **DO NOT USE**
  - `rclone rcd` (remote control daemon) - **DO NOT USE**
  - `rclone serve`(serve remote over a protocol) - **DO NOT USE**
- You should safely be able to use the following, between remotes that you have configured: 
  - `rclone copy`
  - `rclone sync`
  - `rclone lsd`
  - `rclone ls`
  - `..(other basic commands)`
Help on a particular command is found using
{{<command>}}
rclone <command> --help
{{</command>}}
Further examples of useful ways of using rclone on JASMIN will follow...
",https://help.jasmin.ac.uk/docs/data-transfer/rclone#dos-and-don'ts,791,130
"'rsync, scp, sftp'","This article tells you about some of the basic transfer tools available for
use with JASMIN that work over an SSH connection:
- rsync (over SSH)
- scp
- sftp
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp,158,30
rsync over SSH,"rsync is a file synchronisation and file transfer program for Unix-like
systems that can minimise network data transfer by using a form of delta
encoding such that only the differences between and source and destination
data are actually transmitted. rsync can compress the data transferred further
using zlib compression and SSH or stunnel can be used to encrypt the transfer.
rsync is typically used to synchronise files and directories between two
different systems, one local and one remote. For example, the command:
{{<command user=""localuser"" host=""localhost"">}}
rsync mydata remoteuser@remotehost:/data/
{{</command>}}
will use SSH to connect as `remoteuser` to `remotehost`. Once connected, it will
invoke another copy of rsync on the remote host, and then the two programmes
will talk to each other over the connection, working together to determine
which parts of `mydata` are already on the remote host and don't need to be
transferred over the connection.
The generic syntax is:
{{<command>}}
rsync [OPTION] ... SRC [SRC] ... [USER@]HOST:DEST
rsync [OPTION] ... [USER@]HOST:SRC [DEST]
{{</command>}}
...where `SRC` is the file or directory (or a list of multiple files and
directories) to copy from, and `DEST` represents the file or directory to copy
to. (Square brackets indicate optional parameters.)
For more information visit the [official rsync
website](http://rsync.samba.org/).
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp#rsync-over-ssh,1399,206
rsync example with JASMIN,"Here is a simple example using rsync over SSH to your home directory copy a file to a Group
Workspace on JASMIN:
{{<command user=""localuser"" host=""localhost"">}}
exec ssh-agent $SHELL
ssh-add ~/.ssh/id_rsa_jasmin  ## local path to your private key file
rsync myfile <username>@xfer1.jasmin.ac.uk:/gws/nopw/j04/myproject/data/
{{</command>}}
NOTE: The first two lines are the standard method for setting up the SSH agent
in order to allow connections without prompting for a passphrase each time.
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp#rsync-example-with-jasmin,495,69
scp,"`scp` is another basic command-line tool for secure copying between two
machines. It is installed as part of most SSH implementations and comes as
standard on the JASMIN transfer servers. `scp` is the secure analogue of the
`rcp` command. Typically, the syntax of `scp` is like the syntax of `cp`
(copy):
To copy a file to a host:
{{<command user=""localuser"" host=""localhost"">}}
scp myfile remoteuser@remotehost:directory/target
{{</command>}}
To copy a file (or directory) from a host to the local system:
{{<command user=""localuser"" host=""localhost"">}}
scp remoteuser@remotehost:directory/source target
scp -r remoteuser@remotehost:directory/source_folder target_folder
{{</command>}}
Note that if the remote host uses a port other than the default of 22, it can
be specified in the command. For example, copying a file from host over a non-
standard SSH port (2222):
{{<command user=""localuser"" host=""localhost"">}}
scp -P 2222 remoteuser@remotehost:directory/source target
{{</command>}}
For more information on scp please visit the following
[website](https://linux.die.net/man/1/scp).
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp#scp,1090,144
sftp,"sftp is a similar command-line tool to scp, but the underlying SFTP protocol
allows for a range of operations on remote files which make it more like a
remote file system protocol. sftp includes extra capabilities such as resuming
interrupted transfers, directory listings, and remote file removal.
For basic transfer of a file on JASMIN to the local machine:
{{<command user=""localuser"" host=""localhost"">}}
sftp remoteuser@xfer1.jasmin.ac.uk:/group_workspaces/jasmin/myproject/data/notes.txt ./
{{</command>}}
For more information see the [Wikipedia page on
SFTP](https://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol).
There are various 3rd-party tools and clients, for example, WinSCP, FileZilla,
MobaXterm and others, which can do transfers using the SCP and/or SFTP
protocols. Please refer to the documentation for that particular software, but
the basic principles are the same, i.e that you can set up a connection to a
remote host by specifying the same parameters that you would with the command-
line tool, but often through a graphical user interface instead.
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp#sftp,1074,148
Note on performance,"While convenient and familiar to many users, the tools described above do not
make efficient use of available bandwidth for transferring large quantities of
data via high-speed networks over long distances. Please consult [Data
Transfer Tools]({{< ref ""data-transfer-tools"" >}}) to learn more about which
might be the most appropriate tool to use in different contexts.
",https://help.jasmin.ac.uk/docs/data-transfer/rsync-scp-sftp#note-on-performance,370,55
Scheduling/Automating Transfers,"This article explains how to schedule or automate data transfers. It covers:
- Using Globus for transfer automation
- Scheduling download tasks using cron and LOTUS
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers,165,26
Overview,"In many cases it can be useful to fetch data from an external source for
processing/analysis on JASMIN on a regular basis, for example ""every Monday at
11:00 fetch all last week's data"". It can also be helpful to distribute the
task downloading of some large datasets, or simply to be able rely on data
being pulled in from some external source to an accumulating dataset used for
periodic analysis.
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#overview,400,70
Using Globus for transfer automation,"It is easy to automate transfers using {{<link ""globus-transfers-with-jasmin"">}}Globus{{</link>}}. This method has the advantage that you 
do not need to remain connected or logged in to any JASMIN server for the automated transfers
to take place on your behalf, and the transfer itself can be more efficient than other methods described below.
Some introductory information about how to do this is available in this article
{{<link ""globus-command-line-interface/#automation"">}}Using the Globus command-line interface{{</link>}}
(with more to follow)
but please also refer to the comprehensive Globus documentation and their 
[automation examples](https://github.com/globus/automation-examples). You can choose whether 
to schedule/automate tasks via the {{<link ""https://www.globus.org/blog/scheduled-and-recurring-transfers-now-available-globus-web-app"">}}Globus web interface{{</link>}}, {{<link ""https://docs.globus.org/cli/reference/"">}}command-line interface{{</link>}}, or use their {{<link ""https://globus-sdk-python.readthedocs.io/en/stable/examples/index.html"" >}}Globus Python SDK{{</link>}} to build Python code that uses this functionality.
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#using-globus-for-transfer-automation,1155,120
Scheduling download tasks using cron and LOTUS,"While the [cron server]({{< ref ""using-cron"" >}}) `cron.jasmin.ac.uk` is provided for scheduling
general tasks, **it should not be used for the work of executing those tasks itself, and not for transfer tasks.**
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#scheduling-download-tasks-using-cron-and-lotus,212,32
xfer3 - transfer machine with cron,"The transfer server `xfer3.jasmin.ac.uk` is also provided with `cron`, and should be used where
a task is primarily a transfer rather than a processing task and needs the functionality
of a transfer server. For access to `xfer3` you will need the
{{<link ""https://accounts.jasmin.ac.uk/services/additional_services/xfer-sp/"">}}xfer-sp access role{{</link>}}.
Please refer to the above `cron` guidance for best practice advice.
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#xfer3---transfer-machine-with-cron,427,56
Invoking LOTUS from cron to carry out multiple download tasks,"Sometimes we need a task to be invoked from `cron` but executed where there
are lots of nodes to parallelise the tasks (i.e. the LOTUS cluster). In this case, we DO need to use the `cron`
server rather than `xfer3`, since we need to be able to talk to LOTUS (`xfer3` can't do that, as a transfer server).
This will only work where the download can happen over HTTP(S), so depends on how the remote data is made available.
We need it to:
- invoke a job submission script at regular intervals
- have that script initiate downloads using LOTUS nodes
In the examples below, we use the `test` queue (or partition, as queues are
known in SLURM). You can use this for testing, but once you know roughly how
long your download(s) should take, you should [choose an appropriate
queue]({{< ref ""slurm-queues"" >}}) so that the jobs can be scheduled in a fair
way alongside other users' jobs.
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#invoking-lotus-from-cron-to-carry-out-multiple-download-tasks,881,159
1\. Single download script,"The simple script below is used to download a single file from an external
source via HTTP using `wget`. It initially uses the `test` partition (queue), but 
once you had tested it, you would need to use a more appropriate queue.
#!/bin/bash 
#SBATCH --partition=test
#SBATCH -o %j.out 
#SBATCH -e %j.err
#SBATCH --time=00:30
# executable 
wget -q -O 1MB_${SLURM_JOBID}.zip http://speedtest.tele2.net/1MB.zip
In this example, the file is labelled with the id of the job which downloaded
it, e.g. `1MB_61117380.zip`
The same could be also achieved using `curl`, or using a Python script making
use of (for example) the `requests` library.
**A note about transfer tools:** since we are delegating the actual download
task to a LOTUS node, we are restricted to transfer tools already installed on
those nodes or available in the user's path at a location cross-mounted with
nodes in the LOTUS cluster (see Table 1 in [Access to Storage]({{< ref path=""/docs/getting-started/storage"" >}})), such as $HOME or a group workspace. It is not possible for
the JASMIN team to install specialist data transfer tools across the whole
cluster, so you may be limited to downloading via HTTP(S), FTP, or via tools
available via libraries in the Python environment such (which you do have
access to and can easily customise to install additional libraries using
virtual environments).
Due to networking limitations, LOTUS nodes cannot perform downloads using SSH-based methods, i.e. scp/rsync/sftp.
Download tools installed on LOTUS nodes include:
- `wget`
- `curl`
- `ftp` (but not `lftp`)
In our simple example above, we can subit this script to LOTUS from the
command line with
{{<command>}}
sbatch test_download.sh
{{</command>}}
This could be invoked on a regular basis by adding a crontab entry like this
30 * * * * sbatch /home/users/username/test_download.sh
However it would be safer to wrap this in a `crontamer` command like this to
ensure one instance of the task had finished before the next started: (see
[Using cron]({{< ref ""using-cron"" >}}) for details)
30 * * * * crontamer -t 2h 'sbatch /home/users/username/test_download.sh'
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#1\.-single-download-script,2127,333
2\. Multi-node downloads,"We could expand this example to download multiple items, perhaps 1 directory
of data for each day of a month, and have 1 element of a job array handle the
downloading of each day's data.
**A few words of warning:** Distributing download tasks as shown below can
cause unintended side-effects. Here, we're submitting an array of 10 download
jobs, each initiating a request for a 1MB file which may well happen
simultaneously. So we need to be confident that the systems and networks at
either end can cope with that. It would be all too easy to submit a task to
download several thousand large data files and cause problems for other users
of JASMIN (and other users on its host institution's network), or indeed at
the other end. Taken to the extreme, this could appear over the network as a
Distributed Denial-of-Service (DDoS) attack. As with all LOTUS tasks: start
small, test, and increase to sensible scales when you are confident it will
not cause a problem. **A limit of 10 jobs would be a sensible maximum, for one
user.**
We'll simulate this here by downloading the same external file to 10 different
output files, but you could adapt this concept for your own purposes depending
on the layout of the source and destination data.
#!/bin/bash 
#SBATCH --partition=test
#SBATCH -o %A_%a.out
#SBATCH -e %A_%a.err
#SBATCH --time=00:30
#SBATCH --array=1-10
#SBATCH --time=00:30
# executable 
wget -q -O 1MB_${SLURM_ARRAY_TASK_ID}.zip http://speedtest.tele2.net/1MB.zip
echo ""script completed""
In this (perhaps contrived) example, we're setting up an array of 10 elements
and using the `SLURM_ARRAY_TASK_ID` environment variable to name the output
files (otherwise they'd all be the same). In a real-world example you could
apply your own logic to divide up files or directories matching certain
patterns to become elements of a job array.
The script could then be scheduled to be invoked at regular intervals as shown
in (1).
Some tools provide functionality for mirroring or synchronising directories,
i.e. only downloading those files in a directory which are new have been added
since the last time a task was run. These can be useful to avoid repeated
downloads of the same data.
",https://help.jasmin.ac.uk/docs/data-transfer/scheduling-automating-transfers#2\.-multi-node-downloads,2188,356
Transfers from ARCHER2,"This article explains how to transfer data between ARCHER2 and JASMIN. It
covers:
- The choice of available tools / routes
- Example of how to use the currently-recommended method
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2,180,30
Choice of available Tools/Routes,"See [Data Transfer Tools]({{< ref ""data-transfer-tools"" >}}) for general
details.
Users transferring data between ARCHER2 and JASMIN are often transferring
relatively large sets of data, so it is important to choose the most
appropriate route, method and tools to ensure you get the most efficient and
reliable transfer experience. This can vary depending on system and network
conditions.
If you want to try **all** the options available, you will need:
- [hpxfer](https://accounts.jasmin.ac.uk/services/additional_services/hpxfer/) (high-performance data transfer) access role on JASMIN, in addition to the [jasmin-login](https://accounts.jasmin.ac.uk/services/login_services/jasmin-login/) role.
- a login account at ARCHER2
- (only for certificate-based GridFTP) to have registered the subject of your JASMIN-issued short-term credential with ARCHER2 support.
Check the examples in the linked documentation articles and ensure that you
use them between the hosts used in the examples. Not all services connect over
all routes to/from all hosts!
NOTE:
- Enquiries about access to or use of ARCHER2 should be directed to ARCHER2 support ([support@archer2.ac.uk](mailto:support@archer2.ac.uk))
- Enquiries about access to or use of JASMIN should be directed to JASMIN support (use beacon, below-right or [support@jasmin.ac.uk](mailto:mailto:support@jasmin.ac.uk))
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#choice-of-available-tools/routes,1365,177
Available transfer methods,,https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#available-transfer-methods,0,0
Basic SSH transfer,"[**scp/rsync/sftp**]({{< ref ""rsync-scp-sftp"" >}}): Simple transfers using easy method, pushing data to general purpose xfer nodes. Convenient, but limited performance.
_source_ |  _dest_ |  _notes_  
--- | --- | ---
`login.archer2.ac.uk` |  `xfer1.jasmin.ac.uk` |  over 10G JANET, but to virtual machine at JASMIN end  
`login.archer2.ac.uk` |  `xfer2.jasmin.ac.uk` |  same  
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#basic-ssh-transfer,401,51
GridFTP over SSH,"[GridFTP over SSH]({{< ref ""gridftp-ssh-auth"" >}}): GridFTP performance with convenience of SSH. Requires persistent ssh agent
on local machine where you have your JASMIN key. **2nd choice method**
_source_ |  _dest_ |  _notes_  
--- | --- | ---
`login.archer2.ac.uk` |  `hpxfer1.jasmin.ac.uk` |  over 10G JANET  
`login.archer2.ac.uk` |  `hpxfer2.jasmin.ac.uk` |  over 10G JANET<br>hpxfer2 is configured for longer distances but can be useful if hpxfer1 is busy
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#gridftp-over-ssh,487,67
GridFTP using certificate auth,"[GridFTP using certificate auth]({{< ref ""gridftp-cert-based-auth"" >}}): Fully-featured GridFTP. Suitable for person-not-present transfers & long-
running ARCHER2 workflows. **1st choice method**
_source_ |  _dest_ |  _notes_  
--- | --- | ---
`login.archer2.ac.uk` |  `gridftp1.jasmin.ac.uk` |  over 10G JANET.<br>Dedicated GridFTP server.<br>**No need for persistent SSH agent at ARCHER2 end**
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#gridftp-using-certificate-auth,420,50
1st choice method: example,"The currently-recommended method for transfers between ARCHER2 and JASMIN is using
globus-url-copy with the concurrency option, as described below, but using
certificate-based authentication rather than SSH. This will work for person-
not-present transfers, so is suitable for long-running processes on ARCHER2
which need to spawn a transfer to JASMIN at intervals up to a month from
initiation.
1\. Load your SSH key for ARCHER2 on your local machine, then log in to
ARCHER2.
This method **does not** require you to use your JASMIN SSH key. It involves:
- obtaining tools to communicate with JASMIN's short-lived credentials service
- using the service to obtain a credential (it should last for 30 days, but a new one can be obtained at any time)
- using the credential to initiate a transfer (this what you would need to repeat for each transfer)
A fuller explanation of the process is given in this document:
- [Data Transfer Tools: GridFTP (certificate-based authentication)]({{< ref ""gridftp-cert-based-auth"" >}})
Once you have done these steps, you should be able to obtain a short-term
credential as follows (do this command at the ARCHER2 end, after having
downloaded the onlineca script as described in the document mentioned above):
{{<command user=""user"" host=""login.archer2"">}}
./onlineca-get-cert-wget.sh -U https://slcs.jasmin.ac.uk/certificate/ -l USERNAME -o ./cred.jasmin
chmod 600 cred.jasmin
{{</command>}}
Note that the path `./` is used for the script `onlineca-get-cert-wget.sh`,
but you should use the path to wherever you saved it. Alternatively, if you
make yourself a `bin` directory and add that to your `PATH`, then you don't
need to specify the path.
2\. Load the `gct` module (to make the current `globus-url-copy` command
available in your path on ARCHER2).
Once loaded, check with `which` to see that you have the `globus-url-copy` command available to you.
{{<command user=""user"" host=""login.archer2"">}}
module load gct
which globus-url-copy
(out)/work/y07/shared/gct/v6.2.20201212/bin/globus-url-copy
{{</command>}}
3\. Transfer a single file to your home directory on JASMIN (limited space,
but to check things work)
{{<command user=""user"" host=""login.archer2"">}}
globus-url-copy -vb -cred cred.jasmin SRC/FILE gsiftp://gridftp1.jasmin.ac.uk/DEST/FILE
{{</command>}}
Note that we specify the credentials file `cred.jasmin` and use the protocol
`gsiftp://` with no need to specify the username in the connection string
(we've used the path `/~/` to signify ""my home directory"" as the destination
path). Note also that the hostname in this case, `gridftp1.jasmin.ac.uk` is a
host that you can ONLY connect to directly using gsiftp: it does not permit
SSH connections.
In all other aspects, the transfer is the same as for the SSH method (see ""2nd
choice method"" below), so the commands below are very similar: we're just
using the gsiftp method instead of sshftp (both are ways of using the gridftp
transfer protocol)
4\. Recursively transfer a directory of files, using the concurrency option
for multiple parallel transfers
{{<command user=""user"" host=""login.archer2"">}}
globus-url-copy -vb -cd -r -cc 4 -cred cred.jasmin SRC/DATA/ gsiftp://gridftp1.jasmin.ac.uk/DEST/DATA/
{{</command>}}
**NOTE:** The `-cc` option initiates the parallel transfer of several files at
a time, which achieves good overall transfer rates for recursive directory
transfers. This is different from using the `-p N -fast` options which use
parallel network streams to parallelism the transfer of each file.
The `-p N -fast` options (for parallel-streamed transfers) are not currently
working to all JASMIN storage locations, so use at your own risk until further
notice. The transfer should work OK out of ARCHER2 (check by writing a single
file to `/dev/null` at the JASMIN end) but currently will not work properly
when writing to the SOF storage (`/gws/nopw/j04` or `/gws/nopw/j07`, or
`/work/xfc/vol[1-3]`, though other paths should work OK). This is a known
issue at the JASMIN end, thought to be related to network configuration, which
is still under investigation. Single-stream transfers (omitting the `-p N
-fast` options) should work fine.
Here, the options used are (see `man globus-url-copy` for full details):
-vb | -verbose-perf 
        During the transfer, display the number of bytes transferred
        and the transfer rate per second.  Show urls being transferred
-concurrency | -cc
      Number of concurrent ftp connections to use for multiple transfers.
-cd | -create-dest
        Create destination directory if needed
-r | -recurse
        Copy files in subdirectories
Experiment with different concurrency options (4 is a good start, more than 16
would start to ""hog"" resources so please consider
5\. Use the sync option to synchronise 2 directories between source and target
file systems:
{{<command user=""user"" host=""login.archer2"">}}
globus-url-copy -vb -cd -r -cc 4 -sync -cred cred.jasmin SRC/DATA/ gsiftp://gridftp1.jasmin.ac.uk/DEST/DATA/
{{</command>}}
where `SRC/DATA/` and `/DEST/DATA/` are source and destination paths,
respectively (include trailing slash).
Options are as before but with:
-sync
        Only transfer files where the destination does not exist or differs
        from the source.  -sync-level controls how to determine if files
        differ
Note that the default sync level is 2, see level descriptions below, which
only compares time stamps. **If you want to include a file integrity check
using checksums, you need to use`-sync-level 3` but there may be a performance
cost.**
-sync-level 
        Choose criteria for determining if files differ when performing a
        sync transfer.  Level 0 will only transfer if the destination does
        not exist.  Level 1 will transfer if the size of the destination
        does not match the size of the source.  Level 2 will transfer if
        the timestamp of the destination is older than the timestamp of the
        source, or the sizes do not match.  Level 3 will perform a checksum of
        the source and destination and transfer if the checksums do not match,
        or the sizes do not match.  The default sync level is 2.
So a full sync including comparison of checksums would be:
{{<command user=""user"" host=""login.archer2"">}}
globus-url-copy -vb -cd -r -cc 4 -sync -sync-level 3 -cred cred.jasmin src/data/ gsiftp://gridftp1.jasmin.ac.uk/path/dest/data/
{{</command>}}
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#1st-choice-method:-example,6405,929
2nd choice method: example,"The next-best method for transfers between ARCHER2 and JASMIN is using globus-
url-copy with SSH authentication, as described below:
1\. Load your SSH keys for both JASMIN and ARCHER2 on your local machine, then
log in to ARCHER2.
You will need to have loaded into your SSH agent:
- The SSH key associated with your JASMIN account
- The SSH key associated with your ARCHER2 account, if you have one (it is recommended to use a different one than for JASMIN, if so)
You also need to ensure that you connect with the -A option for agent
forwarding, to enable the JASMIN key to be available for the onward
authentication with the JASMIN server.
Note that you do not (and should not) copy your JASMIN private key to ARCHER2.
It should stay on your local machine. This does mean that you need an ssh-
agent running on your local machine, so this method may not work for long-
running continuous processes that need to spawn transfers.
{{<command user=""user"" host=""login.archer2"">}}
ssh-add <jasmin ssh key> #(path to your JASMIN ssh key file on your local machine)
ssh-add <archer2 ssh key> #(path to your ARCHER2 ssh key if you have one, on on your local machine)
ssh-add -l # check both keys are loaded (are both key signatures listed in the output?)
ssh -A <archer2-username>@login.archer2.ac.uk
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#2nd-choice-method:-example,1294,222
(ARCHER2 now uses multi-factor auth at this stage),"{{</command>}}
2\. Load the `gct` module (to make the current `globus-url-copy` command
available in the path)
{{<command user=""user"" host=""login.archer2"">}}
module load gct
which globus-url-copy
(out)/work/y07/shared/gct/v6.2.20201212/bin/globus-url-copy
{{</command>}}
3\. Transfer a single file to your home directory on JASMIN (limited space,
but to check things work)
{{<command user=""user"" host=""login.archer2"">}}
globus-url-copy -vb <file> sshftp://<jasmin-username>@hpxfer1.jasmin.ac.uk/~/<file>
{{</command>}}
Obviously, replace `<file>` with the path to the file you want to transfer.
From here on, the commands are the same as described above in the ""1st choice
method"" but simply replace
-cred cred.jasmin gsiftp://gridftp1.jasmin.ac.uk
with
sshftp://<jasmin-username>@hpxfer1.jasmin.ac.uk
",https://help.jasmin.ac.uk/docs/data-transfer/transfers-from-archer2#(archer2-now-uses-multi-factor-auth-at-this-stage),802,89
Adding and removing SSH keys from an External Cloud VM,"When you create a machine in a JASMIN External Cloud tenancy, the SSH key
associated with your JASMIN account is uploaded to the machine to grant you
access to the machine as `root`:
{{<command>}}
ssh -A root@<external ip>
{{</command>}}
However, this is a one-time operation when the machine is created. **Updating
your SSH key in the JASMIN Accounts Portal is not reflected in External Cloud
VMs.** Once initial access has been granted, you as the tenancy admin are
responsible for **all** configuration of the machine, including the SSH keys
allowed to access the machine. For example, you may choose to grant access to
a user who does not have a JASMIN account by adding their SSH key to the
machine.
**IMPORTANT:** When you change your SSH key in the JASMIN Accounts Portal, you
**must retain your old private key** until you have added your new key to all
External Cloud VMs that you administer. Failing to do so will result in you
being locked out of those machines.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/adding-and-removing-ssh-keys-from-an-external-cloud-vm,974,168
Adding and removing SSH keys,"The allowed SSH keys for a user can be found in `$HOME/.ssh/authorized_keys`
for the user. For `root`, this is `/root/.ssh/authorized_keys`.
To grant access to a user, they must first {{<link ""../getting-started/generate-ssh-key-pair"">}}generate an SSH key pair{{</link>}}. Once they have done this, they should give you
their **public** key. **The private key should never leave the user's
local machine.** Once you have added this public key as a new line to the
`authorized_keys` file for the target user on your External Cloud VM, the user
will be able to SSH to the machine.
Similarly, to disable access for a user, just remove their public key from the
`authorized_keys` file on the machine.
**IMPORTANT:** When replacing an old key with a new one, make sure that you
add the new key before removing the old one or you may accidentally lock
yourself out of your machine.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/adding-and-removing-ssh-keys-from-an-external-cloud-vm#adding-and-removing-ssh-keys,877,143
Cluster-as-a-Service - Identity Manager,"This article describes how to deploy and use the JASMIN Cluster-as-a-Service
(CaaS) Identity Manager.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager,102,14
Introduction,"The Identity Manager consists of a
[FreeIPA](https://www.freeipa.org/page/Main_Page) server, a
[Keycloak](https://www.keycloak.org/) server and a gateway/proxy server that
work together to provide a single identity across all cluster types, whether
via a web-browser, SSH or custom CLI tools like `kubectl`.
[FreeIPA](https://www.freeipa.org/page/Main_Page) is an open-source identity
management system specifically designed to manage Linux hosts and the user
accounts on those hosts. To do this, It integrates
[LDAP](https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol),
[Kerberos](https://en.wikipedia.org/wiki/Kerberos_\(protocol\)),
[NTP](https://en.wikipedia.org/wiki/Network_Time_Protocol),
[DNS](https://en.wikipedia.org/wiki/Domain_Name_System) and a [certificate
authority](https://en.wikipedia.org/wiki/Certificate_authority) into a single
unit that is easy to install and configure.
[Keycloak](https://www.keycloak.org/) is an open-source product that provides
single sign-on (SSO) using [OpenID Connect](https://openid.net/connect/) and
[SAML](https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language),
primarily aimed at web-based services.
FreeIPA and Keycloak are powerful systems, and a full discussion of their
capabilities is beyond the scope of this article. This article focuses on
their use within the CaaS system, and will be sufficient for the vast majority
of users. **Any usage that deviates from that described in the JASMIN CaaS
documentation is not explicitly supported, should something go wrong.**
All hosts deployed using CaaS are registered with the FreeIPA instance for
your tenancy, and FreeIPA provides DNS, user/group management and access
control policies for those hosts. FreeIPA is also the single source of truth
for users and groups on your clusters. It is **not** possible to link with
other accounts, including JASMIN accounts. Keycloak is used to provide OpenID
Connect support for web applications, and for Kubernetes authentication.
Although Keycloak can manage its own users and groups, in the Identity Manager
setup it consumes the users and groups from FreeIPA via the LDAP integration
in order to provide a single user account across all clusters.
The web interfaces for FreeIPA and Keycloak are exposed through a single
gateway/proxy host. This host is also configured to allow SSH access for all
active users, which means it can be used with [SSH agent
forwarding](https://www.ssh.com/ssh/agent#sec-SSH-Agent-Forwarding) as a [jump
host](https://en.wikipedia.org/wiki/Jump_server) for SSH access to clusters
without an external IP (similar to the way that the  MISSING LINK work.)
The Identity Manager does not have self-service user registration or password
reset - these operations must be performed by an admin on behalf of the user.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#introduction,2813,353
Cluster configuration,"The following variables are available when creating an Identity Manager:
Variable |  Description  |  Required?  |  Can be updated?  
---|---|---|---  
External IP  |  The external IP that will be attached to the gateway host. This is the the IP that can be used as a jump host for SSH access.  |  Yes  | No  
Admin password  |  The password for the `admin` account. When the Identity Manager is created, this is the only user that exists. Please make sure you choose a secure password.  **WARNING: This password cannot be changed.** Changing the admin password in the FreeIPA web interface will break cluster configuration for all clusters. |  Yes  | No 
Admin IP ranges  |  One or more IP ranges from which admins will access the FreeIPA and Keycloak web interfaces, in [CIDR notation](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation). Any attempt to access the admin interfaces froman IP address that is not in these ranges will be blocked. FreeIPA and Keycloak allow the creation and modification of users and permissions for all your clusters, so it is recommended that this range be as small as possible. If you are not sure what value to use here, contact your local network administrator to find out the appropriate value for your network.  |  Yes  |  Yes  
FreeIPA size  |  The machine size to use for the FreeIPA server.  |  Yes  | No  
Keycloak size  |  The machine size to use for the Keycloak server.  |  Yes  | No  
Gateway size  |  The machine size to use for the gateway server.  |  Yes  | No  
Gateway domain  |  The domain to use for the gateway server.<br>If left empty, `<dashed-gateway-ip>.sslip.io` is used (this uses the [sslip.io](https://sslip.io/) service). For example, if the selected gateway IP is `192.171.139.83`, the domain will be `192-171-139-83.sslip.io`.<br>If given, the domain must already be configured to point to the **External IP** , otherwise configuration will fail. Only use this option if you have control over your own DNS entries - the CaaS system will **not** create a DNS entry for you.  |  No  |  No  
{.table .table-striped}
Once configuration is complete, the FreeIPA web interface will be available at
`https://<gateway domain>`. You should be able to authenticate with the
username `admin` and the password that was given at deployment time:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-8Czq4TDXQY.png"" caption=""FreeIPA web interface"">}}
The Keycloak web interface is available at `https://<gateway domain>/auth/`.
You should be able to authenticate with the same username and password as
FreeIPA.
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-18g9kpcLBU.png"" caption=""Keycloak web interface"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#cluster-configuration,2718,406
Managing users,"The users of your clusters are not related in any way to JASMIN users - in
fact, there is no requirement that the users of your clusters have a JASMIN
account. The pattern we encourage is that one or more admins with JASMIN
accounts and access to the JASMIN Cloud Portal deploy and maintain clusters on
behalf of their users. Those admins can then create user accounts and grant
access to clusters for their own users without those users even needing to be
aware of JASMIN.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#managing-users,474,86
Creating a user,"To add a new user, first log in to the FreeIPA interface. **Do not add users
via the Keycloak interface.** You will be taken to the users panel, where you
click the **Add** button:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-YE3RJbqLI7.png"" caption=""FreeIPA interface: adding a new user"">}}
This will pop up a dialogue for you to populate some basic information about
the user. The **User login** , **First name** , **Last name** and **New/Verify password** fields are the ones that need to be populated. Pick a strong
password for the user - they can change this later via the FreeIPA interface
if they wish:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-ca8mivu4Fu.png"" caption=""User information dialogue"">}}
Click **Add** to create the user. You must then securely distribute this
password to the user - if possible, write it down and give it to them in
person, otherwise use an encrypted email.
The first time they log in, they will be asked to set a new password. Make
sure they do this as soon as possible:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-1focFj2OE5.png"" caption=""Update password dialogue"">}}
The newly added user cannot do anything except view the users and modify some
of their own information. They can see, but not edit, their group memberships.
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-1LpgGS9J5u.png"" caption=""View of user info"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#creating-a-user,1445,200
Adding an SSH public key,"Adding an SSH public key can be done either by the user themselves or by an
admin. First, navigate to the details page for the user. In the **Account
Settings** section, there is an item called **SSH public keys**. Click the
**Add** button next to it:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-rf1CHPSFBa.png"" caption=""Adding an SSH key (1)"">}}
This will open a dialogue where the SSH public key can be entered:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-tkqBXjmgg6.png"" caption=""Adding an SSH key (2)"">}}
After clicking **Set** , the user interface will show **New: key set** under
the **SSH public keys** item. However, the key is not preserved until the user
is saved by clicking the **Save** button:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-83tahCNg1o.png"" caption=""Adding an SSH key (3)"">}}
Once saved, the content of the **SSH public keys** item will change to a
fingerprint, which means the key was saved correctly. The key can be updated
or deleted at any point in the future if the associated private key is
compromised or lost:
![](file-o8B0Efprrr.png)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#adding-an-ssh-public-key,1135,159
Changing a user's password,"FreeIPA has no facility for self-service password reset, however users can
change their own password or an admin can reset it on their behalf. The
procedure is the same in both cases, except that when changing their own
password the user is required to provide their current password as well as the
new one.
To change a user's password, first navigate to the user details page then
select **Reset password** from the **Actions** dropdown:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-AN9KYOPlgV.png"" caption=""Reset password (1))"">}}
This will open a dialogue where a new password can be entered. An admin
changing the password on behalf of another user will only see the **New/Verify
Password** fields:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-so4iODYIoC.png"" caption=""Reset password (2)"">}}
A user resetting their own password will also see **Current Password** and
**OTP** fields. The current password must be provided. OTP can be ignored.
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-mxaFQCEo4q.png"" caption=""User resetting own password"">}}
After clicking **Reset Password** , the password is changed.
If a user's password is reset by an admin, the user will be asked to change
their password the first time they log in, like when a new user is created.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#changing-a-user's-password,1324,183
Deleting a user,"To delete a user, navigate to the **Identity > Users > Active users**
page. On this page, check the box next the user you want to disable, then
click the **Delete** button:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-6veMwQytmd.png"" caption=""Deleting a user (1)"">}}
In the confirmation dialogue that pops up, make sure to select **preserve** as
the **Delete mode** \- it is not recommended to permanently delete users:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-a7ogWueenK.png"" caption=""Deleting a user (2)"">}}
Upon clicking the **Delete** button, the user will be moved to the **Preserved
users** section:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-jm0VaaEtgX.png"" caption=""Deleting a user (3)"">}}
They will no longer show up as a user on any CaaS hosts or in Keycloak. They
can be easily restored by selecting the user and clicking the **Restore**
button.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#deleting-a-user,926,120
Managing groups,"When you deploy a cluster through CaaS, it may create one or more access
control groups in FreeIPA as part of it's configuration. Some clusters can
also consume additional groups created in FreeIPA. This is discussed in more
detail in the documentation for each cluster type, but the way you manage
group membership is the same in all cases.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#managing-groups,342,59
Creating a new group,"To create a new group, navigate to the **Identity > Groups > User groups**
section and click the **Add** button:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-aNov4uaQ2d.png"" caption=""Creating a new group (1)"">}}
In the resulting dialogue, set the **Group name** and, if you wish, a
**Description** (recommended!). The **Group Type** can be left as **POSIX** ,
even if the group is only to be used for OpenID Connect. By leaving **GID**
empty, a free GID will be allocated:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-KXQDw9RwGW.png"" caption=""Creating a new group (2)"">}}
After clicking the **Add** button, the new group will be available for adding
users.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#creating-a-new-group,699,94
Adding and removing users,"First, navigate to the **Identity > Groups > User groups** section:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-hnj3sXUyRM.png"" caption=""Adding/removing users (1)"">}}
Click on the group that you want to add/remove users for to get to the details
page for that group. To add users, click the **Add** button:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-KEUDEZkOGO.png"" caption=""Adding/removing users (2)"">}}
In the dialogue that pops up, select the users you want to add and click the
**>** button to move them from **Available** to **Prospective** :
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-5D7lycQSQg.png"" caption=""Adding/removing users (3)"">}}
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-eEIqs8FLW0.png"" caption=""Adding/removing users (4)"">}}
Click **Add** to add the users to the group.
To remove users from a group, select them in the user list for the group and
click **Delete** :
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-krx6gFGfbe.png"" caption=""Adding/removing users (5)"">}}
Upon confirmation, the users will be removed from the group.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#adding-and-removing-users,1158,127
The admins group,"There is one special group that is created in FreeIPA by default, called
`admins`. This group is respected by all cluster types and members are granted
permissions across all clusters deployed using CaaS, including (but not
limited to):
- Full admin access to the FreeIPA and Keycloak web interfaces
- SSH access to all hosts deployed using CaaS
- `cluster-admin` access to all Kubernetes clusters
- Access to all Pangeo clusters
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#the-admins-group,430,71
Managing OpenID Connect clients,"For an application to use OpenID Connect to authenticate users, it must first
be registered as a client with Keycloak. Clients are issued with an ID and
secret so that Keycloak knows which application is making an authorisation
request.
To manage your OpenID Connect clients, go to Keycloak at `https://<gateway
domain>/auth/` and click **Administration Console**. Upon signing in with
valid admin credentials (see The admins group above) you will be redirected to
the Keycloak admin console. Click on **Clients** in the menu to see the list
of clients:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-xZnwdQShpx.png"" caption=""Keycloak admin console"">}}
Keycloak itself uses OpenID Connect to handle authentication for its web and
command-line interfaces, so there are several clients related to Keycloak
operations. CaaS will also automatically create new OpenID Connect clients for
clusters that need them - most notably Kubernetes clusters - in which case the
client will be named after the cluster. The client with **Client ID**
`kubernetes` in the list above is an example of a client created by CaaS.
In order to configure an OpenID Connect client to talk to Keycloak, you also
need the client secret. To find out the secret for a client, click on the
client and then click on the **Credentials** tab:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-9ydKRPcO9C.png"" caption=""Keycloak: credentials tab"">}}
The client secret is then shown in a disabled text box, where it can be copied
from:
{{<image src=""img/docs/cluster-as-a-service-identity-manager/file-3uxEBxY9QM.png"" caption=""Keycloak: client secret"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-identity-manager#managing-openid-connect-clients,1651,230
Cluster-as-a-service - Kubernetes,"This article describes how to deploy and use a Kubernetes cluster using JASMIN
Cluster-as-a-Service (CaaS).
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes,108,15
Introduction,"[Kubernetes](https://kubernetes.io/) is an open-source system for automating
the deployment, scaling and management of containerised applications.
Kubernetes is an extremely powerful system, and a full discussion of it's
capabilities is beyond the scope of this article - please refer to the
Kubernetes documentation. This article assumes some knowledge of Kubernetes
terminology and focuses on things that are specific to the way Kubernetes is
deployed by CaaS.
In CaaS, Kubernetes is deployed in a single-master configuration using
[Rancher Kubernetes Engine (RKE)](https://github.com/rancher/rke). This
configuration was chosen so that a single external IP can be used for SSH
access to the cluster and for
[ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/) \-
external IPs are a scarce resource in the JASMIN Cloud and the number
available to each tenancy is limited. It is for this reason that load-balancer
services are also not available. Highly-available (HA) configurations may be
available in the future.
All externally-exposed services, including the Kubernetes API, are
authenticated using the [Identity Manager]({{< ref ""cluster-as-a-service-identity-manager"" >}}), meaning that FreeIPA groups can be used to control
access to the cluster.
The following services are also configured by CaaS (described in more detail
later):
- The [Nginx Ingress Controller](https://kubernetes.github.io/ingress-nginx/)
- The [Openstack Cloud Provider](https://kubernetes.io/docs/concepts/cluster-administration/cloud-providers/#openstack) (Block Storage and Metadata only)
- [Jetstack's cert-manager](https://docs.cert-manager.io/en/latest/)
- The [Kubernetes dashboard](https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#introduction,1772,206
Cluster configuration,"The following variables are available when creating a Kubernetes cluster:
Variable |  Description  |  Required?  |  Can be updated?  
---|---|---|---  
Identity manager  |  The CaaS Identity Manager that is used to control access to the cluster.  |  Yes  |  No  
Version  |  The Kubernetes version to use. The available versions are determined by the RKE version used by the CaaS configuration. This can be changed after initial deployment to upgrade a cluster to a newer Kubernetes version. Before doing this, you should back up your cluster - in particular, you should [take a snapshot of the etcd database](https://rancher.com/docs/rke/latest/en/etcd-snapshots/) and make sure any data in persistent volumes is backed up.  |  Yes  |  Yes  
Worker nodes  |  The number of worker nodes in the cluster. This can be scaled up or down after deployment. When scaling down, there is currently no effort made to drain the hosts in order to remove them gracefully: we rely on Kubernetes to reschedule terminated pods. This may change in the future.  |  Yes  |  Yes  
Master size  |  The size to use for the master node. The master node is configured to be unschedulable, so no user workloads will run on it (just system workloads).  |  Yes  |  No  
Worker size  |  The size to use for worker nodes. Consider the workloads that you want to run and pick the size accordingly. The capacity of the cluster can be increased by adding more workers, but the size of each worker **cannot** be changed after the first deployment.  |  Yes  | No  
Root volume size  |  The size of the root volume of cluster nodes, in GB. This volume must be sufficiently large to hold the operating system (~3GB), all the Docker images used by your containers (which can be multiple GBs in size) and all the logs and ephemeral storage for your containers. For reference, [Google Kubernetes Engine (GKE)](https://cloud.google.com/kubernetes-engine/) deploys hosts with 100GB root disks by default. At least 40GB is recommended.  |  Yes  |  No  
External IP  |  The external IP that will be attached to the master node. This IP is where the Kubernetes API will be exposed, and can be used for SSH access to the nodes.  |  Yes  |  No
Admin IP ranges |  One or more IP ranges from which admins will access the Kubernetes API and dashboard (if enabled), in [CIDR notation](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation). Any attempt to access the API or dashboard from an IP address that is not in these ranges will be blocked. Access to the Kubernetes API may allow the creation of resources in your cluster, so it is recommended that this range be as small as possible. If you are not sure what value to use here, contact your local network administrator to find out the appropriate value for your network.  |  Yes  | Yes  
Kubernetes dashboard  |  Indicates whether to deploy the Kubernetes dashboard.  If selected, the Kubernetes dashboard will be available at the configured domain (see below).  |  Yes  |  Yes  
Dashboard domain  |  The domain to use for the Kubernetes dashboard. If left empty, `dashboard.<dashed-external-ip>.sslip.io` is used. For example, if the selected external IP is `192.171.139.83`, the domain will be `dashboard.192-171-139-83.sslip.io`.  If given, the domain must already be configured to point to the selected **External IP** , otherwise configuration will fail. Only use this option if you have control over your own DNS entries - the CaaS system or Kubernetes will not create a DNS entry for you.  |  No  |  No
{.table .table-striped}  
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#cluster-configuration,3565,580
Accessing the cluster,"Kubernetes is configured to use the OpenID Connect support of the [Identity
Manager]({{< ref ""cluster-as-a-service-identity-manager"" >}}) for
authentication and authorisation. This means that all interactions with the
cluster are authenticated and authorised against the users in FreeIPA, via the
Keycloak integration.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#accessing-the-cluster,319,41
Using the dashboard,"If the option to deploy the dashboard was selected, the Kubernetes dashboard
will be available at `https://<dashboard domain>`. Upon visiting the
dashboard, you will be redirected to Keycloak to sign in:
{{<image src=""img/docs/cluster-as-a-service-kubernetes/file-FQoiCe1v8G.png"" caption=""Keycloak sign-in screen"">}}
Any user that exists in your FreeIPA database is able to log in to the
dashboard, but only those with permissions assigned for the cluster will be
able to see or do anything. Here is an example of what a user with no
permissions will see:
{{<image src=""img/docs/cluster-as-a-service-kubernetes/file-JWVgCWB0YZ.png"" caption=""View for user with no permissions"">}}
And here is an example of what a user with full admin rights will see (see
Using Kubernetes RBAC below):
{{<image src=""img/docs/cluster-as-a-service-kubernetes/file-CXcLW5mzk0.png"" caption=""View for user with full admin rights"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#using-the-dashboard,910,119
Using kubectl,"This section assumes that you have
[kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/), the
Kubernetes command-line client, installed on your workstation. In order to
authenticate with Keycloak, you must also install the
[kubelogin](https://github.com/int128/kubelogin) plugin, which provides OpenID
Connect authentication for kubectl.
In order to configure OpenID Connect, you need to know the client ID and
secret of the OpenID Connect client for your Kubernetes cluster in Keycloak.
If you are an admin, you can [find this information in the Keycloak admin
console]({{< ref ""cluster-as-a-service-identity-manager"" >}}) \- the client
will be named after the cluster. If you are **not** an admin, your admin
should provide you with this information.
Use the following commands to configure kubectl to connect to your Kubernetes
cluster using your Identity Manager, replacing the variables with the correct
values for your clusters:
{{<command>}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#using-kubectl,962,130
Put the configuration in its own file,"export KUBECONFIG=./kubeconfig
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#put-the-configuration-in-its-own-file,31,2
Configure the cluster information,"kubectl config set-cluster kubernetes \
    --server https://${KUBERNETES_EXTERNAL_IP}:6443 \
    --insecure-skip-tls-verify=true
(out)Cluster ""kubernetes"" set.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#configure-the-cluster-information,161,12
Configure the OpenID Connect authentication,"kubectl config set-credentials oidc \
    --auth-provider=oidc \
    --auth-provider-arg=idp-issuer-url=https://${ID_GATEWAY_DOMAIN}/auth/realms/master \
    --auth-provider-arg=client-id=${CLIENT_ID} \
    --auth-provider-arg=client-secret=${CLIENT_SECRET}
(out)User ""oidc"" set.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#configure-the-openid-connect-authentication,280,15
Configure the context and set it to be the current context,"kubectl config set-context oidc@kubernetes --cluster kubernetes --user oidc
(out)Context ""oidc@kubernetes"" created.
kubectl config use-context oidc@kubernetes
(out)Switched to context ""oidc@kubernetes"".
{{</command>}}
Once kubectl is configured, use the oidc-login plugin to authenticate with
Keycloak and obtain an ID token. Running this command launches a temporary
lightweight web server on your workstation that performs the authentication
flow with Keycloak. A browser window will open where you enter your username
and password:
{{<command>}}
kubectl oidc-login
(out)Open http://localhost:8000 for authentication
(out)You got a valid token until 2019-07-11 21:58:06 +0100 BST
(out)Updated ./kubeconfig
{{</command>}}
You can now use kubectl to query the Kubernetes resources to which you have
been granted access:
{{<command>}}
kubectl get nodes
(out)NAME                  STATUS   ROLES               AGE   VERSION
(out)kubernetes-master-0   Ready    controlplane,etcd   12h   v1.13.5
(out)kubernetes-worker-0   Ready    worker              12h   v1.13.5
(out)kubernetes-worker-1   Ready    worker              12h   v1.13.5
(out)kubernetes-worker-2   Ready    worker              12h   v1.13.5
{{</command>}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#configure-the-context-and-set-it-to-be-the-current-context,1217,135
Using Kubernetes RBAC,"Kubernetes includes a powerful [Role-Based Access Control (RBAC)
system](https://kubernetes.io/docs/reference/access-authn-authz/rbac/). A full
discussion of the RBAC system is beyond the scope of this documentation, but
this section gives some examples of how RBAC in Kubernetes can be used in
combination with [FreeIPA groups]({{< ref ""cluster-as-a-service-identity-manager"" >}}) to allow fine-grained access to the cluster.
For every Kubernetes cluster that is deployed, CaaS automatically creates a
group in FreeIPA called `<clustername>_users`. This group, along with the
`admins` group, are assigned the `cluster-admin` role using a
`ClusterRoleBinding`, which grants super-user access to the entire cluster. In
order to grant a user super-user access to the cluster, they just need to be
added to one of these groups (depending on whether you want them to be a
super-user on other clusters as well).
It is also possible to create additional groups in FreeIPA and attach more
restrictive permissions to them.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#using-kubernetes-rbac,1015,145
Example 1: Read-only cluster access,"For example, suppose you have some auditors who require read-only access to
the entire cluster in order to know what workloads are running. The first
thing to do is [create a group in FreeIPA]({{< ref ""cluster-as-a-service-identity-manager"" >}}) \- in this case, you might create a group called
`kubernetes_auditors`. Once the group is created, you can reference it in
Kubernetes by using the prefix `oidc:` \- in this case the group would be
referenced in Kubernetes as `oidc:kubernetes_auditors`. To grant read-only
access to this group for the entire cluster, create a `ClusterRoleBinding`
linking that group to the built-in `view` role:
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubernetes-auditors-read
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: view
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: Group
    name: oidc:kubernetes_auditors
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#example-1:-read-only-cluster-access,931,121
Example 2: Read-write namespace access,"As another example, suppose you have some developers who want to deploy their
app in your cluster, and you want to grant them read-write access to a single
namespace to do this. Again, the first thing you would do is create a group in
FreeIPA called, for example, `myapp_developers`. You can then assign this
group the built-in `edit` role, but this time use a `RoleBinding` that is tied
to a particular namespace:
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: myapp-developers-edit
  namespace: myapp
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: edit
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: Group
    name: oidc:myapp_developers
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#example-2:-read-write-namespace-access,711,96
Using the cluster,"It is beyond the scope of this documentation to discuss how to use Kubernetes: please refer to the Kubernetes documentation for that. This section
describes some things about the way Kubernetes is deployed by CaaS that will
make a difference to how your applications are deployed.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#using-the-cluster,281,46
Ingress,"In CaaS Kubernetes, [Ingress
resources](https://kubernetes.io/docs/concepts/services-networking/ingress/)
are handled by the [Nginx Ingress
Controller](https://kubernetes.github.io/ingress-nginx/), which is exposed at
the external IP used by the master node. The Ingress Controller supports a
wide range of `Ingress` annotations that can be used to customise the
behaviour for particular services - visit the documentation for more details.
In order to expose a service using an `Ingress` resource, each `host` given in
the resource specification must have a DNS entry that points to the external
IP of the master node (where the Ingress Controller is listening). CaaS or
Kubernetes will **not** create these DNS records for you, and it is not
possible to use an IP address as a `host`. If you cannot create or edit DNS
records, you can use [xip.io](http://xip.io/) (or similar services) - these
are ""magic domains"" that provide DNS resolution for any IP address using
domains of the form `[subdomain.]<ip>.xip.io`.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#ingress,1016,148
TLS with cert-manager,"CaaS Kubernetes deployments also include [Jetstack's cert-
manager](https://docs.cert-manager.io/en/latest/), which provides Kubernetes-
native resources for obtaining and renewing SSL certificates - visit the
documentation for more information. CaaS installs a `ClusterIssuer` called
`letsencrypt` that can automatically fetch and renew browser-trusted SSL
certificates from [Let's Encrypt](https://letsencrypt.org/) using
[ACME](https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment).
By using annotations, certificates can be fetched automatically for `Ingress`
resources:
apiVersion: extensions/v1
kind: Ingress
metadata:
  name: myapp
  annotations:
    kubernetes.io/ingress.class: ""nginx""
    cert-manager.io/cluster-issuer: ""letsencrypt""
spec:
  tls:
    - hosts:
        - example.example.com
      secretName: myapp-tls  # This secret will be created by cert-manager
  rules:
    - host: example.example.com
      http:
        paths:
          - path: /
      pathType: prefix
            backend:
              service
    name: myapp
                port: 
      number: 8080
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#tls-with-cert-manager,1110,103
Storage,"CaaS Kubernetes is also configured to take advantage of the fact that it is
running on [Openstack](https://www.openstack.org/). In particular, a [storage
class](https://kubernetes.io/docs/concepts/storage/storage-classes/) is
installed that can dynamically provision
[Cinder](https://docs.openstack.org/cinder/) volumes in response to
[persistent volume
claims](https://kubernetes.io/docs/concepts/storage/persistent-
volumes/#persistentvolumeclaims) being created. This storage class is called
`csi-cinder-sc-delete`, and is consumed like this:
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: myclaim
    spec:
      storageClassName: csi-cinder-sc-delete
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 10Gi
If there is enough quota available, this persistent volume claim should result
in a new Cinder volume being provisioned and bound to the claim. The Cinder
volume will show up in the **Volumes** tab of the JASMIN Cloud Portal with a
name of the form `kubernetes-dynamic-pvc-<uuid>`.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-kubernetes#storage,1070,113
Cluster-as-a-Service - Pangeo,"This article describes how to deploy and use a Pangeo cluster using JASMIN
Cluster-as-a-Service (CaaS).
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo,104,15
Introduction,"[Pangeo](https://pangeo.io/) is a community that promotes a philosophy of
open, scalable and reproducible science, focusing primarily on the
geosciences. As part of that effort, the Pangeo community provides a curated
[Python](https://www.python.org/) ecosystem based on popular open-source
packages like [xarray](http://xarray.pydata.org),
[Iris](https://scitools.org.uk/iris), [Dask](http://dask.readthedocs.io) and
[Jupyter notebooks](http://jupyter.org/), along with documentation and recipes
for deployment on various infrastructures.
The Pangeo cluster type in CaaS is a multi-user implementation of the Pangeo
ecosystem using [JupyterHub](https://jupyter.org/hub) deployed on
[Kubernetes](https://kubernetes.io/), giving users a scalable and fault-
tolerant infrastructure to use for doing science, all through a web-browser
interface. Authentication is handled by the [Identity Manager]({{< ref
""cluster-as-a-service-identity-manager"" >}}) for the tenancy via JupyterHub's
LDAP integration. Each authenticated user gets their own Jupyter notebook
environment running in its own container, isolated from other users. The
automatic spawning of containers for authenticated users is handled by
JupyterHub, which also provides an interface for admins to manage the running
containers. This is achieved by using the [Pangeo Helm
chart](https://github.com/pangeo-data/helm-chart) to deploy the Pangeo
ecosystem on a [CaaS Kubernetes cluster]({{< ref ""cluster-as-a-service-kubernetes"" >}}).
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo#introduction,1492,172
Cluster configuration,"The Pangeo ecosystem is deployed on top of CaaS Kubernetes, so all the
[configuration variables for Kubernetes]({{< ref ""cluster-as-a-service-kubernetes"" >}}) also apply to Pangeo clusters.
In addition, the following variables are available to configure the Pangeo
installation:
Variable |  Description  |  Required?  |  Can be updated?  
---|---|---|---  
Notebook CPUs  |  The number of CPUs to allocate to each user notebook environment.  |  Yes  |  Yes  
Notebook RAM  |  The amount of RAM, in GB, to allocate to each user notebook environment.  |  Yes  |  Yes  
Notebook storage  |  The amount of persistent storage, in GB, to allocate to each user notebook environment. This is where users will store their notebooks and any other files they import. The storage is persistent across notebook restarts - a user can shut down their notebook server and start a new server later without losing their data. Backups are not provided - if required, they are the responsibility of the user or cluster admins.  |  Yes  |  Yes  
Pangeo domain  |  The domain to use for the Pangeo notebook web interface.<br><br> If left empty, `pangeo.<dashed-external-ip>.sslip.io` is used. For example, if the selected external IP is `192.171.139.83`, the domain will be `pangeo.192-171-139-83.sslip.io`.<br><br>If given, the domain must already be configured to point to the selected **External IP** (see Kubernetes configuration), otherwise configuration will fail. Only use this option if you have control over your own DNS entries - the CaaS system or Kubernetes will not create a DNS entry for you.  |  No  |  No  
{.table .table-striped}
These variables define the amount of resource available to each user for
processing - in order to appropriately configure (a) the size of your cluster
worker nodes and (b) the resources for each notebook environment, you will
need to consider how many users you are expecting and what workloads they
might want to run.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo#cluster-configuration,1944,304
Accessing the cluster,"Access to the underlying Kubernetes cluster is achieved in the [same way as
any other CaaS Kubernetes cluster]({{< ref ""cluster-as-a-service-kubernetes"" >}}).
The Pangeo web interface will be available at `https://<pangeo domain>`.
Access to the Pangeo interface is managed through FreeIPA, and users sign in
with the same username and password as for other clusters. As part of the
cluster configuration, CaaS will create a [FreeIPA group]({{< ref ""cluster-as-a-service-identity-manager"" >}}) called `<clustername>_notebook_users`.
Granting access to the Pangeo interface is as simple as adding a user to this
group.
Before adding user to group:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-2pkaT0W3qj.png"" caption=""Adding user to group: before"">}}
And after:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-BEYTxt4Ed9.png"" caption=""Adding user to group: after"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo#accessing-the-cluster,885,108
Using the Pangeo environment,"A full discussion of the capabilities of Jupyter notebooks, the JupyterLab
environment and the many libraries included in the Pangeo ecosystem is beyond
the scope of this documentation. There are plenty of examples on the web, and
Pangeo provide some [example notebooks](https://github.com/pangeo-data/pangeo-
example-notebooks).
As a very brief example of the power and simplicity of Jupyter notebooks,
especially on Kubernetes, this short video (no sound) shows a user signing
into a CaaS Pangeo cluster and uploading a notebook. When run, the notebook
spawns a Dask cluster inside Kubernetes and uses it to perform a noddy but
relatively time-consuming calculation. You can see the Dask cluster scale up
to meet demand in the Dask dashboard:
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo#using-the-pangeo-environment,745,113
Administering the hub,"JupyterHub allows admin users to manage the notebooks running in the system,
and even to impersonate other users. Unfortunately, the JupyterHub LDAP
integration does not currently allow for an entire group to be designated as
admins, so admin access in JupyterHub is granted specifically to the FreeIPA
`admin` user.
To access the admin section, first click **Hub > Control Panel** in the
JupyterLab interface:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-vB8S8UoNaw.png"" caption=""Administering the hub (1)"">}}
This will open the JupyterHub control panel - any user can use this to start
and stop their notebook server, but admins see an extra **Admin** tab:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-NUxDCoKB3d.png"" caption=""Administering the hub (2)"">}}
Clicking on this tab will show a list of the users in the hub, along with
buttons to start and stop the servers for those users:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-c8yR4Lveso.png"" caption=""Administering the hub (3)"">}}
Additional admins can be added by clicking the **edit user** button for that
user. This will pop up a dialogue:
{{<image src=""img/docs/cluster-as-a-service-pangeo/file-DBOc03v93N.png"" caption=""Administering the hub (4)"">}}
Check the **Admin** checkbox and click **Edit User** to save. The user is now
an admin for the hub.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-pangeo#administering-the-hub,1344,180
Cluster-as-a-Service - Shared storage,"This article describes how to deploy and use shared storage clusters using
JASMIN Cluster-as-a-Service (CaaS).
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-shared-storage,111,15
Introduction,"CaaS provides shared storage clusters that can be mounted on multiple nodes to
provide common storage across all those nodes.
These storage clusters are not intended to be directly consumed by users, but
are taken as cluster configuration options by other clusters. In particular,
[Slurm clusters]({{< ref ""cluster-as-a-service-slurm"" >}}) take a shared
storage cluster as a configuration option - the shared storage is mounted on
each cluster node for user home directories.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-shared-storage#introduction,476,72
NFS,"[Network File System (NFS)](https://en.wikipedia.org/wiki/Network_File_System)
is a protocol for accessing remote network-attached storage. NFS is also used
to refer to the implementation of the protocol in the Linux kernel.
A CaaS NFS shared storage cluster provides a simple
[NFS](https://en.wikipedia.org/wiki/Network_File_System) server. A volume is
attached of the specified size, formatted as an [XFS
filesystem](https://en.wikipedia.org/wiki/XFS), mounted at `/srv` and exported
with no authentication.
NFS servers do not get an external IP, and so are only accessible from the
tenancy's internal network.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-shared-storage#nfs,613,78
Cluster configuration,"The following variables are available to configure an NFS cluster:
Variable |  Description  |  Required?  |  Can be updated?  
---|---|---|---  
Identity manager  |  The CaaS Identity Manager that is used to control access to the cluster.  |  Yes  |  No  
Volume size  |  The size of the NFS data volume in GB.  |  Yes  |  No  
Size  |  The size to use for the NFS server.  |  Yes  |  No
{.table .table-striped}",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-shared-storage#cluster-configuration,411,72
Cluster-as-a-Service - Slurm,"This article describes how to deploy and use a Slurm cluster using JASMIN
Cluster-as-a-Service (CaaS).
{{< alert type=""danger"" >}}
CaaS Slurm clusters are currently disabled because of a security problem
with the images that were being used. We are working on a new system which
will provide slurm clusters.
{{< /alert >}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm,323,52
Introduction,"The [Slurm Workload Manager](https://slurm.schedmd.com/) is a popular open-
source job scheduler. It provides facilities for executing and monitoring
workloads across a set of nodes and managing contention for those nodes by
maintaining a queue of pending jobs.
Slurm is a powerful scheduling system, and a full discussion of the available
commands and options is beyond the discussion of this article - please consult
the Slurm documentation. This article focuses on the specifics of how to
deploy and access a Slurm cluster in CaaS.
In CaaS, a Slurm cluster consists of a single login node and several worker
nodes. The Linux users and groups on the cluster are managed by the [Identity
Manager]({{< ref ""cluster-as-a-service-identity-manager"" >}}) for the tenancy,
meaning that SSH access to the nodes can be controlled using FreeIPA groups.
User home directories are mounted on all nodes using a [shared storage
cluster]({{< ref ""cluster-as-a-service-shared-storage"" >}}). Slurm is
configured with a single queue, to which all the compute hosts are added.
The login node can optionally be assigned an external IP, however external IPs
are a scarce resource in the JASMIN Cloud - if you want to preserve your
external IPs for other clusters, you can use the Identity Manager gateway host
as a jump host.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#introduction,1307,207
Cluster configuration,"The following variables are available to configure a Slurm cluster:
| Variable |  Description  |  Required?  |  Can be updated? |
|---|---|---|---|
| Identity manager  |  The CaaS Identity Manager that is used to control access to the cluster.  |  Yes  |  No  |
| Shared storage  |  The shared storage cluster to use for user home directories.  |  Yes  |  No  |
| Worker nodes  |  The number of worker nodes in the cluster. This can be scaled up or down after deployment. When scaling down, there is currently no effort made to drain the hosts in order to remove them gracefully: jobs executing on the removed hosts will fail. This may change in the future. |  Yes  |  Yes  
| Login node size  |  The size to use for the login node.  |  Yes  |  No  
Compute node size  |  The size to use for the compute nodes.  |  Yes  |  No  
| External IP  |  The external IP to attach to the login node. This is optional - if not given, the cluster can still be accessed by using the Identity Manager's gateway host as a jump host for SSH.  |  No  |  No
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#cluster-configuration,1065,199
Accessing the cluster,"The Slurm hosts are configured to use the users and groups from FreeIPA using
[SSSD](https://docs.pagure.org/SSSD.sssd/). They are also configured to use
SSH keys from FreeIPA for SSH authentication (password-based SSH is disabled).
For every Slurm cluster that is deployed, CaaS automatically creates a group
in FreeIPA called `<clustername>_users`. This group, along with the `admins`
group, are permitted SSH access to the hosts in the cluster. To permit a user
SSH access to a Slurm cluster, they just need to be [added to one of these
groups]({{< ref ""cluster-as-a-service-identity-manager"" >}}) (depending on
whether you also want them to be an admin on other clusters).
Once they have been added to one of these groups, the Slurm cluster can be
accessed via SSH. The following is an example of accessing a Slurm cluster
without an external IP using the Identity Manager's gateway as a jump host:
{{<command user=""user"" host=""localhost"">}}
    ## Add SSH key to the session
    ssh-add /path/to/ssh/key
    ## SSH to the identity manager gateway with agent forwarding enabled
    ssh -A jbloggs@192.171.139.83
{{</command>}}
{{<command user=""jbloggs"" host=""identity-gateway-0"">}}
    ## SSH to the Slurm login node
    ssh 192.168.3.16
{{</command>}}
{{<command user=""jbloggs"" host=""slurm-login-0"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#accessing-the-cluster,1307,187
Check that we are in our home directory,"pwd
(out)/home/users/jbloggs
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#check-that-we-are-in-our-home-directory,29,2
Check the Slurm status,"sinfo
(out)PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST
(out)compute*     up 1-00:00:00      3   idle slurm-compute-[0-2]
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#check-the-slurm-status,127,13
Run a simple job,"srun -N3 -l /bin/hostname
(out)0: slurm-compute-0.novalocal
(out)1: slurm-compute-1.novalocal
(out)2: slurm-compute-2.novalocal
{{</command>}}
A more in-depth discussion of the capabilities of Slurm is beyond the scope of
this document - please refer to the Slurm documentation.",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service-slurm#run-a-simple-job,278,34
Introduction,"JASMIN Cluster-as-a-Service (CaaS) is a service on the JASMIN Cloud that aims
to make it easy to provision and maintain clusters of various types by
providing a simple, intuitive interface via the JASMIN Cloud Portal.
CaaS is only available in the External Cloud, and machines provisioned by the
CaaS system are subject to the usual constraints:
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#introduction,346,56
Root access,"- The provisioning user gets root access to the hosts.
- Clusters can be customised, for example to add new packages.
- But be careful not to break the configuration of the clustering software!
  - **Note:** If a tenants makes a change which breaks the cluster patching, the cluster will have to be rebuilt.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#root-access,308,54
Patching,"- Users are responsible for applying patches.
- However, patching a cluster is a simple task triggered in the JASMIN Cloud Portal.
- Cluster admins to decide when to trigger a patch.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#patching,183,32
Access to CEDA archive and JASMIN Group Workspaces,"- No POSIX access to the CEDA archive or JASMIN Group Workspaces.
- Read-only access via HTTP/OPeNDAP is possible.
- Read-write access to the JASMIN Object Store is also possible.
- The CaaS system has cluster types that provide shared storage between clusters.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#access-to-ceda-archive-and-jasmin-group-workspaces,262,43
User management,"- Tenancies must manage their own users/groups.
- Users of services in a tenancy do not need a JASMIN account.
- However a JASMIN account **is** required to use the JASMIN Cloud Portal.
- Encourages a structure where admins provision and maintain clusters on behalf of their users.
- The CaaS system has an Identity Manager which provides identity services for a tenancy, i.e. users have a single identity across all clusters within in a single tenancy.
- However this identity is not linked to a JASMIN account.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#user-management,513,88
Available cluster types,"Cluster type | Details
---|--- 
[Identity Manager]({{< ref ""cluster-as-a-service-identity-manager"" >}})  |  Manages identity and permissions for other clusters using a combination of [FreeIPA](https://www.freeipa.org/page/Main_Page) and [Keycloak](https://www.keycloak.org/).  
[NFS]({{< ref ""cluster-as-a-service-shared-storage"" >}}) |  Shared storage for other clusters using a simple NFS server.  
[Kubernetes]({{< ref ""cluster-as-a-service-kubernetes"" >}}) |  A Kubernetes cluster deployed using [Rancher Kubernetes Engine](https://rancher.com/docs/rke/latest/en/).
[Pangeo]({{< ref ""cluster-as-a-service-pangeo"" >}}) |  The [Pangeo](https://pangeo.io/) stack deployed on Kubernetes.  
[Slurm]({{< ref ""cluster-as-a-service-slurm"" >}}) (currently disabled) |  A batch cluster running the [Slurm workload manager](https://slurm.schedmd.com/).
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#available-cluster-types,870,81
Creating a cluster,"Clusters are created via the JASMIN Cloud Portal using a new **Clusters** tab
alongside **Overview** , **Machines** , and **Volumes**. If you do not see
this tab, then clusters are not enabled for your tenancy.
{{< image src=""img/docs/cluster-as-a-service/file-N77Jt6iuMA.png"" caption=""Select clusters tab if available"" wrapper=""col-6 mx-auto"" >}}
Click on the tab and you will see a list of your existing clusters. To create
a new cluster, click on the **New cluster** button - this will launch a
dialogue where you can select a cluster type:
{{<image src=""img/docs/cluster-as-a-service/file-m8MJKBGWbg.png"" caption=""Select a cluster type"">}}
Clicking on a cluster type will show a form collecting parameters for the
cluster, which will be different for each cluster type (the options for each
cluster type are discussed in more detail in other articles):
{{<image src=""img/docs/cluster-as-a-service/file-6zCKxYATJd.png"" caption=""Specify parameters for new cluster"">}}
Click **Create cluster** to start the cluster creation. The cluster may take
several minutes to configure (especially as the initial configuration includes
a full patch of operating system packages):
{{<image src=""img/docs/cluster-as-a-service/file-sBQzvCEIP0.png"" caption=""Create the cluster"">}}
Once configuration is complete, the cluster status will become **READY**. The
cluster is then ready to use:
{{<image src=""img/docs/cluster-as-a-service/file-FysROPzFxf.png"" caption=""Cluster in READY status"">}}
More details of how to use each cluster type are given in other help articles
on this site, linked in the table of available cluster types above.
Visit the **Machines** tab to see the machines that were created as part of
the cluster:
{{<image src=""img/docs/cluster-as-a-service/file-uPRA6pYBcQ.png"" caption=""List machines created as part of the cluster"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#creating-a-cluster,1835,243
Updating a cluster,"Some cluster options, such the number of workers in a Kubernetes cluster, can
be updated after a cluster has been created. To do this, select **Update
cluster options** from the **Actions...** dropdown for the cluster:
{{<image src=""img/docs/cluster-as-a-service/file-hjbidWNoWg.png"" caption=""Select update cluster options"">}}
This will launch a dialogue similar to the one for creating a cluster, except
some of the options will be greyed out as they cannot be changed:
{{<image src=""img/docs/cluster-as-a-service/file-gov0vLALmy.png"" caption=""Next dialogue"">}}
After updating the options, click **Update cluster** to re-configure the
cluster. As with cluster creation the cluster status will change to
**CONFIGURING** , becoming **READY** once the re-configuration is complete.
Where possible, the CaaS system makes an effort to re-configure the cluster
with as little downtime as possible.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#updating-a-cluster,893,120
Patching a cluster,"""Patching"" refers to the specific operation of updating the operating system
packages on a machine. It is expected that tenants in the External Cloud will
ensure that their machines are regularly patched as a security measure, as
package updates often contain fixes for known vulnerabilities that can be
exploited if left unpatched.
The CaaS system makes patching clusters easy - just select **Patch cluster**
from the **Actions...** dropdown for the cluster and confirm the operation in
the dialogue that appears:
{{<image src=""img/docs/cluster-as-a-service/file-8UgmxTXHq4.png"" caption=""Select patch cluster"">}}
{{<image src=""img/docs/cluster-as-a-service/file-dUZ0anUR7C.png"" caption=""Patch cluster - confirmation"">}}
As with creating and updating, the cluster status will first become
**CONFIGURING** , becoming **READY** once the patching is complete. Where
possible, the CaaS system will patch the cluster with as little downtime as
possible.
Clusters that have not been patched recently will be flagged in the Cloud
Portal:
{{<image src=""img/docs/cluster-as-a-service/file-O49bJXoZzQ.png"" caption=""Unpatched clusters"">}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#patching-a-cluster,1128,144
Deleting a cluster,"To delete a cluster, just select **Delete** from the **Actions...** dropdown
for the cluster and confirm the operation in the dialogue that appears:
{{<image src=""img/docs/cluster-as-a-service/file-YbBzoEzWVV.png"" caption=""Select delete cluster"">}}
{{<image src=""img/docs/cluster-as-a-service/file-90OF1EFAXx.png"" caption=""Delete confirmation"">}}
The cluster status will become **DELETING** :
{{<image src=""img/docs/cluster-as-a-service/file-qxaWljk6Op.png"" caption=""Deleting"">}}
This will delete the machines associated with the cluster. Once the machines
have been deleted, the cluster will be removed. A deleted cluster cannot be
restored.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/cluster-as-a-service#deleting-a-cluster,643,68
Introduction to the JASMIN Cloud,"In addition to the traditional batch computing (LOTUS) and storage (Group
Workspaces) services, JASMIN also provides a cloud computing service.
Many users will already be familiar with cloud services through the use of one
of the large public providers (e.g. Amazon AWS or Microsoft Azure). The JASMIN
Cloud is similar in that it allows an institution or project to consume
compute resources as a utility, with no need to provision and maintain the
associated physical infrastructure. Users can provision their own virtual
machines (VMs) within the JASMIN infrastructure, allowing for greater
flexibility. The JASMIN Cloud also allows users to provision clusters for
Identity Management, Kubernetes, and Slurm clusters amongst others (see
Cluster-as-a-Service).
The thing that makes the JASMIN Cloud unique is its colocation with the CEDA
Archive and Group Workspaces. The JASMIN Cloud is ideally suited to projects
that work with such data, and can enable novel solutions for the manipulation
and presentation of data to end-users.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud,1033,157
Cloud terminology,"Different cloud providers have different terms for the users within their
cloud and the chunks of resource they have been allocated. In the JASMIN Cloud
documentation, we will use the following terminology:
- **Tenancy:** An allocation of resources, i.e. virtual CPUs, RAM and block storage, within the cloud.
- **Tenant:** A group (institution or project) that has been allocated a tenancy in the cloud.
- **Tenancy Admin(istrator):** The person designated as the administrator of a tenancy. There would usually also be a deputy administrator.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud#cloud-terminology,545,84
JASMIN Cloud Architecture,"In order to provide as much flexibility as possible for tenants while
preserving the security of the system, the JASMIN Cloud is split into two
parts (see the schematic below). Both parts of the JASMIN Cloud are
administered through the same self-service portal, allowing tenancy admins to
provision VMs as required, within the quota of their tenancy.
{{<image src=""img/docs/introduction-to-the-jasmin-cloud/file-rJTVn4CXil.png"" caption=""jasmin cloud achitecture"">}}
The **JASMIN External Cloud** is an Infrastructure-as-a-Service (IaaS)
offering, and sits outside of the main JASMIN firewall. Tenants are allowed
root access and have complete responsibility for all system administration
tasks. This means that tenants are able to provision their own infrastructure
(e.g. web portals, remote desktop services), but it also means that tenants
are responsible for the security of their machines (e.g. patching, firewall
configuration) and for managing their own users. Because it is outside of the
JASMIN firewall, tenancies in the External Cloud cannot directly access the
JASMIN storage (including PFS, and SOF), and so there is no filesystem level
access to the CEDA Archive or Group Workspaces - all access to these data is
via the usual external interfaces (i.e. the Object Store, FTP, OpenDAP, HTTP).
We also have our Cluster-as-a-Service available to external cloud tenants
which is a Platform-as-a-Service offering that tenants can use to deploy
clusters including, an identity cluster, storage cluster (NFS), and a
Kubernetes cluster.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud#jasmin-cloud-architecture,1543,224
External Cloud patching policy,"{{<alert type=""info"">}}
We expect tenants to react in a timely manner to any security vulnerabilities.
This means critical vulnerabilities are patched within 7 days, and high
vulnerabilities are patched within 14 days. This is following UKRI security
policy. Failure to comply may result in tenancy access being revoked and
machines powered down.
{{</alert>}}
By contrast, the **JASMIN Managed Cloud** is a Platform-as-a-Service (PaaS)
offering, sitting inside the main JASMIN firewall, meaning it can reach the
JASMIN storage. In order to preserve security, this means that tenants are
_not_ allowed root access, and can only deploy VMs from a limited set of pre-
approved templates. However, tenants are not responsible for the security of
these machines, and users on VMs within the tenancy are JASMIN users.
Currently, only two templates are available - an SSH bastion, or login
machine, and a Scientific Analysis server with a similar configuration to the
shared JASMIN Scientific Analysis servers. The Scientific Analysis servers
have the CEDA Archive and Group Workspaces mounted.
Both offerings have a similar network structure. Each tenancy has its own
local network, where machines have addresses in the `192.168.3.0/24` range -
all machines in the tenancy can talk to each other on this network. In
addition, each tenancy has an ""edge device"", which is effectively a virtual
router. Similarly to your home broadband router, this allows machines within
the tenancy to talk to machines outside the tenancy, and ensures packets
coming back into the tenancy are forwarded to the correct machine. These ""edge
devices"" also provide a [Network Address Translation
(NAT)](https://en.wikipedia.org/wiki/Network_address_translation) facility,
which allows machines to be allocated an IP address that is visible outside of
the tenancy. In the Managed Cloud, this translates to an IP address that is
visible on the JASMIN network. In the External Cloud, it translates to an IP
address that is visible on the _public internet_.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud#external-cloud-patching-policy,2026,310
External vs. Managed - pros and cons,"Attribute |  Managed Cloud  |  External Cloud  
---|---|---  
Self-service provisioning  |  Yes  |  Yes  
Filesystem level access to JASMIN Storage (PFS, SOF)  |  Yes  |  No  
Root access  |  No  |  Yes  
Provision custom infrastructure  |  SSH bastion or Scientific Analysis server only  |  Build from generic Ubuntu or CentOS templates  
Security and patching  |  Handled by infrastructure team  |  Tenant's responsibility  
User management  |  JASMIN users  |  Tenant's responsibility  
Visibility to public internet  |  No  |  Yes (limited number of external IPs)   
Ability to provision Cluster-as-a-Service  |  No  |  Yes
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud#external-vs.-managed---pros-and-cons,652,93
Getting a JASMIN Cloud Tenancy,"To start a conversation with us about getting a JASMIN Cloud Tenancy for your
project, please contact JASMIN Support.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/introduction-to-the-jasmin-cloud#getting-a-jasmin-cloud-tenancy,118,19
Provisioning a Sci VM in a Managed Cloud Tenancy,"This article is for admins and managers of managed-cloud tenancies
and shows how to provision a sci VM within one. It involves the following:
- Becoming a member of a managed cloud tenancy
- Provisioning a VM
A ""sci vm"" is essentially the same as the general-access scientific analysis
servers, but created within a specific tenancy aimed at a certain group of users. 
The manager/deputy then has the responsibility to stop/start/restart or redeploy the VM, and to
control who can access it.
The managed cloud tenancy has four access roles:
- `MANAGER` role: can approve `DEPUTY`, `ADMIN`, and `USER` role access requests
- `DEPUTY` manager role: can approve `ADMIN` and `USER` role access requests
- `ADMIN` role: can access the cloud portal and can restart or provision the Sci VM
- `USER` role: can log in into the sci VM from a JASMIN login node
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/provisioning-tenancy-sci-vm-managed-cloud,850,145
Apply for access to the Sci tenancy,"A managed cloud tenancy is accessible via the {{<link ""jasmin_cloud_portal"">}}JASMIN cloud portal{{</link>}}. 
Access is controlled by a service corresponding to the name of the tenancy: these services are listed under {{<link ""https://accounts.jasmin.ac.uk/services/analysis_vms/"">}}Sci Analysis VMs{{</link>}} category of ""My Services"".
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/provisioning-tenancy-sci-vm-managed-cloud#apply-for-access-to-the-sci-tenancy,339,38
Access the tenancy,"With an ADMIN role, you can log in to the [JASMIN cloud portal](https://cloud.jasmin.ac.uk/) using the same credentials for signing into the JASMIN accounts portal.
You will be presented with the ""Dashboard"" page -below- showing the tenancies
you have access to. On the dashboard, select the organization representing the
tenancy to find out the VM provisioned within a given tenancy, e.g ncas-sci-M
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-jdw37TM5c1.png"" caption=""dashboard showing tenancies available to this user"">}}
Note: The ""ncas-sci-M"" tenancy shown below has 0 machines as this is a new tenancy.
We will proceed next to the provisioning of a virtual machine.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/provisioning-tenancy-sci-vm-managed-cloud#access-the-tenancy,690,96
Provision a virtual machine,"**Step 1:** Select ""Machines"" from the top menu, then click ""New machine"" to
create a new VM. Choose a name for the new VM. Then select a size from the
drop-down menu which shows the catalog of VM template size. For example,
select ""j4.large"" which allocates 8 CPUs and 32GB of RAM resources for the new
VM
**IMPORTANT:** A Sci machine should be deployed with **a minimum of 2 GB RAM**
**IMPORTANT** : A Sci machine name should not exceed 8 characters long. The
preferred naming format is sci<number> e.g. sci1
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-9B3PGwdTJf.png"" caption=""dialogue for creating a new VM"">}}
The VM with the chosen name ncas-sci1 is created and it is running as shown
below.
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-2BhBYPt9hA.png"" caption=""vm now shown in dashboard"">}}
**Step 2:** Attach an external IP to the new VM by clicking ""Actions"" and
selecting ""Attach external IP"". Note that you can restart the VM from the
""Actions"" menu.
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-jTpZDG70NA.png"" caption=""attach external IP (1)"">}}
**Step 3:** From the box that pops up -see image below- click on the ""+""
(green button) to add an IP. Then click on the down arrow next to ""Select an
external IP"" you will see the IP address to assign to the machine, select the
IP and click attach IP
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-6VxGf1Kgz4.png"" caption=""attach external IP (2)"">}}
**Step 4:** Click ""Attach IP""
**Important note:** As `ADMIN` and `MANAGER` of a Sci tenancy, you should note the
""External IP"" as this is the IP address you will need to provide to your users
in order for them to connect to the machine via SSH using a JASMIN login
server.
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-PDx3Ze7Nub.png"" caption=""summary dashboard showing IP allocated."">}}
**Step 5:** An overview of the resources used by the VM is shown below
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-7IJvElS5yE.png"" caption=""resources dashboard"">}}
**Note 1:** Only ADMIN and MANAGER roles have access to the JASMIN cloud
portal and can provision VMs. ADMIN and MANAGER roles of a Sci tenancy will
not be granted root access.
**Note 2:** ADMIN and MANAGER roles will not allow you to SSH into the Sci VM.
It is necessary to have a USER role to do so.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/provisioning-tenancy-sci-vm-managed-cloud#provision-a-virtual-machine,2370,349
Connect to the VM,"From a JASMIN login server, login to the machine using the External IP address.
In the same way, as you login to a JASMIN scientific server via login1. Your
initial connection to JASMIN from your local machine needs to have your SSH
key loaded in your SSH authentication agent, and you must have SSH Agent
Forwarding enabled ""-A"", see also how  MISSING LINK.
{{<image src=""img/docs/tenancy-based-sci-vm-managed-cloud/file-OCr9XwHyWz.png"" caption=""terminal session showing connection to new VM"">}}
**Note** that although the new provisioned Sci VM has a local hostname (in
this example, `sci1-202012041148.ncas-sci-m.jasmin.ac.uk` ), this is NOT
registered in any Domain Name Service (DNS) by default, and we are not able to
arrange this for you, so you need to connect
to the machine using its External IP address, not the name.
**Note** : Users should report issues to the `ADMIN` and/or `MANAGER` of the
tenancy based SCI VM initially, rather than the JASMIN team. If the issue cannot be
resolved by the `ADMIN` and/or `MANAGER`, **they** should contact the JASMIN helpdesk.
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/provisioning-tenancy-sci-vm-managed-cloud#connect-to-the-vm,1077,167
Managing storage,"When provisioned, a virtual machine gets allocated a small hard disk (the
exact size of the disk depends on the selected machine size). This disk is
intended to run the operating system only. If you require additional storage
for data, it is possible to add extra volumes to a virtual machine.
First, create a new volume by navigating to the volumes tab and clicking on
""New Volume"":
{{<image src=""img/docs/sysadmin-guidance-external-cloud/file-BsmkG3EXIw.png"" caption=""create volume dialogue"">}}
This will launch a dialog that allows you to specify a name and size for the
volume:
{{<image src=""img/docs/sysadmin-guidance-external-cloud/file-HRTEvPf0f6.png"" caption=""specify name and size for volume"">}}
Once the volume becomes available, you can attach it to a VM. First, click on
the ""Actions"" button and select ""Attach volume to machine"":
{{<image src=""img/docs/sysadmin-guidance-external-cloud/file-Y8uws7yYHi.png"" caption=""menu options"">}}
This will open a dialog allowing you to select the VM that you want to attach
the volume to:
{{<image src=""img/docs/sysadmin-guidance-external-cloud/file-tMKNp6gxCt.gif"" caption=""attach volume to VM"">}}
Once the volume has attached to the VM, the new disk will be visible to the
machine but will not be usable. This can be verified using the `lsblk`
command:
{{<command>}}
lsblk
(out)NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
(out)sda      8:0    0   4G  0 disk 
(out)└─sda1   8:1    0   4G  0 part /
(out)sdb      8:16   0  50G  0 disk
{{</command>}}
Here, we can see that the operating system is recognising the new disk - `sdb`
\- but there are no partitions or file systems associated with it. To make the
disk usable, it must be formatted with a filesystem and mounted somewhere,
e.g. `/data`:
{{<command>}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#managing-storage,1759,254
Create a single partition spanning the whole disk,"fdisk /dev/sdb
(out)Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
(out)Building a new DOS disklabel with disk identifier 0x598d636f.
(out)Changes will remain in memory only, until you decide to write them.
(out)After that, of course, the previous content won't be recoverable.
(out)
(out)Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)
(out)
(out)Command (m for help): n
(out)Partition type:
(out)    p   primary (0 primary, 0 extended, 4 free)
(out)    e   extended
(out)Select (default p):
(out)Using default response p
(out)Partition number (1-4, default 1):
(out)Using default value 1
(out)First sector (2048-33554431, default 2048):
(out)Using default value 2048
(out)Last sector, +sectors or +size{K,M,G} (2048-33554431, default 33554431):
(out)Using default value 33554431
(out)
(out)Command (m for help): w
(out)The partition table has been altered!
(out)
(out)Calling ioctl() to re-read partition table.
(out)Syncing disks.
(out)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#create-a-single-partition-spanning-the-whole-disk,1007,140
Verify that the partition was created,"lsblk /dev/sdb
(out)NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
(out)sdb      8:16   0  16G  0 disk
(out)└─sdb1   8:17   0  16G  0 part
(out)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#verify-that-the-partition-was-created,140,22
Create a filesystem on the partition,"mkfs.ext4 /dev/sdb1
(out)mke2fs 1.42.9 (4-Feb-2014)
(out)Filesystem label=
(out)OS type: Linux
(out)Block size=4096 (log=2)
(out)Fragment size=4096 (log=2)
(out)Stride=0 blocks, Stripe width=0 blocks
(out)1048576 inodes, 4194048 blocks
(out)209702 blocks (5.00%) reserved for the super user
(out)First data block=0
(out)Maximum filesystem blocks=4294967296
(out)128 block groups
(out)32768 blocks per group, 32768 fragments per group
(out)8192 inodes per group
(out)Superblock backups stored on blocks:
(out)    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
(out)    4096000
(out)
(out)Allocating group tables: done
(out)Writing inode tables: done
(out)Creating journal (32768 blocks): done
(out)Writing superblocks and filesystem accounting information: done
(out)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#create-a-filesystem-on-the-partition,792,93
Mount the filesystem,"mkdir /data
mount /dev/sdb1 /data
(out)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#mount-the-filesystem,40,6
Verify that the filesystem is now available,"lsblk
(out)NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
(out)sda      8:0    0   4G  0 disk 
(out)└─sda1   8:1    0   4G  0 part /
(out)sdb      8:16   0  50G  0 disk 
(out)└─sdb1   8:17   0  50G  0 part /data
df -h
(out)Filesystem      Size  Used Avail Use% Mounted on
(out)/dev/sda1       4.0G  1.4G  2.7G  34% /
(out)devtmpfs        222M     0  222M   0% /dev
(out)tmpfs           245M     0  245M   0% /dev/shm
(out)tmpfs           245M  8.8M  236M   4% /run
(out)tmpfs           245M     0  245M   0% /sys/fs/cgroup
(out)tmpfs            49M     0   49M   0% /run/user/0
(out)/dev/sdb1        50G   53M   47G   1% /data
(out)
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#verify-that-the-filesystem-is-now-available,628,86
Add a line to /etc/fstab to make the mount persistent (i.e. automatic mount on boot),"echo ""/dev/sdb1  /data  ext4  defaults  0 0"" >> /etc/fstab
{{</command>}}
",https://help.jasmin.ac.uk/docs/for-cloud-tenants/sysadmin-guidance-external-cloud#add-a-line-to-/etc/fstab-to-make-the-mount-persistent-(i.e.-automatic-mount-on-boot),74,10
beginners training workshop - materials,"The [CEDA team](https://jasmin.ac.uk/about/team/) regularly run hands-on
interactive training workshops for users of JASMIN. The workshop makes use of
exercises and tutorials to help users to become familiar with the JASMIN
environment.
There are two types of workshop activities; exercises (ex) and tutorials (t).
Exercises are interactive task-based activities based on different common
scenarios of using JASMIN. Whereas tutorials provide in-depth explanations and
demonstrations (but are not interactive). All workshop resources are [freely
available on GitHub](https://github.com/cedadev/jasmin-workshop) and have
supporting videos on
[YouTube](https://www.youtube.com/playlist?list=PLhF74Yhqhjqn8NDgU7xfKGLGP8h-FQ1lt).
Anyone can complete the exercises in their own time with the resources linked,
but joining an in-person workshop is a great chance for you to interact with
the team, to discuss your research needs, and to provide feedback on the
JASMIN service. Details about future workshops will be advertised on the [CEDA
events](https://www.ceda.ac.uk/events/) page - these are currently being run
virtually due to the Covid-19 pandemic.
Most of the exercises are stand-alone and do not necessarily need to be
completed in order - however, if you are a new user, then we recommend you
follow the exercises in order as it will help to explain the general workflows
that you may encounter on JASMIN.
**Note:** If you are using the materials individually (outside of an organised
workshop event) then you will need to use your own JASMIN account and a group
workspace which you already belong to, rather than the training accounts, and
`workshop` group workspace, respectively. Instead of the `workshop` LOTUS
queue, please use the `test` queue in this case.
",https://help.jasmin.ac.uk/docs/getting-started/beginners-training-workshop,1768,252
Overall aims of the workshop:,"- To engage novice to intermediate users in best practice for working on JASMIN via hands-on exercises
- To increase understanding about: 
  - which parts of JASMIN are suited for different tasks
  - software available  on JASMIN
- To provide a face-to-face environment where the JASMIN Team can offer support and feedback on a range of issues/problems
- To gather feedback on the gaps in current provision of documentation
",https://help.jasmin.ac.uk/docs/getting-started/beginners-training-workshop#overall-aims-of-the-workshop:,424,69
Generate an SSH key pair,"This article explains how to create an SSH key pair for logging in to JASMIN.
You can also use this procedure to update an existing SSH key pair for JASMIN.
However, if you are experiencing problems logging in to JASMIN you are advised
to first check [Login problems]({{< ref ""login-problems"" >}}) before changing your
key. Once you have created your SSH key pair it will need to be uploaded to
the JASMIN accounts portal. If this is the first time you have created a key
pair then this will be done when you create an account on the portal (Step 2
of [Get Started with JASMIN]({{< ref ""get-started-with-jasmin"" >}})). If you
are updating your key for an existing account then you will need to update it
in your [JASMIN
profile](https://accounts.jasmin.ac.uk/account/login/?next=/account/profile/).
",https://help.jasmin.ac.uk/docs/getting-started/generate-ssh-key-pair,799,130
The shell terminal,"Generating an SSH key pair requires an SSH client and a Shell terminal. Linux
and Mac users can use a standard terminal which is very likely to have SSH
installed. Windows users are advised to [install the MobaXterm
application]({{< ref ""../uncategorized/mobaxterm"" >}}) which provides a linux-style terminal
with all the relevant utilities included. Figures 1 and 2 show example
terminal windows on a Mac and Windows (using MobaXterm).
{{<image src=""img/docs/generate-ssh-key-pair/file-QrkL51B5fW.png"" caption=""Mac terminal"" >}}
{{<image src=""img/docs/generate-ssh-key-pair/file-jmOb6PSApE.png"" caption=""Terminal using Mobaxterm client on Windows"">}}
",https://help.jasmin.ac.uk/docs/getting-started/generate-ssh-key-pair#the-shell-terminal,652,81
Using ssh-keygen to create an SSH key pair,"The Linux command `ssh-keygen` should be used to generate your SSH key pair.
Open a terminal and generate your public and private key, as follows (replace
the e-mail address with your own):
{{<command user=""localuser"" host=""localhost"">}}
ssh-keygen -t rsa -b 2048 -C ""me@somewhere.ac.uk"" -f ~/.ssh/id_rsa_jasmin
{{</command>}}
At the prompt, type a **secure passphrase** to protect your SSH private key.
**This is a requirement for access to JASMIN machines. Use a new, different
passphrase whenever you generate a new key.** Note that nothing is echoed to
the screen when you enter your passphrase, so it may look like it is not
working.
The output will look something like this:
{{<command user=""localuser"" host=""localhost"">}}
(out)Generating public/private rsa key pair.
(out)Enter passphrase (empty for no passphrase): <ADD PASSPHRASE HERE>
(out)Enter same passphrase again: <REPEAT PASSPHRASE HERE>
(out)Your identification has been saved in /home/users/meuser/.ssh/id_rsa_jasmin.
(out)Your public key has been saved in /home/users/meuser/.ssh/id_rsa_jasmin.pub.
(out)The key fingerprint is:
(out)74:14:95:8a:31:73:cc:5c:af:be:91:04:01:c2:39:0b me@somewhere.ac.uk
{{</command>}}
Running `ssh-keygen` will generate two files in your `$HOME/.ssh/` directory:
- `id_rsa_jasmin` -  private key file (which should have permission ""400"", i.e. readable only by you)
- `id_rsa_jasmin.pub` - public key file
The **public** key file is the part that you need to share in order to access
JASMIN. The **private** key file should be protected and not shared with
others.
",https://help.jasmin.ac.uk/docs/getting-started/generate-ssh-key-pair#using-ssh-keygen-to-create-an-ssh-key-pair,1563,214
Converting a PuTTYGen SSH private key for use with MobaXterm (Windows only),"If you have previously used the
[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/) utilities to
login to JASMIN and you wish to move over to using [MobaXterm]({{< ref ""../uncategorized/mobaxterm"" >}}) then please see these [instructions to convert your SSH
private key from the PuTTYGen format to the OpenSSH
format](https://docs.oseems.com/general/application/putty/convert-ppk-to-ssh-key) (as used by Linux/Mac). Please save your resulting OpenSSH key as `id_rsa_jasmin` in your `$HOME/.ssh/` directory.
",https://help.jasmin.ac.uk/docs/getting-started/generate-ssh-key-pair#converting-a-puttygen-ssh-private-key-for-use-with-mobaxterm-(windows-only),516,59
Get a JASMIN portal account,"This article explains how to register on the JASMIN accounts portal.
Having a jasmin portal account does not by itself provide you with any access to JASMIN machines or services.
",https://help.jasmin.ac.uk/docs/getting-started/get-jasmin-portal-account,179,30
JASMIN accounts portal,"The [JASMIN accounts portal](https://accounts.jasmin.ac.uk/) is the place where you manage your JASMIN account and can apply for access to the many services which you may want to use on JASMIN.
{{<image src=""img/docs/get-jasmin-portal-account/file-cGUc81o2HG.png"" caption=""JASMIN accounts portal"">}}
",https://help.jasmin.ac.uk/docs/getting-started/get-jasmin-portal-account#jasmin-accounts-portal,300,35
Apply for a new JASMIN account,"To apply for a JASMIN account you need to use an email address affiliated with your academic institution. Then proceed as follows:
**Step 1** : On [JASMIN accounts portal](https://accounts.jasmin.ac.uk/)
select ""Apply for a new JASMIN account"". This will take you to the following
page to enter your details.
{{<image src=""img/docs/get-jasmin-portal-account/file-02LXgtpr1G.png"" caption=""Application details page"">}}
**Step 2** : Select your research discipline.
{{<image src=""img/docs/get-jasmin-portal-account/file-OBizwG5pAb.png"" caption=""Research discipline"">}}
**Step 3** : Select the institution you are affiliated with. If your
institution is not listed, you can add new institution details by clicking the
plus button. Remember to provide supporting information to assess your
eligibility for a JASMIN account and then submit your application
{{<image src=""img/docs/get-jasmin-portal-account/file-naVrzJTryc.png"" caption=""Select institution"">}}
**Step 4** : Follow the URL link sent to your email address. Once your email
has been verified, you will receive a second email with a subject 'Application
approved' inviting you to complete the account creation. This link will take
you to the following page where you have to choose your JASMIN account
credentials, register your SSH public key and then click **Create
account**
{{<image src=""img/docs/get-jasmin-portal-account/file-02LXgtpr1G.png"" caption=""Create account"">}}
**Step 5** : An example of registering SSH public key
{{<image src=""img/docs/get-jasmin-portal-account/file-nxDCKF4WAc.png"" caption=""Add public key"">}}
**Step 6** : Agree to the JASMIN Terms and Conditions of Access
{{<image src=""img/docs/get-jasmin-portal-account/file-RkGZaPnIVT.png"" caption=""Accept conditions of use"">}}
**Step 7** : Your JASMIN account is created and you can log in using your
credentials
{{<image src=""img/docs/get-jasmin-portal-account/file-pk5LZMFzVE.png"" caption=""Try login"">}}
",https://help.jasmin.ac.uk/docs/getting-started/get-jasmin-portal-account#apply-for-a-new-jasmin-account,1934,234
Get a login account,"This article explains how to apply for access to the shared JASMIN servers.
",https://help.jasmin.ac.uk/docs/getting-started/get-login-account,76,13
Get a login account,"A user with a `jasmin-login` account is allocated a `HOME` directory of
**100GB** and can access the shared JASMIN servers (Scientific servers, data
transfer servers) and the LOTUS batch cluster. Sign in into your [JASMIN accounts
portal](https://accounts.jasmin.ac.uk/) where you can apply for a JASMIN login
account representing the JASMIN access role appropriate to your affiliation.
{{<image src=""img/docs/get-login-account/file-S2sHe8m6aY.png"" caption=""Sign in"">}}
**Step 1:** Select Login services and navigate to the 'More information' on
this service
{{<image src=""img/docs/get-login-account/file-lLkbVNBejK.png"" caption=""More information"">}}
**Step 2:** Apply for access to jasmin-login service
{{<image src=""img/docs/get-login-account/file-PtHzCBBGZx.png"" caption=""Apply for jasmin-login"">}}
**Step 3:** Provide supporting information
{{<image src=""img/docs/get-login-account/file-Vz26gVnqgG.png"" caption=""Provide supporting information"">}}
**Step 4:** Your request is pending for approval
{{<image src=""img/docs/get-login-account/file-sJXxVgVh7k.png"" caption=""Request pending"">}}
**Step 4:** Upon approval, a notification email is sent to you. Additionally,
a notification counter in the bell will appear on the top left corner of the
menu bar on your JASMIN account portal page. You have now access to the login
server and to the scientific servers
{{<image src=""img/docs/get-login-account/file-Ampt0CXqnH.png"" caption=""Notification"">}}
Under 'My Services' you can view all the services that you currently have
access to or have requested access for. Note: Every time a notification is
acknowledged the counter is reset or decremented.
Now you can proceed to [How to login]({{< ref ""login"" >}})
",https://help.jasmin.ac.uk/docs/getting-started/get-login-account#get-a-login-account,1707,207
Get Started with JASMIN,"This article explains the steps involved for most users to gain
access to the JASMIN environment.
The {{<link ""jasmin_site"">}}JASMIN{{</link>}} scientific data analysis environment is
administered by {{<link ""ceda_site"">}}CEDA{{</link>}} and supports a wide variety of
scientific workflows across environmental science domains.
",https://help.jasmin.ac.uk/docs/getting-started/get-started-with-jasmin,328,40
Essential steps,"The steps listed in **Table 1** (below) are required for scientific end-users
to gain ssh access to the JASMIN login machines which are the ""front door"" for
most users. Other services are available once these basic steps have been
completed.
An overview of JASMIN compute & storage components is given in the
presentation given at the [JASMIN workshop](https://github.com/cedadev/jasmin-workshop) \- we strongly encourage all new users to watch this video recording
and take a look at the [accompanying
exercises](https://github.com/cedadev/jasmin-workshop). These go into detail
about all the basic things you may want to do with JASMIN.
**Table 1.** Steps involved for a scientific end-user to gain login access to
JASMIN. Click on the links under the 'Details' column to find instructions for
each step.
Step  |  Details  |  Comments  
---|---|---  
1  |  [Generate an SSH key]({{< ref ""generate-ssh-key-pair"" >}}) |  Create this locally, ready to upload it to your JASMIN Account profile  
2  |  [Get a JASMIN portal account]({{< ref ""get-jasmin-portal-account"" >}}) |  Access to JASMIN services is controlled by the [JASMIN Accounts Portal](https://accounts.jasmin.ac.uk/) \- you must register for an account. Using this portal, you will then need to apply for access to the JASMIN services and privileges you require (as described in the steps below). Some of these services will require manual approval by individuals external to the CEDA/JASMIN team. Creating a JASMIN portal account does not by itself provide you with any access to JASMIN machines or services. You must complete all the steps below to gain full access.  
3  |  [Check network details]({{< ref ""check-network-details"" >}}) |Check details of your network connection to JASMIN to ensure you are able to connect.   In order to maintain a secure and reliable scientific infrastructure for its users, JASMIN restricts login access by maintaining an ""allow list"" of network domains. 
4  |  [Request ssh login access to JASMIN]({{< ref ""get-login-account"" >}}) |  Apply for the `jasmin-login` service, which will allow you to connect to JASMIN machines using ssh.  
5  |  Apply for access to additional services on JASMIN  |  JASMIN has a range of additional services, access to which is managed via the Accounts Portal. Search and apply for any services you require in the portal. In most cases, users will ""belong"" to a particular scientific project which may already have a presence on JASMIN, often in the form of a [Group Workspace]({{< ref ""short-term-project-storage"" >}}). See here how to [Apply for access to a Group Workspace]({{< ref ""apply-for-access-to-a-gws"" >}}).
6  |  [How to login]({{< ref ""login"" >}}) |  Follow these steps for logging in to JASMIN via ssh, but we also have several other tutorials that may be useful - see [Exercises 1-3 here](https://github.com/cedadev/jasmin-workshop).
7  |  [Get a CEDA account]({{< ref ""ceda-archive"" >}}) |  The CEDA Archive provides access to thousands of atmospheric, climate change, and earth observation datasets. The Archive is directly accessible read-only throughout JASMIN. Some datasets on the CEDA Archive require specific agreements, and to apply for access to these, you will need a CEDA account.  
8  |  [Link your JASMIN and CEDA accounts]({{< ref ""update-a-jasmin-account"" >}})  |  The final step is to link your CEDA account to your JASMIN account. This allows you filesystem access to data on CEDA Archive. This is a step that you will be guided through in the JASMIN accounts portal.
{.table .table-striped}
The table above describes the initial steps to get you started on JASMIN -
however, there are a variety of ways that users can get the most out of
JASMIN, that are not described in the table. Users are strongly encouraged to
read further about JASMIN, and/or to discuss with scientific colleagues to
gain an understanding of the resources available.
The documentation in this site is split into sections, based on different
areas/services on JASMIN. You can navigate these sections in the menu on the
left-hand side of your screen. A short description of each of these sections
is below:
- [Getting Started]({{< ref ""getting-started"" >}}) \- this details all the steps needed to get started on JASMIN. Most documents are linked to from the table above, but there may be some other useful information there too.
- [Interactive Computing]({{< ref ""interactive-computing"" >}}) \- this introduces the resources on JASMIN available for interactive computing. This type of computing is the most common workflow on JASMIN for new users. 
- {{<link ""../batch-computing/lotus-overview"">}}LOTUS batch processing cluster{{</link>}} \- this introduces the available resources on JASMIN for batch computing. 
- [Software on JASMIN]({{< ref ""software-overview"" >}}) \- Information on running software packages within JASMIN
- [Data Transfer]({{< ref ""data-transfer"" >}}) \- this category includes guidance on transferring data to and from JASMIN.
- [MASS]({{< ref ""mass"" >}}) \- JASMIN has Read-only access to the Met Office MASS storage archive. This section explains how to get access. 
- [Short-term project storage]({{< ref ""short-term-project-storage"" >}}) \- this section introduces the concept of shared Group Workspaces and the different storage types on JASMIN. Group Workspaces (GWSs) are portions of disk allocated for particular projects to manage themselves, enabling collaborating scientists to share network accessible storage on JASMIN. 
- [Long-term archive storage]({{< ref ""long-term-archive-storage"" >}}) \- this section describes the long-term CEDA Archive which consists of thousands of atmospheric, climate change, and earth observation datasets. This is directly accessible as a file system from the shared science machines on JASMIN.
- [For Cloud Tenants]({{< ref ""for-cloud-tenants"" >}}) \- JASMIN also provides a cloud computing service, this section describes this. 
- [Workflow management]({{< ref ""workflow-management"" >}}) \- this category details the various tools available for managing your workflow.
The CEDA team also regularly hosts training workshops and events. Details
about past and future events can be found on the [events
section](https://www.ceda.ac.uk/events/) of the CEDA website.
",https://help.jasmin.ac.uk/docs/getting-started/get-started-with-jasmin#essential-steps,6268,945
JASMIN status,"This article lists sources of information about the status of JASMIN services.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-status,79,12
CEDA Status page,"The {{< link ceda_status >}}CEDA Status page{{< /link >}} is updated regularly to announce or track current and upcoming incidents which may affect JASMIN and CEDA services. Please check for known incidents or announced shceduled maintenance before contacting the helpdesk.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-status#ceda-status-page,274,40
JASMIN dashboard,"The {{<link ""https://mon.jasmin.ac.uk"" >}}JASMIN metrics dashboard{{</link>}} has been redeveloped and is now available again. 
Please read the introductory information on that page.
Currrently it provides:
- GWS Dashboard
  - view of all the volumes in a group workspace across different storage types, showing quota and usage
- LOTUS Dashboard
  - showing pending and running jobs per partition (queue) and other useful metrics
- Power Dashboard
  - showing power consumption of the various components of JASMIN
- Tape dashboard
  - showing summary information on tape usage by consortium
This is still under active development and further dashboards may be added in due course.
Please also keep an eye on:
- `JASMIN-USERS` email list (all users should be on this list. If not, please ask)
- {{< link ceda_news >}}CEDA News{{< /link >}} articles on the CEDA website
- {{< link ceda_x >}}@cedanews on X (formerly Twitter){{</link>}}
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-status#jasmin-dashboard,934,145
What are training accounts?,"JASMIN training accounts are TEMPORARY accounts that provide a person with
access to JASMIN for a specific event (such as a training workshop) organised
in advance.
The benefits of using these accounts are:
- permissions/services are consistent across all training accounts 
- these permissions include (but are limited to) those normally anticipated for use within training/hackathon events
- they provide access to someone who may not be eligible for a full account - setting up access for multiple users in advance of an event is more efficient for all involved than the usual registration process
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#what-are-training-accounts?,601,95
When should they be used?,"- By participants of training events led by the JASMIN team
- (By special arrangement with the event organiser) by participants of other events such as training workshops or hackathons which require temporary access to JASMIN
In both cases, use of the training accounts is only for the duration of the
event. Use beyond the event requires the normal registration process.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#when-should-they-be-used?,372,61
Who can request these accounts?,"- Organisers of training events / hackathons, by contacting the JASMIN team.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#who-can-request-these-accounts?,77,12
For event organisers,,https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#for-event-organisers,0,0
How to request training accounts for your event,"If you think these accounts could be useful for you, please contact the
helpdesk with the following information:
- Name/date of event 
- Estimated number of attendees (note: we only have 150 such accounts, and events sometimes overlap)
- What services the accounts will need access to e.g. sci machines, GWS, CEDA Archive, Notebook Service, Transfer Servers, LOTUS, or any other special services on JASMIN 
- Any special requests for accessing resources
  - By default, the training accounts have access to the following services. 
  - Any request for other services beyond these would need to be considered by the JASMIN team: 
    - Login, nx-login, sci and xfer servers
    - `hpxfer` service
    - `workshop` group workspace (`/gws/pw/j07/workshop`)
    - use of LOTUS via the `workshop` Slurm queue
    - Jupyter Notebooks service (requires users to set password)
Once the JASMIN team have confirmed that we can support your event, you will
need to collect and supply the following **at least 2 weeks** before your
event:
- Email addresses for all attendees who need a training account. 
  - These addresses cannot already be associated with an existing JASMIN account. They must be different.
Please note that we cannot guarantee the following during your event:
- no login problems
- uptime of services
- no problems due to usage at scale (particularly for use of sci servers and/or Notebook Service)
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#how-to-request-training-accounts-for-your-event,1408,225
What to tell your event attendees,"The JASMIN team will set up the accounts and send credentials to attendees
approximately 1 week before your event.
Please ensure you have given the following information to attendees:
- A link to this help page. Tell them all information they need is under the 'for event attendees' section.
- Tell users what services they have been granted access to (see above) and any additional information e.g. full path to any GWSs, whether they will need to use the JASMIN Notebook Service or accounts portal. 
- Tell the users when the training accounts will be closed down. This is usually within 24 hours of the end of the event. They would be responsible for copying any important data and/or code elsewhere if it is important that these are not lost when the accounts are wiped.
***
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#what-to-tell-your-event-attendees,779,136
For event attendees,,https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#for-event-attendees,0,0
How to set up your temporary account,"1. Training account credentials will be emailed to you via OneDrive. Sometimes the OneDrive email ends up in junk/spam folders, please check here. If you still can't find the email, please contact the helpdesk ASAP. To access the training account credentials, you must: 
    1. Click on the OneDrive link.
    1. Enter your email address (if you already have a JASMIN account, this will be the alternative email address you provided). 
    1. If you are having difficulty opening the link, please sign out of any alternative OneDrive accounts and then try again. 
    1. You will then be emailed a verification code. 
    1. Enter this code on OneDrive.
    1. Download the files. These contain your training account credentials. 
1. Next, you need to use these training account credentials to set up your own machine for accessing JASMIN. Follow the instructions in [Ex00](https://github.com/cedadev/jasmin-workshop/tree/master/exercises/ex00). You MUST do this before your event. 
1. You may need access to the JASMIN Notebook Service and Accounts Portal. Your event organiser will let you know whether this is needed for your particular event. If you do need it, you will need to follow the steps in the section below. 
    1. For the JASMIN Beginners workshop: you do not need this. 
    1. For the JASMIN Advanced workshop: you do need this. Please follow the steps in the section below. 
1. Before the event, familiarise yourself with the [JASMIN help documentation site]({{< ref ""/"" >}}). This should answer most questions you may have. 
If you are attending a 3rd-party-led event, we suggest taking a look at the
[other JASMIN workshop training materials](https://github.com/cedadev/jasmin-
workshop) \- especially if you are a new user. Your event organiser should
provide full details of how the training account should be used for that
particular event - please contact them if you have any issues.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#how-to-set-up-your-temporary-account,1910,299
JASMIN Notebook Service and Accounts Portal access,"Access to these services requires a password. This is not sent in the OneDrive
link. If you need access to these services, you must:
  * Go to the [Reset Account Password function of the JASMIN Accounts portal](https://accounts.jasmin.ac.uk/account/password_reset/)
  * Enter your email address (NB: the one to be used for the training account)
  * You will then receive a password reset email (don’t forget to check your spam folder). Follow the steps to reset the password. 
  * You can now use this new password for accessing the notebook service and the accounts portal.
",https://help.jasmin.ac.uk/docs/getting-started/jasmin-training-accounts#jasmin-notebook-service-and-accounts-portal-access,575,92
How to login,"This article explains how to login to JASMIN.
The instructions below cover the process of logging in using a terminal client
only. For a graphical linux desktop, please see alternative instructions using
[NoMachine NX]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}).
",https://help.jasmin.ac.uk/docs/getting-started/login,275,37
Preparing your credentials: loading your SSH private key,"In order to log in using SSH, you need to present your SSH private key as your
credential (instead of a username and password). Your private key should
reside **only** on your local machine, so this process of loading your key is
something that you do on that local machine. Even if you connect via a
departmental server, there should be no need to upload your private key to
that machine: the process of loading your key and enabling agent forwarding
should ensure that the key is available to subsequent host(s) in the chain of
SSH ""hops"".
The details of how to do this can vary depending on whether your local machine
runs Windows, MacOS or Linux.
Whichever system you're using, you will need to use an appropriate tool to
load your private key so that it can be presented at the time of logging in.
**Linux and MacOS users:** `ssh-agent` can be used (see instructions below).
**Windows users:** we recommend the [MobAgent utility within MobaXterm]({{<ref ""mobaxterm"" >}}).
MobXterm is a linux terminal emulator for Windows.
`ssh-agent` is a utility that stores private keys and makes them available to
other software that use the SSH protocol to connect to remote clients.
There are two stages to loading your private key into `ssh-agent`: starting
the agent and then loading your private key. Use the following commands to do
this:
**IMPORTANT: The dollar symbol '$' at the start of the command line in these
example represents the shell prompt as displayed in your terminal - it does
not need to be typed!**
{{<command>}}
eval $(ssh-agent -s)
ssh-add ~/.ssh/id_rsa_jasmin
(out)Enter passphrase for /home/users/jpax/.ssh/id_rsa_jasmin:
(out)Identity added: /home/users/jpax/.ssh/id_rsa_jasmin (/home/users/jpax/.ssh/id_rsa_jasmin)
{{</command>}}
When you run the `ssh-add` command you will be prompted to enter the
passphrase that you specified when generating your SSH key pair. (If you use
the c shell, replace the command ""eval $(ssh-agent -s)"" with ""exec ssh-agent
$SHELL"")
You can test whether your key has been loaded by using the ""-l"" option to list
the currently loaded keys in your agent:
{{<command>}}
ssh-add -l
(out)2048 SHA256:iqX3NkPCpschVdqPxVde/ujap2cM0mYaAYYedzBGPaI /Users/jpax/.ssh/id_rsa_jasmin (RSA)
{{</command>}}
This confirms that the key in `id_rsa_jasmin` has been loaded and is ready for
use.
**Notes:**
- The `ssh-agent` session should persist until killed or until system shutdown, even if you close the terminal in which you set it up.
- It is very important that you protect your private key with a strong passphrase, known only to you. Keys must not be shared between individuals.
- If you get an error when attempting the above commands please see [login problems]({{< ref ""login-problems"" >}}).
- Your public key will have been automatically propagated by the JASMIN accounts system to all the machines to which you have access rights, so should already be present in the correct place. Do not attempt to place the public key manually on any host within JASMIN: it will get automatically overwritten.
Mac users (OS X Leopard onwards) can optionally benefit from linking the SSH
key to Keychain, which securely stores the passphrase as well. This means that
even after a reboot, your SSH key is always available in any Terminal session
automatically. See `man ssh-add` and look for the `--apple-use-keychain` or
`--apple-load-keychain` options, if available (These replace the now-
deprecated `-K` option).
",https://help.jasmin.ac.uk/docs/getting-started/login#preparing-your-credentials:-loading-your-ssh-private-key,3445,542
The JASMIN login servers,"See this article for a [description and listing of the login servers]({{< ref
""login-servers"" >}})
",https://help.jasmin.ac.uk/docs/getting-started/login#the-jasmin-login-servers,99,15
Logging in to JASMIN,"Assuming that you have loaded your SSH private key using one of the methods
described above, then you can login to a login server as follows (do this on your own/local machine):
{{<command>}}
ssh -A <user_id>@<login_server>
{{</command>}}
For example, user ""jpax"" might login to the JASMIN login server with:
{{<command>}}
ssh -A jpax@login1.jasmin.ac.uk
{{</command>}}
The `-A` **argument is important** because it enables ""agent-forwarding"".
This means that your the information about your SSH private key is forwarded
to your remote session on the login server so that you can use it for further
SSH connections. (Windows users can [enable X-forwarding in
MobaXterm](https://mobaxterm.mobatek.net/documentation.html#4_1_6) saved
sessions).
 ## Can't login?
  * Check our troubleshooting guide: [login problems]({{< ref ""login-problems"" >}})
",https://help.jasmin.ac.uk/docs/getting-started/login#logging-in-to-jasmin,844,116
The login message,"When you first login you will see a message that provides some useful
information (see Figure 1).
{{<image src=""img/docs/login/file-dKz1hO4aLb.png"" caption=""The login message shown on login1.jasmin.ac.uk. Note that in this case, the -A option enabling onward connections was omitted."">}}
",https://help.jasmin.ac.uk/docs/getting-started/login#the-login-message,288,38
X-forwarding for graphical applications (within JASMIN only),"Some applications involve displaying graphical output from a remote server,
typically to display plots or interace with a user interface. You can instruct
your SSH connection to enable forwarding of X-server capability by adding the
`-X` argument to the `ssh` command, as follows:
{{<command user=""user"" host=""localhost"">}}
ssh -X <user>@<hostname>
{{</command>}}
Note that the `-X` argument can be used in conjunction with the agent-
forwarding`-A` argument. In some cases the `-Y` option may be needed instead of
`-X`.
Please note that this arrangement sends your graphical output back to your
desktop machine over the network, so **should only be used within JASMIN, not
to your local desktop machine**. A solution has been put in place for a
[graphical linux desktop environment within JASMIN using NoMachine NX]({{< ref
""graphical-linux-desktop-access-using-nx"" >}}), removing the need to send X11
graphics over the wide-area network. You are strongly advised to use NX for
any situation which involves graphical output on JASMIN. **Using X11 graphics
over the wide-area network outside of JASMIN is not supported: you will not
get good performance** and this makes inefficient use of shared resources
which can impair performance for other users. **Please use NX instead.** Of
course, you may still need to use X11 graphics to send graphical output back
to your JASMIN-side graphical desktop within JASMIN, but this is OK as it is
all within the JASMIN network.
",https://help.jasmin.ac.uk/docs/getting-started/login#x-forwarding-for-graphical-applications-(within-jasmin-only),1468,227
Where next?,"Having been through all the steps and logged in to JASMIN (well done!) you
will be keen to do some real work. You could try the [general purpose
scientific analysis servers]({{< ref ""sci-servers"" >}}) to get started. Use
the list presented on the login screen to select a sci server which is not
under heavy usage.
For example, from the JASMIN login server, you might choose to login to
`sci1`:
{{<command user=""user"" host=""login1"">}}
ssh <user>@sci1.jasmin.ac.uk
{{</command>}}
If you are asked for a password when trying to login to this second machine,
it indicates that your ssh key is not being forwarded. Please check that you
have used the `-A` option in your initial connection to the login server, or
set up agent forwarding permanently in your SSH client configuration on your
local machine.
**There is no point in trying to enter a password (or even the passphrase
associated with your key) as only an ssh key presented in the way described
above is accepted.**
Note that once you are logged into a login server then you can omit the
`<user_id>@` prefix before the server name for the onward connection, since
your username will be the same on both systems. But there is no harm in
including it anyway, to ensure that you connect as the correct user. As shown
above, the `-A` option is not needed for the onward connection, although there
is no harm in including it.
Remember to log out of the login server in addition to the sci server when you
have finished your work, to get back to your own (local) machine:
{{<command user=""user"" host=""sci1"">}}
exit
(out)logout
{{</command>}}
{{<command user=""user"" host=""login1"">}}
(out)Connection to sci1.jasmin.ac.uk closed.
exit
(out)logout
{{</command>}}
{{<command user=""user"" host=""localhost"">}}
(out)Connection to login1.jasmin.ac.uk closed.
",https://help.jasmin.ac.uk/docs/getting-started/login#where-next?,1800,289
back on your own/local machine now,{{</command>}},https://help.jasmin.ac.uk/docs/getting-started/login#back-on-your-own/local-machine-now,14,1
Multiple account types,"_**Trial period extended**_
This article defines the types of account available on JASMIN and their
purpose. It covers:
- STANDARD accounts (with note about training accounts)
- SHARED accounts
- SERVICE accounts
",https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types,213,32
Introduction,"For some time, we have been asked by user communities to cater for legitimate
use cases where accounts need to be shared by a small, known and pre-arranged
set of users, or by services or functions.
To maintain a secure approach, we have brought these together into a clearly-
defined set of account types for each purpose.
**These are being introduced on a trial basis as of 1st June 2023 for an
initial period of 7 months.**
",https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types#introduction,427,77
Definitions,,https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types#definitions,0,0
STANDARD accounts,"A standard account:
  * is for use by one human individual user only.
  * can login to the JASMIN accounts portal to (re)set a password, store an SSH key and apply for access roles.
  * has a unique SSH key, traceable to its owner.
**Training accounts** are a special type of STANDARD account, issued on a
short-term basis and preconfigured with certain access roles as required for
training events.
A **standard account** holder may act as a **responsible user** on one more
**service** or **shared accounts.**
",https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types#standard-accounts,512,86
SHARED accounts,"A shared account:
  * is for use by a small, defined set of **responsible users** , each associated by their **standard account** username
  * has a set of SSH public keys, one for each **responsible user**. The **shared account** itself does not have a key, and users do not share keys. The set of keys associated with the **shared account** is updated automatically in the event that any individual **responsible user** changes their the SSH key on their own **standard account**.
  * can log in to the JASMIN accounts portal using the shared account username to apply for roles and can (re)set a a password, which may be shared securely** and only between the set of responsible users. The accounts portal profile for the shared account will display, but not allow editing of, the public keys of the responsible users.
  * can be used by individual **responsible users** to login via SSH, but using their own individual SSH private key which must not be shared with any other user, and should be kept locally, i.e. not uploaded to anywhere on JASMIN.
  * by default, emails originating from the JASMIN accounts portal destined for **shared accounts** are instead sent to all their **responsible users**. An optional email address for the **shared account** itself may be specified in the accounts portal profile for the account.
  * can perform any action in the system that a standard account can, including but not limited to the following (and subject to membership of relevant access roles): 
    * becoming a member of a group workspace
    * using elastic tape / JDMA
    * submitting a job to the LOTUS batch processing cluster
    * obtaining an short-lived credential for use with a high-performance transfer method
  * may be requested by a user or group of users via the JASMIN helpdesk, but the decision as to whether to grant the request is at the discretion of the JASMIN team, after scrutiny of the request, its justification and the past JASMIN behaviour of the individual users proposed to be responsible for the **shared account.**
**An example of a secure means of sharing a password is to use Keeper (or
similar password manager system) to share a securely-stored entry with a
specific list of other individuals in an encrypted form. Password sharing via
unencrypted means (such as a text file, email or post-it note) is not
permitted.
",https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types#shared-accounts,2359,396
SERVICE accounts,"A service account:
  * is for use by a service or function only
  * has one or more **responsible users** , each associated by their **standard account** username
  * can never log in to the JASMIN accounts portal or (re)set a password.
  * may be granted roles by arrangement with the JASMIN team
  * has no SSH key
  * emails originating from the JASMIN accounts portal destined for **service accounts** are instead sent to all their **responsible users.** An optional email address for the **service account** itself may be specified in the accounts portal profile for the account.
  * may be requested by a user or group of users via the JASMIN helpdesk, but the decision as to whether to grant the request is at the discretion of the JASMIN team, after scrutiny of the request, its justification and the past JASMIN behaviour of the individual users proposed to be responsible for the **service account.**
**NOTES:**
  * With the implementation of these new account types, existing setups will be examined and discussed with their ""owners"" and moved over to either **service** or **shared account** types as appropriate.
  * Users of a **shared** or **service account** are jointly responsible for actions performed by the account. This requires coordination and communication between responsible users, which should be done independently of the JASMIN system.
  * Membership of a **shared** or **service account** , and availability of the account itself, may be withdrawn if behaviour falls outside the [JASMIN Terms and Conditions](https://accounts.jasmin.ac.uk/account/conditions/). In serious cases, individual users may be barred from further use of JASMIN altogether. Users are reminded to familiarise themselves with the **Terms and Conditions** and have a responsibility to keep up to date with them as they change. Users must also pay attention to service announcements made by the JASMIN team by email and other means.
Requests for shared or service accounts should be sent to
the JASMIN helpdesk with ""shared account
request"" or ""service account request"" in the subject line.
",https://help.jasmin.ac.uk/docs/getting-started/multiple-account-types#service-accounts,2093,330
SSH public key authentication,"JASMIN employs SSH public key authentication for login instead of username and
password. This article provides a basic overview of public key
authentication.
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth,158,23
Public key authentication (for SSH),"SSH stands for ""Secure Shell"", a protocol that allows login to another
computer over the network. This allows the user to execute commands on a
remote machine. SSH uses encryption to keep the connection secure so that it
is more difficult for hackers to passwords or other sensitive information that
may pass through the connection.
Public key authentication is an alternative means of identifying yourself to a
login server, instead of typing a password. It is more secure and flexible,
but can appear more difficult for new users.
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#public-key-authentication-(for-ssh),533,88
Why is public key authentication more secure than a password?,"When using conventional username/password authentication you will type your
password when you log on to a server. If the server you are working on has
been compromised then an attacker could learn your password and then use it to
gain access to the remote server you are connecting to.
With public key authentication, the private key is kept only on your own machine
and the passphrase to unlock it is entered there too. An attacker would require both knowledge of the
passphrase used to protect your private key as well as the private key file
itself.
{{<alert type=""danger"">}}
It is imperative that your private key is protected by a strong passphrase so
that only you can use it.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#why-is-public-key-authentication-more-secure-than-a-password?,696,119
Public key authentication setup,"Setting up SSH keys involves the following steps:
  1. Create a pair of SSH keys (public and private **with associated passphrase** ).
  2. Provide the **public** key to remote machines/services that you wish to login to.
See [instructions for setting this up on JASMIN]({{< ref ""generate-ssh-key-pair"" >}}).
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#public-key-authentication-setup,309,47
Login with your SSH key pair,"Once you have set up your key pair and provided your public key to the remote
machine the process is as follows:
  1. Load the **private** key into an ""authentication agent"" (such as `ssh-agent`) on your local machine.
  2. Use an SSH client (such as the `ssh` command) to login to the remote server. 
See [instructions for setting this up on JASMIN]({{< ref ""login"" >}}).
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#login-with-your-ssh-key-pair,373,65
Logging in from multiple machines,"If you have a requirement to login to your JASMIN account from multiple
servers/locations then please copy your private key file securely to the
~/.ssh directory on the new machine. Note that you should restrict access the
private key so it is only readable by you.
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#logging-in-from-multiple-machines,266,46
Using public key authentication with other applications,"Many other tools use the SSH protocol for their communication with remote
servers or services, for example rsync, scp, git and subversion.
",https://help.jasmin.ac.uk/docs/getting-started/ssh-auth#using-public-key-authentication-with-other-applications,139,22
Access to storage,"This article provides information about JASMIN storage. It covers:
**IMPORTANT:** Please see also [Understanding new JASMIN storage]({{< ref
""understanding-new-jasmin-storage"" >}}) which explains more about the
different types of storage as of Phase 4 of JASMIN's history.
",https://help.jasmin.ac.uk/docs/getting-started/storage,273,36
Home directory,"Every JASMIN user is allocated a HOME directory located
at`/home/users/<user_id>`. This directory is available across most of the
interactive and batch computing resources, including the JASMIN login and
transfer servers.
Each home directory has a default **quota of 100 GB**. Although you can't 
directly check usage against your quota, you can find out the current size
of your home directory as follows (the `pdu` command is a parallel variant
of the `du` command, designed to work with the particular storage used for home
directories on JASMIN).
{{<command>}}
pdu -sh /home/users/<username>
{{</command>}}
{{<alert type=""danger"">}}You are only allowed to exceed the 100 GB quota for a very
brief period of time. If you continue to exceed the limit, you will be
unable to add any more files, which means that jobs may fail, and other things may
stop working for you. You will need to reduce your usage below the 100GB quota to resolve this.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/getting-started/storage#home-directory,958,154
Backups of your home directory,"Your home directory is backed up using a daily snapshot which provides a quick, **self-service** method for you to restore files or directories that have been accidentally deleted. Snapshot backups are kept for 1-2 weeks before being deleted.
",https://help.jasmin.ac.uk/docs/getting-started/storage#backups-of-your-home-directory,243,38
Recovering snapshots of your home directory data,"Users can access snapshots to recover files/directories that have been
accidentally deleted. These are stored in
`/home/users/.snapshot/homeusers.<snapshotid>/<username>`
The most recent backup is the one with the highest snapshot id number.
Find the ones relevant to your username with a command line this: (
`${USER}` is the environment variable containing your username, so can be
copied in this case)
{{<command>}}
ls -ld /home/users/.snapshot/homeusers2.*/${USER}
{{</command>}}
There should be up to 14 directories like this: 
drwx------ 113 joeblogs users 0 Jan 26 15:00 /home/users/.snapshot/homeusers2.2024_01_28_02_01/joebloggs
drwx------ 113 joeblogs users 0 Jan 26 15:00 /home/users/.snapshot/homeusers2.2024_01_29_02_01/joebloggs
drwx------ 113 joeblogs users 0 Jan 29 09:51 /home/users/.snapshot/homeusers2.2024_01_30_02_01/joebloggs
drwx------ 113 joeblogs users 0 Jan 30 09:29 /home/users/.snapshot/homeusers2.2024_01_31_02_01/joebloggs
drwx------ 113 joeblogs users 0 Jan 30 09:29 /home/users/.snapshot/homeusers2.2024_02_01_02_01/joebloggs
Each of these snapshot directories effectively contains your home directory as it was on that date. You can copy files back from them (yourself) to their original location.
{{<command>}}
ls -l /home/users/.snapshot/homeusers2.45678/joebloggs/
(out)total 1170964
(out)-rw-r--r-- 1 joebloggs users              104857600 Jun 26  2017 100M.dat
(out)-rw-r--r-- 1 joebloggs users             1024000000 Feb  1  2017 1G.dat
(out)-rw-r--r-- 1 joebloggs users                      0 Dec 18 12:09 6181791.err
cp /home/users/.snapshot/homeusers2.45678/joebloggs/100M.dat ~/100M.dat
{{</command>}}
A snapshot backup is also provided for `/gws/smf` volumes (similar allocations of
SSD storage for GWS groups to share): snapshots in this case are made hourly
and kept for 10 hours, then daily snapshots are kept for 2 weeks. These can
be retrieved in a similar manner to that shown above. In this case the
relevant directories should be found at
{{<command>}}
    /gws/smf/jNN/<gwsname>/.snapshot
{{</command>}}
(where `NN` = `04` or `07` depending on where the volume is located)
{{<alert type=""danger"">}}All other group workspace volumes are **not backed up**. The only exception to this is the snapshot backups for `smf` SSD volumes just described.
{{</alert>}}
Please also note the {{<link ""#advice-on-inter-volume-symlinks-in-jasmin-storage"">}}advice on inter-volume symlinks{{</link>}}, below: these are to be avoided.
",https://help.jasmin.ac.uk/docs/getting-started/storage#recovering-snapshots-of-your-home-directory-data,2470,300
JASMIN disk mounts,"There is a common file system layout that underpins most of the JASMIN
infrastructure. However, access to different parts of the file system will
depend on where you are logged in. Table 1 outlines the key disk mounts, where
they are accessible from and the type of access (read and/or write).
**Table 1.** List of common disk mounts, types of storage and their
availability on JASMIN
Disk mount  
location |  login  |  sci  |  transfer  |  LOTUS  |  Type  |  Parallel-write  
---|---|---|---|---|---|---  
/home/users  |  R/W  |  R/W  |  R/W  |  R/W  |  SSD  |  no
/gws/pw/j07<br>/gws/nopw/j04 (see note 1 below)<br>/gws/smf/j0[4,7] |  no<br>no<br>no | R/W<br>R/W<br>R/W | R/W<br>R/W<br>R/W | R/W<br>R/W<br>R/W | PFS<br>SOF<br>SSD | yes (hence ""pw"")<br>no (hence ""nopw"")<br>no
/work/xfc/volX (see note 2 below) |  no<br>no  |  R/W  |  R/W |  R/W  | PFS  | yes
/work/scratch-pw[2,3]<br>/work/scratch-nopw  |  no<br>no  |  R/W<br>R/W  |  R/W<br>R/W |  R/W<br>R/W  | PFS<br>SSD  | yes<br>no
/apps/contrib  |  No  |  RO  |  No  |  RO  |  n/a  |  n/a  
/badc, /neodc (archives)  |  No  |  RO  |  RO  |  RO  |  n/a  |  n/a  
{.table .table-striped}
login = {{<link ""../interactive-computing/login-servers"">}}login servers{{</link>}}: login[1-4].jasmin.ac.uk  
sci = {{<link ""../interactive-computing/sci-servers"">}}scientific analysis servers{{</link>}}:
sci[1-6,8].jasmin.ac.uk  
transfer = {{<link ""../interactive-computing/transfer-servers"">}}data transfer servers{{</link>}}:
xfer[1-2].jasmin.ac.uk  
LOTUS = {{<link ""../batch-computing/lotus-overview"">}}LOTUS batch processing cluster{{</link>}}(all cluster
nodes)  
Disks are mounted read/write ("" **R/W** "") or read-only ("" **RO** "").
**Note 1:** Please refer to issues related to writing small files and NetCDF3
to SOF storage [here]({{< ref ""faqs-storage"" >}})
**Note 2:** For details of how to use the Transfer Cache (XFC) service please see [here]({{< ref ""../short-term-project-storage/xfc"" >}})
",https://help.jasmin.ac.uk/docs/getting-started/storage#jasmin-disk-mounts,1953,256
Where to write data,"As indicated in table 1 there are three main disk mounts where data can be
written. Please follow these general principles when deciding where to write
your data:
- HOME directories (`/home/users`) are relatively small (100GB) and should NOT be used for storing large data volumes or for sharing data with other users.
0 Group Workspaces (mostly `/gws/nopw/*/<project>` but some `/gws/pw/*/<project`) are **usually the correct place to write your data**, although they are **not backed up**. Please refer to the [Group Workspace]({{< ref ""short-term-project-storage"" >}}) documentation for details.
  - `/gws/pw/j07` volumes are parallel-write-capable storage from Phase 7 (onwards) of JASMIN
  - `/gws/nopw/j04` volumes are ""Scale out Filesystem"" (SOF) from Phase 4 (onwaards) of JASMIN: this storage is not parallel-write-capable
- The ""scratch"" areas (`/work/scratch-pw2`, `/work/scratch-pw3` and `/work/scratch-nopw`) are available as a temporary file space for jobs running on {{<link ""../batch-computing/lotus-overview"">}}LOTUS{{</link>}} (see next section below).
- The (`/tmp`) directory is **not usually an appropriate location to write your data (see next section below).**
",https://help.jasmin.ac.uk/docs/getting-started/storage#where-to-write-data,1184,162
How to use the temporary disk space,,https://help.jasmin.ac.uk/docs/getting-started/storage#how-to-use-the-temporary-disk-space,0,0
Scratch,"The scratch areas `/work/scratch-pw2`, `/work/scratch-pw3` and
`/work/scratch-nopw` are a temporary file space shared across the entire LOTUS
cluster and the scientific analysis servers.
These scratch areas are ideal for processes that generate _intermediate_ data
files that are consumed by other parts of the processing before being deleted.
Please remember that these volumes are resources shared between all users, so
consider other users and remember to clean up after your jobs. **** Any data
that you wish to keep should be written to a Group Workspace (but remember to
change the group-ownership of the data if you do).
There are 2 types of scratch storage available:
- **PFS scratch** (lots of it, fast, less good for small files) as 2 x 1 PB volumes `/work/scratch-pw[2,3]` and particularly suitable for users with a need for storage capabale of shared-file writes with MPI-IO, but good for most purposes.
- **SSD scratch** (less of it, very fast, good for small files) `/work/scratch-nopw2` as 1 x 220 TB volume. Do not use for operations that attempt to write to multiple parts of a file simultaneously. Please be aware of this if your code (perhaps inadvertently?) writes to a shared log file.
When using the ""scratch"" areas, please create a sub-directory (e.g.
`/work/scratch-????/<username>`) labelled with your username and write your data there.
",https://help.jasmin.ac.uk/docs/getting-started/storage#scratch,1363,216
/tmp,"In contrast to the ""scratch"" space, `/tmp` directories on LOTUS nodes 
and physical sci machines are all local to the machine. These can be used
to store _small_ volumes of temporary data for a job that only needs to be
read by the local process. But `/tmp` on virtual sci machines, are not local and
therefore should not usually be used by users.
",https://help.jasmin.ac.uk/docs/getting-started/storage#/tmp,348,63
Cleaning up the scratch and tmp directories,"**Please** make sure that your jobs delete any files under the `/tmp`and scratch
directories when they are complete ( _especially_ if jobs have not been
completed normally!).
Please do this yourself so that you are not taken by surprise when automated 
deletion processes clear up any residual data:
{{<alert type=""danger"">}}
Automated cleanup processes run daily and
delete files that are older than 28 days from the last time of being
accessed. This applies to `/work/scratch-pw2`, `/work/scratch-pw3` and
`/work/scratch-nopw2`
Please remember that shared temporary storage is for the use of all 2,000 users
of JASMIN, not just you. If you persistently store large amounts (100s of TB) of data in scratch 
for long periods of tine, you deny use of that storage to other users (so expect action from the JASMIN team).
Please be a good JASMIN citizen!
{{</alert>}}
Any important data for keeping should be written to
a {{<link ""../short-term-project-storage/introduction-to-group-workspaces"">}}group workspace{{</link>}}
or to your home directory if appropriate.**
The `/work/scratch-pw[2,3]` and `/work/scratch-nopw`areas are not available on
the xfer, login or nx-login servers.
",https://help.jasmin.ac.uk/docs/getting-started/storage#cleaning-up-the-scratch-and-tmp-directories,1181,172
Avoid inadvertently writing to /tmp,"Sometimes software is configured by default to write to `/tmp`. Where possible, you 
should over-ride this and use your group workspace or a username-labelled directory 
within the scratch space instead.
To do this, please add the following lines (or
similar) to your $HOME/.bashrc file:
export TMPDIR=/<path-to-your-GWS-or-scratch>/<your_username>/tmp
# create the directory if needed
[ -d $TMPDIR ] || mkdir -p $TMPDIR
...but please check that location regularly to clear it out!
",https://help.jasmin.ac.uk/docs/getting-started/storage#avoid-inadvertently-writing-to-/tmp,482,70
Access to the CEDA archive,"The CEDA Archive is mounted read-only under paths refleting the NERC data centres
which merged to form CEDA, i.e.
- `/badc` (British Atmospheric Data Centre)
- `/neodc` (NERC Earth Observation Data Centre).
(other data centre paths now also exist at that level: see {{<link ""ceda_helpdocs"">}}CEDA Help docs{{</link>}} for more info)
The Archive includes a range of data sets that are provided under varying licences. Access
to these groups is managed through standard Unix groups. Information about the
data and their access restrictions is available from the {{<link ""ceda_catalogue"">}}CEDA Catalogue{{</link>}}. 
{{<alert type=""info"">}}
As a JASMIN user, it is your
responsibility to ensure that you have the correct permissions to access data
any data in CEDA Archive from within JASMIN, even if file system permissions permit access.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/getting-started/storage#access-to-the-ceda-archive,851,126
Tape access,"Group workspace managers also have [access to a tape library (Elastic Tape
service)]({{< ref ""secondary-copy-using-elastic-tape"" >}}) for making
secondary copies and managing storage between online and near-line storage.
",https://help.jasmin.ac.uk/docs/getting-started/storage#tape-access,221,28
Number of files in a single directory,"It is highly recommended that you do not exceed more than 100,000 files in a
single directory on any type of storage on JASMIN. Large numbers of files
place unnecessary load on components of the file system and can be the source
of slow performance for you and other storage volumes in the system. To count
the number of files, please note the advice in {{<link ""#slow-ls-response"">}}slow `ls` response{{</link>}} below, or
use an alternative command e.g. `find`.
",https://help.jasmin.ac.uk/docs/getting-started/storage#number-of-files-in-a-single-directory,464,77
Slow 'ls' response,"This can be due to a number of reasons (see above advice regarding number of
files in a single directory, and below regarding inter-volume symlinks). To
speed up the response (useful if you want to count the number of files) it
often helps to un-alias ls, e.g. by placing a backslash in front of the
command: `\ls`.
",https://help.jasmin.ac.uk/docs/getting-started/storage#slow-'ls'-response,316,57
Advice on inter-volume symlinks in JASMIN storage,"We highly recommend users _not_ to use symbolic links in their home
directories to other parts of the JASMIN file systems, such as GWSs or scratch
areas. There are a number of conditions when the petabyte-scale JASMIN storage
can become unusable for all users due to these links. There is a more
technical explanation below. We would advise **path substitutions using
environment variables** instead.
Symlinks in users' home directories that point to other volumes (for example
group workspaces) make matters worse _when_ there are problems on the
`sci*.jasmin.ac.uk` servers and other shared machines, and/or when the
metadata servers responsible for particular storage volumes themselves become
overloaded. The simplest advice we can currently give is to **avoid** using
symlinks.
**In more detail:**
This issue is particularly apparent when `ls` is aliassed to `ls --color` (as
is the default on 99% of JASMIN systems) AND one of the colorisation options
specified is for an orphaned link. The `ls` on symlinks causes the metadata
servers at the end of the symlink to be called (to provided the `stat`
filesystem metadata), in addition to the metadata server for the home
directory. If those metadata servers at the far end are under load, or have
some other problem, the `ls` to the home directory can hang, but this also
hangs other users who may be trying to ls their own home directory (even if
theirs contains no symlinks). The situation can then escalate out of control
as more and more users try and fail.
This is happens especially where one or more of the volumes involved
contains large numbers of small files.
",https://help.jasmin.ac.uk/docs/getting-started/storage#advice-on-inter-volume-symlinks-in-jasmin-storage,1624,267
tips-for-new-users,"These tips for new users are based on users' queries encountered by our helpdesk. They are not exhaustive but may help solve some initial problems and set out best practice.
- Sci machines
- LOTUS
- Xfer servers
- How to report an issue
",https://help.jasmin.ac.uk/docs/getting-started/tips-for-new-users,237,44
"""Sci"" machines usage guidelines","1. Check the current load and number of users on the sci machines, as shown by the login servers, to select a less-used sci machine. [The available Sci machines and their specifications are listed in the table of this help page]({{< ref ""sci-servers"" >}})
2. The sci machines are not for running large, long-running tasks, or scripts that spawn multiple child processes. The batch processing cluster LOTUS is available for heavier processing. The sci machines are for development, testing, and light interactive use. Overloading these with processing seriously impairs performance for interactive use by others.
3. Do not write to the temporary partition ` /tmp`on sci machines. [Use your home directory, a scratch volume or a Group Workspace ]({{< ref ""understanding-new-jasmin-storage"" >}}). Any temporary data files can reside in a subdirectory of your group workspace instead of `/tmp`. To do this, please add the following lines (or similar) to your `$HOME/.bashrc` file:
export TMPDIR=/group_workspaces/jasmin/<your_project>/<your_username>/tmp
## create the directory if needed
[ -d $TMPDIR ] || mkdir -p $TMPDIR
4. If a process hangs, do not simply close the terminal window. Please contact the helpdesk and alert the team so that the process can be shut down. Otherwise hung processes build up and contribute to machine overloading.
5. Do not “hog” IDL development licenses. A limited number of these are available for _development_ and compilation of IDL code which should then be run on LOTUS [using IDL runtime licenses]({{< ref ""idl"" >}}), of which there are many more.
6. Do not use sci machines for data transfer: [xfer hosts are provided for this purpose]({{< ref ""transfer-servers"" >}}).
","https://help.jasmin.ac.uk/docs/getting-started/tips-for-new-users#""sci""-machines-usage-guidelines",1705,266
LOTUS usage guidelines,"1. Do not use [IDL development licences]({{< ref ""idl"" >}}) on LOTUS. There are many _runtime_ licenses available, but the _development_ licenses are for interactive use on the sci machines, where IDL code can be compiled, then run on LOTUS using a _runtime_ license.
2. Beware of inadvertently filling up /tmp on LOTUS nodes. This can take nodes out of action (perhaps for other users who still have jobs running on the same node) if /tmp fills up. Design your code to clean up as it goes along, and use environment variables to control where your applications write temporary data, ideally to storage which is not specific to a LOTUS node. If your job crashes, check which nodes were involved and clean up after yourself.
3. Do not store data in scratch areas for long periods of time. Move data away to group workspaces once your processing has finished.
",https://help.jasmin.ac.uk/docs/getting-started/tips-for-new-users#lotus-usage-guidelines,858,149
Xfer servers guidelines,"1. Do not run a large number (>16) of rsync or scp transfer processes in parallel.
2. Do not run processing on xfer servers: they are provided for data transfer only
3. For heavy/high-performance data transfers, avoid virtual machines jasmin-xfer1/cems-xfer1 and consider using high-performance servers or methods.
",https://help.jasmin.ac.uk/docs/getting-started/tips-for-new-users#xfer-servers-guidelines,315,47
How to report an issue,"When you do experience an issue, please;
1. Make it clear whether you are simply advising the helpdesk of a general issue (which will be noted, but not necessarily investigated for a specific response), or
2. Provide FULL and SPECIFIC details of your problem so that it can be investigated. JASMIN is a complex infrastructure with many hundreds of hosts and storage volumes, so reporting that “JASMIN” or “Storage” is slow, is not sufficient.
3. If you are experiencing difficulties accessing a particular storage volume from a particular sci machine, please state:
    - the full path to the data you are trying to access:
    - the full hostname of the machine (but please try the same access from at least one other machine to help establish whether it’s related to the machine or the storage)
    - the date and time of the issue (for matching up with system reports/log files. Using the date and time of the email is not sufficient: please be specific in your report)
4. Be patient and understand that, particularly at present (where nearly the entire CEDA and JASMIN teams are working remotely), queries will take longer to resolve.
5. Some issues will only be resolved by strategic improvements which are planned as part of phased upgrades to JASMIN accompanied by capital procurements followed by integration work, all carried out by the same, small team.
",https://help.jasmin.ac.uk/docs/getting-started/tips-for-new-users#how-to-report-an-issue,1364,229
Understanding new JASMIN storage,"{{<alert type=""info"">}}This article was originally written in 2018/19 to introdice new forms of storage which were brought into produciton at that stage. Some of the information and terminology is now out of date, pending further review of JASMIN documentation.{{</alert>}}
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage,274,39
Introduction,"JASMIN continues to grow as a unique collaborative analysis environment for an
expanding community of scientists. Some of the big challenges we attempted to
address with Phase 4 were the ever-growing demand for storage space and the
increasing diversity of scientific workflows. However, we’re aware that some
aspects of the changes introduced in Phase 4 have presented some challenges in
themselves. Here, we outline the reasons for the changes and try to summarise
some of the challenges and what can be done to help deal with them.
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#introduction,535,87
Background,"(skip this if you just want to go straight to the advice):
With phase 4 we knew we had to both replace existing storage that had become
uneconomic to maintain, and add significantly more volume! However, we also
knew that most of the data stored on JASMIN disk is not touched for months on
end, but that some data is heavily used. We also knew that the traditional way
of building disk systems was no longer suitable for the scales (volumes of
data) we needed to handle, being supplanted by new technologies, and that at
some point our community would have to get used to these new technologies too.
The solution we chose for JASMIN is the same solution being deployed at most
large HPC sites: deploying tiered storage, that is more types of storage, and
requiring you, the user, to use the right kind of storage in the right place
in your workflow!
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#background,850,154
Understanding the four types of JASMIN disk:,"We have settled on four kinds of disk storage - quite an increase from the one
we had previously! Each is best for one kind of workflow, although each “can
do” most things, although not always well. We will see below that there is one
kind of activity that we now need to be much more careful about, because doing
it not only causes problems for individuals, but also for everyone else. We
could stop allowing this to happen, but it would be at a performance penalty
which would occur all the time: we have gone for “better with occasional
really slow” in preference to “always predictably slow” performance. What we
need you to do is learn how to avoid creating the “occasionally really slow”
times!
The four types are:
- **Solid state fast but not parallel disk (SSD),** really suitable for small files. This is what is used for your `/home/users` directories, so is good for things you really don’t want to lose, because this area is backed up. The same type of storage is also used for the scratch area `/work/scratch-nopw`, although this is NOT for persistent storage and is NOT backed up. SSD is great for compiling and storing millions of small files, but is the most expensive storage, so we don’t have a lot of it.
- **Fast parallel disk (PFS)** , great for jobs that read and write the same file from many different processes. This is what we had before. It’s not so great for lots of small files. This is still pretty expensive, which is one of the reasons why we haven’t simply stayed with it. Some GWS still use this, but most are migrating to the next category - scale-out file storage.
- **Scale Out File Storage (SOF)**. This is what most of our Group Workspaces (GWS) will use. This is great for large volumes of data with regular use (consider near-line tape storage if you don’t need access for a significant period). SOF is not so great for small files, so if you have lots of small files, best to either aggregate them or tar them up. This is *terrible* for parallel *write* access to files, and you must avoid that. More details on that below, but the key point is you might find you need to use the fast parallel scratch (currently /work/scratch) in your workflows as an intermediary between persisting your data and your Lotus batch jobs.
- **High Performance Object Storage (HPOS)**. This is a new type of storage, and it’s best if you are working with the cloud. It’s going to be a bit tricky to get the hang of, so pay attention to the various things we’re going to be saying over the next few months about how to use it. It is the future though...
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#understanding-the-four-types-of-jasmin-disk:,2576,470
What type of storage am I using?,"Storage  |  Type  |  Parallel-write  |  Good for small files?  |  Backed up?  
---|---|---|---|---  
/home/users  |  SSD  |  no  |  yes e.g. Installing Conda  |  yes  
/gws/pw/j07/*  |  PFS  |  yes  |  no  |  no  
/gws/nopw/j04/*  |  SOF  |  no  |  no  |  no  
/gws/smf/j04/*  |  SSD  |  no  |  yes  |  yes  
/work/scratch-pw[23] |  PFS  |  yes  |  no  |  no  
/work/scratch-nopw2  |  SSD  |  no  |  yes  |  no  
/work/xfc/volX  |  SOF  |  no  |  no  |  no
{.table .table-striped}
**Automounted SOF storage:** GWS storage volumes 
`/gws/nopw/j04/*` are automounted. This means that a particular GWS volume is not mounted by a
particular host until the moment it is first accessed. If the volume you
are expecting to see is not listed at the top level ( /gws/nopw/j04/) you
should use the full path of the volume to access it, and after a very short delay, the
volume should appear.
See also [here]({{< ref ""storage"" >}}) to see where these are mounted
throughout JASMIN.
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#what-type-of-storage-am-i-using?,971,165
The BIG issue: why you need to be careful about parallel file access,"(even if you don’t think you are doing it):
Traditional disk systems try and do cunning things when different processes
are writing to the same file; they can lock the file so only one process can
have a turn at a time, or they can try and stack up the updates and do them
one after another (and hope they don’t interfere), but at scale, all those
tricks come with a performance cost. That cost gets paid in many ways: raw I/O
speed, how many extra copies of blocks get written, how long it takes to
rebuild if things go wrong, how big any part of the storage can be… and, how
much kit and software the vendors need to deliver to make it work. All that
cost is worth it if your workflow needs it (and can’t avoid it), but in the
JASMIN environment, not many workflows actually need it.
Our fast parallel disk is fine for those workflows, but none of the others
support it well, and in particular for our scale-out file storage, as used by
most GWSs, the way it works means that if we turn on the support for parallel
write, it will become much slower and write many more copies of some data
blocks, meaning it will do I/O slower, and it will store less! Not what we
want. The parallel read is fine! However, avoiding parallel writes has turned
out to be harder than we anticipated, your workflows have many more ways of
doing it than we thought! Sadly, when you do parallel writes, the file system
can get “stuck” and that’s when everything goes really slow, for everyone on
that host …
One way around this is for us to apply “global write locking” to a GWS volume
(your GWS manager would need to request this). This solves the problem by
preventing parallel writes altogether, but at a significant cost in
performance.
",https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#the-big-issue:-why-you-need-to-be-careful-about-parallel-file-access,1720,320
"FAQs, issues and solutions","Please read our collection of FAQs and known issues (and solutions!) which
we've put together [HERE]({{< ref ""faqs-storage"" >}}).
","https://help.jasmin.ac.uk/docs/getting-started/understanding-new-jasmin-storage#faqs,-issues-and-solutions",130,19
Update a JASMIN account,"This article shows you how to update an active JASMIN account on the JASMIN
accounts portal.
",https://help.jasmin.ac.uk/docs/getting-started/update-a-jasmin-account,93,16
Update info,"**Step 1** : On your {{<link ""https://accounts.jasmin.ac.uk/account/profile/"">}}profile page{{</link>}}, select ""Update info"".
{{<image src=""img/docs/update-a-jasmin-account/file-Q1fSbTtw5P.png"" caption=""Update detils"">}}
**Step 2** : Once the discipline and degree are updated, click ""Update profile""
{{<image src=""img/docs/update-a-jasmin-account/file-mM0VZn7Adl.png"" caption=""Update details"">}}
**Step 3** : The updated details are displayed.
{{<image src=""img/docs/update-a-jasmin-account/file-kaDzBnKcVy.png"" caption=""Updated profile"">}}
",https://help.jasmin.ac.uk/docs/getting-started/update-a-jasmin-account#update-info,543,44
Update SSH public key,"To update your SSH public key, first you need to generate a new SSH key pair as described here: [Generate an SSH key pair]({{< ref ""generate-ssh-key-pair"" >}}). This should be done on
your local machine (e.g. Windows / Linux / Mac). You MUST protect your key
with a strong passphrase. Then follow step 1 to step 5 to update your SSH
public key. You will be asked for a verification token during this process.
The system will reject any key that it recognises has been used before (across all users) so you must generate a fresh key each time: you cannot recycle an old key.
**Step 1** : On the profile page, select ""Update key""
{{<image src=""img/docs/update-a-jasmin-account/file-OqvYqVcAXA.png"" caption=""Update key"">}}
**Step 3** On the profile page shown above select ""Update  key"". Within a few seconds, you should receive a
validation token to your registered email address.
{{<image src=""img/docs/update-a-jasmin-account/file-OpQxH5gX8f.png"" caption="" "">}}
Step 4: Enter the validation token, **delete the old SSH public key** , and
paste the new SSH public key. Click ""Update SSH key"".
{{<image src=""img/docs/update-a-jasmin-account/file-M0OYgojbCq.png"" caption=""Confirmation"">}}
Step 5: Confirmation is displayed. Please allow 15 minutes before attempting to log in again,
 while the new key becomes active on the JASMIN system.
If you get the message ""not a valid ssh public key"" please check that you have
copied the text from the `.pub` file and that no newline characters are
included: the public key should be a single line of text.
It can be difficult to see this as the text automatically wraps
itself to fit in the text box.
{{<image src=""img/docs/update-a-jasmin-account/file-zUPKLVGhgG.png"" caption=""Key updated"">}}
",https://help.jasmin.ac.uk/docs/getting-started/update-a-jasmin-account#update-ssh-public-key,1733,264
Change password,"**Step 1** : Go to your username in the top-right corner of the navigation bar.
Select ""Change password"" from the drop-down menu.
{{<image src=""img/docs/update-a-jasmin-account/file-0cgN9AXHNN.png"" caption=""Select change password from menu"">}}
**Step 2** : Enter the new password which must conform to the rules stated. You should ideally generate a strongly random string
in an encrypted password manager and store it securely. Make sure it is NOT the same as your SSH key passphrase.
Re-enter the new password to confirm, then click ""Change password""
{{<image src=""img/docs/update-a-jasmin-account/file-oSTsBB9mv7.png"" caption=""Submit new password"">}}
",https://help.jasmin.ac.uk/docs/getting-started/update-a-jasmin-account#change-password,654,87
Link CEDA account,"Linking your CEDA account to your JASMIN account allows you filesystem access
to data on CEDA Archive. If you need to access data on the CEDA Archive and
you do not have an account, you will need to apply for a [CEDA account]({{<
ref ""ceda-archive#register"" >}}).
**Step 1** : On the profile page, select ""Link now"" which is opposite to the
field ""Linked CEDA Account"". This will take you to the CEDA accounts portal
page where you need to login.
{{<image src=""img/docs/update-a-jasmin-account/file-Zy3ZGr4y6V.png"" caption=""Login to your CEDA account"">}}
**Step** **2** : You will be directed to the page below to authorise JASMIN
accounts portal to link your CEDA account and read CEDA profile information.
{{<image src=""img/docs/update-a-jasmin-account/file-WAUGpRHodk.png"" caption=""Allow access"">}}
**Step 3** : Your ""Linked CEDA Account"" field on your JASMIN account profile
page will be updated with ""Linked with `<JASMIN username>`"" as shown below
{{<image src=""img/docs/update-a-jasmin-account/file-PNsdqVO3bn.png"" caption=""Updated JASMIN account"">}}
",https://help.jasmin.ac.uk/docs/getting-started/update-a-jasmin-account#link-ceda-account,1058,147
Check network details,"This article explains how to:
- check that your network domain is able to access JASMIN resources
- check that the particular host from which you are intending to connect to JASMIN has the required network configuration
",https://help.jasmin.ac.uk/docs/interactive-computing/check-network-details,220,37
Check network domain (non .ac.uk users),"In order to maintain a secure and reliable scientific infrastructure for its
users, JASMIN restricts login access by maintaining an ""allow list"" of network
domains that are allowed to make SSH connections to the JASMIN login gateways
and data transfer servers.
All `.ac.uk` network domains (i.e. UK universities and ""academic"" institutions)
are already registered.
If your institution's network domain is not .ac.uk, please request for it to
be added to the allow list by contacting [the JASMIN
Helpdesk](https://www.jasmin.ac.uk/help/contact/), after reading the
information in the following section about forward and reverse DNS lookup.
",https://help.jasmin.ac.uk/docs/interactive-computing/check-network-details#check-network-domain-(non-.ac.uk-users),639,92
Check IP address resolves to network domain (all users),"In addition to being on the allowed IP list there is an additional requirement
that the address of your local computer must have **forward and reverse DNS
lookup enabled**. This means that the hostname must resolve to an IP address,
and the IP address must resolve to the fully-qualified hostname.
One easy way to do this is to access the following URL **from the machine
which will be used to make the SSH connection to JASMIN** :
<https://accounts.jasmin.ac.uk/services/reverse_dns_check/>
If you don't have a web browser on that machine, you can use the 'curl' or
'wget' Linux commands to make an HTTP request to that URL, and inspect the
output. A successful response will look like this:
External IP address: 130.246.123.456
Resolved to host: vpn-3-167.rl.ac.uk
Whereas an unsuccessful response will look like this:
External IP address: 130.246.123.456 
Reverse DNS lookup failed
If your IP address does not resolve, please contact your local IT technical
support desk and show them this article to help explain the context.
It is important that the network domain to which the IP address resolves is
part of the network domain which has been allowed. If there is no obvious
relationship between the network domain of the host and that of your
institution (derived from your email address), you may be asked to provide
additional justification or your connection may be denied. Some institutions
prefer not to provide public DNS listings: in this case please ask the
technical support representative to contact the JASMIN helpdesk on your behalf
to see if a technical solution can be found.
This can be a problem if you attempt to connect directly from a commercial
home or business internet service provider. Wherever possible, please connect
to your institution (which is likely to be on the allow list already) before
making an outgoing SSH connection to a JASMIN server.
As long as the IP address resolves to a fully-qualified hostname within the
allowed domain, it does not matter whether the host has a static or
dynamically-assigned (DHCP) IP address.
If you cannot obtain an IP address that resolves in this way, you may still be
able to access (only) `login2.jasmin.ac.uk`, which has been configured to
enable access without the reverse DNS restriction. However, this is likely to
be the only entry point available to you and will limit what you can do on
JASMIN. Doing so can be useful as a temporary solution, but to gain full use
of JASMIN you will need to have an IP address that resolves to the domain of
your institution. For access to graphical desktops, equivalent servers `nx-
login2.jasmin.ac.uk` and `nx-login3.jasmin.ac.uk` have been provided and for
transfer tasks, an additional transfer server `xfer3.jasmin.ac.uk` is
available. See [login servers]({{< ref ""login-servers"" >}}) and [transfer
servers]({{< ref ""transfer-servers"" >}}), but note the additional access role
required in the case of the transfer server.
",https://help.jasmin.ac.uk/docs/interactive-computing/check-network-details#check-ip-address-resolves-to-network-domain-(all-users),2944,475
Creating a virtual environment in the jasmin notebooks service,"Creating a virtual environment is useful to allow a discrete set of extra
packages to be installed to meet specific requirements. This allows a user to
run multiple environments with different dependencies without conflicts.
There are a number of ways to create a virtual environment to use with the
notebook service. This document outlines the most common and reccomended
methods, and then some other ways which you might find useful.
Please note that environments created for the notebook service **will not work**
on the jasmin scientific analysis servers or the LOTUS batch processing.
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service,590,93
Step 1: Creating a virtual environment,"This step creates a python virtual environment, and allows you to install
packages into it.
{{<alert type=""danger"">}}
These commands are intended for use at the jupyter
notebooks shell, **not on the JASMIN sci machines**
{{</alert>}}
To get started, head to <https://notebooks.jasmin.ac.uk> and click the
terminal button.
{{<image src=""/img/docs/creating-a-virtual-environment-in-the-jasmin-notebooks-service/notebook-terminal.png"" caption=""terminal button"">}}
Then, type these commands at the bash shell which appears.
First, make a directory in which to store your virtual environments. You can
put this wherever you like, as long as you reference the same place later. You
could store several virtual environments within this directory, for different
purposes. Then, change into that directory.
{{<command>}}
mkdir ~/nb_envs
cd ~/nb_envs
{{</command>}}
Next, create a new empty virtual environment. We recommended including the
`--system-site-packages` argument which will allow you to add packages on top
of jaspy, rather than starting completely from scratch.
{{<command>}}
python -m venv name-of-environment --system-site-packages
{{</command>}}
Then, activate the specific virtual environment created above, which will
allow you to install packages.
{{<command>}}
source name-of-environment/bin/activate
{{</command>}}
If you want to be able to use your virtual environment as a jupyter notebook
kernel (reccomended), you should install `ipykernel` using pip.
{{<command>}}
pip install ipykernel
{{</command>}}
You can then install whatever packages you need in the environment.
{{<command>}}
pip install pyjokes
{{</command>}}
If you change your mind and need to add more packages in the future, it is
simple to activate the virtual environment in the same way as above and use
pip to install more packages.
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#step-1:-creating-a-virtual-environment,1816,245
Step 2: Making the notebook service recognise your new kernel.,"These steps are also run from the notebooks' service shell, as above.
If you aren't still there from the last step, cd to the location of your venv.
{{<command>}}
cd ~/nb_envs
{{</command>}}
If it isn't already active, activate the virtual environment.
{{<command>}}
    source name-of-environment/bin/activate
{{</command>}}
Running the following command will make the notebook's service notice your new
virtual environment, and include it in the list of kernels which you can run
code with. You only have to do this once.
{{<command>}}
python -m ipykernel install --user --name=name-of-environment
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#step-2:-making-the-notebook-service-recognise-your-new-kernel.,615,88
Step3: Using Your New Kernel,"{{<image src=""/img/docs/creating-a-virtual-environment-in-the-jasmin-notebooks-service/197739637-1e75ce45-c0de-49ec-b168-d2dc101ca7fe.png"" caption=""Select kernel, in this case: 'name-of-environment'"" wrapper=""col-6 mx-auto"">}}
You can then choose this kernel from the jupyterhub homepage, or from the top
right of any open notebook. No changes to the python code within are required.
{{<image src=""/img/docs/creating-a-virtual-environment-in-the-jasmin-notebooks-service/197740127-074abd6d-f0f2-4450-8c4c-232a5800137c.png"" caption=""kernel name in notebook title tab"">}}
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#step3:-using-your-new-kernel,570,46
Other tips & useful knowledge,,https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#other-tips-&-useful-knowledge,0,0
Activating an environment without it being a kernel.,"If you follow Step 1 above to create a virtual environment, it is possible to
use the packages from this environment in a python file without making it a
kernel. While this can be useful, it has the very distinct disadvantage of
hardcoding the path to your virtual environment in your python code. For this
reason we discourage using this method with a medium level of severity. To do
this, simply add the following code to your python file **before** any
imports. Adjust the `venv_path` variable to be correct for the venv you
created.
import sys
import pathlib
import platform
venv_path = ""~/nb_envs/name-of-environment""
py_version = platform.python_version_tuple()
sys.path.append(
    str(
        pathlib.Path(
            f""{venv_path}/lib/python{py_version[0]}.{py_version[1]}/site-packages/""
        ).expanduser()
    )
)
Explanation: this adds the site-packages folder from your venv directly to the
path python uses to search for packages (`$PYTHONPATH`). This lets python
find them to import.
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#activating-an-environment-without-it-being-a-kernel.,1005,140
Can I install packages from inside my python code?,"We very strongly recomend **NOT** trying to install python packages from
inside notebook code. `pip` isn't designed for it, and it is almost always
easier to activate the venv as above and install things that way.
If you wish to record the set of packages inside your venv so you can install
them en-masse later, pip has the facility to do this. To export a list of
packages that exist inside a venv, from the notebooks bash shell with the
virtual environment in question activated:
{{<command>}}
pip freeze > requirements.txt
{{</command>}}
To install a list of packages which have been exported:
{{<command>}}
pip install -r requirements.txt
{{</command>}}
Exporting packages in this way is also useful for sharing your environment
with others, reinstalling when it breaks etc. It's a good idea to keep the
requirements file alongside the code in version control. If your code becomes
more complex it is probably more sensible to make it a python package, and
install it as one, but doing that is outside the scope of this document.
If you really must, you can call pip from inside your notebook like this:
(after first updating the packages variable to be the ones you want to
install.)
import sys
import subprocess as sp
packages = ['pyjokes']
sp.check_call([sys.executable, '-m', 'pip', 'install'] + packages)
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#can-i-install-packages-from-inside-my-python-code?,1315,216
Can I use conda instead of a virtual environment?,"Yes, no problem.
To create a conda environment, sinply run the following at the JASMIN
Notebooks shell:
{{<command>}}
conda create --name name-insert-here ipykernel
{{</command>}}
Install any packages you which to use in the environment:
{{<command>}}
conda install --name name-insert-here pyjokes
{{</command>}}
Make the notebook service recognise your environment as a kernel:
{{<command>}}
conda run --name name-insert-here python -m ipykernel install --user --name name-insert-here
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#can-i-use-conda-instead-of-a-virtual-environment?,501,64
Can I get rid of my old kernels from the notebook service?,"Yes.
To list the names of kernels you have installed, run the following at the
JASMIN notebook's shell:
{{<command>}}
jupyter kernelspec list
{{</command>}}
To remove one of them, run:
{{<command>}}
jupyter kernelspec uninstall insert-name-here
{{</command>}}",https://help.jasmin.ac.uk/docs/interactive-computing/creating-a-virtual-environment-in-the-notebooks-service#can-i-get-rid-of-my-old-kernels-from-the-notebook-service?,259,35
Introduction,"[Dask Gateway](https://gateway.dask.org/) is a service which manages [dask](https://dask.org) clusters for users.
On JASMIN, it creates a dask cluster in {{<link ""../batch-computing/lotus-overview.md"">}}LOTUS{{</link>}}, our batch computing cluster. It automatically creates a dask for you, scheduling Slurm jobs to create dask schedulers and workers as appropriate.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#introduction,367,43
Prerequisites,"Before using Dask Gateway on JASMIN, you will need: 
1. An existing JASMIN account and valid `jasmin-login` access role: {{<button size=""sm"" href=""https://accounts.jasmin.ac.uk/services/login_services/jasmin-login/"">}}Apply here{{</button>}}
2. **Subsequently** (once `jasmin-login` has been approved and completed), the `dask` access role: {{<button size=""sm"" href=""https://accounts.jasmin.ac.uk/services/additional_services/dask/"">}}Apply here{{</button>}}
The `jasmin-login` access role ensures that your account is set up with access to the LOTUS batch processing cluster, while the `dask` role grants access to the special LOTUS partition used by the Dask Gateway service.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#prerequisites,678,76
Creating a dask cluster,,https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#creating-a-dask-cluster,0,0
In the JASMIN Notebooks service,"In the {{<link ""jasmin-notebooks-service"">}}JASMIN notebooks service{{</link>}}, authentication to dask-gateway happends automatically. You can use the snippet below to create a cluster and get a dask client which you can use:
import dask_gateway
# Create a connection to dask-gateway.
gw = dask_gateway.Gateway(""https://dask-gateway.jasmin.ac.uk"", auth=""jupyterhub"")
# Inspect and change the options if required before creating your cluster.
options = gw.cluster_options()
options.worker_cores = 2
# Create a dask cluster, or, if one already exists, connect to it.
# This stage creates the scheduler job in SLURM, so may take some time.
# While your job queues.
clusters = gw.list_clusters()
if not clusters:
    cluster = gw.new_cluster(options, shutdown_on_close=False)
else:
    cluster = gw.connect(clusters[0].name)
# Create at least one worker, and allow your cluster to scale to three.
cluster.adapt(minimum=1, maximum=3)
# Get a dask client.
client = cluster.get_client()
#########################
### DO DASK WORK HERE ###
#########################
# When you are done and whish to release your cluster:
cluster.shutdown()
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#in-the-jasmin-notebooks-service,1133,150
Elsewhere on JASMIN,"(eg. on the `sci` machines)
{{<alert type=""info"">}}
It is not necessary to do this if you only want to use dask in the JASMIN notebook service.
{{</alert>}}
At the current time, it is still necessary to use the notebooks service to generate an API token to allow you to connect to the gateway server.
{{<alert type=""danger"">}}
It is very important that your API token is not shared between users and remains secret. With it, another user can submit dask jobs to lotus as you, and they could exploit this to see anything in your jasmin account.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#elsewhere-on-jasmin,557,97
Setup,"1. Make a dask configuration folder in your home directory
{{<command user=""user"" host=""sci1"">}}
mkdir -p ~/.config/dask
{{</command>}}
2. Create a configuration file for dask-gateway
{{<command user=""user"" host=""sci1"">}}
touch ~/.config/dask/gateway.yaml
{{</command>}}
3. Change the permissions on the file so that only you can read it
{{<command user=""user"" host=""sci1"">}}
chmod 600 ~/.config/dask/gateway.yaml
{{</command>}}
4. Head to https://notebooks.jasmin.ac.uk/hub/token , put a note in the box to remind yourself what this token is for, press the **big orange button** then {{<mark>}}copy{{</mark>}} then {{<mark>}}token{{</mark>}}.
5. Paste the following snippet into `~/.config/dask/gateway.yaml`, replace the part in brackets with the API token you just copied.
gateway:
  address: https://dask-gateway.jasmin.ac.uk
  auth:
    type: jupyterhub
    kwargs:
      api_token: replaceWithYourSecretAPIToken
6. You're done. You can now use dask gateway from the command line.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#setup,986,120
Access the dask dashboard,"Currently the dask dashboard is not accessible from a browser outside the JASMIN firewall. If your browser fails to load the dashboard link returned, please use our {{<link ""graphical-linux-desktop-access-using-nx"">}}graphical desktop service{{</link>}} to run a Firefox browser inside the firewall to view your dashboard.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#access-the-dask-dashboard,323,43
Use a custom python environment,"By default the jasmin notebooks service and dask gateway use the latest version of the `jaspy` software environment. However, often users would like to use their own software environments.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#use-a-custom-python-environment,189,29
Understanding the problem,"When dask gateway greates a dask cluster for a user, it runs a setup command to activate a conda environment or python `venv`.
To have dask use your packages, you need to create a custom environment which you can pass to dask gateway to activate.
However, for techical reasons, it is not currently possible to use the same virtual environment in both the notebook service and on jasmin. So you will need to make two environments, one for your notebook to use and one for dask to use.
{{<alert type=""info"">}}
It is VERY important that these environments have the same packages installed in them, and that the packages are exactly the same version in both environments.
If you do not keep packages and versions in-sync you can expect many confusing errors.
{{</alert>}}
If you use a self-containted conda enironment this is not a problem, and you can use this as a kernel in the notebooks service and on the `sci` machines. You can skip to {{<link ""#putting-it-all-together"">}}Putting it all together{{</link>}} below.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#understanding-the-problem,1017,171
Creating a virtual environment for dask.,"- Login to the JASMIN sci machines.
- Activate jaspy
{{<command>}}
module load jaspy
{{</command>}}
- Create your environment in the normal way
{{<command>}}
python -m venv name-of-environment
{{</command>}}
- Activate the environment
{{<command>}}
source name-of-environment/bin/activate
{{</command>}}
- Install dask and dask gateway and dependencies: without this step your environment will not work with dask.
{{<command>}}
pip install dask-gateway dask lz4
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#creating-a-virtual-environment-for-dask.,477,62
Creating a virtual environment for the notebooks service,"- Follow the instructions {{<link ""creating-a-virtual-environment-in-the-notebooks-service"">}}here{{</link>}} to create a virtual environment.
- Install dask and dask gateway and dependencies: without this step your environment will not work with dask.
{{<command>}}
pip install dask-gateway dask lz4
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#creating-a-virtual-environment-for-the-notebooks-service,316,36
Putting it all together,"- Set your notebook virtual environment as the kernel for the notebook in question as shown in the instructions linked above.
- Set `options.worker_setup` to a command which will activate your dask virtual environment. For example
options.worker_setup = ""source /home/users/example/name-of-environment/bin/activate""
- If you have an existing dask cluster, close it and ensure all lotus jobs are stopped before recreating it using the new environment.
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#putting-it-all-together,451,64
Code Examples,"Examples of code and notebooks which can be used to test the JASMIN dask gateway service are [available on GitHub](https://github.com/cedadev/jasmin-daskgateway/tree/main/examples).
",https://help.jasmin.ac.uk/docs/interactive-computing/dask-gateway#code-examples,182,20
Graphical linux desktop using NoMachine NX,"This article explains how to connect to a graphical linux desktop within the
JASMIN environment using NoMachine NX.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx,116,18
Introduction,,https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#introduction,0,0
Benefits,"- This service provides a graphical Linux desktop on JASMIN, ideal
for use with graphics-heavy tasks like interactive work with large images.
- The desktop environment includes a Firefox web browser which can be used to access 
internal-only web resources.
Using graphical applications over a wide-area network can be very slow, and is
not recommended or supported on JASMIN. This service provides a better alternative with
graphical desktop **within** the JASMIN environment itself, rather than on the user's local machine.
A small client application, available for you to install on your local machine,
enables you to connect to specific servers within JASMIN. Graphics are then relayed to the client 
application in a more efficient form, resulting in much better performance particularly if you need 
to interact with what's being displayed.
The service provides an improved user experience and is strongly
recommended over standard X11 graphics.
The following ""special"" login servers have the NX service available and can be
used as described below:
- `nx-login1.jasmin.ac.uk` (best for use from university networks)
- `nx-login2.jasmin.ac.uk` ([Contingency config]({{< ref ""login-servers#contingency-login-servers"" >}}) similar to `login2.jasmin.ac.uk`, to make it available from clients without reverse DNS lookup to a domain in the JASMIN allow-list. Use this option if you need to connect from home and do not have an institutional VPN available)
- `nx-login3.jasmin.ac.uk` ([Contingency config]({{< ref ""login-servers#contingency-login-servers"" >}}) as above) 
- `nx-login4.jasmin.ac.uk` ([Contingency config]({{< ref ""login-servers#contingency-login-servers"" >}}) as above, but also supports users with usernames > 8 but also supports users with usernames > 8 characters. No support for usernames > 14 characters: contact helpdesk for advice)
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#benefits,1854,261
Notes,"- In all other respects these are the same as the standard [login servers]({{< ref ""login-servers"" >}}), but should only be used with the NX enterprise client as described below, (other than for testing your connection) as this preserves system resources for their intended purpose.
- Although the graphical desktop session which you create with this service should persist when you close the client (unless you specifically log out), you should not rely on this feature, so please don't report this as a problem: occasionally machines run out of resources and sessions get killed. Keeping sessions open consumes resources on the server even when you're not using the session, which may mean that other users can't use the service.
- `nx-login4` has been introduced to help cater for users whose usernames exceed 8 characters length. This works around a known limitation in the NX server software but may not solve the problem for users with very long names (created before we introduced a limit to prevent this happening: if this still affects you and you cannot make onward connections to other machines in NX, please contact the helpdesk)
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#notes,1142,188
Installing NoMachine Enterprise Client,"Download the appropriate version of the NoMachine Enterprise Client from
[NoMachine](https://www.nomachine.com/download-enterprise#NoMachine-
Enterprise-Client). This page contains links to several different products.
**The only one you need to install is ""NoMachine Enterprise Client"".**
Versions are available for Windows, Mac and Linux. You may need privileges on
your local machine in order to install the software so you may need to ask for
help from your local IT helpdesk.
Note that **""Nomachine Enterprise Client""** is a different application to the
""Nomachine Enterprise Desktop"" available from the more publicised download
link on the NoMachine website or other applications in the NoMachine suite:
the desktop edition contains additional components to enable remote access to
your **own** (local) machine from a remote location: perhaps convenient
but not what we are trying to enable for you here.
The **NoMachine Enterprise Client** is purely a client to connect to a remote
server: in our case the server is at the JASMIN end, where the desktop session will exist.
Remember to check for updates for the enterprise client to ensure you always
have the latest stable version. You can configure the application to check for
updates (and optionally apply them automatically) by going to Settings /
Updates in the menu.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#installing-nomachine-enterprise-client,1329,201
Setting up your connection,"As you can see from the following videos, the instruction steps below are very
similar for Windows / Mac / Linux, once the enterprise client is installed.
Note that the interface may look slightly different depending on which version
number of the client you have installed (we can't promise to keep the videos
up to date with every new version, unfortunately!)
{{< nav type=""tabs"" id=""tabs-os"" >}}
  {{< nav-item header=""Windows"" show=""true"" >}}
    {{< youtube id=""-O-Ec4lZJuE"" title=""Windows"" >}}
  {{< /nav-item >}}
  {{< nav-item header=""Mac"" >}}
    {{< youtube id=""R9zb3LbrlJE"" title=""Mac"" >}}
  {{< /nav-item >}}
  {{< nav-item header=""Linux"">}}
    {{< youtube id=""g22dDHX7Tt0"" title=""Linux"" >}}
  {{< /nav-item >}}
{{< /nav >}}
Instructions for v8.x clients: (older clients may vary but same concept overall)
  1. Open the NX client 
      1. On Mac and Windows, click the NoMachine Icon
      1. On Linux, the default location for the executable once installed is `/usr/NX/bin/nxplayer`, so you may want to add this to your path. Your desktop environment may enable you to add an icon to your desktop.
  1. In the ""Machines"" view, select ""Add""
      1. You're now in the ""Address"" tab. Type a name for this connection profile, and the full hostname, e.g. `nx-login2.jasmin.ac.uk`. Set the Protocol to ""SSH"", which will change the port to 22.
  1. Go to the ""Configuration"" tab.
      1. Choose **""Use key-based authentication with a key you provide""** , then click the Modify button to the right.
      1. The default is ""Use password authentication"": **don't** use this.
      1. Use the button to the right to navigate to your private key, or type the path in the box.
      1. Your private key may be in a hidden directory e.g. `~/.ssh` (see {{<link ""#cant-find-your-private-key"">}}Troubleshooting{{</link>}})
      1. It is recommended NOT to ""import the private key to the connection file"".
      1. Make sure you tick the box ""Forward Authentication"" **IMPORTANT**
  1. Go back to the ""Add connection"" dialog
      1. If all is correct, click ""Add""
  1. In the ""Machines"" list
      1. You should see your new connection listed.
      1. Either double-click it, or right-click and select ""Start connection""
      1. (Note that you can right-click to Edit/Remove/Rename or see {{<link ""#troubleshooting"">}}Troubleshooting{{</link>}} )
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#setting-up-your-connection,2351,351
Connecting,"  1. Enter your JASMIN username and your SSH passphrase (it is NOT recommended to save your passphrase in the connection file). Click OK.
  1. You may see a list of all the other desktop sessions currently in progress from other users. Ignore these and click ""New desktop"".
  2. Select ""Create a new virtual desktop"", then click ""Create""
  3. **Note the instructions for how to reach the NX menu once in the session, and select screen settings from the list of icons: Recommended setting is ""Fit to window"" (leftmost icon)**
  4. Click OK on this and subsequent screens giving information about the NX and desktop environments.
  5. You should be presented with a linux deskop on the server to which you connected, e.g. `nx-login2.jasmin.ac.uk`
  6. Click ""Activities"" (top left menu on desktop) ![](file-XXVsbhxQi8.jpg)
  7. Open a terminal window by clicking the ""Terminal"" icon in the menu down the left hand side.  
  ![](file-chi3HNdvmk.jpg)
  8. To see the list of sci servers which is normally presented at login (which helps in selected a less-loaded sci server), type the following:  
{{<command user=""user"" host=""nx-login1"">}}
cat /etc/motd
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#connecting,1166,182
Using the graphical desktop environment,"Once you have set up the environment to your liking, you can
  - use the web browser on that system to access web-based resources available only within JASMIN
  - make SSH connections to other systems within JASMIN such as `sci1.jasmin.ac.uk`
  - use graphical applications on other systems within JASMIN and send the output bask to this desktop
  1. Click ""Activities"" (top left menu on desktop) 
{{<image src=""img/docs/graphical-linux-desktop-access-using-nx/file-XXVsbhxQi8.jpg"" caption=""click Activities"">}}
  2. Click the Firefox icon in the side bar menu to start the Firefox web browser. Use this to access web-based resources only available within JASMIN. Do not use for personal web browsing. To toggle Firefox between taking up the whole of your desktop, and running in a smaller, sizeable window, double-click its title bar (this applies to any windowed application on the desktop).
{{<image src=""img/docs/graphical-linux-desktop-access-using-nx/file-zykeLBbqgb.jpg"" caption=""open Firefox browser"">}}
  3. Click the Terminal icon 
{{<image src=""img/docs/graphical-linux-desktop-access-using-nx/file-RMJ4FzLkUz.jpg"" caption=""open Terminal application"">}}
  4. Try an onward SSH connection, for example to a SCI machine. 
{{<command user=""user"" host=""nx-login2"">}}
ssh -AX <user>@sci1.jasmin.ac.uk
{{</command>}}
(where `<user>` should be replaced by your JASMIN username).
  5. Work interactively on a SCI machine as you would normally, but any graphical tools/applications should now work efficiently. 
  6. (Example of a graphical application on another machine within JASMIN). Try opening a simple graphical application on `sci1.jasmin.ac.uk` with the command:
{{<command user=""user"" host=""nx-login2"">}}
xclock
{{</command>}}
(you may find `-AY` works if `-AX` does not).
  You may also get a few warning messages like this, which can safely be
  ignored:
  ```
  Warning: Missing charsets in String to FontSet conversion
  ```
  Cancel the graphical application (xclock) with `CTRL + c`, or use the
  application's own exit command, if it has one.
  With other graphical applications opened on other servers within JASMIN, you
  may get warning/error messages like these as they start up: these can safely
  be ignored. Sometimes an application window can take a few seconds to appear,
  but should work normally after that.
Failed to open connection to ""session"" message bus: /usr/bin/dbus-launch terminated abnormally without any error message
Running without a11y support!
Gtk-Message: 08:58:38.169: Failed to load module ""pk-gtk-module""
Gtk-Message: 08:58:38.171: Failed to load module ""canberra-gtk-module""<br>
  7. To log out of the virtual desktop, locate the menu top-right, and select your name, then ""Log Out"" 
    1. Don't worry if it appears that you're able to power off the machine with other users logged in: you would need administratrive privileges for this (which you don't have) so you can't do this accidentally. Please don't try, however!
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#using-the-graphical-desktop-environment,2974,411
Notes,"  * The number of ""virtual desktops"" which can be created per user is limited to 1 in order to preserve system resources.
  * Although in theory sessions and desktop windows should persist when you close down the NoMachine client and when you re-open it to the same connection, you should not rely on this feature. Keeping long-running sessions open reduces resources available to other users.
  * The option to shut down the machine does not work for a ""regular"" user (only admins). Please just ""Log out"" instead.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#notes,515,87
Troubleshooting,,https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#troubleshooting,0,0
Authentication error (Windows users),"* Try reformatting your private key using a tool available within MobaXterm. 
    * If you have tested and can successfully connect to `nx-login2.jasmin.ac.uk` from a MobaXterm terminal but **NOT** from the NoMachine NX client (""Authentication Failed""), then try following the steps below: these instructions are for Windows users.
    * Note that this doesn't make you a new key, it just makes a newly-formatted version of your key, which can sit alongside your existing private key file. The public key stays the same, so there's no need to upload anything new to your JASMIN profile.
    * Open the MobaKeyGen tool: MobaXterm menu / Tools / **MobaKeyGen (SSH Key Generator)**
    * Click Load, navigate to your existing private key file (you may need to change the filter to show all files (*.*) instead of just (*.ppk). Select your key, click Open
    * You will be prompted for the passphrase which you set when creating the key.
    * In the MobaKeyGen menu, select Conversions / Export OpenSSH key (the 2nd option)
    * Choose a new name for the file (it is recommended to just append something on to the end of your existing key name, so that it's clear that they are formats of the same key, e.g. id_rsa_jasmin -> id_rsa_jasmin_f (but the name is not significant).
    * Close the ""MobaXterm SSH Key Generator"" window
    * Make yourself a new NX connection profile, pointing to the new file
    * You should now be able to connect.
    * The following video shows this sequence in action (although the key is named slightly differently)
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#authentication-error-(windows-users),1548,259
Transposed symbol keys,"After the first connection (particularly for Mac users), subsequent connections to the same connection profile sometimes have some symbols keys e.g. `@` and `""` transposed. 
Watch the following video for how to correct this.
{{< youtube bC41sdqOr7k >}}
Doing as shown leaves a small drop-down choice tool in your Gnome desktop menu so that you can correct the problem if it re-occurs later. The correct choice for the author's UK Mac was ""English (UK, Macintosh)"", but you may need to experiment with the choices available to match your own keyboard layout.
If you click the small keyboard-layout icon (bottom right when viewing the list of choices), you will be shown a preview of that keyboard layout to compare with your own. 
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#transposed-symbol-keys,730,121
Connection timeout,"Please do not try and connect using the proprietary ""NX"" protocol. Select ""SSH"" as the protocol. If you mistakenly use ""NX"" as the protocol you may see an error similar to the following when you try to connect (The correct port for **SSH** connections is 22)
A connection timeout has occurred while trying to connect to 'nx-login2.jasmin.ac.uk' on port '4000'.
The issue could either be caused by a networking problem, by a firewall or NAT blocking incoming
traffic or by a wrong server address. Please verify your configuration and try again.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#connection-timeout,544,91
Authentication method,"Please use ""Private key"" as the authentication method, not ""Authentication agent"", as the former has been found to work more consistently and reliably, particularly for onward connections to other machines.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#authentication-method,207,30
Client version,"Make sure you have installed and are using the most recent version of the [NoMachine Enterprise Client](https://www.nomachine.com/download-enterprise#NoMachine-Enterprise-Client) (not the NoMachine Enterprise Desktop or any other applications from NoMachine).
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#client-version,260,28
Key format,"If you created your SSH private key using the ""PuTTYgen"" application, and are getting ""Authentication failed"" for a key pair that you know works OK for simple terminal connections, it could be that you need to convert the private key to ""OpenSSH format"" for use here. By doing this you would be creating an alternately-formatted version of the same private key, so the public key stays the same (and you don't need to re-upload that to JASMIN).
- Open PuTTYgen and ""Load an existing private key file"" (click ""Load"")
- Ignore the notice about saving it in PuTTY's own format (this is not useful here) (click ""OK"")
- In the PuTTYgen menu, select ""Conversions"", then ""Export OpenSSH key""
- Save the newly-formatted private key file locally. The passphrase needed to unlock it should not have changed.
- Use this newly-formatted key file with NoMachine NX.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#key-format,853,145
Passphrase vs Password,"Be sure to use the PASSPHRASE associated with your SSH private key, and not the PASSWORD associated with your JASMIN account, when prompted using the NX client.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#passphrase-vs-password,161,27
Can't find your private key?,"The location of your private key on your local machine may be in a hidden directory for example `~/.ssh`. In order to navigate to it to provide the location when setting up your connection profile, you may need to enable the display of hidden directories/files in your local desktop environment first. On a Mac you can do this with the shortcut {{<kbd ""CMD+SHIFT+."">}}. In Windows this is under File Explorer / View / Hidden Items. It's also possible that your home directory itself (normally `/Users/<username>`) is not configured to be displayed by default in `Finder`. If this is case, go to Finder / Preferences / Sidebar / Show these items and tick the box next to the item representing your username: this should make it appear, and `.ssh` should be a subdirectory of this.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#can't-find-your-private-key?,780,134
Can't make an onward connection,"Previous versions of the Windows client had problems with ""forward authentication"" enabled, but this is required for onward connection to other machines. If this happens, try:
* Does your username have > 8 characters? If so, try using `nx-login4`.
* Uninstalling the v7 client client
* Deleting the `C:\Users\<username>\.nx` directory on your machine
* Re-installing and trying again.
* Deleting and making a new connection profile for the nx-login server you're connecting to.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#can't-make-an-onward-connection,478,73
Can't display graphics from sci machine or other onward connection,"Did you omit the `-X` option from the SSH command when you made the onward connection to that machine? Try `-Y` if `-X` doesn't work for you.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#can't-display-graphics-from-sci-machine-or-other-onward-connection,142,27
Disk space,"Check your disk usage in your JASMIN home directory: if this is over the 100G limit, you may not be able to write any temporary files and this could prevent NoMachine from being able to start a new session or even reconnect to an existing virtual desktop session. Clear out some space and re-check with `pdu -sh $HOME` to find out how much space you're using.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#disk-space,360,66
Can't connect or gets stuck connecting to a previous session,"Sometimes, you can't connect because you have a previous session which did not terminate correectly, or you might have problems reconnecting to a previous desktop session. Sometimes the client will get stuck with a ""spinning wheel"" before eventually timing out. You can terminate your own previous session as follows:
- Follow instructions in {{<link ""#connecting"">}}Connecting{{</link>}} until step 2 where all the users' sessions on the machine are displayed.
- Find the one corresponding to your username
- Right-click it and select ""Terminate session""
Note that you may lose any unsaved work in the session that you terminate, but it should clear the stuck session and allow you to reconnect. Please try this first before asking the support team, as this is the first thing that they will try in order to clear your session.
",https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#can't-connect-or-gets-stuck-connecting-to-a-previous-session,829,134
"""It worked yesterday""","For occasions where ""it worked last time I tried to connect, but now doesn't"", please first try the above step to clear any previous session which might have got stuck, otherwise the time-honoured IT support advice of ""turning it off and on again"" is applicable: try restarting your local machine where the NX client is running, as this can sometimes clear issues with the client, your machine or your network connection. Don't forget to re-connect via your VPN if available.
","https://help.jasmin.ac.uk/docs/interactive-computing/graphical-linux-desktop-access-using-nx#""it-worked-yesterday""",476,80
Interactive computing overview,"This article introduces the resources on JASMIN available for interactive
computing (as opposed to [batch computing]({{< ref ""slurm-scheduler-overview"" >}})). It covers:
- Login servers
- Scientific Analysis servers
- Data Transfer Servers
- Project Specific Servers
",https://help.jasmin.ac.uk/docs/interactive-computing/interactive-computing-overview,267,36
Login Severs,"The [login (also known as gateway or bastion) servers]({{< ref ""login-servers"">}}) provide external* users with access to services inside of JASMIN.
*external = outside of the STFC/RAL firewall.
",https://help.jasmin.ac.uk/docs/interactive-computing/interactive-computing-overview#login-severs,195,28
Scientific Analysis Servers,"The [scientific analysis servers]({{< ref ""sci-servers"" >}}) are the main
resource for most users' everyday work. They have a [standardised software
environment]({{< ref ""software-overview#common-software"" >}}) and are ideal for development and testing of
processing tasks which can then be submitted to the [LOTUS batch processing
cluster]({{< ref ""slurm-scheduler-overview"" >}}) for larger processing runs.
",https://help.jasmin.ac.uk/docs/interactive-computing/interactive-computing-overview#scientific-analysis-servers,409,53
Data Transfer Servers,"General [data transfer servers]({{< ref ""transfer-servers"" >}}) are provided
for simple or smaller data transfer tasks. For larger data flows or where high
performance is required, more sophisticated tools and services are available.
Please read the guides in consult the [data transfer
category](http://help.ceda.ac.uk/category/217-data-transfer) for more details.
",https://help.jasmin.ac.uk/docs/interactive-computing/interactive-computing-overview#data-transfer-servers,366,46
Project-Specific Servers,"In some cases in the past, project requirements were not met by the general resources
provided above and [project-specific servers]({{< ref ""project-specific-servers"" >}}) were provided.
However these are now deprecated as in most cases, a [tenancy in the
JASMIN Cloud](http://help.ceda.ac.uk/category/65-for-cloud-tenants) should provide what's needed.
",https://help.jasmin.ac.uk/docs/interactive-computing/interactive-computing-overview#project-specific-servers,354,44
JASMIN Notebooks Service,"The JASMIN Notebooks Service provides access to [Jupyter
Notebooks](https://jupyter.org/) in the web browser.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service,110,13
What is a Jupyter Notebook?,"A Jupyter Notebook is an interactive document containing live code and
visualisations that can be viewed and modified in a web browser. These
documents can be shared, often using GitHub, and many projects distribute
example code as Jupyter notebooks. Users interact with their notebooks using
the open-source Jupyter Notebook server application.
Jupyter has support for many languages including Python, R, Scala and Julia,
which are implemented by plugins known as ""kernels"". The JASMIN Notebook
Service currently provides one kernel - Python 3.10 with the latest [Jaspy
software environment]({{< ref ""jaspy-envs"" >}}) installed. This environment is
active by default, so there is no need for the `module` commands described in
the linked article. You can also install and use your own Python environments
as explained below.
The JASMIN Notebook Service uses
[JupyterHub](https://jupyter.org/hub) to manage multiple Jupyter Notebook
servers. After authenticating with a JASMIN account (with the correct access),
a user gets access to **their own notebook server**. The notebook server runs as
the authenticated user, and the user can access their home directory, Group
Workspaces and CEDA Archive data as they would from a scientific analysis
server.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#what-is-a-jupyter-notebook?,1251,186
Getting access to the JASMIN Notebook Service,"In order to access the JASMIN Notebook service, first, follow the steps in
[Getting started with JASMIN]({{< ref ""get-started-with-jasmin"" >}}) to get a
JASMIN account and the `jasmin-login` service.
{{<alert type=""info"">}}
From 16/6/2021, access to the JASMIN Jupyter Notebook service
is controlled simply by having a valid `jasmin-login` grant. [2-step
verification](http://notebooks.jasmin.ac.uk/) is still required as shown
below, but it is no longer necessary to apply for and be granted the
additional `jupyter-notebooks` role, which is now deprecated.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#getting-access-to-the-jasmin-notebook-service,572,78
Using the JASMIN Notebook Service,"To use the JASMIN Notebook Service, navigate to
<https://notebooks.jasmin.ac.uk>. This will redirect you to the JASMIN
Accounts Portal, where you should sign in with your JASMIN Account. If you
have previously accessed the notebook service from the computer you are using,
this may happen automatically.
The first time you access the JASMIN Notebook Service from a new computer or
browser, you will be asked to verify your email address after signing in. To
do this, make sure the ""Email"" method is selected and click ""Send me a code"":
{{<image src=""img/docs/jasmin-notebooks-service/file-9fa76fPQdE.png"" caption=""Sign in with 2-factor authentication"">}}
This will result in an email being sent to your registered email address
containing a six-digit verification code. Enter this code and press ""Verify
code"". Each code lasts between 15 and 30 minutes.
Upon successfully signing in and verifying your email if required, you will be
redirected back to the JASMIN Notebook Service. The service will then create a
notebook server for you to use, and you will see a loading page:
{{<image src=""img/docs/jasmin-notebooks-service/file-nkDFYlwSg1.png"" caption=""Loading page"">}}
After a few seconds, or in some rare cases a minute or two, you will be taken
to the JupyterLab interface:
{{<image src=""img/docs/jasmin-notebooks-service/file-fhTnvJz3xx.png"" caption=""JupyterLab interface"">}}
The folder shown in the left-hand panel will be your home directory on JASMIN,
exactly as if you had logged in to a scientific analysis server. Any changes
made in JupyterLab will be immediately reflected on the scientific analysis
servers and LOTUS, and vice-versa. You can then launch, edit and run Python
notebooks using the JupyterLab interface. Notebooks can access files from the
CEDA Archive, and also have read-only access to group workspaces. For example,
this notebook reads a file belonging to the CCI project from the CEDA Archive
and plots the data on a map:
{{<image src=""img/docs/jasmin-notebooks-service/file-LvHEu70CM6.png"" caption=""Example notebook"">}}
A full discussion of the power of the JupyterLab interface is beyond the scope
of this documentation, but the [JupyterLab
documentation](https://jupyterlab.readthedocs.io/en/stable/) is excellent, and
there are many tutorials available on the internet.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#using-the-jasmin-notebook-service,2306,328
Intended usage and limitations,"The JupyterLab environment provided by the JASMIN Notebooks Service is
powerful, but it has some limitations that reflect the type of usage that we
want to encourage.
The JASMIN Notebooks Service is primarily intended for interactively producing visualisations
of existing data, not for processing vast amounts of data. As such, the
resources made available to each notebook server are limited.
For larger processing tasks with Notebooks, users
should consider using the {{<link ""https://github.com/cedadev/jasmin-daskgateway"">}}JASMIN Dask Gateway service{{</link>}}, which provides an easy way for processing managed from within a Jupyter Notebook to be scaled out to multiple LOTUS jobs in parallel.
Alternatively, use the {{<link ""../batch-computing/lotus-overview"">}}LOTUS batch processing cluster{{</link>}}
separately, before using the notebooks service to visualise the output.
Doing this means that the bulk of the resource usage will be shared by the LOTUS cluster rather than the Notebooks service itself.
{{<alert type=""info"">}}
Although it was previously the case that Group Workspaces were only available in Notebooks read-only, this is no longer the case (as of 2023), so you should have full read-write access to any group workspace volume.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#intended-usage-and-limitations,1270,179
Common issues and questions,,https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#common-issues-and-questions,0,0
"I get ""403 forbidden"" when I try to access the JASMIN Notebook Service","This error occurs when you do not have the correct permissions to access the
JASMIN Notebook service. Please ensure you have been granted the `jasmin-login` and allow some time for the changes to propagate through the system.
","https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#i-get-""403-forbidden""-when-i-try-to-access-the-jasmin-notebook-service",226,37
Which software environment is used by the Notebook Service?,"The JASMIN Notebook Service currently uses the **default Jaspy environment**
listed on the [Jaspy page]({{< ref ""jaspy-envs"" >}}).
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#which-software-environment-is-used-by-the-notebook-service?,131,18
Can I install additional packages?,"The recommended way to do this is to [create your own virtual environment in
the notebooks service and install additional packages into that.]({{< ref ""creating-a-virtual-environment-in-the-notebooks-service"" >}})
You can
make that virtual environment persist as a kernel to use again next time you
use the Notebooks service.
If you believe that the package is more widely applicable, you can request an
update to Jaspy.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#can-i-install-additional-packages?,421,63
Can I use a different software environment?,"Yes, the article linked above also describes how to use Conda to create your
own custom environment.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#can-i-use-a-different-software-environment?,101,17
"I get ""503 service unavailable"" when I try to access the JASMIN Notebook","Service
This error occurs when your notebook server is unable to start. By far the
most common cause of this error is when you are over your quota in your home
directory. As part of starting up, Jupyter needs to create some small files in
your home directory in order to track state. When it is unable to do this
because you are over your quota, you will see the ""503 service unavailable""
error.
If you see this error, try connecting to JASMIN using SSH and checking your
home directory usage. After clearing some space in your home directory, your
notebook server should be able to start again.
","https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#i-get-""503-service-unavailable""-when-i-try-to-access-the-jasmin-notebook",596,108
I get the following message when my notebook is queued for spawning,"{{<image src=""img/docs/jasmin-notebooks-service/file-NHYStoV3nD.png"" caption=""Error message"">}}
The message above indicates that the Notebook service
is oversubscribed -busy- and there are no resources available to start your
Notebook server. Please try again later!
Please use the scientific analysis server and LOTUS for processing and Jupyter
Notebook for lighter visualisation.
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#i-get-the-following-message-when-my-notebook-is-queued-for-spawning,382,46
Example Notebooks,"In support of the JASMIN Notebook Service, we have developed a GitHub
repository with a collection of Notebooks that demonstrate some of the
important features of the service. The following provides a general
introduction:
<https://github.com/cedadev/ceda-notebooks/blob/master/notebooks/training/intro/notebook-tour.ipynb>
Other Notebooks can be found within the repository, under:
<https://github.com/cedadev/ceda-notebooks/tree/master/notebooks>
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#example-notebooks,449,45
Webinar / video tutorial,"A [CEDA webinar on 16th June 2020](https://www.ceda.ac.uk/events/past/jasmin-notebook-service-webinar/) demonstrated how to use the service. A recording of the event is available:
{{< youtube nle9teGLAb0 >}}
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#webinar-/-video-tutorial,208,24
Further info,"Here are a set of links to learn more about Jupyter Notebooks and the JASMIN
Notebook Service:
- [The JASMIN Notebook Service](https://notebooks.jasmin.ac.uk/)
- [Intro to Jupyter Lab](https://jupyter.org/)
- [Try a Jupyter Lab Notebook in your browser](https://jupyter.org/try) (this link does not use the JASMIN Notebook Service)
- [Tour of the JASMIN Notebook Service](https://github.com/cedadev/ceda-notebooks/tree/master/notebooks/training/intro) \- set of notebooks highlighting different features
- [Intro to the JASMIN Notebook Service](https://www.ceda.ac.uk/events/demo-of-the-jasmin-notebook-service-webinar/) \- video of a webinar from June 2020
- [Instructions to create a Python virtual environment](https://github.com/cedadev/ceda-notebooks/blob/master/notebooks/training/rerunnable-virtualenv-maker.ipynb) \- example notebook
- [Instructions to create a Conda environment for use with the Notebook Service](https://github.com/cedadev/ceda-notebooks/blob/master/notebooks/docs/add_conda_envs.ipynb) \- example notebook
",https://help.jasmin.ac.uk/docs/interactive-computing/jasmin-notebooks-service#further-info,1034,101
Login problems,"Having problems connecting to a host on JASMIN? Details of how to login to
JASMIN can be found [here]({{< ref path=""docs/getting-started/login"" >}}), but this article may help to
resolve login problems. It provides information for the following issues:
- Unable to login to a login server e.g. `login1.jasmin.ac.uk`
- Can login to login server but can't login to a subsequent server
- ssh-add command gives error: ""Could not open a connection to your authentication agent.""
- Errors when trying to connect with MobaXterm
",https://help.jasmin.ac.uk/docs/interactive-computing/login-problems,521,83
Unable to login to login server,"If you are unable to login to a login server e.g. `login1.jasmin.ac.uk` then
look carefully at any error messages displayed as this can help diagnose what
is wrong:
**1) ""Connection reset by peer""**
This suggests a problem with the configuration of your machine or local
network. Connections to JASMIN login servers are allowed from a specific set
list of network domains (the domain is the part **after** the host name e.g.
myhost. **mylocalnetwork.ac.uk** ). For this to happen, 2 things need to be in
place:
- the IP address of your machine needs to resolve to a full-qualified host name (so that it can be checked against the list)
- the domain part of the hostname needs to be on JASMIN's allow list.
Use the tool provided on the JASMIN accounts portal to check that your IP
address does indeed resolve:
Visit <https://accounts.jasmin.ac.uk/services/reverse_dns_check/> with your
browser, or do the following at the command line, on the machine **from which**
you're trying to connect:
{{<command user=""user"" host=""localhost"">}}
    curl https://accounts.jasmin.ac.uk/services/reverse_dns_check
{{</command>}}
Depending on your system, this will either provide output to the terminal (via
stdout) or on some systems this might save the output in the file
""reverse_dns_check"". You may need to look in that file for the result.
See [check network details]({{< ref ""check-network-details"" >}}) for further
information on how to interpret the result from this.
Most institutional networks for UK universities and partner organisations are
on our allow list, which is updated on request. However if you are trying to
connect from your home broadband, then please be aware that this is not the
the preferred route, for security reasons. If you connect from home, please be
aware that:
- The IP address which you are allocated by your internet service provider (ISP) may not resolve to a full hostname
- That domain name is unlikely to be on the allow list.
One solution is to connect via your VPN to your institution first. This
assigns you another IP address belonging to that institution, but you need to
repeat the checks above to make sure that address resolves (not all do).
Another option, if you have SSH terminal access to a machine at your
institution from where you can also make outgoing SSH connections, is that you
connect from your local machine to the machine at your institution, then make
the outward SSH connection to JASMIN from there. In this case, you need to
have your JASMIN SSH key loaded on your local machine first, and remember to
include the -A flag for ""agent forwarding"" for ALL the intermediate steps.
If all else fails, you can use the [""contingency route""]({{< ref ""login-servers"" >}}) provide by login2.jasmin.ac.uk (see article for further
details), but you will be limited in what you can do / connect to within
JASMIN as a result. We prefer all users to connect from their institutional
network.
**2) ""Permission denied""**
Here, the most likely cause is that the SSH key which your client is
presenting does not match the one in your JASMIN account. This can be for a
number of reasons:
  * **You have omitted to specify the username in your SSH connection**
    * In this case, you will be attempting to connect with the username you have on your local machine, which may not be the same.
  * **You have only recently uploaded your SSH key (it can take 20 to 60 minutes before the key propagates to all the places it needs to on JASMIN).**
    * Try waiting a few minutes before trying again.
  * **You don't have your key loaded in your local authentication agent (e.g. ssh-agent).**
    * Check that you are following the method suitable for your operating system 
      * The article ""[How to login]({{< ref path=""docs/getting-started/login"" >}})"" has instructions for linux, mac and windows.  
    * Note that connections using NoMachine NX don't require an authentication agent: this can be a good alternative if you're having problems.
  * **You have not yet been granted jasmin-login access or your access has expired.**
    * To check, go to [List my services](https://accounts.jasmin.ac.uk/services/my_services/?page=1&active=1&_apply_filters=1) on the JASMIN accounts portal and check that ""Login services: jasmin-login"" is listed. If not then you either need to [apply for jasmin-login access](https://accounts.jasmin.ac.uk/account/login/?next=/services/login_services/jasmin-login/), or if you have already done this recently you may simply need to wait for it to be approved. Note that if you have applied for access to a group workspace you still need jasmin-login access in order to connect to jasmin machines.
**3) ""The authenticity of host 'nnnn ( <ip address>)' can't be established.""
or ""key for host nnnn has changed""**
Your local computer stores a list of all the other SSH hosts which it has
successfully connected to in the past. If you use an intermediate host like a
login server to make onward connections to a sci machine, the login host will
maintain another such list. In both cases there should be a
file`~/.ssh/known_hosts` (so one in your local home directory on your own
machine, and one in your JASMIIN home directory)
When the SSH client first contacts the host for the SSH connection, it checks
to see if the remote host is one that it recognises. If this check fails, you
may get a message like the following:
**Message 1:**
{{<command>}}
(out)The authenticity of host 'nnnn (<ip address>)' can't be established.
(out)ECDSA key fingerprint is SHA256:8QY9iBcOQFyEYkpOtBUU8WQGeADb0DyMff01BRuvYls.
(out)ECDSA key fingerprint is MD5:f9:19:c4:5f:2b:fa:ed:aa:34:86:c9:23:dd:1c:44:30.
(out)Are you sure you want to continue connecting (yes/no)?
{{</command>}}
**Message 2:**
{{<command>}}
(out)@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
(out)@       WARNING: POSSIBLE DNS SPOOFING DETECTED!          @
(out)@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
(out)The ECDSA host key for nnnn has changed,
(out)and the key for the corresponding IP address <IP address>
(out)has a different value. This could either mean that
(out)DNS SPOOFING is happening or the IP address for the host
(out)and its host key have changed at the same time.
(out)Offending key for IP in /home/users/username/.ssh/known_hosts:62
(out)@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
(out)@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
(out)@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
(out)IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
(out)Someone could be eavesdropping on you right now (man-in-the-middle attack)!
(out)It is also possible that a host key has just been changed.
(out)The fingerprint for the ECDSA key sent by the remote host is
(out)SHA256:Evr7U40sEGSLVypfafLYtbF2oYvGDuBxTyrALdx11pk.
(out)Please contact your system administrator.
(out)Add correct host key in /home/users/username/.ssh/known_hosts to get rid of this message.
(out)Offending ECDSA key in /home/users/username/.ssh/known_hosts:115
(out)ECDSA host key for nnnn has changed and you have requested strict checking.
(out)Host key verification failed.
{{</command>}}
This can happen when:
- machines are re-installed (as part of maintenance by the JASMIN team)
- when you modify your `~/.ssh/known_hosts` file  
- when you access a ""known"" host but via a different name (e.g. `sci1` vs `sci1.jasmin.ac.uk`) 
Message 1 means that you don't have an entry for that host in your
`~/.ssh/known_hosts` file. In most cases, you can safely reply ""yes"" and the
SSH connection should proceed as normal from then on.
If you get message 2, and are confident that the change is for a legitimate
reason, the solution is to modify your `~/.ssh/known_hosts` file, removing the
entries for that host (there may be more than one, as above for `sci1` vs
`sci1.jasmin.ac.uk`) by deleting those lines. Next time you try and connect,
you will get message 1, but can reply ""yes"" and the SSH connection should
proceed as normal.
**Note:** If you're using a graphical SFTP or SCP client for data transfers,
the error messages above may be hidden and so it can be harder to establish
the reason for failure. Using a terminal session (in MobaXterm on Windows, or
Mac/Linux terminal) to the problem host will likely reveal the messages and
enable you to follow the steps above to solve the problem.
",https://help.jasmin.ac.uk/docs/interactive-computing/login-problems#unable-to-login-to-login-server,8370,1272
Can login to login server but can't login to a subsequent host,"Here, there are 3 main possibilities:
**1) You have not set up agent forwarding correctly on your local machine.**
****This allows your ssh key to be used for logging in from `login1.jasmin.ac.uk` to
other machines. To check, run the following command on the login server:
{{<command user=""user"" host=""login1"">}}
echo ""$SSH_AUTH_SOCK""
{{</command>}}
This should display something that looks similar to (but not identical to)
{{<command user=""user"" host=""login1"">}}
(out)/tmp/ssh-RNjiHr2844/agent.2844
{{</command>}}
If nothing is displayed then it indicates
that agent forwarding is not working. Please read 
[how to login]({{< ref path=""docs/getting-started/login"" >}}) and make sure
 you are running ssh-agent (or similar), have loaded
your private key and are using the -A option on your ssh command for the
connection to the login server. NX users should make sure that the ""agent
forwarding"" option is ticked when setting up a connection profile.
**2) Some hosts within JASMIN are restricted to particular (groups of)
users.**
The ""sci"" servers (e.g. `sci1.jasmin.ac.uk`) and ""xfer"" machines (e.g.
`xfer1.jasmin.ac.uk`) should be available to all with `jasmin-login` access
(see above). However, some other machines are restricted to particular project
participants and require special permission to use. For example, the high-
performance transfer servers `hpxfer[12].jasmin.ac.uk` requires the
{{<link ""../data-transfer/hpxfer-access-role"">}}hpxfer access role{{</link>}}, which can be applied for at the JASMIN accounts portal,
as can most roles currently in use.
**3) There is a problem with the host you are trying to connect to.**
Occasionally there may be problems with the host (machine) which you are
trying to connect to. The sci servers (particularly the high-memory host
jasmin-sci3) experience very high usage loads and occasionally run out of
resources. This may prevent you from logging in. In some circumstances ask you
for a password: this is normally a sign that something is wrong with the
machine, since passwords are not used for host logins on JASMIN, so there is
no point in trying to enter your account password or SSH passphrase at this
point. In this case please contact us using the help beacon below.
If you still have problems then please contact us using the help beacon below.
It would be helpful if you can include as much of the following information as
possible:
- The IP address and full hostname of the machine you are trying to connect from.
- The date and time that you tried connecting (to the nearest minute if possible). This will help us to identify any relevant messages in any log files.
- The exact command you were using
- Add ""-vvv"" to your SSH command and send us the the output (please include the SSH command itself)
- List the SSH keys directory on your local machine. On a linux machine this can be done with the command: `ls -l ~/.ssh`
",https://help.jasmin.ac.uk/docs/interactive-computing/login-problems#can-login-to-login-server-but-can't-login-to-a-subsequent-host,2894,456
"ssh-add command gives error: ""Could not open a connection to your authentication agent.""","On some terminal sessions the usual instructions for starting the ssh-agent
session and adding the key may give the following error:
{{<command user=""user"" host=""localhost"">}}
ssh-add ~/.ssh/id_rsa_jasmin
(out)Could not open a connection to your authentication agent.
{{</command>}}
If you get this message, please try either:
modifying the method you use to start the ssh-agent, to:
{{<command user=""user"" host=""localhost"">}}
eval $(ssh-agent -s)
{{</command>}}
(and then trying to load the key again)
or see below (if using MobaXterm) which now has a better way of loading the SSH key.
","https://help.jasmin.ac.uk/docs/interactive-computing/login-problems#ssh-add-command-gives-error:-""could-not-open-a-connection-to-your-authentication-agent.""",588,86
Errors when connecting with Mobaxterm,"Please follow the [instructions for MobaXterm]({{< ref ""mobaxterm"" >}}) (which
include a video to show how to load your key into its own ssh-agent, `MobAgent`).
These instructions have changed with more recent versions of MobaXterm, and
replace the need to use the `ssh-add` command, so please make sure that both the
version you are using, and your method, are up to date!
Please note that even if your initial connection to (for example) your
university host does not require your JASMIN SSH key, you should still load
the key AND enable agent forwarding, for your initial connection to that host,
so that the key can be used for the subsequent connection to the JASMIN login
host. This actually applies to any connection method, not just MobaXterm.
",https://help.jasmin.ac.uk/docs/interactive-computing/login-problems#errors-when-connecting-with-mobaxterm,752,126
Available login servers,"There are three login servers available to access resources within JASMIN.
Users with the `jasmin-login` access role can access the following servers via
SSH:
Login server name | details |
|---|---|  
| `login1.jasmin.ac.uk`  | best for use from university networks (requires fwd/reverse DNS lookup to domain in allow-list) | 
| `login2.jasmin.ac.uk`  | {{<link ""#contingency-login-servers"">}}Contingency config{{</link>}}, see notes below  |
| `login3.jasmin.ac.uk`  | as per login1 |
| `login4.jasmin.ac.uk`  | as per login1 |
{.table .table-striped}
See also [How to login]({{< ref path=""docs/getting-started/login"" >}}) and other articles in the [Getting started]({{< ref ""getting-started"" >}}) category.
See also [NoMachine NX service]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}) which provides login to a graphical Linux desktop, rather than a
single terminal window.
",https://help.jasmin.ac.uk/docs/interactive-computing/login-servers#available-login-servers,885,116
Features of login servers,"Login servers have minimal resources and software installed. They provide:
- Access to your home directory (`/home/users/<username>`).
- Access via SSH to other hosts within JASMIN (inside the RAL firewall)
- No analysis software is installed on the login servers.
- No access to group workspaces or other volumes.
",https://help.jasmin.ac.uk/docs/interactive-computing/login-servers#features-of-login-servers,315,49
"""Contingency"" login servers","There are [requirements on your local network]({{< ref ""check-network-details"">}}) which apply to accessing the login servers **and** the [transfer
servers]({{< ref ""transfer-servers"" >}}) via SSH. If you cannot meet these
requirements, even after discussion with your local network admin team, a
contingency route is provided in the form of login server
`login2.jasmin.ac.uk`
However, you will be limited in what you can access within JASMIN from this
server. Specifically:
- You will not be able to access the transfer servers `xfer[1,2].jasmin.ac.uk` via SSH directly from an external host.  
- You can access these via SSH from `login2`, but can then only initiate an inward pull of data from an external SSH server, if available at your institution. You cannot push data directly to `xfer[1,2].jasmin.ac.uk` via SSH from outside in this case.
- Instead, an alternative transfer server `xfer3.jasmin.ac.uk` is provided with equivalent configuration to `login2`. This should provide what you need for direct SSH transfers from outside, but you will need the additional `""xfer-sp""` access role in in this case: see [here for further details]({{< ref ""transfer-servers"" >}}).
","https://help.jasmin.ac.uk/docs/interactive-computing/login-servers#""contingency""-login-servers",1177,177
How to use the login servers,"For full details of how to log in, including making onward connections to
other machines, please see the article [""How to login""]({{< ref path=""docs/getting-started/login"" >}}).
{{<alert type=""danger"">}}
Users are **not permitted to execute commands which require
administrative privileges**. This applies to all hosts in the managed part of
JASMIN where users have SSH login access (for example `login`, `nx-login`,
`sci`, `xfer` and `hpxfer` machines).
In other words, the **use of `su` and `sudo` is not permitted**.
Please be careful when typing commands,
particularly if you have multiple terminal windows open on your own computer,
that you do not accidentally attempt `sudo`on a JASMIN machine: expect some
follow-up from the JASMIN team if you do!
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/login-servers#how-to-use-the-login-servers,769,115
Project-specific servers,"{{<alert type=""danger"">}}
**Deprecated feature** documented here to provide information about how to access existing instances.
Project-specific servers are no longer provided on request, as most use cases can be satisfied by 
a tenancy in the JASMIN cloud.
{{</alert>}}
This article introduces the project specific servers. It covers:
",https://help.jasmin.ac.uk/docs/interactive-computing/project-specific-servers,336,47
What is a project-specific server?,"Previously, projects could be provided with dedicated servers
built with specific software required by the project, or where
access needs to be restricted to members of a project or institution.
",https://help.jasmin.ac.uk/docs/interactive-computing/project-specific-servers#what-is-a-project-specific-server?,195,30
Get Access,"On the JASMIN accounts portal, you can apply for access to an existing Project
VM.
Step 1: Select Project VMs from the Discover Services menu on the left
{{<image src=""img/docs/project-specific-servers/file-sXxKyvM4tC.png"" caption=""discover services menu"">}}
Step 2: You can either browse the page listing or do a search on the Project
VMs. For example here using CEDA as a keyword search and to apply for access
to CEDA_scisup, click apply or look into More information
{{<image src=""img/docs/project-specific-servers/file-sXxKyvM4tC.png"" caption=""locate relevant server"">}}
{{<image src=""img/docs/project-specific-servers/file-1VcK9TxAb7.png"" caption=""apply for access"">}}
{{<image src=""img/docs/project-specific-servers/file-6pFYZos6OQ.png"" caption=""provide supporting information and submit request"">}}
{{<image src=""img/docs/project-specific-servers/file-bfV2a3mLsK.png"" caption=""request pending"">}}
",https://help.jasmin.ac.uk/docs/interactive-computing/project-specific-servers#get-access,905,95
Intro,"Once you have logged on to one of the [login servers]({{< ref ""login-servers"" >}}) you can then `ssh` to a scientific analysis (sci) server to do your work.
The sci servers are not directly accessible outside the firewall of RAL (JASMIN's host instution) so most users will need to access them via a login server.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#intro,314,55
Available sci servers,"The following sci servers are available:
Server name  |  Virtual/Physical (OperatingSystem)  |  Processor model  |  CPU Cores  |  RAM (GB)  |  /tmp (GB)  
---|---|---|---|---|---  
sci1.jasmin.ac.uk  |  V (CentOS7)  |  Xeon(R) Silver 4114 CPU @ 2.20GHz  |  8  |  32  |  N/A [[Note 2.]](#2-tmp-on-vms)
sci2.jasmin.ac.uk  |  V (CentOS7)  |  Xeon(R) E5-2630 @ 2.20GHz  |  8  |  32 |  [[Note 2.]](#2-tmp-on-vms)  
sci3.jasmin.ac.uk  |  P (CentOS7) [[Note 1.]](#1-physical-servers) |  AMD EPYC 7402  |  48  |  1000|  25  
sci4.jasmin.ac.uk  |  V (CentOS7)  |  Xeon E5-2660 @ 2.20GHz  |  8  |  32  | N/A  [[Note 2.]](#2-tmp-on-vms)
sci5.jasmin.ac.uk  |  V (CentOS7)  |  Intel(R) Xeon(R) CPU E5-2630 v4 @2.20GHz  |  8  |  32  |  N/A  [[Note 2.]](#2-tmp-on-vms)
sci6.jasmin.ac.uk  |  P (CentOS7), [[Note 1.]](#1-physical-servers) |  AMD EPYC 7402  |  48  |  1000|  25  
sci8.jasmin.ac.uk  |  P (CentOS7), [[Note 1.]](#1-physical-servers) |  Intel(R) Xeon(R) Gold 5118CPU @ 2.30GHz  |  24  |  383  |  25  
|  |  |  |  |
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#available-sci-servers,1035,151
Notes,,https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#notes,0,0
1. Physical servers,"Hosts `sci[3,6,8].jasmin.ac.uk ` are physical servers on a private internal network, so outbound internet access (via NAT) is only
for HTTP(S), so outbound SSH **will not work (to hosts outside of
JASMIN) on these machines**. If you try to `git pull/clone` from external repositories e.g. Github, the operation will timeout with error `fatal: Could not read from remote repository`. The solution in this case is to access `git pull/clone` over **HTTPS** instead (check the repo for alternative access details).
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#1.-physical-servers,511,79
2. /tmp on VMs,"The local `/tmp` of the virtual sci servers is not available (N/A) for users
as this is used by the VM itself. It also provides no performance advantage as it is not local to the server.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#2.-/tmp-on-vms,187,36
3. Arbiter,"A monitoring utility ""**Arbiter**"" is implemented across
all sci machines to control CPU and memory usage. This utility
records the activity on the node, automatically sets limits on the resources
available to each user. Users' processes are thus capped from
using excessive resources, and can be slowed or have memory reduced in response to repeated violations.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#3.-arbiter,363,56
4. Privileges,"Users are **not permitted to execute commands which require
administrative privileges.** This applies to all hosts in the managed part of
JASMIN where users have SSH login access (for example `login`, `nx-login`,
`sci`, `xfer` and `hpxfer` machines). In other words, the **use of `su` or
`sudo` is not permitted**. Please be careful when typing commands,
particularly if you have multiple terminal windows open on your own computer,
that you do not accidentally attempt `sudo` on a JASMIN machine: expect some
follow-up from the JASMIN team if you do!
See also {{< link ""#software-installed"">}}Software installed{{</link>}}, below.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#4.-privileges,632,95
Purpose,"Scientific analysis servers are designed for interactive and ad-hoc analysis
of data in group workspaces, the CEDA archive, and users' home directories.
**For long-running and resource-intensive jobs, users are required to use
the LOTUS cluster** which offers better I/O performance, parallelism, and
fair-share scheduling.
The following guidelines should be considered when using the scientific analysis
servers:
- Check available resources before your process starts and choose a sci server that is suitable (check average load in the list displayed at the login screen on the login servers, or by using the Linux monitoring commands: `top`, or `free -h` )
- Execution/processing time should be less than 1 hour
- Serial jobs only
- High memory jobs should be executed on the physical servers which have more memory (labelled P in [above table](#available-sci-servers)).
- Monitor your process on a sci server using `top` or `ps` Linux commands
- Report if there is a user's process affecting the performance of a scientific server
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#purpose,1034,161
Software installed,"Each sci server has the following features:
- CentOS7 operating system with development tools. [NB: Rocky9 from summer 2024]
- Software packages that make up the [JASMIN Analysis Platform]({{< ref ""software-overview#common-software"" >}}) are all installed - providing commonly-used open-source analysis tools. These packages include NCO, CDO, Python (with netCDF4, matplotlib, numpy etc.,) and R.
- Access to proprietary tools, e.g. IDL and Intel Fortran, through the `module` system.
- Ability to run graphical applications: use the [NX graphical desktop service]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}) for best performance.
Further information on using the software provided on JASMIN [can be found here]({{< ref ""software-overview"" >}}).
See [[Note 4]](#4-privileges) above about privileges: you can only install software for yourself if it can be done with user-level privileges.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#software-installed,900,123
Access to storage,"Each sci server has:
- Access to the LOTUS `/work/scratch-pw*` and `/work/scratch-nopw2` volumes.
- Read access to the [CEDA Archive]({{< ref ""ceda-archive"" >}}) according to permissions on your CEDA account.
- Read/Write access to Group Workspaces according to membership.
",https://help.jasmin.ac.uk/docs/interactive-computing/sci-servers#access-to-storage,274,39
Tenancy Sci Analysis VMs,"This document explains how to access a tenancy-based sci machine. These are 
normally provisioned by an admin/manager representing a particular community/institution.
Check which institutions/group you belong to:
NCAS, NCEO, UKMO, RSG, ...
The admin/manager will provide you the name of the tenancy.
You can then search for it on your JASMIN accounts portal under the JASMIN
service named `Sci Analysis VMs`.
",https://help.jasmin.ac.uk/docs/interactive-computing/tenancy-sci-analysis-vms,409,61
How to request access,"**Step 1:** Find the Sci Analysis VMs under the Menu 'Discover services' at https://accounts.jasmin.ac.uk/services/
**Step 2:** Check the name of the service and the description that your supervisor
or PI recommended you to choose and click ""More information""
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-EUW05EGJj3.png"" caption=""Locate the correct service"" >}}
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-pyW8yyQboJ.png"" caption=""Click +Apply"" >}}
**Step 3:** Apply for `USER` role and provide details on your project and a
reference then click ""Apply""
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-QyGyIDjEcM.png"" caption=""Apply for USER role"" >}}
**Step 4:** Notification
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-pY8gr70WNK.png"" caption=""Status PENDING"" >}}
Once your request was approved, you will get a notification
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-j2xhRrluyc.png"" caption=""Notification"" >}}
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-BLPGdEfAD5.png"" caption=""Status updated to ACTIVE"" >}}
If your request was rejected, then reapply and provide further supporting
information
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-un7XlTQ5JU.png"" caption=""Rejected: further info requested"" >}}
Click on the rejection notification. This will take you to the following page
where you can ""Apply again""
{{<image src=""img/docs/tenancy-sci-analysis-vms/file-jtLIeTwWez.png"" caption=""Request for further detail"" >}}
",https://help.jasmin.ac.uk/docs/interactive-computing/tenancy-sci-analysis-vms#how-to-request-access,1479,148
How to login,"The machine will not be accessible directly externally, so you need to access it via a JASMIN login machine: don't forget the -A (agent forwarding) option on your initial connection.
{{<command user=""localuser"" host=""localhost"">}}
ssh -A user@login2.jasmin.ac.uk
{{</command>}}
Access the VM using the IP address (not the hostname) of the virtual machine. Your manager should be able
to provide you with this, since they created (provisioned) the virtual machine.
{{<command user=""user"" host=""login2.jasmin.ac.uk"">}}
ssh -A user@<IP-ADDRESS-OF-VM>
{{</command>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/tenancy-sci-analysis-vms#how-to-login,563,75
How to report issues,"Users should report issues to the `ADMIN` and/or `MANAGER`/`DEPUTY` of the
tenancy based SCI VM initially, rather than the JASMIN team. If the issue cannot be
resolved by the `ADMIN` and/or `MANAGER`, **they** should contact the JASMIN helpdesk. You can find the name of the current holders of the `MANAGER`/`DEPUTY` roles by going to the page which described the service on the accounts portal, as above.
",https://help.jasmin.ac.uk/docs/interactive-computing/tenancy-sci-analysis-vms#how-to-report-issues,406,66
Transfer servers,"This article lists the JASMIN data transfer servers and provides links to how
they can be used.
JASMIN provides specific servers for managing data transfers. These are:
Server  |  Purpose  |  Access requirements  |  Further information  
---|---|---|---  
`xfer1.jasmin.ac.uk` |  Virtual machine for general purpose data transfers.  |`jasmin-login` |  Visible on optical network connections from `k9.leeds.ac.uk` and some Met Office hosts.
`xfer2.jasmin.ac.uk` |  Virtual machine for general purpose data transfers.  |`jasmin-login` |  
`xfer3.jasmin.ac.uk` |  As per `xfer[12]`, but with config like `login2`for enabling access from IP addresses without fwd/rev DNS lookup.  |  `jasmin-login` AND `xfer-sp` |  Apply for additional access role access [here](https://accounts.jasmin.ac.uk/services/additional_services/xfer-sp).  See below for further specifics.  
`hpxfer1.jasmin.ac.uk` |  Physical machine for high-performance data transfers.  |  `jasmin-login` AND `hpxfer`  IP address of client  |  Tuned for UK & European network paths. Apply for additional access role access[here](https://accounts.jasmin.ac.uk/services/additional_services/hpxfer)  
`hpxfer2.jasmin.ac.uk` |  Physical machine for high-performance data transfers.  |  `jasmin-login` AND `hpxfer`. IP address of client  |  Tuned for long (intercontinental) network paths (e.g. UK - Australia). Apply for additional access role access [here](https://accounts.jasmin.ac.uk/services/additional_services/hpxfer)
`gridftp1.jasmin.ac.uk` |  Physical machine for high-performance GridFTP transfers.  |  `jasmin-login` AND `hpxfer`  IP address of client  |  No SSH login access. Apply for additional access role access [here](https://accounts.jasmin.ac.uk/services/additional_services/hpxfer) Acts as Globus Online endpoint "" [JASMIN GridFTP Server](https://www.globus.org/app/endpoints/4cc8c764-0bc1-11e6-a740-22000bf2d559/overview)""  
{.table .table-striped}
Please see further articles in the [Data Transfer category]({{< ref ""data-transfer-overview"" >}}) for details on managing your data transfers.
The standard transfer servers provide a basic and functional service for
moving small amounts of data over relatively short distances. However, the
high-performance data transfer servers shown above are also available for
those with particular requirements. Users with login accounts can [apply for
access to use the high-performance servers]({{< ref ""hpxfer-access-role"" >}}).
{{<alert type=""info"" >}}
Please make sure you use the dedicated transfer servers and not the scientific
analysis or login servers for any significant data transfers. The transfer servers have been configured to achieve the best transfer rates and will perform significantly better than other servers on jasmin, while maintaining the performance of analysis servers for interactive use by other users.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/transfer-servers,2858,342
Special transfer machine `xfer3.jasmin.ac.uk`,"This machine has been set up to cater for those whose network configuration
does not enable them to connect to xfer1 and xfer2 (for example because of a
lack of fwd/rev DNS lookup). A different set of access rules apply, which
enables users to access this machine but a side effect of these additional
rules is that **repeated attempts to access the machine via SSH-based
processes can result in being ""locked out""**. This may happen when attempting
the transfer of several small files in quick succession with separate SSH
connections for each. The ""xfer-sp"" access group is therefore a way of
ensuring that the users accessing this machine know to be aware of this issue
and can have their access to this machine denied if found to be causing a
problem for the machine's operation for other users.
{{<alert type=""danger"" >}}
Users are **not permitted to execute commands which require
administrative privileges.** This applies to all hosts in the managed part of
JASMIN where users have SSH login access (for example `login`, `nx-login`,
`sci`, `xfer` and `hpxfer` machines). In other words, the **use of`su` or
`sudo` is not permitted**. Please be careful when typing commands,
particularly if you have multiple terminal windows open on your own computer,
that you do not accidentally attempt `sudo`on a JASMIN machine: expect some
follow-up from the JASMIN team if you do!
{{</alert>}}
",https://help.jasmin.ac.uk/docs/interactive-computing/transfer-servers#special-transfer-machine-`xfer3.jasmin.ac.uk`,1390,228
CEDA Archive,"This article describes accessing the {{<link ""ceda_archive"">}}CEDA Archive{{</link>}} from JASMIN:
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive,99,10
Overview,"The CEDA Archive provides direct access to thousands of atmospheric, climate
change and earth observation datasets. The Archive is directly accessible as a
file system from the shared science machines on JASMIN.
It is a separate service run by the CEDA team - it is not a JASMIN service.
Therefore, many of the links in this document will take you to the [CEDA
Archive help documentation site](https://help.ceda.ac.uk) (as the information
relates to CEDA Archive services). This is separate from the JASMIN help
documentation site (which is specifically about JASMIN services).
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#overview,578,90
Register for a CEDA Account,"First, you need a CEDA Archive account. If you do not have a CEDA account,
please [follow the steps in this CEDA help
document](https://help.ceda.ac.uk/article/39-ceda-account) to register as a
new CEDA user. It also explains how you can reset your password if you have
forgotten it. When you have made a CEDA account, you will then need to use the CEDA portal to [link
it to your JASMIN account](https://help.ceda.ac.uk/article/5105-linking-your-jasmin-account).
The JASMIN Account Portal deals with the management of access to JASMIN
resources (e.g. compute and storage), whereas
[MyCEDA](https://services.ceda.ac.uk/cedasite/myceda/user/) (the CEDA Accounts
Portal) deals with access to CEDA resources (e.g. access to datasets in the
archives). You will need both accounts linked in order to access CEDA Archive
data from JASMIN - you can check whether your accounts are linked from within
the [CEDA Accounts Portal](https://services-beta.ceda.ac.uk/account/jasmin/).
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#register-for-a-ceda-account,971,134
Accessing the CEDA Archive on JASMIN servers,"Once you have linked your CEDA and JASMIN accounts, you will have access to
large parts of the archive straightaway.
The contents of the CEDA Archive are available on the file system under `/badc`
and `/neodc`. Note: do not access data via any symlinks that point to
`/datacentre/archvol*` - these are not permanent links and may change when data
are migrated to new storage. Please use the archive path names under `/badc` and
`/neodc`. Search the [CEDA data
catalogue](https://help.ceda.ac.uk/article/137-ceda-data-catalogue) for further
details about data held in the archive.
Note: `/badc` is for atmospheric & climate model data, `/neodc` is for earth observation data - they
are named after CEDA's previous archive names (British Atmospheric Data
Centre, and the NERC Earth Observation Data Centre).
Most data on the Archive is open access - however, some datasets are
restricted. You can work this out by looking at the UNIX access groups the
data are within (see below). If your required datasets are restricted, access
to these can be obtained by applying for specific access via the data centre
(see [this article ](https://help.ceda.ac.uk/article/98-accessing-data)for more
details). If direct access is not possible the data can be obtained via
[standard FTP and web-based](https://help.ceda.ac.uk/article/99-download-data-from-ceda-archives)
access methods to the CEDA Archive and transferred to a
suitable group workspace on JASMIN. As the data centres use the same JASMIN
infrastructure the transfer rates are high.
The [CEDA Data Catalogue](https://help.ceda.ac.uk/article/137-ceda-data-catalogue) is a useful tool to find and apply for access to datasets.
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#accessing-the-ceda-archive-on-jasmin-servers,1673,243
Archive access groups,"The UNIX access groups used within the CEDA Archive are listed below with
links to example datasets in the CEDA data catalogue for those wishing to use
them:
- `open` Available to any logged in JASMIN user with a linked CEDA user account. See a full list of available datasets [here](https://catalogue.ceda.ac.uk/?q=&results_per_page=20&sort_by=relevance&permission=restricted).
- `cmip5_research` restricted [CMIP3](https://catalogue.ceda.ac.uk/uuid/72afa18db5988d1be0066a26e09422df) and [CMIP5 ](https://catalogue.ceda.ac.uk/?q=wcrp+cmip5&record_types=Observation&sort_by=relevance)datasets
- `esacat1` Satellite data including [MERIS](https://catalogue.ceda.ac.uk/uuid/f26559a9daeae9e6740811d3b3113716), [MIPAS](https://catalogue.ceda.ac.uk/uuid/4a9da084adf4252752e5fe77a5cfd0a9) and [SCIAMACHY](https://catalogue.ceda.ac.uk/uuid/6877f4f100d22f750b44f4c3b7ada498).
- `ecmwf` Access to the [ECMWF Operational Datasets](https://catalogue.ceda.ac.uk/uuid/c46248046f6ce34fc7660a36d9b10a71).
- `eurosat` Satellite data including [IASI](https://catalogue.ceda.ac.uk/?q=iasi&record_types=ObservationCollection&sort_by=relevance), [AVHRR-3](https://catalogue.ceda.ac.uk/?q=avhrr+3&record_types=ObservationCollection&sort_by=relevance) and [GOME-2](https://catalogue.ceda.ac.uk/?q=gome+2&record_types=ObservationCollection&sort_by=relevance).
- `ukmo_wx `  Met Office observational dataset collections including [LIDARNET](https://catalogue.ceda.ac.uk/uuid/38a6e76871fca4c58d0f831e532bff41), [MIDAS](https://catalogue.ceda.ac.uk/uuid/220a65615218d5c9cc9e4785a3234bd0), [MetDB](https://catalogue.ceda.ac.uk/uuid/8ee156b6ed41b153e85dbf02a4134513) and [NIMROD](https://catalogue.ceda.ac.uk/uuid/82adec1f896af6169112d09cc1174499)
- `ukmo_clim` Climatology datasets from the Met Office, including [Central England Temperature](https://catalogue.ceda.ac.uk/uuid/a946415f9345f6da9bf4c475c19477b6) dataset collection, [HadISST](https://catalogue.ceda.ac.uk/?q=hadisst).
- `byacl` These data have specific restrictions on them meaning that they can't be accessed directly from JASMIN, but can be obtained via FTP and web access.
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#archive-access-groups,2114,140
Data Licensing,"All use of data accessed directly from the CEDA Archive must be used in line
with the relevant data licence in place for the relevant dataset for the
purposes stated in the access application. Data licence information can be
found on the relevant CEDA Data Catalogue page, a link to which can be found
in the `00README_catalogue_and_licence.txt` files found in the archive. For
specific data licences granted for restricted datasets, users should log into
their MyCEDA page to view their granted licence and the associated usage
purpose under which access was granted. **Any required alternative use of the
data beyond the original purpose stated in the original licence application
can only be made with a freshly granted new licence application.**
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#data-licensing,750,120
Accessing data in the archive,"In the example below, the logged-in user is listing the contents of the CRU
data sets within the BADC archive. These are ""open"" so all logged-in users can
access them:
{{<command user=""user"" host=""sci1"">}}
ls -l /badc/cru/data
(out)total 320
(out)-rw-r-----  1 badc open  396 Feb 18  2015 00README
(out)drwxr-x---  8 badc open 4096 Mar 22 10:32 cru_cy
(out)drwxr-x---  4 badc open 4096 Dec  6  2014 crutem
(out)drwxr-x--- 12 badc open 4096 May  9 14:11 cru_ts
(out)drwxr-x---  3 badc open 4096 Feb 18  2015 PDSI
{{</command>}}
The {{<link ""ceda_data"">}}CEDA Archive Data Browser{{</link>}} is a good place to start as it gives a web-based view of the data with additional metadata but enables copying & pasting the directory path for use within the JASMIN environment:
{{<image src=""img/docs/ceda-archive/ceda-archive-cru.png"" caption=""ceda archive data browser"">}}
",https://help.jasmin.ac.uk/docs/long-term-archive-storage/ceda-archive#accessing-data-in-the-archive,866,128
External Access to MASS FAQ,"## Introduction
The Managed Archive Storage System (MASS) provides storage and restore services for large volumes of Met Office data. It is a service operated by the UK Met Office.
This article provides answers to MASS frequently asked questions:
Click on the link for each of the FAQs below to expand the answer.
## General
{{< accordion id=""accordion-1"" >}}
  {{< accordion-item header=""Can I use my existing MASS account"" show=""false"" >}}
    No. You need a separate MASS account for use on the Met Office internal
network (CDN), Monsoon, ECMWF HPCs, and JASMIN. With these different account
types, you can have permission to access different datasets specific to these
computing environments.
  {{< /accordion-item >}}
  {{< accordion-item header=""How do I use MOOSE?"" >}}
    Please see the [MOOSE User Guide here]({{< ref ""moose-the-mass-client-user-guide"" >}})
  {{< /accordion-item >}}
  {{< accordion-item header=""Will my account expire?"" >}}
Yes. By default, MASS via JASMIN accounts will expire after 500 days and your
account will be automatically disabled.
Shortly before your account is due to expire you will receive an email, and it
will contain instructions for you and your sponsor about how to extend your
access. If your account has already expired and you are looking to reactive
it, please email: [Monsoon@metoffice.gov.uk](mailto:Monsoon@metoffice.gov.uk)
  {{< /accordion-item >}}
  {{< accordion-item header=""Why am I asked for a password when logging in to mass-cli?"" >}}
    There are two reasons that may result in you being prompted for a password
when attempting to login to the MASS client machine (mass-cli.jasmin.ac.uk).
The first is if you do not have permission to access the machine. A quick
method to check is to verify if you are a member of the `moose` user group. It
should be listed when you use the ‘groups’ command:
[login1]$ groups
moose
If this happens, please contact:
[Monsoon@metoffice.gov.uk](mailto:Monsoon@metoffice.gov.uk)
The second is if you forget the `-A` option for agent forwarind when you ssh to a JASMIN login
node. You can test for this condition by listing loaded identities on the
login node, and finding you have none:
[login1]$ ssh-add -l
Could not open a connection to your authentication agent.
If this happens, please exit back to your local machine and ssh in again using
the `-A` flag or tick the relevant box for ""agent forwarding"".
  {{< /accordion-item >}}
  {{< accordion-item header=""How can I directly login to the MASS client machine?"" >}}
    You can't, but you can edit your ssh configuration so that it automatically enables
you to jump through the intermediary login servers.
Add the following to your home institute ssh config file ($HOME/.ssh/config
file):
Host mass-cli 
    User your_jasmin_userid 
    HostName mass-cli.jasmin.ac.uk
    ProxyCommand ssh -YA -t your_jasmin_userid@login1.jasmin.ac.uk -W %h:%p 2>/dev/null
You should then be able to login directly using:
$ ssh mass-cli
Please note that this only works if you are using **OpenSSH version 5.4** or
greater as earlier versions do not support the `-W` flag. You can check your
version using: `ssh -v`
  {{< /accordion-item >}}
{{< /accordion >}}
## MOOSE messages and what to do
{{< accordion id=""accordion-2"" >}}
  {{< accordion-item header=""Is this process running in the correct environment?"" show=""false"" >}}
    When running 'moo install' you may get an error message similar to:
Cannot read file: /home/user/<userid>/.moosedir/moose     
- is this process running in the correct environment?
This can be the result of the wrong combination of Unix user-id and UID having
been used to encrypt the credentials file. If you encounter this error
message, please type `id` on the command line whilst logged into JASMIN, and
send the `uid=` section of the output to:
[Monsoon@metoffice.gov.uk](mailto:Monsoon@metoffice.gov.uk)
Your credentials file will then be reissued.
    {{</accordion-item>}}
    {{<accordion-item header=""Your password is due to expire in X day(s)."">}}
Occasionally on running a MOOSE command you will be told that your password is
due to expire with a message of the form:
    Your password is due to expire in 6 day(s).   
    A new password can be generated using 'moo passwd -r'.
This refers specifically to your MASS via JASMIN, it does not affect any other
MOOSE accounts you may have.
You need to run the command as advised in order to update your credentials
whilst you are logged into mass-cli. You do not actually need to provide a new
password, as this is generated and hidden from you by the command.
If you have a retrieval in progress, it is safe to run this command as it will
not affect processes already running.
    {{</accordion-item>}}
    {{< accordion-item header=""ERROR_SINGLE_COPY_UNAVAILABLE"" >}}
MOOSE - Single Copy Unavailable error
On occasion, a tape library needs to be taken down for maintenance. If a user is trying to retrieve a single-copy file stored on one of those tapes, the retrieval will temporarily fail with the message `ERROR_SINGLE_COPY_UNAVAILABLE`. As soon as the maintenance is completed, the file will be available again.
Tapes are taken out of MASS for copying to the new MASS system and become unavailable for roughly 14 days. The process is as follows:
- Thursday (week one): Tapes are marked unavailable for indexing by the system.
- Tuesday (week two): Tapes get taken out for copying to the new MASS system.
- Following Thursday (week three): Tapes are returned to Met Office library and should be available again.
So, if you find that data or files are unavailable due to the `ERROR_SINGLE_COPY_UNAVAILABLE` error, try reading the data again on Friday, and if still not available, try the following Friday when the migration should have completed.
    {{< /accordion-item >}}
{{< /accordion >}}
## MOOSE basics
{{< accordion id=""accordion-3"" >}}
  {{< accordion-item header=""What is MOOSE?"" >}}
    The software that allows you to interact with MASS.
  {{< /accordion-item >}}
  {{< accordion-item header=""What is a project?"" >}}
    A collection of access rules.
  {{< /accordion-item >}}
  {{< accordion-item header=""What is an access rule?"" >}}
    Permission to access an area in MASS. For example, project-random might have
an access rule to moose:/crum/random-numbers
Being part of project-random would allow you to access the random-numbers set.
  {{< /accordion-item >}}
    {{< accordion-item header=""How do I see what projects I am a member of?"" >}}
    You can use: `moo prls`
  {{< /accordion-item >}}
    {{< accordion-item header=""How do I see what access rules a project has?"" >}}
    You can use: `moo projinfo -l projectname` (Replace _projectname_ with the name of one of your projects)
  {{< /accordion-item >}}
  {{< accordion-item header=""How do I get access to a project, or add an access rule to one of my projects?"" >}}
Please contact your sponsor. They can then complete this form if they also
agree you require access:
https://metoffice.service-now.com/sp?id=sc_cat_item&sys_id=5653331e1bbaf0d88ffa422ad34bcba0&referrer=recent_items
Please note that the link above is only visible to those in the Met Office.
  {{< /accordion-item >}}
      {{< accordion-item header=""Why can I not access a set that I know is part of a project?"" >}}
    If you are given access to a project but do not have access to all the sets
associated with it, this can be due to the Access Control Lists (ACLs).
The project owner will be able to change the ACLs on sets to make them
readable if it is appropriate.
      {{< /accordion-item >}}
  {{< accordion-item header=""How do I retrieve a file from MASS?"" >}}
Use `moo get` or `moo select`. More information about both commands is in the
[MOOSE User Guide]({{< ref ""moose-the-mass-client-user-guide"" >}}).
  {{< /accordion-item >}}
    {{< accordion-item header=""How do I make sure my directory has all the available data retrieved from MASS?"" >}}
**The problem:** You are running a model over a period of several days or weeks,
and you need to analyse the output of the model as it runs. You have a moo get
or moo select command that you run to fetch the data that is available. You
want to be able to re-run it to fetch the files or fields that have been added
to MASS since you last ran the command, but you do not want it to waste time
re-fetching things you already have.
**The solution:** Use the -i or --fill-gaps option when you run moo get or moo
select. This option tells MOOSE that you only want to fetch files that don't
already exist in the specified local directory. Note that MASS works out where
gaps are by doing checks to see if files of the expected name exist in your
destination directory, so it won't behave correctly if you rename files after
you have retrieved them, or if you use the -C option with moo select which
condenses all the matching fields into a single file.
You might also find the `-g` / `--get-if-available` option to moo get useful. This
tells MOOSE to get every file from your moo get list that is available, but
ignore ones that are not there rather than exit with an error. This could help
if you are expecting files to be archived at some point but are not sure
whether they will be there when your job runs. If you use this option MOOSE
will get as much as it can from your list without bailing out.
  {{< /accordion-item >}}
    {{< accordion-item header=""How can I script my data retrieval from MASS?"" >}}
There are restrictions on how to login to JASMIN and use of Linux utilities
such as ‘cron’ and ‘at’ but it is possible to remotely initiate a retrieval
from MASS on to JASMIN, provided you have your ssh agent running on a machine
local to you.
eval $(ssh-agent -s)
ssh-add ~/.ssh/jasmin_id_rsa 
ssh -A -X sci1.jasmin.ac.uk 'ssh mass-cli my_script.sh'
If you have set up your $HOME/.ssh/config to allow more direct access, then
the following should work:
ssh mass-cli my_script.sh
This will run the script “my_script.sh” on the MASS client VM. You can put the
moose retrieval commands into a script and it should work:
#!/bin/bash 
SRC_URI=moose:/opfc/atm/global/SOMETHING
moo get $SRC_URI jasmin_copy.pp 
exit
If you have access to an appropriate JASMIN workspace, then you can scp data
from the workspace directly through one of the dedicated data transfer VMs.
Again, you need the ssh-agent running locally:
eval $(ssh-agent -s)
ssh-add ~/.ssh/jasmin_id_rsa 
scp userid@xfer1.jasmin.ac.uk:/group_workspaces/cems/<project>/jasmin_file.pp my_local_copy.pp
  {{< /accordion-item >}}
  {{< accordion-item header=""Can I run MASS retrievals on LOTUS or through a workload manager?"" >}}
In addition to the interactive mass-cli server there is also the moose1 server
that is only accessible through the {{<link ""../batch-computing/lotus-overview"">}}LOTUS batch processing cluster{{</link>}}. To submit jobs to moose1 you must use the [SLURM scheduler]({{< ref
""slurm-scheduler-overview"" >}}). You will need to specify the account
mass and partition mass, for example:
 sbatch -A mass -p mass [<options>] <jobscript>
where \<jobscript\> looks something like:
#!/bin/bash 
SRC_URI=moose:/opfc/atm/global/SOMETHING
moo get $SRC_URI jasmin_copy.pp 
exit
It is also easy to configure the [Rose/Cylc workflow manager]({{< ref ""rose-cylc-on-jasmin"" >}}) to submit jobs to moose1 through the SLURM scheduler by
including the following lines in your suite.rc file:
[[[job submission]]]
    method = slurm
[[[directives]]]
    --partition=mass
    --account=mass
[<options>]
  {{< /accordion-item >}}
{{< /accordion >}}
",https://help.jasmin.ac.uk/docs/mass/external-access-to-mass-faq,11537,1783
Introduction,"To access data held in the Met Office MASS archive, you will need:
- a sponsor 
- access to the mass-cli1 client machine
- a MASS account 
Your sponsor will need to be a **Senior Met Office Scientist** with whom you
are working on a collaborative research project. If you are a Met Office
employee, your sponsor will be your manager.
Note: The following instructions also assume you already have a **JASMIN login
account** and the **jasmin-login** service. If you do not, please follow steps
1-4 [here]({{< ref ""get-started-with-jasmin"" >}}).
",https://help.jasmin.ac.uk/docs/mass/how-to-apply-for-mass-access#introduction,543,90
Step One - Sponsor Form,"Ask your sponsor to:
  1. [Complete the sponsor form](https://metoffice.service-now.com/sp?id=sc_cat_item&sys_id=f00fb9d4dbd06b404690fe9b0c9619a6)
Please note that the link above is only visible to those in the Met Office.
The following information will be asked for, so please provide your sponsor
with any details they may not have:
- Your full name
- Your official email address
- Your organization's name
- Your department name
- The host country of your organization
- A list of MASS projects and/or data sets that you need access to. A full MOOSE dataset path is required, and your sponsor should help you determine this.
- Your JASMIN username
- Your JASMIN user ID number (UID). You can get this by typing echo $UID at the terminal on any JASMIN machine.
The information you provide to the Met Office will be treated in accordance
with the [Met Office Privacy Policy](https://www.metoffice.gov.uk/about-
us/legal/privacy), and your use of the service will be subject to the [Terms
and Conditions of Use](https://metoffice.github.io/JASMIN-MASS-
access/Terms_and_Conditions.html) for the service.
",https://help.jasmin.ac.uk/docs/mass/how-to-apply-for-mass-access#step-one---sponsor-form,1104,162
Step Two - Access to mass-cli1,"  1. Sign into your JASMIN account
  1. Select ‘JASMIN Services’
  1. Select ‘Additional Services’
  1. Next to ‘mass’ click ‘More information’ 
  1. Select ‘Apply for access’
  1. Within the request, please name your sponsor
The direct link is:
<https://accounts.jasmin.ac.uk/services/additional_services/mass/>
",https://help.jasmin.ac.uk/docs/mass/how-to-apply-for-mass-access#step-two---access-to-mass-cli1,313,39
Step Three - MASS account,"When steps one and two are complete, you will be provided with a specific MASS account to
use on JASMIN and emailed a MOOSE credentials file. Please see [Setting up
your JASMIN account for access to MASS]({{< ref ""setting-up-your-jasmin-account-for-access-to-mass"" >}}) once you have received the credentials file.
Note: If you have access to MASS on other systems you cannot copy those MOOSE
credentials file/s onto JASMIN – they will not work! Please also see the
[External Users’ MOOSE Guide]({{< ref ""moose-the-mass-client-user-guide"" >}})
for what MOOSE commands are available on JASMIN.
",https://help.jasmin.ac.uk/docs/mass/how-to-apply-for-mass-access#step-three---mass-account,593,90
Setting up your JASMIN account for access to MASS,"The following notes are written assuming you are using a Linux machine in your
home institution, that you have [applied for a new MASS account]({{< ref ""how-to-apply-for-mass-access"" >}}), and that you have received an email from the
Met Office Storage Team with your new MASS credentials file attached.
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass,304,48
Load your SSH key,"Start an ssh-agent on your home institution machine, load your private key, and enter your passphrase when requested.
{{<command user=""localuser"" host=""localhost"">}}
eval $(ssh-agent -s)
ssh-add ~/.ssh/id_rsa_jasmin
(out)Enter passphrase for ~/.ssh/id_rsa_jasmin:
{{</command>}}
**Note:** it's a good idea to keep your private keys for different systems
separated, so you may want to keep your private key for JASMIN in a separate
file, just move the one created during the process described above to a new
sensible location such as ~/.ssh/jasmin_id_rsa.
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#load-your-ssh-key,555,78
Test login to the JASMIN login node,"**Note:** that the `-A` in the first ssh command is mandatory to enable access
to the client VM, the `-X` enables X11 forwarding and is optional.
{{<command user=""localuser"" host=""localhost"">}}
ssh -A -X <userid>@login1.jasmin.ac.uk
{{</command>}}
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#test-login-to-the-jasmin-login-node,248,34
3\. Test login to the MASS client host,"From the login machine, you can then login to the MASS client host.
**Note:** If you are prompted for a password at this stage, then you have
either not requested additional access to the dedicated client machine, or
access hasn't been approved yet, email the Met Office Service Manager
[monsoon@metoffice.gov.uk](mailto:monsoon@metoffice.gov.uk), to verify that
approval has been granted. Allow a couple of days for this process to happen
after submitting your request for access to the VM.
{{<command user=""user"" host=""login1"">}}
ssh -X <userid>@mass-cli.jasmin.ac.uk
{{</command>}}
{{<command user=""user"" host=""mass-cli"">}}
echo ""Hello World""
(out)Hello World
exit
{{</command>}}
{{<command user=""user"" host=""login1"">}}
exit
{{</command>}}
{{<command user=""localuser"" host=""localhost"">}}
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#3\.-test-login-to-the-mass-client-host,791,101
back on your local machine,"{{</command>}}
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#back-on-your-local-machine,15,1
Install your MOOSE credentials file,"You can `scp` the file via a JASMIN transfer server, make sure the credentials
file is called `moose`, and you must run the `moo install` command on `mass-
cli.jasmin.ac.uk` to set it up for you.
{{< alert type=""info"" >}}
The external moose client has improved security settings, so **you
must use the `moo install` command** to put your moose credentials file in the
correct place in order to get remote access to work. This can only be done on
the client machine mass-cli.jasmin.ac.uk. The credentials file is also changed
by the running of moo install, so this process can be run only once.
{{< /alert >}}
{{<command user=""user"" host=""localhost"">}}
scp moose <userid>@xfer1.jasmin.ac.uk:~/moose
ssh -A -X <userid>@login1.jasmin.ac.uk
{{</command>}}
{{<command user=""user"" host=""login1"">}}
ssh -X <userid>@mass-cli.jasmin.ac.uk
{{</command>}}
{{<command user=""user"" host=""mass-cli"">}}
ls -l ~/moose  
(out)-rwx------ 1 <userid> users 511 Jul  3 13:45 /home/users/<userid>/moose
moo install  
(out)### passwd, command-id=148593088         
(out)Your password is due to expire in -1 day(s).    
(out)A new password can be generated using 'moo passwd -r'.          
ls -l ~/.moosedir/moose  
(out)-rw------- 1 <userid> users 511 Jul  3 13:45 /home/users/<userid>/.moosedir/moose
{{</command>}}
Having run these commands on the client machine, the moose file will have
disappeared from your home directory, but a .moosedir directory will have been
created, this will contain a new moose file, an install.log file, and once you
start making MOOSE queries, a moose-external-client.log will be created.
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#install-your-moose-credentials-file,1598,224
Test use of the locally installed MOOSE client,"{{<command user=""user"" host=""mass-cli"">}}
which moo  
(out)/opt/moose/external-client-version-wrapper/bin/moo   
moo si  
(out)<system information appears here>  
moo help  
(out)<help details appear here>      
moo projlist  
(out)<list of projects appears here>
{{</command>}}
You have now successfully accessed MASS from JASMIN!
If you are new to MOOSE, you might like to read the 
[User Guide]({{< ref ""moose-the-mass-client-user-guide"" >}}) next.
",https://help.jasmin.ac.uk/docs/mass/setting-up-your-jasmin-account-for-access-to-mass#test-use-of-the-locally-installed-moose-client,452,52
Introduction,"This article describes how to configure Cross-Origin Resource Sharing (CORS) on a JASMIN Caringo S3 object store.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/configuring-cors-for-object-storage#introduction,114,17
S3 CORS configuration,"JASMIN's DataCore (previously Caringo) S3 object storage allows domain owners to configure Cross-Origin Resource Sharing (CORS) at bucket level. This article assumes you have read the {{<link ""using-the-jasmin-object-store"">}}this help article{{</link>}} which introduces the object store and the use of the `s3cmd` command line tool.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/configuring-cors-for-object-storage#s3-cors-configuration,335,44
Prerequisites,"You will need a valid S3 Token ID and Secret Key for the domain that you wish to modify.
e.g.
key will not be displayed again!
Token ID: <The Token for your Domain>
S3 Secret Key: <The Secret for your Domain>
Expiration Date: 2024-02-13
Owner: <Your JASMIN ID>
Description: test
See using s3cmd for instructions on generating these.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/configuring-cors-for-object-storage#prerequisites,333,58
CORS XML Configuration File,"CORS configuration is set on the S3 bucket using an XML file format, as shown below:
<CORSConfiguration>
   <CORSRule>
      <AllowedOrigin>http://www.example1.com</AllowedOrigin>
      <AllowedMethod>PUT</AllowedMethod>
      <AllowedMethod>POST</AllowedMethod>
      <AllowedMethod>DELETE</AllowedMethod>
      <AllowedHeader>*</AllowedHeader>
   </CORSRule>
   <CORSRule>
      <AllowedOrigin>http://www.example2.com</AllowedOrigin>
      <AllowedMethod>PUT</AllowedMethod>
      <AllowedMethod>POST</AllowedMethod>
      <AllowedMethod>DELETE</AllowedMethod>
      <AllowedHeader>*</AllowedHeader>
   </CORSRule>
   <CORSRule>
      <AllowedOrigin>*</AllowedOrigin>
      <AllowedMethod>GET</AllowedMethod>
   </CORSRule>
</CORSConfiguration>
The above example shows a configuration which allows CORS access from external web sites www.example1.com and www.example2.com.
You can create a new file on your filesystem to store your CORS configuration using the above example as a reference. In the next step, you'll learn how to apply this file to your bucket.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/configuring-cors-for-object-storage#cors-xml-configuration-file,1063,88
Applying CORS Settings to a Bucket,"To apply the CORS XML file you've created, you can use any S3 compatible client to set the CORS configuration.
The following example uses `s3cmd` on a Linux system.
First confirm that your `s3cmd` settings are correct by showing the `info` of the bucket.
e.g.
{{<command>}}
s3cmd info s3://testbin1
(out)s3://testbin1/ (bucket):
(out)   Location:  objectstore4.jc.rl.ac.uk
(out)   Payer:     none
(out)   Expiration Rule: none
(out)   Policy:    {
(out)                ""Version"":""2008-10-17"",
(out)                ""Id"":""testbin1 Policy"",
(out)                ""Statement"": [
(out)                  {
(out)                    ""Sid"":""1: Full access for Users"",
(out)                    ""Effect"":""Allow"",
(out)                    ""Principal"":{""anonymous"":[""*""]},
(out)                    ""Action"":[""*""],
(out)                    ""Resource"":""*""
(out)                  },
(out)                  {
(out)                    ""Sid"":""2: Read-only access for Everyone"",
(out)                    ""Effect"":""Allow"",
(out)                    ""Principal"":{""anonymous"":[""*""]},
(out)                    ""Action"":[""GetObject"",""GetBucketCORS""],
(out)                    ""Resource"":""*""
(out)                  }
(out)                ]
(out)              }
(out)   CORS:      none
(out)   ACL:       ahuggan: FULL_CONTROL
{{</command>}}
This example shows a bucket which currently doesn't have a CORS policy set. Specifically, this is the section we're interested in:
   CORS:      none
In this example, we'll set a simple ""allow all"" CORS configuration. We've already created a file named `test-cors-file` which we will be uploading to the bucket:
<CORSConfiguration>
  <CORSRule>
    <AllowedOrigin>*</AllowedOrigin>
    <AllowedMethod>GET</AllowedMethod>
    <AllowedMethod>HEAD</AllowedMethod>
    <AllowedHeader>*</AllowedHeader>
  </CORSRule>
</CORSConfiguration>
Using the `s3cmd` command, we apply the CORS XML file to our S3 bucket:
{{<command>}}
s3cmd setcors test-cors-file s3://testbin1
{{</command>}}
(your S3 address will be different to the one shown here)
We can now run the info command to confirm that the CORS configuration from our file has been set on the bucket:
{{<command>}}
s3cmd info s3://testbin1
(out)s3://testbin1/ (bucket):
(out)   Location:  objectstore4.jc.rl.ac.uk
(out)   Payer:     none
(out)   Expiration Rule: none
(out)   Policy:    {
(out)                ""Version"":""2008-10-17"",
(out)                ""Id"":""testbin1 Policy"",
(out)                ""Statement"": [
(out)                  {
(out)                    ""Sid"":""1: Full access for Users"",
(out)                    ""Effect"":""Allow"",
(out)                    ""Principal"":{""anonymous"":[""*""]},
(out)                    ""Action"":[""*""],
(out)                    ""Resource"":""*""
(out)                  },
(out)                  {
(out)                    ""Sid"":""2: Read-only access for Everyone"",
(out)                    ""Effect"":""Allow"",
(out)                    ""Principal"":{""anonymous"":[""*""]},
(out)                    ""Action"":[""GetObject"",""GetBucketCORS""],
(out)                    ""Resource"":""*""
(out)                  }
(out)                ]
(out)              }
(out)   CORS:      <CORSConfiguration>
(out)                <CORSRule>
(out)                  <AllowedOrigin>*</AllowedOrigin>
(out)                  <AllowedMethod>HEAD</AllowedMethod>
(out)                  <AllowedMethod>GET</AllowedMethod>
(out)                  <AllowedHeader>*</AllowedHeader>
(out)                </CORSRule>
(out)              </CORSConfiguration>
(out)   ACL:       ahuggan: FULL_CONTROL
{{</command>}}
To delete the CORS config from the bucket, we can run the following command:
{{<command>}}
s3cmd delcors s3://testbin1
(out)s3://testbin1/: CORS deleted
{{</command>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/configuring-cors-for-object-storage#applying-cors-settings-to-a-bucket,3731,341
Elastic Tape command-line interface hints,"{{<alert type=""info"">}}
- Information below relates to the Elastic Tape command-line tools. The [JDMA]({{<ref ""jdma"">}}) system provides a better interface for putting/retrieving data into the Elastic Tape System)
- A new system called [NLDS](https://techblog.ceda.ac.uk/2022/03/09/near-line-data-store-intro.html) is coming very shortly (as of Feb 2023) and will eventually replace both of these.
{{</alert>}}
This article explains the return codes of certain Elastic Tape (ET) commands.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints,489,62
et_put.py,"Command-line tool to register large numbers of files for upload to Elastic
Tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_put.py,80,13
Return codes,"rc 0: normal exit    
rc 1: error in start up parameters    
rc 2: error processing list
{{<alert type=""danger"">}}
When writing data to the ET system, it is very important that data remains in place on disk, in the location where ET expects to find them, until the status of the batch in question has reached `CACHED_SYNCED` or `SYNCED`.  This means that the data have actually been written to tape, but is not the case until that status is shown.
The location where ET expects to find the files will be specified in the `LISTFILE` that the user supplied to the `et_put.py` command, or all files and directories under the `DIR`.  The status of user's batches can be checked by going to the webpage: http://et-monitor.fds.rl.ac.uk/et_user/ET_AlertWatch.php. You need to be logged into JASMIN to see this webpage, via the [nx-login servers](/docs/interactive-computing/graphical-linux-desktop-access-using-nx/), and use Firefox as the web browser.
Deleting the data from disk prematurely can cause problems for the ET system as a whole (impacting other users) so please be careful with this aspect.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#return-codes,1110,173
et_get.py,"Command-line tool to download large numbers of files from Elastic Tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_get.py,71,11
Return codes,"0: normal exit
1: error in start up parameters
2: cannot write to target directory
3: error received during download
4: closed by interrupt (^c probably)
5: completed with ""bad files"" (see list via stderr)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#return-codes,206,35
et_rm.py,"Command-line tool to delete files from Elastic Tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_rm.py,52,8
Return codes,"rc 0: normal exit    
rc 1: error in start up parameters    
rc 2: error processing list
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#return-codes,89,16
et_ls.py,"Command-line tool for listing holdings in Elastic Tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_ls.py,55,8
et_ls.py and grep,"The first character on any data line is the line's type. This allows a script
to know the type of line it is trying to parse
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_ls.py-and-grep,125,26
Return codes,"0: normal exit    
1: error in start up parameters or reading config file    
2: requestor is not authorised for the intended workspace    
4: closed by interrupt (^c probably) or as a result of a head/tail command
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#return-codes,215,36
et_transfer_mp,,https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#et_transfer_mp,0,0
Return codes,"0: OK    
1: config error    
2: log directory error   
3: already running    
4: error creating client
",https://help.jasmin.ac.uk/docs/short-term-project-storage/elastic-tape-command-line-interface-hints#return-codes,104,16
New storage FAQs and issues,"{{<alert type=""info"">}}This article was originally written in 2018/19 to introdice new forms of storage which were brought into produciton at that stage. Some of the information and terminology is now out of date, pending further review of JASMIN documentation.{{</alert>}}
Workflows with some of the issues highlighted below will have a knock on
effect for other users, so please take the time to check and change your code
to make appropriate use of new storage system. If used correctly, the new
storage offers us a high performance scalable file system, with the capability
for object storage as tools and interfaces evolve, and we can continue to
serve the growing demand for storage in the most cost effective manner.
We understand these changes may cause you some extra work, but we hope that
you can understand why they were necessary and how to adapt to these changes.
We will continue to add to this page when new issues or solutions are found.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage,955,160
1\. Known cases where parallel write can occur (may be unknowingly to you!):,,https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#1\.-known-cases-where-parallel-write-can-occur-(may-be-unknowingly-to-you!):,0,0
Use of MPI-IO or OpenMPI,"_Parallel threads can update the same file concurrently on same or from
different servers._
**Suggested solution:** use a `/work/scratch-pw*` volume which is PFS (but not
`/work/scratch-nopw*` !), then move output to SOF storage.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#use-of-mpi-io-or-openmpi,230,33
Writing all the logs from a LOTUS job or job array to the same output or log file,"**Suggested solution:** see job submission advice 
[here]({{< ref ""how-to-submit-a-job-to-slurm"" >}}) showing how to use SBATCH options to use distinct output and log files for each job, or element of a job array.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#writing-all-the-logs-from-a-lotus-job-or-job-array-to-the-same-output-or-log-file,214,32
Deleting a file via one host before another host has closed it,"_This is a form of parallel write truncation_
**Suggested solution:** take care to check for completion of 1 process before
another process deletes or modifies a file. Be sure to check a job has
completed before interactively deleting files from any server you are logged
into (eg. sci1.jasmin.ac.uk)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#deleting-a-file-via-one-host-before-another-host-has-closed-it,301,48
"Attempting to kill a process that was writing/modifying files, but not checking that it has been killed before starting a replacement process which attempts to do the same thing","_This can happen with rsync leading to duplicate copying processes._
**Suggested solution:** check for successful termination of 1 process before
starting another.
","https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#attempting-to-kill-a-process-that-was-writing/modifying-files,-but-not-checking-that-it-has-been-killed-before-starting-a-replacement-process-which-attempts-to-do-the-same-thing",164,22
Opening the same file for editing in more than one editor on the same or different servers,"_Here’s an example of how this shows up using “lsof” and by listing user
processes with “ps”. The same file “ISIMIPnc_to_SDGVMtxt.py” is being edited
in 2 separate “vim” editors. In this case, the system team was unable to kill
the processes on behalf of the user, so the only solution was to reboot sci1._
{{<command user=""user"" host=""sci1"">}}
lsof /gws/nopw/j04/gwsnnn/
(out)COMMAND   PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
(out)vim     20943 fbloggs  cwd    DIR   0,43        0 2450 /gws/nopw/j04/gwsnnn/fbloggs/sdgvm/ISIMIP
(out)vim     20943 fbloggs    4u   REG   0,43    24576 2896 /gws/nopw/j04/gwsnnn/fbloggs/sdgvm/ISIMIP/.ISIMIPnc_to_SDGVMtxt.py.swp
(out)vim     31843 fbloggs  cwd    DIR   0,43        0 2450 /gws/nopw/j04/gwsnnn/fbloggs/sdgvm/ISIMIP
(out)vim     31843 fbloggs    3r   REG   0,43    12111 2890 /gws/nopw/j04/gwsnnn/fbloggs/sdgvm/ISIMIP/ISIMIPnc_to_SDGVMtxt.py
ps -ef | grep fbloggs
(out)......
(out)fbloggs 20943     1  0 Jan20 ?        00:00:00 vim ISIMIPnc_to_SDGVMtxt.py
(out)fbloggs 31843     1  0 Jan20 ?        00:00:00 vim ISIMIPnc_to_SDGVMtxt.py smc_1D-2D_1979-2012_Asia_NewDelhi.py
{{</command>}}
**Suggested solution:** If you are unable to kill the processes yourself,
contact the helpdesk with sufficient information to ask for it to be done for
you. In some cases, the only solution at present is for the host or hosts to
be rebooted.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#opening-the-same-file-for-editing-in-more-than-one-editor-on-the-same-or-different-servers,1387,173
2\. Issues with small files,"_The larger file systems in operation within JASMIN are suitable for storing
and manipulating large datasets and not currently optimised for handling small
( <64kBytes) files. These systems are not the same as those you would find on
a desktop computer or even large server, and often involve many disks to store
the data itself and metadata servers to store the file system metadata (such
as file size, modification dates, ownership etc). If you are compiling code
from source files, or running code from python virtual environments, these are
examples of activities which can involve accessing large numbers of small
files._
_Later versions of our PFS systems handled this by using SSD storage for small
files, transparent to the user. SOF however, can’t do this (until later in
2019), so in Phase 4, we introduced larger home directories based on SSD, as
well as an additional and larger scratch area._
**Suggested solution:** Please consider using your home directory for small-
file storage, or `/work/scratch-nopw2` for situations involving LOTUS
intermediate job storage. It should be possible to share code, scripts and
other small files from your home directory by changing the file and directory
permissions yourself.
We are planning to address this further in Phase 5 by deploying additional SSD
storage which could be made available in small amounts to GWSs as an
additional type of storage. [Now available: please ask about adding an ""SMF"" volume to your workspace]
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#2\.-issues-with-small-files,1479,238
Issues writing netCDF3 classic files to SOF storage type,"Writing netCDF3 classic files to SOF storage e.g. `/gws/nopw/j04/*` should be
avoided. This is due to the fact that operations involving a lot of
repositioning of the file pointer (as happens with netCDF3 writing) has
similar issues from writing large numbers of small files to SOF storage (known
as QB ).
**Suggested solution:** It is more efficient to write netCDF3 classic files to
another filesystem type (e.g. /work/scratch/pw* or /work/scratch-nopw2) and then move them to a SOF
GWS, rather than writing directly to SOF.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#issues-writing-netcdf3-classic-files-to-sof-storage-type,527,84
"3\. ""Everything's running slowly today""","_This can be due to overloading of the scientific analysis servers
(`sci*.jasmin.ac.uk`) which we provide for interactive use. They’re great
for testing a code and developing a workflow, but are not designed for
actually doing the big processing. Please take this heavy-lifting or
long-running work to the LOTUS batch processing cluster, leaving the
interactive compute nodes responsive enough for everyone to use.
**Suggested solution:** When you log in via one of the `login*.jasmin.ac.uk`
nodes, you are shown a 'message of the day"" a list of all the `sci*` machines,
along with memory usage and the number of users on each node at that time.
This can help you select a less-used machine (but don’t necessarily expect the
same machine to be the right choice next time!).
","https://help.jasmin.ac.uk/docs/short-term-project-storage/faqs-storage#3\.-""everything's-running-slowly-today""",774,126
GWS etiquette,"This article highlights the essential principles of working with group
workspaces.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-etiquette,83,11
Keeping informed,"Please maintain contact throughout the life of the GWS via the following
methods:
- Using the [JASMIN dashboard](https://mon.jasmin.ac.uk) to check on the status of your GWS (used versus available space).
- Using the {{<link ""gws-scanner-ui"">}}GWS Scanner User Interface{{</link>}} to check on where, for how long and by whom, space is being used.
- GWS Managers should {{<link ""gws-scanner"">}}configure the GWS Scanner{{</link>}} to gather the above information and arrange email alerts.
- Look out for emails from the CEDA/JASMIN team
- News articles on the {{<link ""ceda_site"">}}CEDA{{</link>}} or {{<link ""jasmin_site"">}}JASMIN{{</link>}} websites and by monitoring {{<link name=""ceda_x"" cue=""true"" >}}CEDA social media{{</link>}}feeds which may be used to post messages regarding system status or security.
If you are aware that a user who has access to your GWS leaves your project,
or, for whatever reason, no longer needs to be a member of the GWS, please let
the CEDA helpdesk know, as arrangements may need to be made to transfer the
ownership of files and/or directories to another member of the GWS (e.g. the
manager) to ensure continued access to the data.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-etiquette#keeping-informed,1170,178
"""GWS Scanner UI""","The [Group Workspace (GWS) Scanner](https://gws-scanner.jasmin.ac.uk/) UI is an interactive web application for JASMIN users to view their GWSs.
**_Please note this service is under beta-testing and should be used with care (July 2023)_**
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner-ui,239,33
What is the GWS Scanner UI?,"A GWS is collaborative storage made available to a group for a project. The GWS Scanner UI provides information about the structure of GWSs in the form of a tree graph showing the folders within the GWS. The tiles of the graph can be scaled or coloured by size, count or heat. 
- **Size** refers to the size (in TB or GB) of the folder
- **count** refers to the number of files and folders within the directory
- **heat** refers to the average time since last access (hot = recent).
The tree graph only shows tiles for the folders within the GWS, the files are lumped together as **unindexed children**, but the files are considered in the calculation of the GWS statistics - e.g. the number of **children** is the number of folders and files within the GWS. There are also doughnut graphs with additional breakdowns in terms of users, filetypes and heats which can be scaled by either size or count.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner-ui#what-is-the-gws-scanner-ui?,901,163
Using the GWS Scanner UI,"Navigate to the [GWS Scanner homepage](https://gws-scanner.jasmin.ac.uk/) where you should see a **Log In** button.
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-homepage.png"" caption="""">}}
Clicking the login button will take you to the login page where you can sign in using your JASMIN account. Upon successful sign-in you should be redirected back to the homepage where you will have the option to view [your GWSs](https://gws-scanner.jasmin.ac.uk/my_gws).
{{< alert type=""info"" >}}
 At any time, you can click the JASMIN logo in the navbar to return to the homepage.
{{< /alert >}}
Here you will see a table with the names of your GWSs and their path. Clicking on the path will take you to the tree page for the GWS.
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-my-gws.png"" caption="""">}}
Alternatively, if you know the path to your GWS you can search for it in the url, e.g. `https://gws-scanner.jasmin.ac.uk/tree/<path-here>`. On this page you will see the path to your GWS at the top, then the tree graph with the coloured tiles representing folders within the GWS. *Note that some larger GWSs may take longer to load*. 
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-tree-page.png"" caption="""">}}
There is a **Toggle Patterns** button which can be used to swap the coloured tiles for patterned tiles. Hovering over a tile will reveal more information about that folder. There are buttons on the right hand side to scale and colour the tiles by size, count or heat as described earlier. There is also a key showing the values the colour of the tiles correspond to in this sidebar as well as information showing when the GWS was last scanned. Scans usually take around two weeks to complete so each GWS should be scanned approximately fortnightly. There is a **Go Up One Level** button which will take you back a level, but note that this will only work if you have gone deeper into the file path as it will not show the structure above the root GWS folder. You can click on a tile on the graph to view the tree graph inside that folder. For example, you may have a folder called *user1* in *group-workspace-1*, you could click on this tile to see the structure of the *user1* directory then you could use the **Go Up One Level** button to go back to *group-workspace-1*. Alternatively, you can just use the back button in your browser to go back. You can keep clicking files to go deeper into the GWS structure until you reach an **unindexed children** level where there are no more folders, only files. This is represented by a tile saying **__unindexed children__** which refers to a collection of files (every level will have an unindexed children tile representing the files within that folder).
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-unindexed-children.png"" caption="""">}}
Scrolling down the page, you will find the doughnut graphs. There is one for the **User Breakdown**, **Filetype Breakdown** and **Heat Breakdown**. Each of these have coloured sections corresponding to different users, filetypes or heats and the size of them is proportional to the size or count (there are **Size** and **Count** buttons to change between them). Again, hovering over a section of the graph will give you more information.
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-doughnut-graphs.png"" caption="""">}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner-ui#using-the-gws-scanner-ui,3329,516
Common issues and questions,"  * If you get stuck on a loading screen try refreshing the page - we are working on fixing this issue. 
  * If you go to the [My GWSs](https://gws-scanner.jasmin.ac.uk/my_gws) page and don't have any GWSs listed, check that your JASMIN account does have access to the GWS you are looking for.
  * Sometimes, if there are lots of tiles they can be hard to read - you can hover over the tile to get the full title or if you want to view the tree graph for that folder, you search for it by URL instead. 
  * If you are ever stuck and requiring help, the help beacon can be accessed from any page.
{{<image src=""img/docs/gws-scanner-ui/gws-scanner-beacon.png"" wrapper=""col-2 mx-auto"" caption="""">}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner-ui#common-issues-and-questions,696,119
Further information,"Here are some links to learn more about the GWS Scanner:
  * [The GWS Scanner UI](https://gws-scanner.jasmin.ac.uk/)
If you have any questions or suggestions, feel free to [get in touch](mailto:nicola.farmer@stfc.ac.uk).",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner-ui#further-information,220,29
Introduction,"This article explains about the process that runs in the background scanning all group workspaces to gather basic information about usage, which are fed into a database to be made available to users via the {{<link ""gws-scanner-ui"">}}GWS Scanner User Interface{{</link>}}.
It is intended for GWS Managers and provides details about how to customise the scan that is done on each GWS.
**It is run centrally, and is a very resource-intensive task, so please don't run similar tasks of your own, as you will be unnecessarily duplicating resource usage.**
There are two different scans of the Group Workspaces (GWSs).
- A daily scan which checks for how full the GWS is, and will email the GWS manager if it is over the default threshold of 83%, or a defined threshold in the GWS config file (see below).
- An approximately fortnightly check of the contents of all GWSs. 
As a GWS Manager you will receive e-mails summarising the usage and contents
of the GWS. By default this is a simple volume level summary of the GWS.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner#introduction,1018,175
Customisation,"If you wish for additional directories to be scanned and summarised please add
these to the `{GWS_PATH}/.gws_scan/config.ini`, where {GWS_PATH} is the path to
your group workspace (the directory and the file may need to be created).
Directories can also be excluded from the scan in the same way. This can be
useful for speeding up the run time of a scan. Here is an example of a
config.ini file.
{{<alert type=""info"">}}
Please note that the required directory for this configuration data is `.gws_scan`, not `.gws_scanner` - the
latter is from the **previous** incarnation of the scanner, and will be be removed in due course)
{{</alert>}}
[general]
# GWS fullness threshold for which the daily scan will send a warning email (default 83) (in %)
volume_warning_threshold = 83
# Directories to check for largest sub-dir and filetypes below (comma separated list), these paths must be relative to the group workspace path i.e. path/to/dir, not /group/workspace/path/to/dir
  # Defaults to all top level directories inside volume
dirs = dir1,path/to/dir2
# Directories to exclude from the scan. This can be useful to speed up the scan if there are know directories with a large number of files, for which the scan information is not very useful
excl_dirs = path/to/excl, large_dir
# Filetype extensions to count inside directories above (comma separated list)
  # Defaults to none
exts = html,py,js
`dirs` and `excl_dirs` can have the `*` wildcard anywhere in the directory path.
From the config above for example: `path/to/*`, and `p*h/to/dir2` would pick up
the directory `/path/to/dir2`, and any other directories which matched the
pattern.  
Please don't comment out the arguments. If you don't want to use one just leave
it blank, this will then just use the internal defaults. E.g.
[general]
volume_warning_threshold =
dirs = 
excl_dirs =
exts =
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner#customisation,1850,295
Report,"When the fortnightly scan runs it sends the output to the GWS manager as an
email, which looks like this:
{{<alert color=""light"">}}
### Group Workspace Report for: {GWS_PATH}
#### Scan Details
Time most recent scan started: 16/04/2019 - 10:15:57  
Time most recent scan finished: 16/04/2019 - 12:25:27  
Duration of most recent scan (h:m:s): 2:09:29  
Scan Complete: True
#### Usage Details
Filesystem: fuse.quobyte  
Total Storage: 199.2 TiB  
Used Storage: 81.8 TiB  
Free Storage: 117.4 TiB  
Usage: 42%
#### Directory Details
To get information about specific directories within this volume, please add
the relative paths to the volume config file (.gws_scan/config.ini) - see
[https://help.jasmin.ac.uk/article/4499-gws-scanner]({{< ref ""gws-scanner"">}})
**Directory** |  **Total Files** |  **Total Size** |  **Sub-directory with most files** |  **Files in this Sub-directory**  
---|---|---|---|---  
all_dirs  |  238336  |  81.8 TiB  |  {GWS_PATH}/dir1/example/path  |  7929  
.gws_scanner  |  0  |  0.0 B  |  None  |  0  
dir1  |  0  |  0.0 B  |  {GWS_PATH}/dir1/example/path  |  0  
#### Filetype Details
To get information on the quantity and size of specific filetypes under the
directories above, please add the relevant file extensions to the volume
config file (.gws_scan/config.ini) - see
[https://help.jasmin.ac.uk/article/4499-gws-scanner]({{< ref ""gws-scanner""
>}})
_No filetypes requested_
{{</alert>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/gws-scanner#report,1422,192
XFC client install,"In order to initiate and manage your usage of the XFC (transfer cache)
service, you need to use the XFC client.
Once set up, you don't need to use this client to read/write data to XFC
storage itself, but you can use it to interrogate the system to find out what
data you have stored and how much of your quota(s) you are using.
The following steps should be used to create a python virtual environment and
pip to install the xfc client:
NOTE: do these steps on one of the `sci` (not `xfer`) servers:
  1. Log into one of the sci machines: e.g. `sci1.jasmin.ac.uk` (1 - 8 is available)
  2. The `xfc` client can be used with Python 3 using jaspy.  
{{<command user=""user"" host=""sci1"">}}
module load jaspy
{{</command>}}
Setup a virtual environment in your home directory:
{{<command user=""user"" host=""sci1"">}}
python -m venv ~/xfc_venv
{{</command>}}
  3. The following steps for Python 2 and Python 3 are now the same.
  4. Activate the virtual environment:
{{<command user=""user"" host=""sci1"">}}
source ~/xfc_venv/bin/activate
{{</command>}}
  5. Download the client software using git to your home directory:
{{<command user=""user"" host=""sci1"">}}
git clone https://github.com/cedadev/xfc_client.git
{{</command>}}
  6. pip install the xfc client
{{<command user=""user"" host=""sci1"">}}
pip install -e ~/xfc_client
{{</command>}}
  7. Use xfc on the command line
{{<command user=""user"" host=""sci1"">}}
xfc -h
{{</command>}}
Users who already have a Python virtual environment can skip step 2 and
install into an existing virtual environment.
The recommendation for users using NLA, XFC and JDMA is to create a single
virtual environment to install all 3 client applications into.
The `xfc` client can be used without activating the python virtualenv by
adding the path to the xfc client to the `$PATH$` environment variable:
{{<command user=""user"" host=""sci1"">}}
export PATH=""$PATH:~/xfc_venv/bin"" `
echo 'export PATH=""$PATH:~/xfc_venv/bin""' >> ""$HOME/.bashrc""
{{</command>}}
The `xfc` client can now be used by invoking `xfc` from the command line
without activating the virtualenv. **Python 3** users   load jaspy
using the command `module load jaspy`
For instructions on how to use the xfc client, see the article [JASMIN
Transfer Cache (XFC).]({{< ref ""xfc"" >}})
",https://help.jasmin.ac.uk/docs/short-term-project-storage/install-xfc-client#xfc-client-install,2265,341
Introduction,"This article describes the way that storage is usually provided to projects on JASMIN: the **Group Workspace (GWS)**.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#introduction,118,18
What is a GWS?,"GWSs are portions of disk allocated for particular projects
to manage themselves, enabling collaborating scientists to share network
accessible storage on JASMIN. Users can pull data from external sites to a
common cache, process and analyse their data, and where allowed, exploit data
available from other GWSs and from the CEDA archive.
It is important to understand that these workspaces are not the same as the
CEDA archive. Data in a GWS can be earmarked for ingestion into the CEDA
archive, but this process should be discussed directly with the CEDA Archive team (via the CEDA Helpdesk), it is not automatic and will not happen without prior arrangement.
Data within GWSs are the responsibility of the designated GWS manager and
**are not backed up by the JASMIN team** (see below).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#what-is-a-gws?,790,130
Accessing a GWS,,https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#accessing-a-gws,0,0
Where are GWSs available?,"Each GWS volume is found in a directory mounted under a pattern of paths which refers to the capabilities of the storage, ie.
Path | Type | Capability
--- | --- | ---
/gws/nopw/j04/* | SOF | no parallel write (nopw)
/gws/pw/j07/* | PFS | parallel write capable (pw)
/gws/smf/j04/* | SSD | small-files optimised (smf)
{.table .table-striped}
A project may have several GWS volumes, perhaps of different types, for example:
- `/gws/nopw/j04/jules` SOF volume for the `jules` project
GWSs are available on:
- Transfer servers including `xfer*`, `hpxfer*`, `gridftp*` and the JASMIN Default Collection Globus endpoint.
- The general scientific analysis servers `sci*`
- All nodes in the LOTUS and ORCHID clusters
- Some application-specific servers (by arrangement)
They are NOT available on `login` or `nx-login` servers.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#where-are-gwss-available?,819,128
Requesting access to a GWS,"There is a Unix group associated with each GWS to provide convenient access
control. Any JASMIN user can apply for access to a given GWS by following the
links provided in the [list of available
GWSs](https://accounts.jasmin.ac.uk/services/group_workspaces/) on the JASMIN Accounts Portal.
**Important:** The GWS
Manager (not the JASMIN team) will need to authorise the request before you are granted access.
Once you have been granted the relevant access role, then the relevant Unix group will be added
to your account. If you are not sure of the group name for your GWS you can
find this by entering the command `groups` to see the names of the groups you
belong to. The group name normally has the prefix “gws_"".
{{<alert type=""info"">}}
All data in a GWS should belong to this group `gws_<name>`, so that group read/write permissions apply to this group rather than the default group, `users`.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#requesting-access-to-a-gws,911,148
GWS management,"Each GWS has a designated manager. See the article on
[managing a GWS]({{< ref ""managing-a-gws"" >}}).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#gws-management,102,16
Backup,"Please note that data in GWSs are only backed up if the GWS Manager has put
tasks in place to do this. The 
[Elastic Tape service]({{< ref ""secondary-copy-using-elastic-tape"" >}}) is available to enable to  make a secondary near-line copy of data. Please discuss the details with your GWS Manager.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#backup,298,49
Recommended directory structure for a GWS,"We recommend that a sensible directory structure is set up within your GWS in
order to conventions are used within your GWS:
<your_gws>/
    users/
        <userid>/   # each user can create their own directory here
    public/         # required if you want to share data via HTTP
    data/
        internal/   # internal/intermediate data
        incoming/   # third-party data brought to the GWS
        output/     # output data generated by project
See the GWS etiquette article for more details about GWSs and the [GWS data
sharing via HTTP]({{< ref ""share-gws-data-via-http"" >}}) article for
information about the use of the `public` directory.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/introduction-to-group-workspaces#recommended-directory-structure-for-a-gws,652,95
Joint-storage Data Migration App (JDMA),"{{<alert type=""info"">}}
A new system called [NLDS](https://techblog.ceda.ac.uk/2022/03/09/near-line-data-store-intro.html) is coming very shortly (as of Feb 2023) and will eventually replace both Elastic Tape and JDMA.
{{</alert>}}
**See the JDMA user documentation
at:[cedadev.github.io/jdma_client](https://cedadev.github.io/jdma_client/docs/build/html/index.html)
for more information about using JDMA.**
The joint-storage data migration app (JDMA) is a multi-tiered storage system
which provides a single API to users to allow the movement of data to a number
of different storage systems, query the data they have stored on those storage
systems and retrieve the data.
These interactions are carried out using a common user interface, which is a
command line tool to be used interactively, a python library or a HTTP API,
both to be used programmatically. The command line tool essentially provides a
wrapper for calls to the python library, which in turn makes calls to the HTTP
API.
JDMA was designed with the following usability criteria in mind:
- The user experience for moving data, regardless of the underlying storage systems, should be identical.
- The user should not be responsible for maintaining the connection to the storage system in the case of asynchronous transfers.
- User and group ownership and permissions should be preserved and restored on downloading the data
- The user should receive notifications when the transfers are complete.
- Users should be able to transfer data from one storage system to another
- JDMA is only a request and query layer. Any cataloguing of data should be carried out by the backend system. So that, if JDMA fails, then the data is still available independently of JDMA, from the storage backend.
**See the JDMA user documentation
at:[cedadev.github.io/jdma_client/](http://cedadev.github.io/jdma_client/docs/build/html/index.html)
for more information about using JDMA.**
JDMA was development under a Horizon 2020 grant from the EU Commission. A
report submitted to the EU Commission can be found in the repository at:
[github.com/cedadev/django-jdma_control/blob/master/doc/ESiWACE-
Milestone-8_final.pdf](https://github.com/cedadev/django-
jdma_control/blob/master/doc/ESiWACE-Milestone-8_final.pdf)
The JDMA client github is at:
[github.com/cedadev/jdma_client](https://github.com/cedadev/jdma_client)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/jdma,2364,312
Quick guide to installing the JDMA client on JASMIN,"If you are working on JASMIN and you wish to use the JDMA client, then you can
install it as follows on a `sci` server:
{{<command user=""user"" host=""sci1"">}}
module load jaspy
python -m venv ~/venvs/jdma-venv
source ~/venvs/jdma-venv/bin/activate
pip install git+https://github.com/cedadev/jdma_client
{{</command>}}
You should then have the **jdma** command-line tool available in your terminal
session.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/jdma#quick-guide-to-installing-the-jdma-client-on-jasmin,405,54
Managing a GWS,"This article explains the responsibilities of the Group Workspace (GWS)
manager.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws,81,11
Role of the GWS Manager,"When a GWS is created it is important that the designated GWS Manager
understands the responsibilities associated with the role. The GWS Manager has
a duty to:
- Ensure that GWS is being used appropriately: this may include enforcement of limits on particular users.
- Advertise the URL for requesting access to the GWS.
- Respond to e-mail authorisation requests from CEDA.
- Manage disk and tape effectively: specifically the use of the [Elastic Tape system]({{< ref ""secondary-copy-using-elastic-tape"" >}}) to back-up or migrate data.
- Communicate [GWS etiquette]({{< ref ""gws-etiquette"" >}}) to the project scientists.
- Manage additional services such as [sharing of GWS data via HTTP server]({{< ref ""share-gws-data-via-http"" >}}).
- Manage the closing down of the GWS effectively: all GWSs have a termination date and data may be lost if not managed effectively.
- Communicate any issues to the CEDA Helpdesk.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#role-of-the-gws-manager,918,143
Managing users,,https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#managing-users,0,0
Authorising access to the GWS,"When your GWS has been set up, users can submit requests for access to the GWS
via the JASMIN accounts portal: the new GWS will appear in the list of [JASMIN
Services](https://accounts.jasmin.ac.uk/account/login/?next=/services/group_workspaces/).
An access request from a user will trigger an e-mail to you that asks you to
approve (or refuse) the request. The e-mail will include details of the user
and their intended use of the resource. As GWS manager, **you** are now
responsible for approving these requests (this is a change from the previous
situation where you confirmed your approval to the CEDA helpdesk who then
actioned the approval). Now the approval is instant.
IMPORTANT: in order for this approval process to work, the GWS manager's own
account needs to have been migrated to the JASMIN accounts portal *if it existed prior to the JASMIN Accounts Portal in 2017*. Very few accounts such now remain in that state, but you can check by going to this page:
{{<button href=""https://accounts.jasmin.ac.uk/account/ceda_claim/confirm/"">}}Migrate your account{{</button>}}
If it says ""You are already logged in with a JASMIN account"" then you need take no further action.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#authorising-access-to-the-gws,1182,182
File system permissions and groups,"File system access to a GWS is managed using a Unix group that begins with
`gws_` and normally corresponds with the name of the service in the Accounts Portal. When users are granted the `USER` role for the workspace, they are also made members of the corresponding `gws_<gwsname>` group. As manager, you are normally granted `USER` and `MANAGER` access at the time that the GWS is set up by the JASMIN team, so it should be in place when you first access the storage. This means that:
- you have access yourself to the workspace (via the `USER` role giving you membership of the `gws_<gwsname>` group)
- you take over responsibility (via the `MANAGER` role) for approving other users' applications for the `USER` role.
- you can unilaterally grant `DEPUTY` access to other users if you know their username and want them to help you in the task of approving requests for `USER` access.
Once you yourself have access, a good first task is to set up the {{<link ""introduction-to-group-workspaces/#recommended-directory-structure-for-a-gws"">}}recommended directory structure{{</link>}}.
A list of the user IDs that have access to a given GWS can be found by using
the ""getent group"" command and piping it through ""grep"" to select only your
GWS. For example:
{{<command user=""user"" host=""sci1"">}}
getent group | grep gws_cedaproc
(out)gws_cedaproc:*:26015:fbloggs,jdoe
{{</command>}}
You can lookup a specific user ID with the following:
{{<command user=""user"" host=""sci1"">}}
getent passwd | grep fbloggs
(out)fbloggs:*:29775:26030:Fred Bloggs:/home/users/fbloggs:/bin/bash
{{</command>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#file-system-permissions-and-groups,1585,237
Maintaining group permissions throughout the GWS,"In order to maintain the group permissions throughout the GWS the highest
level directory has the ""sticky bit"" set. This means that the default group
for all files and directories created within the GWS will be the relevant
`gws_*` access group. This is particularly useful to enable data within the
GWS to be shared amongst collaborators. If users have a specific need to
modify the group permissions they can do so using ""chgrp"" command.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#maintaining-group-permissions-throughout-the-gws,440,74
Making directory contents writable by other members of the GWS,"If a user wishes to make their files/directories writable by others in the GWS
they can follow the procedure here using the ""umask"" command:
Make a directory (and set it the permission so that the group can read/write
to it):
{{<command user=""user"" host=""sci1"">}}
mkdir --mode=u+rwx,g+rws,o-rwx testdir
ls -l testdir
(out)drwxrws--- 2 jdoe gws_cedaproc 4096 Jan 26 14:36 testdir
{{</command>}}
Or (as separate steps):
{{<command user=""user"" host=""sci1"">}}
mkdir testdir
chgrp g+rws testdir
chgrp o-rwx testdir
ls -l testdir
(out)drwxrws--- 2 jdoe gws_cedaproc 4096 Jan 26 14:36 testdir
{{</command>}}
However, please also see {{<link ""#security"" />}}, below (and make sure your users are aware of this).
Check your umask:
{{<command user=""user"" host=""sci1"">}}
umask
(out)0022
{{</command>}}
Modify your ""umask"" so that any new file or directory that you create will be
writable anyone with the group permission:
{{<command user=""user"" host=""sci1"">}}
umask 002
touch testdir/newfile
ls -l testdir
(out)-rw-rw-r-- 1 jdoe gws_cedaproc 0 Jan 26 14:39 newfile
{{</command>}}
If you want the `umask` setting to persist, you should set it for yourself in your `~/.bashrc` file, and advise your users to do the same.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#making-directory-contents-writable-by-other-members-of-the-gws,1209,180
"Quota, resource allocation and GWS lifetime","The overall usage of a GWS can be determined with the `df` (SOF) or `pan_df`
(PFS) command:
{{<command user=""user"" host=""sci1"">}}
pan_df -H /gws/pw/j07/workshop/
(out)Filesystem             				Size   Used  Avail Use% Mounted on
(out)panfs://panmanager03.jc.rl.ac.uk/gws/pw/j07     2.6T    16G   2.6T   1% /gws/pw/j07/workshop/
df -H  /gws/nopw/j04/ncas_generic
(out)Filesystem                                      Size   Used  Avail Use% Mounted on
(out)quobyte@sds.jc.rl.ac.uk/gws_ncas_generic        83T    80T   3.4T  96% /gws/nopw/j04/ncas_generic
{{</command>}}
For PFS (paths beginning `/gws/pw/j07/*`), the raw capacity of the GWS is 2.6TB (measured in TB,
defined using powers of 10), but to obtain space available to users this
should be **divided by roughly 1.3**, resulting in around 2TB of free space. Of
this, 16GB is currently in use. The factor of 1.3 can depend on the number of
small files stored in the GWS because lots of small files take up more space
than expected. 
For SOF (paths beginning `/gws/nopw/j04/*`), the value reported by `df -H` is the usable size.
A summary of specific sections of a GWS can be determined using `pan_du -sh \<di\r>` (PFS), and `du -sh --si --apparent-size \<dir\>` (SOF). Set the
`--apparent-size` flag to get an accurate size.
Similarly, you can use the `find` command together with `-atime` or `-mtime` to locate
files accessed or modified more than a certain length of time ago. For
example, to find files which were accessed more than 1 year ago:
find /gws/nopw/j04/upscale/cache -type f -atime +365
**However**, this can
- consume significant system resources in running the `du` command, for a long time, and
- fail due to permission issues (as a regular user, you can't always ""see"" down all the directory branches)
...So we provide some tools to help with this:
1. The {{<link ""gws-scanner"">}}GWS Scanner{{</link>}} runs this for you, centrally, on a roughly 2-week cycle, and stores all the output in a database from which results can be visualised in the {{<link ""gws-scanner-ui"">}}GWS Scanner User Interface{{</link>}}.
1. There is also a live view of GWSs and the available space left on the [JASMIN Dashboard](https://mon.jasmin.ac.uk). The “JASMIN Storage” tab shows many
JASMIN storage volumes with information about current usage.
**So please don't run large `du` or `find` jobs yourself, as this will be duplicating something already running in the background.**
As a GWS Manager
you will receive e-mails summarising the usage and contents of the GWS. If you
wish for additional directories to be scanned and summarised please add these
to the [GWS scanner configuration]({{< ref ""gws-scanner"" >}}).
The typical lifetime of a GWS is 3 years. All GWS managers are expected to
actively manage the space during its lifetime and plan for the eventual
reclamation of the space by deleting and migrating data to other locations.
Typically, less-frequently-used data might be written to Elastic Tape (see below) and some final
outputs would be curated in the CEDA Archive. In the latter case please note
that you should discuss the requirements with the CEDA Archive team via the
CEDA Helpdesk, ideally before the project starts.
","https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#quota,-resource-allocation-and-gws-lifetime",3193,481
Migrating data to tape,"Proactive data management is an important part of providing an effective GWS.
We recommend that the GWS Manager discusses use of the space with the project
team to ensure that the use of disk and tape are being optimised. This may
involve use of the [Elastic Tape system]({{< ref ""secondary-copy-using-elastic-tape"" >}})
for backup or data migration (from disk to tape).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#migrating-data-to-tape,371,60
Requesting a change to the GWS size,"Although it is helpful to provide the best estimate of required allocation at
the time of initially requesting the GWS, a GWS Manager may request a change
in size (increase or decrease) of the GWS during its lifetime. We would
positively encourage you to be honest about your requirements so that others
can make use of this expensive resource if you are not using it until later in
your project, or if you no longer require all the space you originally
requested.
Requests for an increase in GWS size will be considered by the Consortium
Manager with responsibility for managing an overall allocation to that
particular scientific community. See 
[Requesting Resources]({{< ref ""../uncategorized/requesting-resources"" >}}). Depending on available resources and competing
demand, it may not always be possible to increase the allocation, and you may
be asked to move data to Elastic Tape to free up disk space.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#requesting-a-change-to-the-gws-size,911,147
Security,"User account security is very important in a multi-user environment such as
JASMIN. As a GWS Manager you have a responsibility to users of your GWS but
also to all other GWS users in helping to maintain a safe and secure system in
which productive scientific work can be done. There is a strict policy of one-
user-one-key, and on no account must any user make use of the SSH key of
another user to gain access to any part of the JASMIN infrastructure. Private
keys MUST be protected by a strong passphrase. Please encourage adherence to
these rules by users of your GWS. Any infringements may be dealt with swiftly
by removal of user access. No offensive, obscene or otherwise unauthorised
data may be stored in the GWS or anywhere else within JASMIN. Users should not
store any data of a personal or sensitive nature in the GWS.
{{< alert type=""danger"" >}}
Do not set, or allow your users to set, open permissions on files or directories.
By this we mean permissions where data are ""world-writable"" by anyone, for example
`-rw-rw-rw-` for a file, or **<< DON'T USE THESE!!**<br>
`drwxrwxrwx` for a directory. **<< OR THESE!!**
We provide a UNIX a group corresponding to each group workspace, which all members of that GWS belong to: this enables sharing within the group if you set permissions appropriately using that group. If you are unsure about setting permissions, please ask the helpdesk.
{{< /alert >}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#security,1413,244
Keeping informed,"Please maintain contact throughout the life of the GWS via the following
channels:
- Using the [JASMIN dashboard](https://mon.jasmin.ac.uk) to check on the status of your GWS (used versus available space).
- Email alerts from the system when the GWS reaches >83% full
- Email from the CEDA/JASMIN team
- News articles on the CEDA or JASMIN websites and by monitoring CEDA social media feeds which may be used to post messages regarding system status or security. 
  - [CEDA Website](http://www.ceda.ac.uk/)
  - [CEDA News on Twitter](https://twitter.com/cedanews)
If you are aware that a user who has access to your GWS leaves your project
or, for whatever reason, no longer needs to be a member of the GWS, please let
the [JASMIN Helpdesk](mailto:support@jasmin.ac.uk) know either by email or via
the beacon, lower right on this page. Arrangements may need to be made to
transfer the ownership of files and/or directories to another member of the
GWS to ensure continued access to the data.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/managing-a-gws#keeping-informed,992,159
Secondary copy using Elastic Tape,"{{<alert type=""info"">}}
- Information below relates to the Elastic Tape command-line tools. The [JDMA]({{<ref ""jdma"">}}) system provides a better interface for putting/retrieving data into the Elastic Tape System)
- A new system called [NLDS](https://techblog.ceda.ac.uk/2022/03/09/near-line-data-store-intro.html) is coming very shortly (as of Feb 2023) and will eventually replace both of these.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape,411,50
Introduction,"Elastic Tape is a system developed for use with JASMIN Group Workspaces
(GWSs), enabling the Group Workspace Manager to:
- Optimise their use of high-performance online disk by moving data to and from cheaper near-line storage
- Create and manage secondary copies of GWS data
At present, the system is designed only to be used by GWS Managers, rather
than individual members of a GWS. It is the responsibility of a GWS Manager to
create and manage backups or additional copies of data in a GWS.  
The servers used to access Elastic Tape changed in January 2021.
Previous users should note that the server to use now is `et.jasmin.ac.uk`.
**The maximum size for any file put into Elastic Tape is 500GB.  This changed in 2023, when the underlying tape system was upgraded.  Please limit your files to less than 500GB.**
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#introduction,818,140
Who can use ET?,"ET is only for use by the named GWS manager, i.e. the individual responsible for managing the GWS disk space. The high-performance disk space used for a GWS is a valuable commodity and the role of the GWS Manager involves making best use of the online space. This may mean moving data to tape to free up space online, or taking a copy of online data to make a secondary copy. **No undertaking is provided that the secondary copy will exist beyond the lifetime of the Group Workspace itself, hence it is called a secondary copy and not a backup. It is also NOT long-term archive storage:** some data in GWSs may need to be earmarked for longer-term archive storage and wider availability via the CEDA Archive, but this is a **separate process** for which data management plans, ingest processes and metadata need to be put in place. Please contact the helpdesk if this is the case, but ideally this needs to be considered at project design phase (as it may need funding!).
Each GWS has a quota of online disk space (agreed at the time of its creation) and initially the ET quota has been set to the same value. So if you have a 10 Tb workspace, you initially have a 10Tb quota of ET storage to match.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#who-can-use-et?,1200,220
How does it work?,"Putting data into ET storage involves creating a ""batch"" of data which is
transferred to the ET system. Using either a file list or top-level directory
for reference, the system calculates resources needed and creates a batch,
identified by a batch ID. This must be retained by the GWS manager as a
""ticket"" for later retrieval of this batch of data. It is recommended that you
assess the data that you plan to transfer so that you have an idea of the
overall volume to be transferred before initiating any actual transfer jobs.
It is also recommended to test operation with a small set of test data.
Transparent to the user, and asynchronously (so it is not necessary to wait
with a terminal window open), the data are transferred first to online cache
and then to tape storage. It is not an instant process and the task of
migrating data from online cache to tape can take several hours, even days,
depending on factors such as the size of the transfer, contention for the tape
system and network conditions. An RSS feed and a web page provide updates on
the process of data transfer for each batch. Data can later be retrieved, or
removed from ET storage via similar tools.
The transfer of data via a batch involves the ""registration"" of each file in a
database so that its existence is recorded.
Command line tools are provided on a dedicated machine within the JASMIN
infrastructure, to which GWS managers will be given access. A GWS manager has
access to the python tools `et_put.py`, `et_get.py`, `et_rm.py` and
`et_ls.py`. Some initial documentation for these command line tools is
attached.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#how-does-it-work?,1600,277
What should I do next?,"It is recommended to try sending **and retrieving** some small data transfers
(a few Gb) at first using the documentation below, but the system has been
designed to cope with storing entire GWSs. You will need ssh login access to
`et.jasmin.ac.uk` first. This should have been arranged for you as part of the 
GWS setup process. If not, please contact the JASMIN helpdesk. Once
there, you should be able to see your group workspace and try out the commands
on a small set of test data.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#what-should-i-do-next?,486,86
System overview,"Elastic Tape provides the ability to create ""batches"" of files which are then
sent to the storage system, initially to an online disk cache before being
written to near-line tape. Batches can later be retrieved, or removed. An
alert system provides the user with the ability to monitor the progress of
transfer jobs.
The system comprises:
- A command-line interface on a client machine
- A backend system, consisting of 
  - I/O servers connected to an online disk cache and database
  - A near-line tape system
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#system-overview,512,86
Configuration file,"As a GWS manager, you will normally be responsible for one or more GWSs. The
GWS with which you wish to work using ET needs to be specified either in a
configuration file in your home directory, or by specifying the workspace as
an option in the command line interface.
Certain default settings are set in a system-wide config file at
`/etc/et_config`.
If needed, you need to create a small text file in your home directory named
`.et_config`, which contains the following, replacing ""myworkspace"" with the
name of your default workspace:
[Batch]
Workspace = myworkspace
`myworkspace` should just be the short name of the workspace, not the full
path to it.
The workspace specified in any command-line option overrides that specified in
the user's (`~/.et_config`) config file, which in turn overrides that
specified in the system (`/etc/et_config`) config file.
Please **REMOVE** any previous reference to host and port from your individual
`~/.et_config file`. This setting is now set from the system /etc/et_config
file.
Further configuration options are available in the `[DIRECTORY]` section of
the file, see the system-wide file /etc/et_config for examples. The main
parameter for which you may wish to override the default is:
outputLevel = workspace|batch|file
although these can be over-ridden at the command line anyway. See `et_ls.py`
command documentation below for the meaning of these options.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#configuration-file,1408,219
User interface,"Please note that NOT ALL features of the currently-implemented user interface
are described here, however we would recommend that users limit their usage to
those features described below.
The user interface consists of the following components:
- **et_put.py** Put data onto tape
- **et_get.py** Retrieve data from tape
- **et_rm.py** Remove data from tape
- **et_ls.py** List data holdings on tape
- **Alerts** Get information about processes and holdings via web interface
The commands are available on host `et.jasmin.ac.uk`. As a GWS manager you
should have been granted login access to this machine using your JASMIN
account, however if accessing the host from outside the RAL network you will
need to use the login gateways `login1.jasmin.ac.uk`, `login2.jasmin.ac.uk`,
`login3.jasmin.ac.uk` or `login4.jasmin.ac.uk`. Use the -A option or
equivalent for agent forwarding in ssh. STFC users may use the STFC VPN to
connect to `et.jasmin.ac.uk` as if it were a local connection.
{{<alert type=""danger"">}}
When writing data to the ET system, it is very important that data remains in place on disk, in the location where ET expects to find them, until the status of the batch in question has reached `CACHED_SYNCED` or `SYNCED`.  This means that the data have actually been written to tape, but is not the case until that status is shown.
The location where ET expects to find the files will be specified in the `LISTFILE` that the user supplied to the `et_put.py` command, or all files and directories under the `DIR`.  The status of user's batches can be checked by going to the webpage: http://et-monitor.fds.rl.ac.uk/et_user/ET_AlertWatch.php. You need to be logged into JASMIN to see this webpage, via the [nx-login servers](/docs/interactive-computing/graphical-linux-desktop-access-using-nx/), and use Firefox as the web browser.
Deleting the data from disk prematurely can cause problems for the ET system as a whole (impacting other users) so please be careful with this aspect.
{{</alert>}}
* * *
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#user-interface,2011,309
et_put.py,"Put data onto tape.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#et_put.py,20,4
Synopsis,"et_put.py [-v] [-l LOGFILE] [-w WORKSPACE] [-c] [-t one-word-tag] [ -f LISTFILE | DIR ]
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#synopsis,88,15
Description,"Data files to be stored can be specified either in an input list file (-f) or
by specifying the path to the top of a directory tree containing files to be
stored. All symbolic links are ignored (see note below). In both cases, the
system will analyse the request and create a **batch** , identified by a
`BATCH ID`, which can later be used to retrieve that set of files from
storage. Although the main ""put"" operation is asynchronous (and does not
require you to maintain a terminal connection for its duration), the initial
registration step, which creates the BATCH ID is synchronous, so you should
wait for this step to complete before disconnecting.
Given current resources, all users of Elastic Tape share the current
throughput capacity of about 25 TB/day, which may increase over time. Please
consider this when organising your input batches and expectations of
completion time. Large numbers of small files will degrade performance.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#description,941,157
Options,"option | details
---|---  
-v  |  Verbose output
-l LOGFILE  |  Log file in which to record process output
-f LISTFILE  |  Text file containing ABSOLUTE paths of files to be stored, 1 file per line. NB Files and directory names are case-sensitive. The list should not contain any blank lines or extraneous white space.
-w WORKSPACE  |  Name of the group workspace to use. Overrides default set in config file. Case sensitive.
DIR  |  ABSOLUTE path to top of directory tree containing files to be stored  
-c  |  Continue if errors encountered.
-t tag  |  Tag batch with descriptive label meaningful to user. Should be single one-word string. Appears as ""Batch name"" in ET alert output and ""Tag"" in et_ls output.
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#options,736,124
Example usage,"Simple case, using a file input.list which contains paths of all the files to
be included in the batch:
{{<command user=""user"" host=""et1"">}}
et_put.py -v -l et_put.log -f input.list -w myworkspace
{{</command>}}
In the following example, the `-c`option is used to continue on errors. One
error that may be encountered is that a file already exists in the system
(e.g. has already been ""put""). This option causes the system to ignore any
errors and continue with the transfer. Note that this should not be used by
default (we would rather know about errors and fix them!)
{{<command user=""user"" host=""et1"">}}
et_put.py -v -l et_put.log -f input.list -w myworkspace -c
{{</command>}}
Alternative usage specifying a directory beneath which all files / directories
will be included. In this case the directory must be the last parameter in the
command:
{{<command user=""user"" host=""et1"">}}
et_put.py -v -l et_put.log -w myworkspace /group_workspaces/jasmin/myworkspace/mydir
{{</command>}}
**Symbolic links:** Attempting to include symbolic links in an et_put
operation should cause an error. You can override this with the `-c` option
(although this will ignore ALL errors), but a better solution is to generate a
list file as in the first two examples above. If this list file is generated
with a command like `find <path> -type f > listfile.txt`, then referring to it
in the et_put command will ensure that only those files are included in the
batch. You can then keep the list file (perhaps named as per the resulting
batch ID for your own records.
* * *
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#example-usage,1555,249
et_get.py,"Retrieve data from tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#et_get.py,24,4
Synopsis,"et_get.py [-v] [-l LOGFILE] [-b BATCHID | -f FILELIST] [-w WORKSPACE] [-r DIR] [-t MAXPROC]
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#synopsis,92,15
Description,"Data files to be retrieved should be specified by referring to the `batch ID`
of the batch in which they were stored. If files have been stored by
specifying an absolute path e.g. `/group_workspaces/jasmin/myworkspace/mydir`,
the retrieval process will not write the retrieved files to the same location
but a new location specified by `DIR`. The final part of the relative path
needs to correspond with the first part of the absolute path of the stored
files, e.g. `group_workspaces`
Proposed best-practice is to create a temporary directory for retrieved data
within your workspace, e.g. `/group_workspaces/jasmin/myworkspace/ettmp` and
to do the initial retrieval into that directory. Once you are satisfied that
the retrieval has completed correctly, data can be moved back to their
original location in the workspace. NB if you need additional storage space
for this, please contact the [CEDA help desk](mailto:support@ceda.ac.uk).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#description,937,140
Options,"option | details
---|---  
-v  |  Verbose output
-l LOGFILE  |  Log file in which to record process output. Note that the log file location must be capable of accepting multi-threaded input, or this parameter should be omitted and instead the output from the et_get command be piped to the log file from stdout   
-b BATCHID  |  ID of batch to be retrieved
-f FILELIST  |  A list of individual files to be retrieved, with one file per line. Note that:<br>- entries in the list must contain the full name of the file, including path, just as it was archived<br>- the list should not contain blank lines or any extraneous white space.
-w WORKSPACE  |  name of the group workspace to use. Overrides default set in config file. Case sensitive.   
-r DIR  |  ABSOLUTE path of retrieval location   
-t MAXPROC  |  Maximum number of worker processes to use in retrieval. MAXPROC recommended to be between 5 and 10. Please feed back your experience of performance improvement with this feature.   
{.table .table-striped}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#options,1014,171
Example usage,"{{<command user=""user"" host=""et1"">}}
cd /group_workspaces/jasmin/myworkspace
mkdir ettmp
et_get.py -v -l et_get.log -w myworkspace -b 507 -r /group_workspaces/jasmin/myworkspace/ettmp
{{</command>}}
At this point, data will be transferred into the specified retrieval
directory. Files and directories will be restored with their ABSOLUTE path
below the retrieval directory. NB this is a synchronous process and you will
need to keep your terminal window open to ensure it completes (or run within
the `screen` command if you are familiar with this).
When the retrieval process has finished, you should satisfy yourself that it
is correct (using your preferred method). When this is the case, you can move
the data to the required location as shown below:
{{<command user=""user"" host=""et1"">}}
mv /group_workspaces/jasmin/myworkspace/ettmp/group_workspaces/jasmin/myworkspace/* /group_workspaces/jasmin/myworkspace
{{</command>}}
* * *
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#example-usage,934,121
et_rm.py,"Remove data from tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#et_rm.py,22,4
Synopsis,"et_rm.py [-v] -b BATCHID [-w WORKSPACE]
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#synopsis,40,6
Description,"Deletes the files in the specified batch from the Elastic Tape system.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#description,71,12
Options,"option | details
---|---
-v  |  Verbose output
-b BATCHID  |  ID of batch to be removed   
-w WORKSPACE  |  name of the group workspace to use. Overrides default set in config file. Case sensitive.
{.table .table-striped}
Example usage:
{{<command user=""user"" host=""et1"">}}
et_rm.py -v -b 507
{{</command>}}
* * *
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#options,314,50
et_ls.py,"List holdings on tape
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#et_ls.py,22,4
Synopsis,"et_ls.py [-h] [-X XMLSOURCE] [-H] [-b BATCHID] [-w WORKSPACE] [-L {file,batch,workspace}] [-F {text}]
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#synopsis,102,13
Description,"Lists the holdings of a workspace within Elastic Tape at the file, batch or
workspace level.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#description,93,16
Options,"option | details
---|---
-h, --help  |  show this help message and exit
-x XMLSOURCE --xmlsource XMLSOURCE  |  Base XML source, if not default. Note that this has to be compatible with the current base source currently, so can’t be pointed at files, for example   
-H --headerWanted  |  Print headers showing column names for text output   
-b BATCHID --batchid BATCHID  |  ID of batch by which to filter results   
-w WORKSPACE  |  Name of the group workspace to use. Overrides default set in config file. Case sensitive.   
-L {file, batch, workspace} --outputLevel {file, batch, workspace}  |  Level of detail to display for results (default is ""workspace"")   
-F {text} --outputFormat {text}  |  Format to use for the display of results   
{.table .table-striped}
Example usage:
{{<command user=""user"" host=""et1"">}}
et_ls.py -w myworkspace -H -L file -b 504
{{</command>}}
Works with the workspace ""myworkspace"", selects display of headers in output,
results at file level, filter by batchid 504 (i.e. shows the files present in
ET in the given batch.)
{{<command user=""user"" host=""et1"">}}
et_ls.py -w myworkspace -H -L batch
{{</command>}}
Works with the workspace ""myworkspace"", selects display of headers in output,
results at batch level (i.e. shows the batches present in ET holdings for this
workspace.)
* * *
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#options,1320,204
Alerts,"The system provides real-time status messages on the progress of operations
requested. **These services are now available only inside the RAL firewall** ,
so JASMIN users outside of RAL should use the 
[NX graphical desktop service]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}) to open a
firefox browser on one of the nx-login servers, to access these URLs
**Alerts Dashboard** <http://et-monitor.fds.rl.ac.uk/et_user/ET_AlertWatch.php>
**RSS Feed** <http://et-monitor.fds.rl.ac.uk/et_rss/ET_RSS_AlertWatch_atom.php>
In both cases these can be customised to display only alerts from the
workspace of interest to the GWS manager.
**Alerts Dashboard** <http://et-monitor.fds.rl.ac.uk/et_user/ET_AlertWatch.php?workspace=WORKSPACE>
**RSS Feed** <http://et-monitor.fds.rl.ac.uk/et_rss/ET_RSS_AlertWatch_atom.php?workspace=WORKSPACE>
(replace `WORKSPACE` with your workspace name in the above URLs)
**Further views**
**ET Home** <http://et-monitor.fds.rl.ac.uk/et_user/ET_Home.php?caller=USERNAME>
**Holdings summary**[http://et-monitor.fds.rl.ac.uk/et_user/ET_Holdings_Summary.php?caller=USERNAME&workspace=WORKSPACE](http://et-monitor.fds.rl.ac.uk/et_user/ET_Holdings_Summary.php?caller=USERNAME&workspace=WORKSPACE)
(replace `USERNAME` with your username, `WORKSPACE` with your workspace name
in the above URLs)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/secondary-copy-using-elastic-tape#alerts,1320,117
Introduction,"This article explains how a GWS Manager can organise for some directories within a GWS to be shared with other users on JASMIN.
**Note:** this only applies to sharing data within the managed environment of the JASMIN platform.
If you need to share data with users outside JASMIN, or to users of external cloud tenancies, please consider
the [HTTP option]({{< ref ""share-gws-data-via-http"" >}}).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/share-gws-data-on-jasmin#introduction,395,63
How to share specific directories,"Sometimes it is useful to share the contents of specific directories within
your GWS with other users on JASMIN (that do not have access to your GWS).
This can be achieved with the following approach:
Suppose you manage the GWS `/group_workspaces/jasmin/superproj` and you want
to share the directory `/group_workspaces/jasmin/superproj/mydata` with other
JASMIN users.
1\. Add read and execute permission for all to the top-level GWS directory.
This requires root access so you might need to request that CEDA make this
change for you:
{{<command>}}
chmod 775 /group_workspaces/jasmin/superproj
{{</command>}}
2\. Alter the permissions of all sub-directories to remove the execute
permission for all users that don't have access to the GWS:
{{<command>}}
find /group_workspaces/jasmin/superproj -type d -exec chmod o-x {} \;
{{</command>}}
3\. Add execute permission on the sub-directory you want to share:
{{<command>}}
chmod o+x /group_workspaces/jasmin/superproj/mydata
{{</command>}}
NOTE: You may need to change permissions on directories and files within the
sub-directory as well. Please consult the `chmod` man pages (by typing `man
chmod`) for details.
NOTE: if you have a `public` directory then it needs `755` access if you want it
to be visible via the webserver on the `gws-access.jasmin.ac.uk` server. So
you may wish to re-add execute permission on that directory, e.g.:
{{<command>}}
chmod o+x /group_workspaces/jasmin/superproj/public
{{</command>}}
{{< alert type=""danger"" >}}
Do not set open permissions on files or directories.
By this we mean permissions where data are ""world-writable"" by anyone, for example
`-rw-rw-rw-` for a file, or **<< DON'T USE THESE!!**
`drwxrwxrwx` for a directory. **<< DON'T USE THESE!!**
We provide a UNIX a group corresponding to each group workspace, usually named `gws_<name>` which all members of that GWS belong to: this enables sharing within the group if you set permissions appropriately using that group. If you are unsure about setting permissions, please ask the helpdesk.
{{</alert>}}",https://help.jasmin.ac.uk/docs/short-term-project-storage/share-gws-data-on-jasmin#how-to-share-specific-directories,2048,299
What is HTTP data sharing?,"Specific parts of JASMIN Group Workspaces (GWSs) can be made available via
HTTP, so that:
- data can be shared with users who do not have JASMIN accounts
- common clients such as `wget`, `curl`, client libraries and web browsers can be used to access the data via a commonly-supported protocol.
In this respect, the service should be regarded as another [data transfer
tool]({{< ref ""data-transfer-tools"" >}}). However it must be arranged in
advance between the Group Workspace manager and the JASMIN Helpdesk. It
involves:
1. A member of the workspace creating a `public` directory and placing data inside it
2. The **GWS manager** making a request to the [JASMIN Helpdesk](mailto:support@jasmin.ac.uk) to request that this specific GWS is configured to be shared via HTTP.
Both these steps need to be completed in order for the GWS to be visible via
HTTP. By default, GWSs are not visible by HTTP.
Once a GWS has been made available, it is publicly visible by the entire
internet: please bear that in mind.
The following sections below describe how to set up restricted and
unrestricted access to your ""public"" directory. If you require access control
then see the section on password-protected access below. [Note: this is
currently possible, though not recommended, only because the current webserver
configuration permits this (now deprecated) means of restricting access.
Future revisions of the service may remove or change the way access
restrictions can be imposed].
{{<alert type=""danger"">}}
This facility is **not to be used for hosting project websites**. It is
provided as a simple means for specific data files to be made available to a
wider audience than members of a Group Workspace, using a convenient data
transfer protocol (HTTP). Likewise, it is not recommended to build tools or
front-end applications relying on this service as a dependency if they are to
be operated as a production or (near-)real-time service. The JASMIN team
reserves the right to apply rate-limiting (by project and/or IP address) or to
remove GWSs from the service if they are considered to be causing problems for
the network or other parts of the service infrastructure.
Projects considering web-based solutions for showcasing or disseminating their
data via more complex tools or with specific availability requirements should
consider requesting an external tenancy in the JASMIN Community Cloud, or
indeed external service providers if more appropriate, but should be prepared to
do the necessary design, development, operation and maintenance of those
services themselves.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/share-gws-data-via-http#what-is-http-data-sharing?,2587,407
Public access set up,"In some cases the GWS manager may want to make some files and directories
available over HTTP so that users (perhaps a wider audience than just the
membership of the GWS) can access the data via a web browser or other HTTP-
based tools. This can be done by creating a `public` directory in the top-
level directory of the GWS, for example:
{{<command user=""user"" host=""sci1"">}}
cd /group_workspace/jasmin/foobaa/
mkdir public 
chmod -Rf 755 public
{{</command>}}
You should then contact [JASMIN Support](mailto:support@jasmin.ac.uk) and ask
for this directory to be made visible via the `gws-access` server. The JASMIN
team will configure this change and your `public` directory will then be
visible from:
https://gws-access.jasmin.ac.uk/public/foobaa/
{{<alert type=""info"">}}
The URL of this service changed in June 2020. A redirect
is in place from the old URL of `https://gws-access.ceda.ac.uk/`, so the change
should be transparent to existing users, but **please use the new URLs**
beginning with `https://gws-access.jasmin.ac.uk/` to avoid any problems for
example with HTTP clients that are unable to handle redirects.
{{</alert>}}
Please see the section below if you wish to control who can access the content
of one or more of the sub-directories within your `public` directory.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/share-gws-data-via-http#public-access-set-up,1288,193
Restricted access set up,"In order to restrict access to your ""public"" directory, and/or any sub-
directories, you will need to create an "".htaccess"" file within it. In turn,
the "".htaccess"" file must point to a "".htpasswd"" file which lists the
usernames and encrypted passwords that have read-access to that directory.
{{<alert type=""danger"">}}
This method of access control is entirely independent of the SSH login
accounts used on JASMIN and would be the responsibility of the GWS Manager to
maintain. It is not secure by modern standards and not particularly
recommended as it adds complication for GWS managers and users, but is an
option for some basic access control if no other options are available.
**Future
revisions of the service may revise or remove this feature.**
{{</alert>}}
In order to create the "".htpasswd"" file, you will need access to the
""htpasswd"" command. This is available on the transfer servers
xfer[12].jasmin.ac.uk
You can then create the "".htpasswd"" file as follows (using the example of a
Group Workspace called ""foobaa""):
{{<command user=""user"" host=""sci1"">}}
export GWS=/group_workspaces/jasmin/foobaa/
cd $GWS
mkdir -p public 
cd public
htpasswd -b -m -c $GWS/public/.htpasswd i_am_a_user i_am_a_password
{{</command>}}
Before this will work, you also need to create a "".htaccess"" file which you
could do as follows
{{<command user=""user"" host=""sci1"">}}
cat >.htaccess <<EOL
AuthType Basic
AuthName ""Password Required""
AuthUserFile /group_workspaces/jasmin/foobaa/public/.htpasswd
Require valid-user
EOL
{{</command>}}
Finally, change the permissions on these files:
{{<command user=""user"" host=""sci1"">}}
chmod 644 .htaccess .htpasswd
{{</command>}}
Now, you can test that you get prompted for the username and password by
visiting
https://gws-access.jasmin.ac.uk/public/foobaa/
",https://help.jasmin.ac.uk/docs/short-term-project-storage/share-gws-data-via-http#restricted-access-set-up,1789,250
Using the JASMIN Object Store,"This article describes how to use the JASMIN high-performance object storage.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store,78,11
What is object storage?,"An [object store](https://en.wikipedia.org/wiki/Object_storage) is a data
storage system that manages data as objects referenced by a globally unique
identifier, with attached metadata. This is a fundamental change from
traditional file systems that you may be used to, as there is no directory
hierarchy - the objects exist in a single flat domain. These semantics allow
the object store to scale out much more easily than a traditional shared file
system.
The other fundamental change is that the data is no longer accessed by
mounting a file system onto a host and referencing a file path (where
authentication is ""can I log in to the host""). Instead, the data is accessed
over HTTP, with authentication using HTTP headers. This has many benefits, the
biggest of which is that we can make the object store available outside of the
JASMIN firewall, for example to the JASMIN External Cloud. Data can be read
**and written** in the same way, using the same tools, from inside and outside
JASMIN. Contrast this with Group Workspaces, where you must be logged in to a
JASMIN host in order to write data using the file system, and data is only
accessible externally in a readonly way using HTTP or OPeNDAP or via data 
transfer methods.
Object stores are seen as the most efficient (and cheapest!) way to store and
access data from the cloud, and all the major cloud providers support some
variant of object store. The JASMIN object store is [S3
compatible](https://www.scality.com/topics/what-is-s3-compatible-storage/) \-
S3 is the object store for Amazon Web Services (AWS), and has become a de-
facto standard interface for object stores. This means that all the same tools
that work with AWS S3 will also work with the JASMIN object store.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#what-is-object-storage?,1743,288
Accessing the object store,"The JASMIN object store is organised into **tenancies**. These are shared
areas of the object store, similar in concept to Group Workspaces, and are
requested by users, usually Group Workspace Managers. Several users can have
access to a tenancy, and so they can be used collaboratively.
To join an existing object store tenancy, navigate to the ""Services"" section
in the JASMIN Accounts Portal and select the ""Object store"" category. Select a
tenancy and submit a request to join. This request will then be considered by
the manager of the tenancy and either accepted or rejected.
{{<image src=""img/docs/using-the-jasmin-object-store/file-kHfcUlqbAf.png"" caption="""">}}
For details on how to request and manage an object
store tenancy, please see the help article ""JASMIN Object Store for Managers""
(forthcoming).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#accessing-the-object-store,814,121
Default access policies,"As of Jan 2024, we have changed the default access policy for newly created tenancies to provide a more sensible and flexible set of access policies.
The old policy allowed any members of the tenancy access to any bucket created in the tenancy by default. The new policy allow Users (USER only in the JASMIN Accounts Portal) of the tenancy only access to buckets they own by default. This can be effectively changed to the old policy by setting the policy of the bucket to the LDAP group for the tenancy members (<tenancy>-members, e.g. cedadev-o-members) - this can be done using the JASMIN Object Store portal (below) or the Swarm portal. Specific JASMIN users or groups can also be given permission to buckets (group access is controlled by LDAP groups, and only existing LDAP group will work - you may need to ask for one to be created).
The new policy also gives admin access for tenancy MANAGER and DEPUTY roles, who have access to all the buckets in the tenancy.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#default-access-policies,970,171
Creating an access key and secret,"Authentication with the object store uses an access key and secret that are separate to your JASMIN username and password. You can generate keys and manage bucket permissions through the {{<link ""jasmin_object_store_portal"">}}JASMIN Object Store Portal.{{</link>}}
{{<image src=""img/docs/using-the-jasmin-object-store/file-OkGcJm0Mpo.png"" caption=""JASMIN sbject store portal"">}}
You can log in with your JASMIN username and password. You can then click on the ""Object Stores"" button on the right. This will present you with the list of object store tenancies that you have access to. If you don't see an object store tenancy that you expect to, please check you have access in the {{<link ""jasmin_accounts_portal"">}}JASMIN Accounts Portal{{</link>}}. If you have access in the Accounts Portal, but not in the Object Store Portal then please email the helpdesk.
{{<image src=""img/docs/using-the-jasmin-object-store/file-3kmJDqsPGr.png"" caption=""List of object store tenancies"">}}
The URL for the object store tenancy is also presented here for convenience. You can click on the ""Manage Object Store"" button to manage you keys and buckets. This will ask you to confirm your JASMIN password.
{{<image src=""img/docs/using-the-jasmin-object-store/file-J7sWRXVp9D.png"" caption=""Prompt for password"">}}
You will then be presented with the following page.
{{<image src=""img/docs/using-the-jasmin-object-store/file-gRPOhQpGBG.png"" caption=""existing keys"">}}
From this page you can view your existing keys, and delete them if you require. You can also use the ""Create Key"" tab on the left.
{{<image src=""img/docs/using-the-jasmin-object-store/file-L8tOrtBj7z.png"" caption=""Create access key"">}}
You need to name the key and enter an expiry date for it. This will then present you with a pop-up with details on your access key and secret key. **This is the only time your secret key will visible, so save it immediately in a secure password manager.**
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#creating-an-access-key-and-secret,1941,264
Managing bucket permissions,"You can also manage the permissions on buckets using the ""Buckets"" tab from this page. This allows you to manage the access policies for your buckets without using the S3 API or the Swarm portal.
{{<image src=""img/docs/using-the-jasmin-object-store/file-6m0rwBsm9K.png"" caption=""Bucket permissions"">}}
Click on the ""Manage permissions"" button for a bucket to add or change access policies for that bucket.
{{<image src=""img/docs/using-the-jasmin-object-store/file-CxoXaC08wI.png"" caption=""Granting access"">}}
By default this lets you grant access to specific JASMIN Users and/or groups (these are LDAP groups and you might need to request that one is created for you if you require a subgroup for your tenancy). The advanced tab gives you the same options as available through the Swarm portal - including making buckets publicly accessible. Once done, hit the save to add the policy to the bucket. You can edit or delete permissions from that bucket through the ""View Bucket Policies"" tab.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#managing-bucket-permissions,991,145
Legacy method for key creation,"This is the old way of creating keys which still works, but the new way above is accessible outside JASMIN on the public internet.
You can generate an access key and secret using the Caringo portal. 
Authentication with the object store uses an access key and secret that are
separate to your JASMIN username and password. You can generate an access key
and secret using the Caringo portal. This portal is not currently available
outside of JASMIN - you will need to use a graphical session on JASMIN to
access a Firefox browser running on a JASMIN system.
**The recommended way to do this is using the** [NX Graphical Desktop
service]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}). You can start Firefox from
the ""Activities"" menu once you have logged in to your graphical desktop on one
of the `nx-login*` servers (so no need to make an onward connection to a `sci`
server).
An alternative option is to using X11 Forwarding on your SSH connection:
ssh -AY <user>@sciX.jasmin.ac.uk firefox
Once you have Firefox open, navigate to
http://my-os-tenancy-o.s3.jc.rl.ac.uk:81/_admin/portal
but replace `my-os-tenancy-o` with your tenancy name.
You will see a login screen where you
should enter your JASMIN username and password:
{{<image src=""img/docs/using-the-jasmin-object-store/file-4dszwvVbge.png"" caption="""">}}
If you receive a ""HTTP ERROR 500 java..."" error, it is likely that you haven't
added the port (81) to the address.  
Upon successfully entering the username and password of a user who belongs to
the tenancy, you will see a dashboard. To create an access key and secret,
click on the cog icon and select ""Tokens"":
{{<image src=""img/docs/using-the-jasmin-object-store/file-sazR2YE8xn.png"" caption="""">}}
On the tokens page, click ""Add"":
{{<image src=""img/docs/using-the-jasmin-object-store/file-tiUnM6oyq6.png"" caption="""">}}
In the dialogue that pops up, enter a description for the token and set an
expiration date. Make sure to click ""S3 Secret Key"" - this will expose an
additional field containing the secret key. **Make sure you copy this and
store it somewhere safe - you will not be able to see it again!** This value
will be used whenever the ""S3 secret key"" is required.
{{<image src=""img/docs/using-the-jasmin-object-store/file-8ezAbSQY56.png"" caption="""">}}
Once the token is created, it will appear in the list. The ""Token"" should be
used whenever the ""S3 access key"" is required:
{{<image src=""img/docs/using-the-jasmin-object-store/file-QSg6RtIAv8.png"" caption="""">}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#legacy-method-for-key-creation,2500,363
Accessing data in the object store,,https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#accessing-data-in-the-object-store,0,0
URLs for internal and external access,"Although the data is exactly the same in both cases, a slightly different URL
must be used depending on whether you are accessing the object store from the
JASMIN managed cloud servers or from the JASMIN External Cloud.
From inside JASMIN, including LOTUS and the Scientific Analysis servers, 
`my-os-tenancy-o.s3.jc.rl.ac.uk` should be used, with the `http://`` prefix.
From the JASMIN External Cloud, and from locations external to JASMIN, `my-os-tenancy-o.s3-ext.jc.rl.ac.uk` should be
used - note the `https://` prefix and additional `-ext`.
(Where `my-os-tenancy-o` needs to be replaced with your tenancy name)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#urls-for-internal-and-external-access,616,89
Using s3cmd,"`s3cmd` is a command line tool provided by Amazon to work with S3 compatible
Object Storage. It is installed on JASMIN, both on the sci-machines and on
LOTUS. It is a little more complicated to use than the MinIO client, but is
more powerful and flexible. For full details on `s3cmd`, see the [s3tools.org
website](http://s3tools.org).
To configure `s3cmd` to use the JASMIN object store, you need to create and
edit a `~/.s3cfg` file. To access the `my-os-tenancy-o` tenancy (where ""my-os-
tenancy-o"" needs to be replaced with your tenancy name), the following should
be in the `~/.s3cfg `file:
access_key = <access key generated above>
host_base = my-os-tenancy-o.s3.jc.rl.ac.uk
host_bucket = my-os-tenancy-o.s3.jc.rl.ac.uk
secret_key = <secret key generated above>
use_https = False
signature_v2 = False
or, from an external tenancy or locations outside of JASMIN:
access_key = <access key generated above>
host_base = my-os-tenancy-o.s3-ext.jc.rl.ac.uk
host_bucket = my-os-tenancy-o.s3-ext.jc.rl.ac.uk
secret_key = <secret key generated above>
use_https = True
signature_v2 = False
To see which commands can be used with s3cmd, type:
s3cmd -h
To list a tenancy's buckets:
s3cmd ls
To list the contents of a bucket:
s3cmd ls s3://<bucket_name>
Make a new bucket:
s3cmd mb s3://<bucket_name>
`s3cmd` uses PUT and GET nomenclature for copying files to and from the object
store.  
To copy a file to a bucket in the object store:
s3cmd put <file name> s3://<bucket_name>
To copy a file from a bucket in the object store to the file system:
s3cmd get s3://<bucket_name>/<object_name> <file_name>
For more commands and ways of using `s3cmd`, see the [s3tools
website](https://s3tools.org/s3cmd).
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#using-s3cmd,1694,253
Using the MinIO client,"The MinIO Client is a command line tool to connect to object stores (among
other types of file storage) and interface with it as you would with a UNIX
filesystem. As such, many of the UNIX file management commands found in
standard installations of the OS are found within this client ( `ls`, `cat`,
`cp`, `rm` for example).
There are a number of ways to install this client as shown in the [quickstart
guide](https://docs.min.io/docs/minio-client-quickstart-guide.html). Methods
include: docker, Homebrew for macOS, wget for Linux and instructions for
Windows. Follow these steps to get the client installed on the relevant
system.
MinIO Client is not installed on JASMIN, but users can download and install it
to their own user space, following the instructions for ""64-bit Intel"" (linux-
amd64) in the MinIO quickstart guide. Below is an example to install it into
the `bin` directory in your user space
mkdir ~/bin
wget https://dl.min.io/client/mc/release/linux-amd64/mc ~/bin
chmod u+x ~/bin/mc
You can then add the `~/bin` directory to the PATH environment variable in
your `~/.bashrc` file to allow `mc` to be accessed from anywhere on JASMIN.
# User specific aliases and functions
PATH=$PATH:$HOME/bin
To configure the client with the JASMIN object store, create an access key and
secret as documented above and insert them into the command:
mc config host add [ALIAS] [S3-ENDPOINT] [TOKEN] [S3 SECRET KEY]
The ALIAS is the name you'll reference the object store when using the client.
To demonstrate, if the alias was set to ""jasmin-store"", displaying a specific
bucket in the object store would be done in the following way:
mc ls jasmin-store/my-bucket
The commands available in the client are documented in the quickstart guide
(linked above). Copying an object from one place to another is very similar to
a UNIX filesystem:
mc cp jasmin-store/my-bucket/object-1 jasmin-store/different-bucket/
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#using-the-minio-client,1907,295
From Python,"One method of accessing the object store from Python is using
[s3fs](https://s3fs.readthedocs.io/en/latest/index.html). This library builds
on
[botocore](https://botocore.amazonaws.com/v1/documentation/api/latest/index.html)
but abstracts a lot of the complexities away. There are three main types of
object in this library:
[S3FileSystem](https://s3fs.readthedocs.io/en/latest/api.html#s3fs.core.S3FileSystem),
[S3File](https://s3fs.readthedocs.io/en/latest/api.html#s3fs.core.S3File) and
[S3Map](https://s3fs.readthedocs.io/en/latest/api.html#s3fs.mapping.S3Map).
The filesystem object is used to configure a connection to the object store.
Note: it's **strongly** recommended to store the endpoint, token and secret
outside of the Python file, either using environment variables or an external
file. This object can be used for lots of the operations which can be done
MinIO:
with open('jasmin_object_store_credentials.json') as f:
    jasmin_store_credentials = json.load(f)
    jasmin_s3 = s3fs.S3FileSystem(
        anon=False, secret=jasmin_store_credentials['secret'],
        key=jasmin_store_credentials['token'],
        client_kwargs={'endpoint_url': jasmin_store_credentials['endpoint_url']}
    )
    my_object_size = jasmin_s3.du('my-bucket/object-1')
Please note in the example above, the `jasmin_object_store_credentials.json`
file would look along the lines of:
{
    ""token"": ""<access key generated above>"",
    ""secret"": ""<secret key generated above>"",
    ""endpoint_url"": ""http://my-os-tenancy-o.s3.jc.rl.ac.uk""
}
or, from an external tenancy or locations outside of JASMIN:
{
    ""token"": ""<access key generated above>"",
    ""secret"": ""<secret key generated above>"",
    ""endpoint_url"": ""https://my-os-tenancy-o.s3-ext.jc.rl.ac.uk""
}
S3File is used for dealing with individual files on the object store within
Python. These objects can read and written to and from the store:
file_object = s3fs.S3File(jasmin_s3, 'my-bucket/object-1', mode='rb')
# refresh can be set to True to disable metadata caching
file_metadata = file_object.metadata(refresh=False)
# Writing data to variable in Python
file_object.write(data)
# Data will only be written to the object store if flush() is used. This can be executed in S3FS source code if the buffer >= the blocksize
file_object.flush()
S3Map is very useful when using [xarray](http://xarray.pydata.org/en/stable/)
to open a number of data files (netCDF4 for example), and turn them into the
zarr format ready to be stored as objects on the store. The function for this
can store a `.zarr` file in a POSIX filesystem, or can be streamed directly to
an object store. These datasets can then be opened back into Python:
xarray.open_mfdataset(filepath_list, engine=netcdf4)
s3_store = s3fs.S3Map('my-bucket/zarr-data', s3=jasmin_s3)
dataset.to_zarr(store=s3_store, mode='w')
# Reopening the dataset from object store using xarray
xarray.open_zarr(s3_store, consolidated=True)
",https://help.jasmin.ac.uk/docs/short-term-project-storage/using-the-jasmin-object-store#from-python,2934,327
What is the XFC?,"The Transfer Cache (XFC) provides a large area of temporary storage for
users of JASMIN to store large files and/or a large volume of files on a
short-term basis.
Users are granted a quota of space in their user area on the temporary
storage. When users exceed their quota some of their files will be deleted
automatically.
Users interact with the XFC in two ways:
  1. to initialise their user area, and to get information about their quota, a [command-line client]({{< ref ""install-xfc-client"" >}}) is used.
  2. to move data in and out of their user area, the standard UNIX command-line tools (cp, mkdir, rm, mv, rsync, etc.) are used.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#what-is-the-xfc?,639,110
Quotas,"XFC has two different types of quota. The first is the ""hard quota"" (HQ). This
is the absolute maximum volume of data that can be stored in the user area.
This is expressed in TB (terabytes).
The second type of quota is the ""temporal quota"" (TQ). This is expressed in
units of TB day (terabyte days), and has a time component as well as a data
volume component. For an individual file, the TQ for that file is the product
of the size of the file and the number of days the file has been in the user
area. As an example, if the user moves a 2TB file into their area, after 24
hours it will have used 2TB days of the TQ. After 48 hours it will have used
4TB days and after 1 week it will have used 14TB days.
Finally, any file in the XFC can have a maximum persistence of 365 days. i.e.
if a file is in XFC for more than one year then it will be deleted by the
automatic deletion.
{{<image src=""img/docs/xfc/file-7mwfbT5NdE.png"" caption="""">}}
The above figure shows an example of the quota system in use. The red line
shows the temporal quota used (TQ) and the blue line shows the hard quota
(HQ).
- The user initialises their XFC.
- On day **5** , the user copies a 1 TB file into their XFC
- For the next 4 weeks (on days **12** , **19** , **26** and **31** ) the user copies in another 1 TB file
- The TQ steadily grows until on day **79** it has reached it's limit of 300TB days, the first 1TB file is deleted
- On day **98** another 1TB file is deleted
- On day **120** , the user copies 10TB into their XFC
- On days **122** , **130** and **140** the 1TB files that were copied in on days **19** , **26** and **31** are deleted.
- On day **151** , the 10TB file is deleted.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#quotas,1678,334
Default Quota values:,"The default Hard Quota (HQ) is 10 TB
The default Time Quota (TQ) is 300 TB
So you could store 10TB of data for 30 days before risking the deletion of
data.
Additionally, an overall time limit of 365 days is set for ALL data stored by
a given user. You cannot store any data, no matter how small, for longer than
365 days.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#default-quota-values:,322,64
Automatic deletion,"If users exceed either their temporal quota or hard quota, then files in their
user area will be deleted automatically. The deletion process will delete as
many files as necessary to bring the amount of HQ and TQ below the quotas
allocated to the user. Files will be deleted on an age basis. Those files that
were copied into the user area first will be deleted first, with newer files
deleted after these.
The user can be notified which files will be deleted if they switch the option
to be notified on and supply an email address in the XFC client. Files will be
deleted 24 hours after the notification.
If a file is modified between the notification and the scheduled deletion (24
hours later) then the file will not be deleted. However, the automatic
deletion is relentless and it will choose some other file to delete instead.
XFC is not designed as permanent storage and the automatic deletion process
has been designed to discourage long term storage of files on it.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#automatic-deletion,974,172
Using XFC,"JASMIN provides access to XFC via a command-line client: `xfc`
Once [installed]({{< ref ""install-xfc-client"" >}}) into your `$HOME`
directory (using one of the `sci` servers), the `xfc` client can be run on
either the `sci` (`sci[1-8].jasmin.ac.uk`) or `xfer` (`xfer[12].jasmin.ac.uk`)
servers, but should NOT be run on the high-performance transfer servers
`hpxfer[12].jasmin.ac.uk`.
The client is used only for interacting with the service, but is not needed
for accessing the storage it provides. The storage provided is mounted in most
places across JASMIN: the path to your XFC volume is returned by the client in
one of the steps shown below.
Users are expected to use the [xfer servers]({{< ref ""transfer-servers"" >}})
or a high-performance data transfer service to do any data transfers either
within or in/out of JASMIN. This reduces the load on the `sci` servers which
are for general-purpose interactive computing.
The `xfc` client is used to initialise and then query the status (quota,
scheduled deletions etc) of a user's XFC storage volume:
  1. To see all the available options: `xfc -h`
  2. To initialise your user area: `xfc init`
{{<command user=""user"" host=""sci1"">}}
xfc init
(out)** SUCCESS ** - user initiliazed with:
(out)username: username  
(out)email: user.name@stfc.ac.uk  
(out)quota: 300TB  
(out)path: /work/xfc/vol1/user_cache/username
{{</command>}}
The `path` is the path on the JASMIN system to the user area. Data can be
copied here using standard UNIX command-line tools cp, mv, rsync.
Subdirectories can be created using mkdir. Change read/write permissions on
the directories and files using `chmod`, etc. The user area is just a standard
POSIX directory and so any POSIX commands can be used on it.
  3. To get the user area path again: 
{{<command user=""user"" host=""sci1"">}}
xfc path
(out)/work/xfc/vol1/user_cache/username
{{</command>}}
  4. To set the user email for notifications: 
{{<command user=""user"" host=""sci1"">}}
xfc email --email=user.name@stfc.ac.uk
(out)** SUCCESS ** - user email updated to: user.name@stfc.ac.uk
{{</command>}}
  5. To query the email set for the user: `xfc email `
{{<command user=""user"" host=""sci1"">}}
xfc email
(out)user.name@stfc.ac.uk
{{</command>}}
  6. To switch deletion notifications on / off:
{{<command user=""user"" host=""sci1"">}}
xfc notify
(out)** SUCCESS ** - user notifcations updated to: on
{{</command>}}
  7. To see remaining quota:
{{<command user=""user"" host=""sci1"">}}
xfc quota
(out)------------------------
(out)Quota for user: username 
(out)------------------------
(out)Temporal Quota (TQ)
(out)  Used : 1.7 TB  
(out)  Allocated : 300.0 TB
(out)  Remaining : 298.3 TB
(out)------------------------  
(out)Hard Quota (HQ)
(out)  Used      : 444.9 GB  
(out)  Allocated : 40.0 TB  
(out)  Remaining : 39.6 TB
{{</command>}}
  8. To see which files are scheduled for deletion:
{{<command user=""user"" host=""sci1"">}}
xfc schedule
(out)No files scheduled for deletion
{{</command>}}
  9. To list the files in your user area:
{{<command user=""user"" host=""sci1"">}}
xfc list
(out)user_cache/username/historical/.ftpaccess 
(out)user_cache/username/historical/00README_catalogue_and_licence.txt 
(out)user_cache/username/historical/day/atmos/day/r1i1p1/COPY_CURRENT_20150326.txt
{{</command>}}
Pattern matching can be used to search for a file. This is just a simple
substring search, e.g. `r1i1p1_19500101-19541231.nc`
{{<command user=""user"" host=""sci1"">}}
xfc list -m r1i1p1_19500101-19541231.nc
(out)user_cache/username/historical/day/atmos/day/r1i1p1/v20120907/va/va_day_CMCC-CESM_historical_r1i1p1_19500101-19541231.nc
(out)user_cache/username/historical/day/atmos/day/r1i1p1/v20120907/rsds/rsds_day_CMCC-CESM_historical_r1i1p1_19500101-19541231.nc
(out)user_cache/username/historical/day/atmos/day/r1i1p1/v20120907/prc/prc_day_CMCC-CESM_historical_r1i1p1_19500101-19541231.nc
{{</command>}}
File names are given relative to the `user_cache/ ` directory. To list the
full file path use the `-f ` list option:
{{<command user=""user"" host=""sci1"">}}
xfc list -f
{{</command>}}
  10. To predict when the files will be deleted, if no other files are added to the user area, and none of the current files are removed: ` xfc predict`
{{<command user=""user"" host=""sci1"">}}
xfc predict
(out)Quota is predicted to be exceeded on 21 Aug 2019 14:58 by 252.1 GB
(out)Files predicted to be deleted  
(out)user_cache/username/historical/.ftpaccess
(out)user_cache/username/historical/00README_catalogue_and_licence.txt
(out)user_cache/username/historical/day/atmos/day/r1i1p1/COPY_CURRENT_20150326.txt
{{</command>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#using-xfc,4595,553
Example of initial use,"Below is a list of commands the user might use in their initial session with
XFC.
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#example-of-initial-use,82,16
initial setup,"{{<command user=""user"" host=""sci1"">}}
xfc init
xfc path
xfc email --email=user.name@email.com
xfc notify
{{</command>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#initial-setup,120,13
query the quota,"{{<command user=""user"" host=""sci1"">}}
xfc quota 
xfc predict 
xfc schedule
{{</command>}}
",https://help.jasmin.ac.uk/docs/short-term-project-storage/xfc#query-the-quota,90,10
'Additional software',"This article provides details of additional packages that exist under the
`/apps/jasmin/` directory which is available on all scientific analysis
servers and on the LOTUS batch cluster on JASMIN.
The `/apps/jasmin/` directory has been provided as a home for additional
software packages that are not installed within either [Jaspy]({{< ref ""jaspy-envs"" >}}) or [""jasmin-sci""]({{< ref ""jasmin-sci-software"" >}}) environments.
This page details which packages are available along with details of how they
are managed and accessed.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/additional-software,529,75
Community packages under: /apps/jasmin/,"Software installed as _community packages_ are provided, and maintained, by
developers outside the CEDA/JASMIN Team. If you have queries about using
community packages on JASMIN then please contact the JASMIN Helpdesk and we
will forward them to the team that supports that specific package on JASMIN.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/additional-software#community-packages-under:-/apps/jasmin/,302,46
ESMValTool,"The Earth System Model Evaluation Tool (ESMValTool) is a community diagnostics
and performance metrics tool for the evaluation of Earth System Models (ESMs)
that allows for routine comparison of single or multiple models, either
against predecessor versions or against observations. See the [ESMValTool on
JASMIN page]({{< ref ""community-software-esmvaltool"" >}}) for more info.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/additional-software#esmvaltool,379,52
Overview,"`checksit` is a tool that checks the structure and content of a file against a range of available checks. Checks can be made using either ""spec"" files defining rules that objects within a file must meet, or comparison against a template file.
Whilst initial development focussed around the standards developed for NCAS data, checksit can be adapted to check files against any desired requirements.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-checksit#overview,398,64
Features,"Currently, checksit can:
- use spec files and define rules against which to check files
- check a file against a given template file
- check for compliance against `NCAS-GENERAL-2.0.0` and `NCAS-IMAGE-1.0` standards
- output in either ""standard"" mode or a one line ""compact"" mode
- summarise output from multiple ""compact"" mode file checks
Work in progress includes:
- check for compliance against other NCAS standards (e.g. `NCAS-RADAR`)
- check against future versions of standards (`NCAS-GENERAL-2.1.0` and `NCAS-IMAGE-1.1`)
- allow user defined specs and rules
- Visit the GitHub repository linked at the bottom of this page for further information on what is being worked on.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-checksit#features,681,106
Use on JASMIN,"`checksit` is available on all `sci` machines. To check a file in your current directory:
{{<command>}}
/apps/jasmin/community/checksit/checksit check name-of-file.ext
{{</command>}}
For a complete guide on how to use checksit, please visit the documentation site linked at the bottom of this page.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-checksit#use-on-jasmin,299,41
Further information,"Documentation: https://checksit.readthedocs.io/en/latest/
GitHub: https://github.com/cedadev/checksit",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-checksit#further-information,101,4
'Community Software,"ESMValTool is installed on JASMIN as a _community package_. This article
provides:
- a brief overview of the ESMValTool software
- a description of the main features of the tool
- a quick-start for using ESMValTool on JASMIN
- links to further information
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool,256,43
Overview of ESMValTool,"The Earth System Model Evaluation Tool (ESMValTool) is a community diagnostics
and performance metrics tool for the evaluation of Earth System Models (ESMs)
that allows for routine comparison of single or multiple models, either
against predecessor versions or against observations. The priority of the
effort so far has been to target specific scientific themes focusing on
selected Essential Climate Variables, a range of known systematic biases
common to ESMs, such as coupled tropical climate variability, monsoons,
Southern Ocean processes, continental dry biases and soil hydrology-climate
interactions, as well as atmospheric CO2 budgets, tropospheric and
stratospheric ozone, and tropospheric aerosols.
The tool is being developed in such a way that additional analyses can easily
be added. A set of standard recipes for each scientific topic reproduces
specific sets of diagnostics or performance metrics that have demonstrated
their importance in ESM evaluation in the peer-reviewed literature. The
ESMValTool is a community effort open to both users and developers encouraging
open exchange of diagnostic source code and evaluation results from the CMIP
ensemble. This will facilitate and improve ESM evaluation beyond the state-of-
the-art and aims at supporting such activities within the Coupled Model
Intercomparison Project (CMIP) and at individual modelling centres.
Ultimately, we envisage running the ESMValTool alongside the Earth System Grid
Federation (ESGF) as part of a more routine evaluation of CMIP model
simulations while utilizing observations available in standard formats
(obs4MIPs) or provided by the user.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool#overview-of-esmvaltool,1639,236
"Installation as a ""community package"" on JASMIN","ESMValTool is installed on JASMIN as a _community package_. This means it is
provided, and maintained, by developers outside the CEDA/JASMIN Team. If you
have queries about using ESMValTool _on JASMIN_ then please contact the JASMIN
Helpdesk and we will forward them to the team that supports this package on
JASMIN.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool#installation-as-a-""community-package""-on-jasmin",317,51
Main Features,"ESMValTool has the following features:
- Facilitates the complex evaluation of ESMs and their simulations submitted to international Model Intercomparison Projects (e.g., CMIP).
- Standardized model evaluation can be performed against observations, against other models or to compare different versions of the same model.
- Wide scope: includes many diagnostics and performance metrics covering different aspects of the Earth System (dynamics, radiation, clouds, carbon cycle, chemistry, aerosol, sea-ice, etc.) and their interactions.
- Well-established analysis: standard namelists reproduce specific sets of diagnostics or performance metrics that have demonstrated their importance in ESM evaluation in the peer-reviewed literature.
- road documentation: a user guide (Eyring et al., 2015); SPHINX; a log-file is written containing all the information of a specific call of the main script: creation date of running the script, version number, analyzed data (models and observations), applied diagnostics and variables, and corresponding references. This helps to increase the traceability and reproducibility of the results.
- High flexibility: new diagnostics and more observational data can be easily added.
- Multi-language support: Python, NCL, R... other open-source languages are possible.
- CF/CMOR compliant: data from many different projects can be handled (CMIP, obs4mips, ana4mips, CCMI, CCMVal, AEROCOM, etc.). Routines are provided to CMOR-ize non-compliant data.
- Integration in modelling workflows: for EMAC, NOAA-GFDL and NEMO, can be easily extended.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool#main-features,1574,218
Quick User Guide on JASMIN,"The latest version of ESMValTool is available for users on JASMIN and can be
accessed via a standard module:
{{<command user=""user"" host=""sci1"">}}
module load esmvaltool
{{</command>}}
To run a yaml-formatted recipe:
{{<command user=""user"" host=""sci1"">}}
esmvaltool run recipe.yml
{{</command>}}
For a complete guide on how to configure the tool, set up and run available
diagnostic recipes please consult the documentation at:
<https://docs.esmvaltool.org/en/latest/>
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool#quick-user-guide-on-jasmin,469,61
Further information,"- Documentation: <https://docs.esmvaltool.org/en/latest/>
- Website: <https://www.esmvaltool.org/index.html>
- GitHub: <https://github.com/ESMValGroup/ESMValTool>
[](https://github.com/ESMValGroup/ESMValTool)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/community-software-esmvaltool#further-information,209,10
Introduction,"This article describes two types of software environments that you can create
in order to install packages for your own use on JASMIN. Typical examples why
you may wish to do this is if you have asked us to add packages to [Jaspy]({{<
ref ""jaspy-envs"" >}}) but wish to make use of them before the next release, or
if they are not likely to be relevant to other users.
Separate pages explain the details of how to create and install [Python
virtual environments]({{< ref ""python-virtual-environments"" >}}) and [Conda
environments]({{< ref ""creating-and-using-miniconda-environments"" >}}). This
page gives an overview of what they are, and how to choose which one is most
suitable for your needs.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#introduction,695,113
Description of Python virtual environments and Conda environments,"- A Python virtual environment is a relatively lightweight environment, which is used for running Python packages, typically installed using the ""pip"" installer from the Python Package Index ([pypi](https://pypi.org/)) or locally from Python source containing a ""setup.py"" file. This enables you to install packages in your home directory without writing to the underlying Python installation itself (for example when you do not have write permission), and you can have any number of separate virtual environments and ""activate"" the relevant one when needed. When you run ""pip"" to install a Python package, additional Python packages may be installed automatically in order to satisfy dependencies. Depending on the package being installed, if it requires compiled libraries to accompany it, it may try to compile these locally, but depending what development libraries are available, occasionally this might not succeed.
- By contrast, a Conda environment is a much bulkier, more fully featured environment, using the conda package manager. This enables the installation of packages from conda channels, typically [conda-forge](https://conda-forge.org/), which are not restricted to being Python packages. Where packages contain compiled libraries, these are generally available as pre-compiled binaries. As with python virtual environments, you can have any number of these environments and activate the required one. When you run the conda installer, similarly it will install whatever additional packages are required in order to satisfy dependencies. (It is also possible to use the pip installer when working with conda environments.)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#description-of-python-virtual-environments-and-conda-environments,1641,238
Environment size,"To take an example of the size, a new Python virtual environment without
additional packages occupies about 10MB and contains under 1000 files (maybe
approximately twice this if using the `--system-site-packages` option
explained in more detail elsewhere), whereas as a new conda base environment
occupies about 400MB and contains over 20,000 files.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#environment-size,350,52
Installation examples,"To give an example of installing a Python package, the `numexpr` library is a
numerical expression evaluator for NumPy. It is available as a pip package
called `numexpr`, and also as a conda package called `numexpr`. (For some
packages, the two may have slightly different names.) It can be installed
successfully into either a Python virtual environment using `pip install
numexpr` or a conda environment using `conda install numexpr`. In either case,
the `numpy` package on which it depends, amongst other things, will be
installed automatically if required.
To give an example of installing a non-python package, `zsh` is a Unix shell
which combines various features of bash and csh. You cannot install this using
`pip install` because it is not a python package, but it is available on
conda-forge, and can be installed into a conda environment using `conda
install zsh`.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#installation-examples,876,142
Combining environments,"We already provide a wide range of packages via [Jaspy]({{< ref ""jaspy-envs""
>}}). This is in itself a conda environment, and it is important to note that
although you can use a Python virtual environment to install additional
packages when using a conda environment, you cannot have more than one conda
environment activated at the same time.
- When using Python virtual environments, you are advised to start by activating a Jaspy environment, as this will ensure that you are using a version of Python that we support, as well as significantly increasing the range of compiled libraries available during the ""pip install"" process. You can also use the ""--system-site-packages"" option to access the Python packages provided by Jaspy itself, as described in more detail on the [virtual environments]({{< ref ""python-virtual-environments"" >}}) help page.
- However, if you choose to use your own conda environment, then you will activate it _instead_ of Jaspy, and you will need to install into it _everything_ that you will need to accompany the package which you wish to use.
Note that because you can install `pip` packages into conda environment, it is
not generally useful to create a virtual environment in order to extend your
own private conda environment. The reason for creating one to extend Jaspy is
that users do not have write permission to add packages to Jaspy itself.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#combining-environments,1385,227
Choosing between a Python virtual environment and a Conda environment,"Because python virtual environments are much more lightweight that conda
environments, and also give you access to packages that we provide via Jaspy,
we would generally recommend that you start by trying a Python virtual
environment. However, this might prove not to be possible, for example
because:
- The package that you wish to install is not available via PyPI (perhaps it is not a Python package).
- The package that you wish to install depends on compiled libraries that do not build successfully during a ""pip install"". Often pre-compiled versions will be available from conda-forge.
If you do decide to install a conda environment, then remember to install
additional packages that you might otherwise have used via Jaspy.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/conda-environments-and-python-virtual-environments#choosing-between-a-python-virtual-environment-and-a-conda-environment,733,119
Creating and using miniconda environments,"On JASMIN, we provide a wide range of packages via the [Jaspy]({{< ref ""jaspy-envs"" >}}) environment (which is itself a Conda environment). This page gives
detail on how to create and use your own personal Conda environments via the
miniconda installer, as an alternative to the use of Jaspy.
To decide whether you should use a _Python virtual enviro_ _nment_ or a _Conda
environment_ , first see the page: [overview of software environments]({{< ref
""conda-environments-and-python-virtual-environments"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments,510,76
Obtaining miniconda,"In order to create your own conda environments, you will first need to
download the [miniconda](https://docs.conda.io/en/latest/miniconda.html)
installer. It is possible as an alternative to use the full
[Anaconda](https://www.anaconda.com/products/distribution), but your initial
base environment will be much bigger if you do that (at time of writing this
installs 5GB, compared to 400MB with miniconda) so we suggest the use of
miniconda.
This can be downloaded using:
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#obtaining-miniconda,547,67
Deactivating Jaspy,"You cannot have your own conda environment activated at the same time as
Jaspy, so it is recommended that if you have loaded the jaspy module, then you
start by typing:
module unload jaspy
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#deactivating-jaspy,189,34
Creating a base environment,"You can run the installer by typing:
` bash Miniconda3-latest-Linux-x86_64.sh `
You will be asked to confirm the licence agreement, to choose an installation
location, and to decide whether it should run ""conda init"". It is recommended
that you:
  * Accept the default location (~/miniconda3). If you need to change this, see the section ""Varying the installation location"" near the end of this page for more info.
  * Say _no_ to the question about ""conda init"", because saying yes will cause it to add lines to your ~/.bashrc file causing your base environment to be activated every time you log in, which may interfere with the use of Jaspy. If you say no, you can still follow the instructions below when you wish to activate your base environment.  
(Add the `-b` option at the end of the above command to run the installer in
batch mode, which will also skip the ""conda init"". Or add `-h` to see help on
other available command-line options.)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#creating-a-base-environment,949,164
Activating the base environment,"Assuming that you made the choices recommended above when running the
installer, you should type the following in order to activate the base
environment:
source ~/miniconda3/bin/activate
(You may encounter documentation elsewhere which suggests ""conda activate""
instead, but the above command is a workaround for the fact that you have not
run ""conda init"", the reasons for which are explained above.)
Your command prompt will then change to include ""(base) "" at the start, in
order to remind you that this environment is activated. You can deactivate the
environment by typing:
conda deactivate
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#activating-the-base-environment,596,92
Creating and activating a sub-environment,"Although once you have activated the base conda environment, you can in
principle start to install packages immediately, your use of conda will
generally be better organised if you do not install packages directly into the
base environment, but instead use a named sub-environment. You can have
multiple sub-environments under a single base environment, and activate the
one that is required at any one time. Unless you install packages directly
into the base environment, your sub-environments will work independently.
To create a named environment (for example, called ""myenv""), ensure that the
base environment is activated (the command prompt should start with ""(base)
""), and type:
conda create -n myenv
It will show the proposed installation location, and once you answer the
prompt to proceed, will do the installation. If you have followed these
instruction, this location should be
`/home/users/<your_username>/miniconda3/envs/myenv`. You can alternatively
give it a different location using the option `-p <path>` instead of `-n
<name>`.
Once you have created your sub-environment, you can activate it using `conda
activate <name>` for example:
conda activate myenv
The command prompt will then change (e.g. to start with ""(myenv) "") to reflect
this. Typing `conda deactivate` once will return you to the base environment;
typing it a second time will deactivate conda completely (as above).
conda env list
 will list your environments.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#creating-and-activating-a-sub-environment,1447,219
Installing conda packages,"Once you have activated a named environment, you can install packages with the
`conda install` command, for example:
conda install gcc
You can also force particular versions to be installed. See the [conda cheat
sheet](https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-
cheatsheet.pdf) for details.
To list the packages installed in the currently activated environment, you can
type `conda list`.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#installing-conda-packages,443,53
Running packages from your conda environment,"In order to run packages from a conda environment that you installed
previously, you will first need to activate the environment in the session
that you are using. This means repeating some of the commands typed above. Of
course, you will not need to repeat the steps to create the environment or
install the software, but the following may be needed again:
module unload jaspy
source ~/miniconda3/bin/activate`
conda activate myenv`
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#running-packages-from-your-conda-environment,434,70
Installing pip packages,"Many python packages that are available via PyPI are also available as conda
packages in conda-forge, and it is generally best to use these via ""conda
install"" as above.
Nonetheless, you can also install pip packages (as opposed to conda packages)
into your conda environment. However, first you should type:
conda install pip
before typing the desired commands such as
pip install numpy
If you do not install pip into your sub-environment, then either:
  * your shell will fail to find the `pip` executable, or
  * your shell will find `pip` in your base environment, which will lead to pip packages being installed into the base environment, resulting in potential interference between your conda environments
Explicitly installing pip into your sub-environment will guard against this.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#installing-pip-packages,789,125
The mamba installer,"When you install packages into a conda environment, the installer first has to
_resolve_ the environment. This means using available package dependency
metadata in order to decide which versions of packages to install, so as to
end up with a self-consistent environment. If you are working with a large
environment and/or working with legacy versions of packages, sometimes (in our
experience with preparing Jaspy environments) the conda installer can be very
slow and use a lot of memory, and may fail to resolve the environment. In this
situation, we have tended to find better performance with the
[mamba](https://github.com/mamba-org/mamba) installer, which uses a different
algorithm and is implemented in C++ rather than Python, for speed.
To use mamba, you would first type `conda install mamba`, and then you can use
`mamba install <package_name>` instead of `conda install <package_name>` in
order to install the other package(s) of interest. You would still use the
`conda` command for other operations such as `conda activate`.
If you will be using mamba in multiple sub-environments, then it might make
sense to install mamba into the base environment rather than each sub-
environment separately, despite our general suggestion of installing packages
into named sub-environments. To do this, you might need to use `conda
deactivate` to return to the base environment before installing mamba, then
re-activate your sub-environment to install other packages.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#the-mamba-installer,1470,224
Cloning a conda environment,"There can be occasions when you wish to create a conda environment which is
based on the contents of an existing environment. An example when you might
wish to do this is in order to create an environment of your own which is
based on Jaspy but with certain changes such as the addition or removal of
certain packages. (Recall that your environment cannot be activated at the
same time as Jaspy.)
To do this, you can export a list of packages to a YAML file and use this file
to create the new environment -- as follows:
  * first activate the conda environment that you wish to clone (for Jaspy, load the jaspy module)
  * export a list of contents to a YAML file (for example ""environment.yml"") by typing  
conda env export > environment.yml
  * deactivate this environment (or as the case may be, unload the jaspy module)
  * ensure that the relevant base environment is activated
  * create the new environment (for example ""my_new_env"") by using:  
conda env create -n my_new_env -f environment.yml
Note the use of ""conda env create"", rather than ""conda create"" as above.  
(As above, if you have installed mamba, you can also use ""mamba"" in place of
""conda"" at this stage.)
You might also edit the YAML file before using it to create the environment if
you do not want an exact clone -- for example, adding packages, removing
packages that are not of relevance, or removing version requirements in order
to give the environment solver more flexibility about what versions to install
(for example if you do not require particular legacy versions, or if the
versions in the original environment are no longer available).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#cloning-a-conda-environment,1625,281
Varying the installation location,"(This is the section that is referred to above, where running the Miniconda
installer is discussed.)
The default installation location offered by the installer for your base
environment will be `~/miniconda3` (that is, a ""miniconda3"" subdirectory of
your home directory). We recommend accepting this default, or using another
location under your home directory. It is possible to change this, but note
that a conda environment can have tens of thousands of files and that group
workspaces on JASMIN will generally perform poorly for this use case. If you
need to make a conda environment which is shared with collaborators, you may
need to request a [small files GWS]({{< ref ""share-software-envs"" >}}) as
these will give better performance.
If you are creating a conda environment for very short-term testing only, you
may find best performance using `/tmp` due to the large number of files.
However, you may need several gigabytes, which is too big for the /tmp areas
on most of the ""sci"" machines at time of writing, although sci3, sci6 and sci8
have larger /tmp areas. Choose an appropriate machine, make use of the `df`
command to check available disk space, and ensure that you do not fill up /tmp
as this would impact negatively on other users.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/creating-and-using-miniconda-environments#varying-the-installation-location,1252,208
Introduction,"This article introduces {{<link ""https://geocat-viz.readthedocs.io/en/latest/"">}}geocat{{</link>}} as a replacement on JASMIN for NCAR Command Language (NCL) which is now deprecated.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/geocat-replaces-ncl#introduction,183,19
NCL now deprecated,"NCL is now deprecated by NCAR (see [this announcement](https://www.ncl.ucar.edu/Document/Pivot_to_Python/)),
there is no Rocky 9 version available, so we will not be providing it when JASMIN moves from CentOS to using
Rocky 9 in the next few months. The plan is to add to Jaspy the `geocat-viz` package, which is NCAR's Python
replacement for NCL. 
",https://help.jasmin.ac.uk/docs/software-on-jasmin/geocat-replaces-ncl#ncl-now-deprecated,349,54
Installation in a conda environment,"To give you a chance now to familiarise yourself with `geocat-viz`, here are some
instructions for how you could install it in a Conda environment under your own home directory.
{{<alert type=""info"">}}
Note that such an environment cannot be activated at the same time as Jaspy.
{{</alert>}}
Total disk space required is 3.2GB.
Commands marked with `#*` below will be needed again in order to activate the environment in later sessions.
Deactivate `jaspy` in this session:
{{<command user=""user"" host=""sci1"">}}
module unload jaspy     ##*
{{</command>}}
Download `miniforge` installer:
{{<command user=""user"" host=""sci1"">}}
wget <https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh>
{{</command>}}
Install base environment:
{{<command user=""user"" host=""sci1"">}}
bash Miniforge3-Linux-x86_64.sh
{{</command>}}
Accept the default answers to the questions, saying no to the question about `conda init`.
Activate the base environment:
{{<command user=""user"" host=""sci1"">}}
source ~/miniforge3/bin/activate  ##*
{{</command>}}
Create and activate an environment:
{{<command user=""user"" host=""sci1"">}}
mamba create -n my-geocat-env
conda activate my-geocat-env    ##*
{{</command>}}
Install the packages:
{{<command user=""user"" host=""sci1"">}}
mamba install geocat-viz geocat-datafiles
{{</command>}}
Try one of the examples from:\
https://geocat-examples.readthedocs.io/en/latest/gallery/index.html
{{<command user=""user"" host=""sci1"">}}
wget https://geocat-examples.readthedocs.io/en/latest/_downloads/efafc109e5344e8e33052ad5213ee4be/NCL_box_1.py
python NCL_box_1.py
{{</command>}}
(should display a plot)
Full documentation is at <https://geocat-viz.readthedocs.io/en/latest/>",https://help.jasmin.ac.uk/docs/software-on-jasmin/geocat-replaces-ncl#installation-in-a-conda-environment,1713,180
IDL,"This article explains how to:
- use the IDL software on JASMIN 
- run these tools on the scientific analysis servers and LOTUS
- make efficient use of the IDL licences
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl,168,31
What is IDL?,"[IDL](https://www.nv5geospatialsoftware.com/Products/IDL) stands for
Interactive Data Language. It is a licensed data manipulation toolkit made
available on JASMIN.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#what-is-idl?,165,17
Availability of IDL on JASMIN,"IDL is available on all [scientific analysis servers]({{< ref ""sci-servers"">}}) and [LOTUS](http://help.ceda.ac.uk/category/107-batch-computing-on-lotus).
{{<alert type=""info"">}}
The related software `MIDL` is no longer available on JASMIN
{{</alert>}}
To get started with **IDL**, login to one of scientific analysis servers and
do as follows:
{{<command user=""user"" host=""sci1"">}}
module load idl
idl
(out)IDL Version 8.5 (linux x86_64 m64). (c) 2015, Exelis Visual Information Solutions, Inc., a subsidiary of Harris Corporation.
(out)Installation number: 406672.
(out)Licensed for use by: Science & Technology Facilitie
{{</command>}}
You can then type commands at the `IDL` prompt
{{<command prompt=""IDL>"">}}
print,1+4
(out)  5
exit
{{</command>}}
For help on the `idl` module you can type the following :
{{<command user=""user"" host=""sci1"">}}
module help idl
(out)----------- Module Specific Help for 'idl/8.2' --------------------  	
(out)         Adds IDL 8.2 to your environment variables,  
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#availability-of-idl-on-jasmin,1016,128
Making efficient use of IDL development licences,"We have a large pool of **run-time** licences but a much more limited pool of
**development** licences. In each case, these consist of floating licences shared
between JASMIN sci machines and the LOTUS cluster.
Users are welcome to run multiple instances of IDL code, but for that purpose
please make use of the run-time licences by compiling your code using a **single**
development session and then running the pre-compiled code using the `-rt`
flag. An example of this is shown in the next section (below).
Please try not to run more than one or two simultaneous IDL development
sessions. However, for licence purposes, each unique combination of username,
hostname, and `$DISPLAY` variable counts as a single session. So for example,
if you run idl (development mode) in one window, then suspend it with {{<kbd ""CTRL-Z"">}} and
start another development session in the same window, this still is only
counted as one session by the licence server because the username, hostname,
and $DISPLAY are all identical between the two processes. But if you ""ssh"" in
on two different windows, probably the `$DISPLAY` will differ between the two
windows (e.g. `localhost:10` and `localhost:11`), so if you start idl
development sessions in each window they will require separate licences.
To see what licences you and others are using, you can use the following
sequence of commands:
{{<command>}}
module add idl/8.2
lmstat -a
{{</command>}}
When interpreting the numbers, note that a single session is counted as 6
licences.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#making-efficient-use-of-idl-development-licences,1517,244
Using IDL on LOTUS (via the run-time Licences),"IDL run-time licences are available for use on the LOTUS cluster. In order to
specify use of the run-time licences please follow the instructions here. You
need to compile your IDL code in order to run in run-time mode.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#using-idl-on-lotus-(via-the-run-time-licences),220,39
Example program,"The example program, ""foo"", depends on some other functions.
======== foo.pro =======
    pro foo  
    print, doubleit(10) end 
========================
===== doubleit.pro ===== 
function doubleit, n   
return, two() * n 
end 
========================
======= two.pro ======== 
function two   
return, 2 
end 
========================
You must save a compiled version of the code in order to run it.
1\. Compile the program:
Compiles top-level routine only
{{<command prompt=""IDL>"">}}
.compile foo
(out)% Compiled module: FOO.
{{</command>}}
2\. Use resolve_all to compile routines it depends on:
Recursively search for and compile modules called 
{{<command prompt=""IDL>"">}}
resolve_all
(out)% Compiled module: DOUBLEIT. 
(out)% Compiled module: TWO.
{{</command>}}
3\. Save all compiled routines to a file:
{{<command prompt=""IDL>"">}}
save, /routines, file='foo.sav'
{{</command>}}
4\. To run the program, using a run-time licence only:
{{<command user=""user"" host=""sci1"">}}
idl -rt=foo.sav 
(out)IDL Version 8.4 (linux x86_64 m64). (c) 2014, Exelis Visual Information Solutions, Inc.
(out)Installation number: 406502. 
(out)Licensed for use by: Science & Technology Facilities
(out)  20
{{</command>}}
{{<alert type=""info"">}}Using` -vm=` instead of `-rt=` opens the save file in the IDL
virtual machine. No run-time licence is required, but a splash screen must
be dismissed interactively, so it is not suitable for queues on the
cluster.
{{</alert>}}
To see what routines are present in the save file:
{{<command prompt=""IDL>"">}} 
.reset_session     <=== removes any existing compiled modules  
help               <=== show compiled modules (and variables); there shouldn't be any 
(out)% At $MAIN$           
(out)Compiled Procedures:
        (out)$MAIN$  
(out)Compiled Functions:  
restore,'foo.sav'   <=== load contents of save file  
help 
(out)% At $MAIN$          
(out)Compiled Procedures:
        (out)$MAIN$  FOO                     <=== this was loaded from foo.sav  
(out)Compiled Functions: 
        (out)DOUBLEIT    TWO            <=== so were these
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#example-program,2084,261
Passing arguments,"You can also pass arguments in to your code as follows:
In your code, use function `command_line_args`, for example:
argsarray = command_line_args(count = nparams)
Call the code with -args flag:
{{<command user=""user"" host=""sci1"">}}
idl -rt=foo.sav -args 10 20 30
{{</command>}}
`command_line_args` returns a string array, so convert type as required, e.g. `n = fix(argsarray[0]) `
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#passing-arguments,382,55
Further reading,"- Vendor documentation: {{<link ""https://www.nv5geospatialsoftware.com/docs/using_idl_home.html"">}}Using IDL{{</link>}} (although may be for a newer version than on JASMIN)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/idl#further-reading,173,16
Introduction,"This article describes the `jasmin-sci` software environment on JASMIN. It
covers the following topics:
- Overview of the `jasmin-sci` software environment
- Activating and deactivating the `jasmin-sci` environment
- Using the `jasmin-sci` environment with Jaspy
",https://help.jasmin.ac.uk/docs/software-on-jasmin/jasmin-sci-software-environment#introduction,263,35
"Overview of the ""jasmin-sci"" software environment","The `jasmin-sci` software environment is intended as a supplement to 
[Jaspy]({{<ref ""jaspy-envs"" >}}) and contains extra software packages for use with
scientific data analysis which, for various reasons, are not provided as part
of Jaspy itself. These packages are generally installed on the same
machines where Jaspy is available, for example, the `sci` machines
(e.g. `sci1.jasmin.ac.uk`) and LOTUS nodes, but not
the login machines. It is not intended for the `jasmin-sci` environment 
itself to provide a complete suite of analysis software.
The packages included in `jasmin-sci` are provided via RPMs. A list of
explicitly included packages can be seen using the command `rpm -qR jasmin-sci`,
although some additional packages may be installed to satisfy
dependencies.
The packages fall into two categories:
- Packages provided by standard RPM repositories (example ""gnuplot"") - these are installed into ordinary system paths (such as `/usr/bin/gnuplot` for the gnuplot program) and require no special setup in order to run. So if you are on a relevant machine, you should just be able to type `gnuplot`.
- Packages which we have built locally for use on JASMIN (although most are third-party software). To avoid any potential later conflicts with standard packages, they are installed under the path `/opt/rh/jasmin-sci/` rather than in system paths. 
Also, the RPM package names, as can be seen in the above `rpm -qR jasmin-sci` command,
are prefixed with `jasmin-sci-`. So for example, the local build of `nccmp` (a program to compare netCDF files) is a package called `jasmin-sci-nccmp`, and the executable is at `/opt/rh/jasmin-sci/root/usr/bin/nccmp`. Before these packages can be conveniently used, it is necessary to ""activate"" the environment as described below, so that when you type e.g. ""nccmp"" the relevant files can be found.
Unlike the Jaspy environments, `jasmin-sci` can only provide one version of each
package at a time, so the versions are subject to change when updates are
done. If we anticipate any important changes, then we will notify JASMIN users
by email.
In a few cases, software packages are provided in `jasmin-sci` which are also
provided in Jaspy. This is only done where other RPM packages depend on it.
For example, the netcdf package is provided in Jaspy, but is also installed as
an RPM because the nccmp package requires it. This means that copies of the
netCDF libraries exist both in Jaspy (for the full path, type `nc-config --libs` after
activating Jaspy) and also under `/usr/lib64` (from the RPM). When
linking code to the netCDF library, it is recommended to use the one in Jaspy
because this will be version controlled. Also, although the `jasmin-sci`
software might provide some software that happens to be implemented in Python,
any such Python modules are not intended to be imported into your own code.
For Python development, packages from Jaspy should be used.
The development for `jasmin-sci` takes place via the [extra-sci-packages](https://github.com/cedadev/extra-sci-packages) GitHub repository,
and an associated [issues](https://github.com/cedadev/extra-sci-packages/issues) page. The readme file on the repository has some package-
specific documentation (including how to build the python bindings for Misr
toolkit).
","https://help.jasmin.ac.uk/docs/software-on-jasmin/jasmin-sci-software-environment#overview-of-the-""jasmin-sci""-software-environment",3285,499
"Activating and deactivating the ""jasmin-sci"" environment","To **activate** the jasmin-sci environment, use the command:
{{<command user=""user"" host=""sci1"">}}
module load jasmin-sci
{{</command>}}  
and to **deactivate** it, use the command:
{{<command user=""user"" host=""sci1"">}}
module unload jasmin-sci
{{</command>}}
(""add"" and ""purge"" can also be used).
The `module load` command must be done in each session, or added to your `$HOME/.bashrc` file.
As mentioned above, this is only required for a subset of packages in jasmin-
sci. The majority of packages do not require it, but for example, those which
do include ferret, and the leafpad (notepad-like) editor.
Ferret users should note that it is still necessary to do ""source
ferret_paths.sh"" after activating jasmin-sci, in order for ferret to find all
its additional resource files.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/jasmin-sci-software-environment#activating-and-deactivating-the-""jasmin-sci""-environment",782,115
"Using the ""jasmin-sci"" environment with Jaspy","To activate both jasmin-sci and Jaspy, it is best to activate them in the
following order:
{{<command user=""user"" host=""sci1"">}}
module load jasmin-sci
module load jaspy
{{</command>}}
This will ensure that in the unlikely event of an executable in Jaspy also
existing under `/opt/rh/jasmin-sci/`, then one in Jaspy will take priority.
The corresponding `module unload` commands can be done in either order.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/jasmin-sci-software-environment#using-the-""jasmin-sci""-environment-with-jaspy",408,61
"Jaspy Software Environments (Python 3, R and other tools)","This page provides details of the ""Jaspy"" software environments that provide
access to Python 3, R and a range of other tools on JASMIN.
## Overview
Jaspy is a toolkit for managing and deploying Conda environments that include
Python, R and other packages. Jaspy is used to provide software environments
of common packages on the scientific analysis servers and LOTUS cluster on
JASMIN.
One advantage of Jaspy is that multiple environments can co-exist on the same
platform. This allows us to retain previous environments and provide new ones
simultaneously. This may be particularly useful for scientists undertaking
long-running studies that require a consistent software environment to ensure
reproducibility and continuity.
## Working with Jaspy environments
#### Quickstart for Python 3 environment
If you want to get on, you can select a Jaspy environment to ""activate"". This
means that once you have run these commands then the various tools and
libraries will be available in your current session.
{{<command user=""user"" host=""sci1"">}}
module load jaspy
{{</command>}}
#### Activating the environment in scripts
If you want a particular script to activate a Jaspy environment then add the
""module"" command to it, e.g.:
#!/bin/bash
module load jaspy
python do-something.py
#### Setting your profile to always use a Jaspy environment
If you want all your JASMIN sessions to use a particular Jaspy environment
then you can add the `module load jaspy` command to your `$HOME/.bashrc` file.
In order to avoid issues with using ""module load"" on
unsupported servers, please wrap the call in an ""if"" clause, such as:
if [[ $(hostname) =~ (sci[0-9]|host[0-9]|cylc) ]] ; then
    module load jaspy
fi
## Discover which environments are available
You can list the currently available Jaspy environments using:
{{<command user=""user"" host=""sci1"">}}
module avail jaspy
(out)-------------------------  /apps/modulefiles  ----------------------------
(out)   jaspy/2.7/r20190715    jaspy/3.7/r20200606     jaspy/3.10/r20230718 (D)
(out)   jaspy/3.7/r20181219    jaspy/3.7/r20210320     jaspy/3.11/r20240302
(out)   jaspy/3.7/r20190612    jaspy/3.8/r20211105     jaspy/3.11/r20240508
(out)   jaspy/3.7/r20190627    jaspy/3.10/r20220721
{{</command>}}
This lists all jaspy modules (i.e. environments) that can be loaded.
#### Jaspy Python 3.7+ (plus other tools) environments
The packages available in the Jaspy environments can be found by searching the
GitHub repository where the Conda environment files are defined. This table
lists all the Jaspy Python 3.7+ environments provided on JASMIN and specifies
the current (default) version.
Jaspy Python 3.7 Environment |  Versioned list of software packages |  Default? |  Comments / Issues
---|---|---|---
jaspy/3.11/r20240508  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/main/environments/py3.11/mf3-23.11.0-0/jaspy3.11-mf3-23.11.0-0-r20240508/final-spec.yml) | No (will become the default on 22/05/2024) | [Release notes](https://github.com/cedadev/ceda-jaspy-envs/releases/tag/jaspy3.11_r20240508)
jaspy/3.11/r20240302  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/main/environments/py3.11/mf3-23.11.0-0/jaspy3.11-mf3-23.11.0-0-r20240302/final-spec.yml) | No | [Release notes](https://github.com/cedadev/ceda-jaspy-envs/releases/tag/jaspy3.11_r20240302)
jaspy/3.10/r20220721  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/main/environments/py3.10/m3-4.9.2/jaspy3.10-m3-4.9.2-r20220721/final-spec.yml) |  Yes (from: 18/10/2022)  |  NCO and NCL have now been moved to the [""jasmin-sci"" packages]({{< ref ""jasmin-sci-software"" >}}) installation.
jaspy/3.8/r20211105  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py3.8/m3-4.9.2/jaspy3.8-m3-4.9.2-r20211105/final-spec.yml) |  No (was default: 16/11/2021 - 17/102022)  |  Known problem with NCL rendering Shapefiles (see [issue](https://github.com/cedadev/ceda-jaspy-envs/issues/56)). Some packages were removed in this release due to dependency problems: theano, pymc3, pystan, pyngl,pyferret (see[issue](https://github.com/cedadev/ceda-jaspy-envs/issues/81)).
jaspy/3.7/r20210320  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py3.7/m3-4.9.2/jaspy3.7-m3-4.9.2-r20210320/final-spec.yml)  |  No (was default:  20/05/2021 - 16/11/2021)  |  Known problem with NCL rendering Shapefiles (see [issue](https://github.com/cedadev/ceda-jaspy-envs/issues/56))
jaspy/3.7/r20200606  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py3.7/m3-4.6.14/jaspy3.7-m3-4.6.14-r20200606/packages.txt)|  No  |  |
jaspy/3.7/r20181219  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py3.7/m3-4.5.11/jaspy3.7-m3-4.5.11-r20181219/packages.txt)|  No  |  |
{.table .table-striped}
#### Jaspy Python 2.7 (plus other tools) environments
This table lists all the Jaspy Python 2.7 environments provided on JASMIN and
specifies the current (default) version.
Jaspy Python 2.7 Environment |  Versioned list of software packages |  Default?
---|---|---
jaspy/2.7/r20190715 |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py2.7/m2-4.6.14/jaspy2.7-m2-4.6.14-r20190715/packages.txt)  |  Yes
{.table .table-striped}
#### Jasr R environments
Environments for the ""R"" programming language are packaged into separate
software environments, known as ""Jasr"". This table lists all the Jaspy R
environments provided on JASMIN and specifies the current (default) version.
{{<alert type=""danger"" >}}
We are aware of a newly discovered vulnerability in the R Language (CVE-2024-27322) which allows arbitrary code execution from maliciously built RDS (R Data Serialisation) files.
We will be updating to the latest version of R as soon as possible to remove this vulnerability, but we do not plan to remove access to R beforehand.
Our advice, as always, is to not open data from untrusted sources and not to install untrusted packages from CRAN.
Please note that this position may change at short notice as more information becomes available- this notice was last updated on Friday 10th May 2024.
{{< /alert >}}
Jaspy R Environment (""Jasr"") |  Versioned list of software packages|  Default?
---|---|---
jasr/4.3/r20240320  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/main/environments/r4.3/mf3-23.11.0-0/jasr4.3-mf3-23.11.0-0-r20240320/final-spec.yml) | No (will become the default on 16/04/2024)  |
jasr/4.0/r20220729  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/main/environments/r4.0/m3-4.9.2/jasr4.0-m3-4.9.2-r20220729/final-spec.yml)  |  Yes (from: 18/10/2022)
jasr/4.0/r20211110  |  [List of packages including versions](https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/r4.0/m3-4.9.2/jasr4.0-m3-4.9.2-r20211110/packages.txt)|  No  (was default: 16/11/2021 - 17/10/2022)
{.table .table-striped}
The available R environments can be listed with:
{{<command user=""user"" host=""sci1"">}}
module avail jasr
{{</command>}}
##  Understanding versioning with Jaspy/Jasr
Jaspy environments are labelled as ""jaspy/<python_version>/<release>"". The
environment is selected and activated using the ""module load"" command:
{{<command user=""user"" host=""sci1"">}}
module load jaspy/3.7/r20210320
{{</command>}}
However, if you wish to get the latest environment for a given Python version
you can omit the ""<release>"", as follows:
{{<command user=""user"" host=""sci1"">}}
module load jaspy/3.7
{{</command>}}
And if you just want the most up-to-date Python you can even omit the
`<python_version>`, as follows:
{{<command user=""user"" host=""sci1"">}}
module load jaspy
{{</command>}}
{{<alert type=""info"" >}}
If you choose to omit the `<release>` and `<python_version>`
components then it is important to be aware that the resulting environment may
differ over time. For continuity, you ay wish to use the full
environment specification.
{{< /alert >}}
## How Jaspy works: managing Python and non-Python packages using conda
[Jaspy](https://github.com/cedadev/jaspy-manager) is a framework for managing
multiple Python (and other) environments simultaneously on a single platform.
It was created in order to meet the requirements tabulated below.
**Requirement** |  **Details** |  **Jaspy solution** |  **Further info**
---|---|---|---
Reproducibility  | 1. Generate a specific set of packages and versions from a generic set of requirements. | 1. Conda has a powerful package-management workflow:<br>a. Begin with a minimal set of package/version requirements.<br>b. Generate a consistent environment.<br>c. Provide a detailed description of all exact packages/versions in the environment.|  Conda: [https://docs.conda.io](https://docs.conda.io/)  jaspy-manager: <https://github.com/cedadev/jaspy-manager/blob/master/README.md>  CEDA jaspy environments: <https://github.com/cedadev/ceda-jaspy-envs>
Documentation  |  Provide an appropriate level of documentation detailing which software packages exist in each release.  |  We use Conda ""environment files"" to build the environments. These list the packages and versions and are stored in public GitHub repositories, so each environment is documented as a collection of packages/versions.  |  See: <https://github.com/cedadev/jaspy-manager/blob/master/README.md>  Example package list: <https://github.com/cedadev/ceda-jaspy-envs/blob/master/environments/py3.7/m3-4.5.11/jaspy3.7-m3-4.5.11-r20181219/packages.txt>
Multiple simultaneous environments  |  Allow multiple, but separate, software environments to co-exist on a single operating system.  |  Conda is designed to allow multiple environments to co-exist. Within jaspy it is possible to document each environment. Therefore, multiple environments can be deployed on one system. Key advantages are:<br>- Supporting multiple versions of Python and side-by-side.<br>- Releasing an update to an environment as a ""pre-release"" so that users can adapt their code and test it whilst still having access to the ""current"" (production) environment.|
Manageability  |  Provide tools to easily construct, test, deploy, document and reproduce software environments.  |  Jaspy builds upon a set of excellent Conda command-line tools that simplify the package management process. Jaspy wraps the Conda functionality so that command-line tools can be used to build, test, deploy and distribute Conda environments for use by our community.  |
{.table .table-striped}
## Updates and tracking of Jaspy/Jasr environments
#### History of environments on JASMIN
Please see the [Jaspy Python 3.7+ (and other tools) environments](#jaspy-python-27-plus-other-tools-environments) section
above for information about releases on JASMIN.
#### Which environment is ""current""?
Please refer to the [Jaspy Python 3.7+ (and other tools) environments](#jaspy-python-27-plus-other-tools-environments) section
above for information about the current release on JASMIN.
## Citing Jaspy environments
#### Can I cite a jaspy (conda) environment?
We do not yet have an agreed approach for citing a Jaspy environment. However,
you can refer to the environment description URLs given in the table above.
These provide a definitive list of the software packages, their versions and
other information.
## Requesting updates to a Jaspy environment
If you would like us to add a new package, or an updated version, to the Jaspy
environments on JASMIN then please use one of the following approaches:
  1. Contact the JASMIN helpdesk with the subject: ""Request for Jaspy update: <package name>""
  2. Get a GitHub account and add an issue to the `ceda-jaspy-envs` repository at:
    1. <https://github.com/cedadev/ceda-jaspy-envs/issues/new>
## Conda method of ""activating"" Jaspy environments
Jaspy environments can also be activated in a more traditional way using
standard the standard conda approach, for example:
{{<command user=""user"" host=""sci1"">}}
export PATH=/apps/jasmin/jaspy/miniconda_envs/jaspy3.7/m3-4.6.14//bin/conda:$PATH
source activate
conda activate jaspy3.7-m3-4.6.14-r20210320
{{</command>}}
This has the same result as the `module load` approach. The naming of the
environment identifiers includes the ""Miniconda"" version used to generate the
environment. The `module load` approach is recommended as the standard method
for activating Jaspy environments.
## Using Jaspy beyond JASMIN
Jaspy is a versatile and generic tool for managing multiple conda
environments. The code is open source, and more information is available at:
<https://github.com/cedadev/jaspy-manager>
",https://help.jasmin.ac.uk/docs/software-on-jasmin/jaspy-envs,12822,1489
Using Matplotlib for visualisation on JASMIN,"This article provides a basic example of using Matplotlib on JASMIN to
generate a plot. It also gives an important tip that may stop your code
failing when run on the LOTUS cluster.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/matplotlib,182,33
Matplotlib - a basic example,"[Matplotlib](https://matplotlib.org/) is a very well documented plotting
library for Python. Here is a brief example of generating a line graph on a
PNG file using matplotlib.
Load the Jaspy Python 3 environment, and start a Python session:
{{<command user=""user"" host=""sci1"">}}
module load jaspy
python
{{</command>}}
In python, set some x-values, y-values, axis labels and a title, and plot:  
import matplotlib
matplotlib.use('agg')
import matplotlib.pyplot as plt
x_values = [1, 5, 3, 9, 14]
y_values = [2000, 2005, 2010, 2015, 2020]
x_label = 'Temperature (degC)'
y_label = 'Year'
title = 'Average temperature of garden shed (2000-2020)'
plt.plot(y_values, x_values, 'g--')
plt.ylabel(y_label)
plt.xlabel(x_label)
plt.title(title)
plt.savefig('output.png')
",https://help.jasmin.ac.uk/docs/software-on-jasmin/matplotlib#matplotlib---a-basic-example,762,101
Plotting with matplotlib on LOTUS,"When using matplotlib on LOTUS hosts please make sure that you are setting the
_rendering_ _backend_ to a setting that will definitely work. This must be
done **before** importing `matplotlib.pyplot`.
On JASMIN it is safe to use:
import matplotlib
matplotlib.use('agg')
import matplotlib.pyplot as plt
or alternatively, the `MPLBACKEND` environment variable can be set in the job
script before invoking python:
export MPLBACKEND=agg
If you do not set this option or you choose an alternative backend then you
may see **failures which include very large dump (error) files being written
(up to 56GB per file!)**. Please remove these files if you accidentally create
them, and switch over to selecting an appropriate rendering backend as
indicated above.
Note that if you see the following error message, this results from attempting
to use the default GTK backend on LOTUS (as GTK is only available in an
interactive X-windows environment). The solution is to use `agg`, as described
above.  
{{<command>}}
(out)ValueError: Namespace Gtk not available for version 3.0
{{</command>}}
For more information please see the [matplotlib back-ends
page](https://matplotlib.org/faq/usage_faq.html#what-is-a-backend).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/matplotlib#plotting-with-matplotlib-on-lotus,1208,174
NAG Library,"This article introduces the Fortran and C library of software under the
Numerical Algorithm Group (NAG) license. NAG Library is a collection of
robust, documented, tested and maintained numerical algorithms.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library,208,30
Accessing the NAG Library,,https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#accessing-the-nag-library,0,0
Requesting access,"If you wish to use the NAG Library on JASMIN you will need to request access
via the JASMIN Accounts Portal at:
<https://accounts.jasmin.ac.uk/services/additional_services/nerctools/>
This will give your JASMIN user account access to the ""nerctools"" Unix Group
that is used to limit access to NAG.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#requesting-access,298,44
Loading the NAG Library for use on JASMIN,"The NAG library is made available via `module` command which is only available
once you are on the [scientific analysis servers]({{< ref ""sci-servers"" >}})
and [LOTUS cluster]({{< ref ""lotus-overview"" >}}) on JASMIN. In addition to
loading a module for the library, you will usually need to load a module for
the compiler you are using. For example:
{{<command user=""user"" host=""sci1"">}}
module load contrib/nag/25
module list
(out)Currently Loaded Modulefiles:
(out)    1) intel/fce/15.0.090   2) contrib/nag/25
{{</command>}}
The NAG library is loaded as well as the Intel Fortran compiler. Now you can
compile your code and link to the NAG library, for example:
{{<command user=""user"" host=""sci1"">}}
ifort your_code.f90 -lnag_nag -o your_code.exec
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#loading-the-nag-library-for-use-on-jasmin,766,109
How to find a NAG library routine,"Please search the NAG documentation when looking for specific routines:
<https://www.nag.co.uk/numeric/fl/nagdoc_fl25/html/indexes/kwic.html>
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#how-to-find-a-nag-library-routine,142,11
How to use the NAG library,"The following shows the directory and file organisation of the materials.
/apps/contrib/nag/fll6i25dcl/
                    |- in.html  (Installer's Note - this document)
            |- doc -|- un.html  (Users' Note)
            |       |- lic_agr.txt  (license agreement)
            |
            |       |- libnag_nag.a      (static self-contained library
            |       |                     including NAG BLAS/LAPACK)
            |       |- libnag_nag.so.25  (shareable self-contained library
            |       |                     including NAG BLAS/LAPACK)
            |       |- libnag_nag.so     (symbolic link pointing at
            |- lib -|                     libnag_nag.so.26)
            |       |- libnag_mkl.a      (static library requiring
            |       |                     MKL BLAS/LAPACK)
            |       |- libnag_mkl.so.25  (shareable library requiring
            |       |                     MKL BLAS/LAPACK)
            |       |- libnag_mkl.so     (symbolic link pointing at
            |                             libnag_mkl.so.26)
fll6i25dcl -|
            |- nag_interface_blocks -|- *  (interface blocks for Intel compiler)
            |
            |            |- source --|- ??????e.f90
            |            |
            |- examples -|- data ----|- ??????e.d
            |            |           |- ??????e.opt
            |            |
            |            |- results -|- ??????e.r
            |
            |           |- nag_example*  (scripts to compile and run
            |- scripts -|                  NAG example programs)
            |           |
            |           |- nag_recompile_mods  (script to recompile
            |                                   interface blocks)
            |
            |- c_headers -|- * (C/C++ header file and information)
            |
            |- mkl_intel64_11.2.0 -|- *  (Intel Math Kernel Library)
            |
            |- rtl -|- *  (Intel compiler run-time libraries)
            |
            |           |- bin -|- *  (directories of license management
            |           |              binaries for supported platforms)
            |- license -|- README.txt
                        |
                        |- doc -|- *  (license management documentation)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#how-to-use-the-nag-library,2295,211
Further information,"See the full NAG library manual at:
<https://www.nag.co.uk/numeric/fl/nagdoc_fl26/html/frontmatter/manconts.html>
",https://help.jasmin.ac.uk/docs/software-on-jasmin/nag-library#further-information,114,8
Met Office NAME Model,"This article provides links to information about running the Met Office
atmospheric dispersion model, NAME, on JASMIN.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/name-dispersion-model,119,17
The NAME atmospheric dispersion model,"The Met Office's Numerical Atmospheric-dispersion Modelling Environment (NAME)
<https://www.metoffice.gov.uk/research/modelling-systems/dispersion-model> can
be run on JASMIN using the LOTUS cluster. A NAME Group Workspace is
provided to store both the Numerical Weather Prediction (NWP) met data needed
to drive NAME as well as the user outputs derived from NAME itself.
This service has been developed through a collaboration between STFC CEDA, the
Met Office Atmospheric Dispersion and Air Quality team and the University of
Leicester.
If you would like to know more about running NAME on JASMIN, please contact us
at [atmospheric.dispersion@metoffice.gov.uk](mailto:atmospheric.dispersion@metoffice.gov.uk).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/name-dispersion-model#the-name-atmospheric-dispersion-model,712,90
Introduction,"This article explains that users may request access to a PostgreSQL (known as
Postgres) database on JASMIN for use with scientific workflows.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#introduction,142,22
Overview of the user database service,"There are a large number of different workflows on JASMIN and it is common for
users to require access to _persistent storage_ of information about the progress of a workflow.
In some cases, it is
appropriate for users to save information in a relational database. Examples
might be to create/update/delete data records (when working with _small_
results) or to store the success/failure of batch tasks (running on LOTUS).
To meet this need, a _user database service_ is available on request. The
service provides secured access to a [Postgres](https://www.postgresql.org/)
database that is accessible from the interactive and batch compute nodes on
JASMIN. An individual user, or group of users, can be issued with login
credentials to enable read and/or write access to the database.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#overview-of-the-user-database-service,786,123
How to request a Postgres database for use on JASMIN,"In order to request a Postgres database from the user database service, please
ensure you have a JASMIN Login account and then send a message to the JASMIN
Helpdesk. You should include the following information in your message:
- state that you would like a user database set up
- your JASMIN user ID
- Postgres details: database name, database user account name
- the expected size of the database (fully populated)
- machines (inside JASMIN) from which you would like to contact the database
- If you require backups of the database to be made.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#how-to-request-a-postgres-database-for-use-on-jasmin,547,96
Postgres extensions,"The Postgres installation includes the following extension:
- {{<link ""https://postgis.net/"">}}PostGIS{{</link>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#postgres-extensions,114,10
Backups,"By default we make daily backups of the databases, which are kept for a week.
We keep a weekly backup for a month and a monthly backup for 6 months. These
intervals may be subject to change, so if you have particular concerns about
backups please let us know. If your database is particularly large we may
either make less frequent backups or not make backups at all. We will discuss
any particular backup requirements you may have when we set up your database.
You should contact the JASMIN Helpdesk to request access
to previous backups.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#backups,540,96
Restrictions and limitations,"Please note that the following restrictions and limitations apply to the user
database service:
- We cannot provide training in SQL or the use of relational databases: please ensure that you have the appropriate experience before requesting access.
- There is a size limit on the server and the disk that the user databases are housed on: if you expect to store many GBs of data then please discuss this with the JASMIN Team.
- The database cannot be made accessible outside the JASMIN firewall: it is intended to support applications and workflows that take place inside JASMIN.
- The database should not be considered as a long-term data store: you should migrate any content elsewhere if you intend to keep it for the medium or long term.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/postgres-databases-on-request#restrictions-and-limitations,742,128
Python Virtual Environments,"This article describes how you can use ""virtual environments"" to install
Python packages that are not provided in the [common software environments on
JASMIN]({{< ref ""software-overview"" >}}). You might wish to do this if you
want to use different packages/versions from those installed on the system, or
if you have requested for a package to be installed system-wide but wish to
start using it before this request can be acted upon.
To decide whether you should use a _Python virtual environment_ or a _Conda
environment_ for this purpose, see: [overview of software environments]({{<
ref ""conda-environments-and-python-virtual-environments"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments,650,96
"What is a ""virtual environment""?","A ""virtual environment"" is a self-contained directory tree that contains a
Python installation for a particular version of Python (such as 2.7, 3.7,
3.8), plus a number of additional packages. It provides a very useful method
for managing multiple environments on a single platform that can be used by
different applications.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#what-is-a-""virtual-environment""?",326,51
Creating a virtual environment,"**As a pre-requisite, when using any modern Python (i.e. Python2.7 onwards),
you should[activate a Jaspy environment]({{< ref ""quickstart-software-envs""
>}}) before following the instructions below.**
Python allows you to create a directory containing a private virtual
environment, into which you can install your packages of choice. This is done
differently for python2 and python3, as follows:
{{<command user=""user"" host=""sci1"">}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#creating-a-virtual-environment,435,58
Python 3 onwards:,"python -m venv /path/to/my_virtual_env
(out)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#python-3-onwards:,45,5
Python 2.7 (deprecated),"virtualenv /path/to/my_virtual_env
{{</command>}}
The path can be an absolute or relative path, but it should not already exist.
Note: `/path/to/my_virtual_env` here (and also in the commands shown below)
should be replaced by the actual path where you choose to create your virtual
environment.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#python-2.7-(deprecated),296,43
"Using the system ""site-packages"" with your virtual environment","Note that if you create a virtual environment using the above syntax, the
packages initially installed in it will **only be those in the standard Python
library**. This means, for example, that the `numpy` package (not in the
standard library, but installed as part of Jaspy) will be unavailable unless
you install it yourself. If you would prefer as a starting point to have all
the add-on packages which have already been installed in Jaspy, then use
instead:
{{<command user=""user"" host=""sci1"">}}
python -m venv --system-site-packages /path/to/my_virtual_env
{{</command>}}
This will work for most packages in Jaspy. We have seen situations where one
or two packages from Jaspy do not work in private virtual environments, and if
you are affected by this then please see the ""package-specific fixes"" section
below.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#using-the-system-""site-packages""-with-your-virtual-environment",818,128
Activating a virtual environment,"Before the virtual environment can be used, it needs to be "" **activated** "".
This is done by running the `activate` script using the `source` command:
{{<command user=""user"" host=""sci1"">}}
source /path/to/my_virtual_env/bin/activate
{{</command>}}
(If you prefer, you can use `.` instead of `source`.)
After you run the activate script, some environment variables will be set so
that the `python` (or `python2.7` (deprecated), `python3`) command will point to the one in the
virtual environment, allowing installation and use of packages in that
environment.
You can see that `python` points to the python executable in the virtual
environment, with:
{{<command user=""user"" host=""sci1"">}}
which python
(out)/home/users/my_username/my_virtual_env/bin/python
{{</command>}}
Note that you have to source the `activate` script in **every** shell (login
session) in which you intend to use the virtual environment. If there is a
particular virtual environment which you want to use consistently, you might
consider putting the command to source the `activate` script in your
`$HOME/.bashrc` file.
If you wish to deactivate the currently active virtual environment in a
particular shell, just type `deactivate`. The environment variable changes
will be undone, and you will again be using the system default set of
packages. This is also reflected in the shell prompt.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#activating-a-virtual-environment,1364,198
Installing packages into a virtual environment,"Once you have activated a virtual environment, the `pip` utility will be
available. This allows package installation into the environment using the
command:
{{<command user=""user"" host=""sci1"">}}
pip install your_package
{{</command>}}
`pip` is quite flexible what you can use for `your_package`. It can include:
- a package name in the [Python Package Index](https://pypi.python.org/pypi) (PyPI)
- a URL pointing to a package repository
- the local path of a `.tar.gz` or `.zip` file containing the package source
- the local path of a directory containing the extracted package source
- the download URL of a `.tar.gz` or `.zip` file
If the package requires other packages that are not already installed into the
virtual environment, then `pip` will use the package's requirements file to
install them automatically from PyPI.
One thing to consider when doing this, is that some temporary space is needed
by the install process. The location of this temporary space may be set by default
to `/tmp`, which is restricted on the `sci` machines.
You might see this error, despite having ample free space in your own home directory:
ERROR: Could not install packages due to an OSError: \
[Errno 122] Disk quota exceeded
In order to avoid encountering this, 
you are advised to {{<link ""../getting-started/storage/#avoid-inadvertently-writing-to-tmp"">}}follow this advice{{</link>}} to over-ride the `TMPDIR` environment variable, setting it to the location of somewhere you know have free space. Don't forget to clean up afterwards!
To upgrade an existing package, use:
{{<command user=""user"" host=""sci1"">}}
pip install --upgrade your_package
{{</command>}}
If your Python package cannot be installed with `pip` for any reason, it can
also be installed directly from the `setup.py` file after activating the
virtual environment.
{{<command user=""user"" host=""sci1"">}}
python setup.py install
{{</command>}}
To install a specific version of a package, this can be specified with:
{{<command user=""user"" host=""sci1"">}}
pip install your_package==1.2.3
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#installing-packages-into-a-virtual-environment,2059,300
Inspecting the virtual environment,"To list the packages installed into the virtual environment, with their
version numbers, type:
{{<command user=""user"" host=""sci1"">}}
 pip freeze
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#inspecting-the-virtual-environment,160,20
Using the virtual environment,,https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#using-the-virtual-environment,0,0
Interactive use,"After you have activated the virtual environment in your shell, any packages
that you have installed into it can be imported into an interactive python
session.
{{<command user=""user"" host=""sci1"">}}
python # automatically uses python in your virtualenv
{{</command>}}
The prompt changes to `>>>`:
{{<command user=""user"" prompt="">>>"">}}
import my_package
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#interactive-use,369,49
Scripts,"If a script is run using the `python` command on the command-line in a similar
way to when starting an interactive Python session, this will use any virtual
environment that has been activated in the calling shell.
{{<command user=""user"" host=""sci1"">}}
python my_script.py
{{</command>}}
If an executable script is run using the `#!` mechanism, and the first line of
the script has the hard-coded path to the executable in the virtual
environment, then it is not necessary to activate the virtual environment in
the calling shell.
{{<command user=""user"" host=""sci1"">}}
head -n 1 myscript.py  # show the first line
(out)#!/path/to/my_virtual_env/bin/python3.7
(out)
chmod u+x myscript.py  # ensure that it is executable
(out)
./myscript.py  # run it
{{</command>}}
As an alternative to hard-coding the path of the virtual environment, it is
possible to use the `/usr/bin/env` approach to ensure that the script is run
using whichever python executable is found via `$PATH`. The script will then
run using any virtual environment that has been activated in the calling
shell. This makes the script more portable, although at the expense of having
to source the activate script.
{{<command user=""user"" host=""sci1"">}}
head -n 1 myscript.py
(out)#!/usr/bin/env python3.7
(out)
chmod u+x myscript.py
(out)
./myscript.py
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#scripts,1329,198
Package-specific fixes,"When using the `--system-site-packages` option in combination with Jaspy, it
has been found that some packages provided by Jaspy (and which work correctly
in the Jaspy environment itself) require fixes in order to use them in virtual
environments that are created on top of Jaspy. In particular:
- if you use `shapely`, we suggest to reinstall this into your virtual environment using `pip install --ignore-installed shapely` after activating the environment
- if you use `geopandas`, you will need to reinstall shapely as above, and also when running python you will need to set an environment variable to enable it to find the `spatialindex` library. After loading Jaspy and activating the virtual environment, you could use either one of the following: 
  - `export LD_LIBRARY_PATH=$CONDA_PREFIX/lib:$LD_LIBRARY_PATH`
  - `export LD_PRELOAD=$CONDA_PREFIX/lib/libspatialindex.so:$CONDA_PREFIX/lib/libspatialindex_c.so`
Note that these environment variables could potentially also affect the
behaviour of other Linux commands, although unlikely, so you might prefer to
set them only for the python session (using a command of the form `env
variable_name=value python`) rather than using `export`.
- if you use `cartopy` (also used by `iris`), you may need to create a symbolic link into your virtual environment to allow the correct loading of `libgeos_c.so` during `import cartopy` or `import iris`. To do this: 
{{<command user=""user"" host=""sci1"">}}
ln -s $CONDA_PREFIX/lib/libgeos_c.so /path/to/my_virtual_env/lib/
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/python-virtual-environments#package-specific-fixes,1534,213
Quickstart for activating/deactivating software environments,"This article provides a minimum quick-start guide for working with software environments on JASMIN.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/quickstart-software-envs,100,14
Activate (load) an environment,"To activate an environment containing the ""current"" common software packages
(including a modern Python):
{{<command user=""user"" host=""sci1"">}}
module load jaspy
{{</command>}}
or for a specific version, see {{<link ""jaspy-envs/#discover-which-environments-are-available"">}}how to discover what versions are available{{</link>}}
To activate additional packages (known as ""jasmin-sci""):
{{<command user=""user"" host=""sci1"">}}
module load jasmin-sci
{{</command>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/quickstart-software-envs#activate-(load)-an-environment,462,49
Deactivate (unload) an environment,"If you want to deactivate an environment that you have previously activated,
do:
{{<command user=""user"" host=""sci1"">}}
module unload <env-id>
{{</command>}}
Where ""<env-id>"" is the name used when you activated the environment.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/quickstart-software-envs#deactivate-(unload)-an-environment,227,31
Which environment(s) should you use?,"If you are not sure which environment(s) to use please see details on the
[overview]({{< ref ""software-overview"" >}}) of Jaspy and ""jasmin-sci""
environments page.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/quickstart-software-envs#which-environment(s)-should-you-use?,163,24
Migration to Rocky Linux 9 2024,"{{<alert type=""info"">}}
Watch this space for further updates about the details and timetable for the migration to Rocky Linux 9 on JASMIN.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/rocky9-migration-2024,152,23
Introduction,"As with a previous migration completed in 2020, the change of operating system version is needed to make sure that the version in use is current and fully supported, i.e. that package updates are available and important security updates can be obtained and applied to keep the platform secure.
The current operating system, CentOS7 is officially end-of-life as of the end of June 2024. We will be moving from CentOS7 to Rocky Linux 9, which is supported until May 2032. Rocky9 should provide a very similar user experience to that provided by CentOS7, but with more recent software packages. Some software may have been removed or replaced during this transition.
This change affects JASMIN and CEDA services in several ways, including but not limited to the following:
- Components of all CEDA Archive and JASMIN web-based services need to be redeployed
- User-facing service hosts (e.g. `login`/`sci`/`xfer` and LOTUS nodes) all need to be redeployed
- All of these hosts need appropriate versions of drivers for various hardware and infrastructure components (e.g. storage, network, …) to be configured.
- The Slurm scheduler used for the LOTUS and ORCHID clusters needs to be adapted to work under Rocky 9, in terms of its own management functions and the worker nodes which it controls. A separate announcement will cover the expansion of LOTUS with new processing nodes: these will be introduced as a new cluster under Slurm, with existing nodes moved from old to new as part of the transition. There will be a limited window in which the 2 clusters will co-exist, during which time the old cluster will shrink in size: the current estimate for this is between July to September 2024, but we will provide updates on this as the new hardware is installed and timescales become clearer. We will endeavour to provide sufficient overlap and temporary arrangements to help users to migrate their workflows.
- Software made available centrally via the `module` system and under `/apps` needs to be made available in versions compatible with Rocky 9. Some software may need to be recompiled.
- Other software (e.g. run by users or groups, without being centrally managed) may need to be tested and in some cases recompiled in order to work correctly under Rocky 9.
- Management and monitoring systems need to be updated to operate in the new environment
- For tenants of the JASMIN Cloud, you should already be aware of our plans to move to use the STFC Cloud as the base platform for the JASMIN Cloud Service. Images are currently in preparation so that new (empty) tenancies will soon be available for tenants to manage the migration of their own virtual machines over to new instances using Rocky 9 images. It is anticipated at this stage that managed tenancies (with tenancy sci machines) will be discontinued as part of this move, so users of those VMs will be advised to use the new Rocky 9 general-use sci servers instead.
Much of this work is already underway by teams in CEDA and STFC’s Scientific Computing Department. As a result of extensive work by these teams in recent years to improve the way services are deployed and managed, we are now in a much better position to undertake this kind of migration with as little disruption to users as possible. Some disruption and adaptation by users will be inevitable, however.
Some services have already been migrated and are already running under Rocky 9, but there is still much work to be done over the coming weeks so please watch this space as we do our best to keep you informed of the progress we’re making, and of any actions you may need to take to minimise disruption to your work on JASMIN.
{{<alert type=""info"">}}
Further details to follow soon.
{{</alert>}}",https://help.jasmin.ac.uk/docs/software-on-jasmin/rocky9-migration-2024#introduction,3726,634
Running python on JASMIN,"On the JASMIN analysis machines and on Lotus, we currently support
Python version 3.10 through [Jaspy]({{< ref ""jaspy-envs"" >}}).
When you log in, the default version of Python is `2.7.5` which is the used by the
operating system. You shoud now use a more modern version of Python as v2.x is now deprecated. 
We recomment using the Jaspy environments. In this example, we
activate the current Jaspy environment before running Python.
{{<command user=""user"" host=""sci1"">}}
module load jaspy
{{</command>}}
Check the Python version:
{{<command user=""user"" host=""sci1"">}}
python -V
(out)Python 3.10.8
{{</command>}}
Run a script:
{{<command user=""user"" host=""sci1"">}}
python your_script.py
{{</command>}}
If you want to use an executable script (which can be invoked just by name),
then the recommended line to put at the top of the script would be:
#!/usr/bin/env python
after which you should set ""write"" permission, and then you can run it without
the ""python "" prefix:
{{<command user=""user"" host=""sci1"">}}
chmod 755 your_script.py
./your_script.py
{{</command>}}
You should work with Python on the {{<link ""../interactive-computing/sci-servers"">}}scientific analysis servers{{</link>}}. 
Login servers do not have any software installed, or filesystems mounted other than home directories.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/running-python-on-jasmin,1292,182
Sharing software environments,"This article explains how you can share software environments with other users
on JASMIN.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/share-software-envs,90,14
What is a software environment?,"A software environment is typically a collection of files and directories
associated with a set of environment variables that allows a given session to
access them. In the context of JASMIN, there are a number of Python/other
environments already available on the system. See the [Jaspy page]({{< ref
""jaspy-envs"" >}}) for examples of these.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/share-software-envs#what-is-a-software-environment?,342,54
Creating software environments on JASMIN,"In some cases, JASMIN users will need to create their own software
environments because the existing environments do not include all the packages
that they require. See the [virtual environments page]({{< ref ""python-virtual-environments"" >}}) for details on creating your own Python
environments.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/share-software-envs#creating-software-environments-on-jasmin,298,42
Tips on sharing software environments on JASMIN,"If you need to create your own environment it is important to be aware of
which file system you are working on:
- SOF (e.g. `/gws/nopw/j04/*`): does not perform well with small files.
- SSD (e.g. `$HOME` and `/gws/smf/j04/*`): performs much better with small files, but is expensive so only limited quotas are available.
If you are building an environment for your use only then it makes sense to
create it under your $HOME directory.
If you need to share an environment with other JASMIN users you can:
- Request a ""small files"" (**smf**) Group Workspace volume.
- Install the software environment within the ""small files"" volume.
- Then all users with access to that GWS will be able to access the environment.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/share-software-envs#tips-on-sharing-software-environments-on-jasmin,713,123
'JASMIN software changes,"{{<alert type=""danger"">}}
This article is now out of date, but a similar exercise is about to get underway
for the migration of the JASMIN platform from CentOS7 operating system (end of life June 2024) to Rocky Linux 9. Look out for futher details in due course.
{{</alert>}}
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020,276,47
Introduction,"This article explains the changes in the provision of common software on
JASMIN (""sci"" servers and LOTUS) when upgrading to main operating system from
RedHat Enterprise Linux 6 (RHEL6) to CentOS7. It answers for the following
questions:
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#introduction,237,37
What is changing?,"The upgrade from RHEL6 to introduces a new way of working with software
environments on JASMIN.
The previous system involved installations via RPM using a collection of
packages known as the ""JASMIN Analysis Platform"" (JAP).
The current system uses two approaches to providing software environments and
packages:
  1. Jaspy environments – a collection of software environments that you can ""activate"" for use.
  2. ""jasmin-sci"" environment – a single set of software packages installed separately because they were difficult to include in Jaspy.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#what-is-changing?,546,82
Which systems are affected?,"This change applies to all generally available JASMIN servers and the LOTUS
cluster. These include:
- jasmin-sci*
- cems-sci*
- jasmin-cylc
- cron
- All LOTUS nodes (accessed via LSF)
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#which-systems-are-affected?,184,30
Why is it changing?,"The reason for moving away from the JAP was to provide a system that could
support multiple versions of software packages, and environments, on a single
platform. From the perspective of reproducible science, the [Jaspy]({{< ref
""jaspy-envs"" >}}) approach is more useful because it:
-  keeps previous environments on the system when a new version of an environment is launched
- includes a listing of all packages (and their versions) that are provided in each date-stamped software environment
From a management point-of-view, Jaspy builds on the packaging tool
""[conda](https://docs.conda.io/en/latest/)"" and the community repositories
known as ""[conda-forge](https://conda-forge.org/)"". These tools are widely
used in the scientific community and provide many components that are re-used
in Jaspy.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#why-is-it-changing?,801,114
"Comparison of packages in old JASMIN Analysis Platform and new Jaspy/""jasmin-sci"" environments","Most packages that were previously provided as part of the JASMIN Analysis
Platform (JAP) are now included in Jaspy environments or the ""jasmin-sci""
environment. Some packages have however been dropped. The treatment of certain
packages is documented on the ""[extra-sci-
packages](https://github.com/cedadev/extra-sci-packages)"" GitHub repository. A
full table of packages that were in JAP and their mappings to Jaspy/""jasmin-
sci"" is provided below.
","https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#comparison-of-packages-in-old-jasmin-analysis-platform-and-new-jaspy/""jasmin-sci""-environments",451,61
How do I get started (quickly)?,"If you want to access most of the packages you can find them in the most
recent Jaspy environment. This can be activated using:
module load jaspy
If you need packages that are provided in the ""jasmin-sci"" environment then
you can activate it using:
module load jasmin-sci
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#how-do-i-get-started-(quickly)?,272,47
Full table of packages from JAP,"Here is a full table of packages that were provided via JAP, and how they are
provided for use on CentOS7 machines (as of initial release).
In the summary column:
- **C** \- package is provided via Conda environment (i.e. Jaspy)
- **R** \- package is provided via an RPM (as part of the base OS or via jasmin-sci)
- **CR** \- package is provided both via Jaspy and via an RPM. The version in Jaspy is recommended for use with user code; the RPM version is also installed in order to satisfy an RPM dependency only, and may be subject to change.
- **N** \- not provided (mostly these have been deprecated by the third-party sources)
**NAME (in JAP)** | **Version in Jaspy 3.7 (conda)** | **Version in Jaspy 2.7 (conda)** | **Version in RPMs (base or jasmin-sci SCL)** | **Summary:** **(C)onda/** **(R)PM /** **(N)one** | **Comments**  
---|---|---|---|---|---  
arpack  |  3.6.3  |  3.6.3  |  |  C  |  
atlas  |  |  3.8.4  |  3.10.1  |  R  |  
atlas-devel  |  |  3.8.4  |  3.10.1  |  R  |  
bbcp  |  |  |  |  N  |  deprecated  
bbcp-config  |  |  |  |  N  |  deprecated  
blas  |  1.1  |  1.0  |  |  C  |  
boost-devel  |  |  1.70.0  |  |  C  |  
cdo  |  1.9.5  |  |  |  C  |  
cmip6-cmor-tables  |  |  |  |  N  |  groups advised to maintain own CMOR  
cmor-libs  |  |  |  |  N  |  groups advised to maintain own CMOR  
coda  |  |  0.19_1  |  |  C  |  
ddd  |  |  |  3.3.12  |  R  |  
diffuse  |  |  |  0.4.8  |  R  |  
dvipng  |  |  |  1.14  |  R  |  package texlive-dvipng-svn26689  
eccodes  |  2.9.2  |  |  |  C  |  
eccodes-devel  |  2.9.2  |  |  |  C  |  
eccodes-fortran  |  2.9.2  |  |  |  C  |  
eccodes-python27  |  2.9.2  |  |  |  C  |  
emacs  |  |  26.1  |  24.3  |  R  |  _emacs is broken in jaspy 2.7_ \-
/usr/bin/emacs may be required to override  
emacs-common-ess  |  |  |  |  N  |  might provide later  
emacs-ess  |  |  |  |  N  |  might provide later  
emacs-ess-el  |  |  |  |  N  |  might provide later  
emacs-gnuplot  |  |  |  4.6.2  |  R  |  
emos  |  |  |  |  N  |  deprecated  
esmf  |  7.1.0r  |  7.1.0r  |  |  C  |  
esmf-doc  |  |  |  |  N  | See [here](http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_usrdoc/) and ESMF_refdoc  
esmf-python27  |  7.1.0r  |  7.1.0r  |  |  C  |  
ferret  |  |  |  7.5.0  |  R  |  
fftw  |  3.3.8  |  3.3.8  |  |  C  |  
fftw-devel  |  3.3.8  |  3.3.8  |  |  C  |  
firefox  |  |  |  |  N  |  
flex-devel  |  |  2.6.4  |  |  C  |  
gcc-gfortran  |  |  |  4.8.5  |  R  |  
gdal  |  2.2.4  |  2.0.0  |  |  C  |  
gdal-devel  |  |  |  |  N  |  gdal provided as ""gdal""  
gdal-doc  |  |  |  |  N  |  gdal provided as ""gdal""  
gdal-java  |  |  |  |  N  |  
gdal-javadoc  |  |  |  |  N  |  
gdal-libs  |  |  |  |  N  |  
gdal-perl  |  |  |  |  N  |  
gdal-python27  |  2.2.4  |  2.0.0  |  |  C  |  
geany  |  |  |  1.31  |  R  |  
geos  |  3.6.2  |  3.7.1  |  |  C  |  
geos-devel  |  3.6.2  |  3.7.1  |  3.4.2  |  R  |  
git  |  2.20.1  |  2.20.1  |  |  C  |  
gitk  |  |  |  1.8.3.1  |  R  |  
glibc-static  |  |  |  2.17  |  R  |  
gnuplot  |  |  |  4.6.2  |  R  |  
grads  |  |  |  2.0.2  |  R  |  
GraphicsMagick-c++  |  |  |  1.3.32  |  R  |  
graphviz  |  2.38.0  |  2.38.0  |  |  C  |  
graphviz-gd  |  |  |  |  N  |  
graphviz-python27  |  2.38.0  |  2.38.0  |  |  C  |  
grass  |  |  |  6.4.4  |  R  |  
grass-devel  |  |  |  6.4.4  |  R  |  
grass-libs  |  |  |  6.4.4  |  R  |  
grib_api  |  |  |  |  N  |  deprecated - use eccodes  
grib_api-devel  |  |  |  |  N  |  deprecated - use eccodes  
grib_api-fortran  |  |  |  |  N  |  deprecated - use eccodes  
grib_api-python27  |  |  |  |  N  |  deprecated - use eccodes  
gsl  |  2.2.1  |  2.5  |  |  C  |  
gsl-devel  |  2.2.1  |  2.5  |  |  C  |  
gsl-static  |  2.2.1  |  2.5  |  |  C  |  
gtk2  |  2.24.31  |  |  |  C  |  
gtk2-devel  |  2.24.31  |  |  |  C  |  
gv  |  |  |  3.7.4  |  R  |  
hdf  |  4.2.13  |  4.2.13  |  |  C  |  
hdf-devel  |  4.2.13  |  4.2.13  |  |  C  |  
hdf5  |  1.10.3  |  1.10.1  |  |  C  |  
hdf5-devel  |  1.10.3  |  1.10.1  |  |  C  |  
hdfeos2  |  2.2  |  2.20  |  20.1.00  |  CR  |  
hdfeos5  |  5.1.16  |  5.1.16  |  |  C  |  
ImageMagick  |  7.0.8_16  |  7.0.8_10  |  |  C  |  
JAGS  |  |  |  |  N  |  available as ""rjags""  
jasper-devel  |  1.900.1  |  2.0.14  |  |  C  |  
ksh  |  |  |  20120801  |  R  |  
lapack  |  3.6.1  |  3.6.1  |  |  C  |  
lapack-devel  |  3.6.1  |  3.6.1  |  |  C  |  
leafpad  |  |  |  0.8.18  |  R  |  
libcdms  |  3.1.0  |  3.0.1  |  |  C  |  
libcrayutil  |  |  |  20121128  |  R  |  
libcurl-devel  |  |  |  7.29.0  |  R  |  
libdrs  |  3.1.0  |  3.1.0  |  3.1.2  |  CR  |  
libuuid-devel  |  2.32.1  |  2.32.1  |  2.23.2  |  CR  |  
llvm-devel  |  |  3.3  |  |  C  |  
lxterminal  |  |  |  0.3.2  |  R  |  
mercurial  |  |  4.9.1  |  2.6.2  |  R  |  
mo_unpack  |  |  |  2.0.1  |  R  |  
mtk  |  |  |  1.4.5  |  R  |  
mtk-devel  |  |  |  1.4.5  |  R  |  
mtk-python27  |  |  |  |  N  |  see build instructions for user  
ncBrowse  |  |  |  |  N  |  deprecated  
nccmp  |  |  |  1.8.3.1  |  R  |  
ncl  |  6.5.0  |  |  |  C  |  
nco  |  4.7.8  |  |  |  C  |  
nco-devel  |  4.7.8  |  |  |  C  |  
ncview  |  |  |  2.1.2  |  R  |  
nedit  |  |  |  5.7  |  R  |  
netcdf  |  4.6.1  |  4.6.1  |  4.3.3.1  |  CR  |  called libnetcdf in conda  
netcdf-c++  |  4.2.1  |  4.3.0  |  |  C  |  called netcdf-cxx4 in conda  
netcdf-c++-devel  |  4.2.1  |  4.3.0  |  |  C  |  called netcdf-cxx4 in conda  
netcdf-devel  |  4.6.1  |  4.6.1  |  4.3.3.1  |  CR  |  called libnetcdf in
conda  
netcdf-fortran  |  4.4.4  |  4.4.4  |  4.2  |  CR  |  
netcdf-fortran-devel  |  4.4.4  |  4.4.4  |  4.2  |  CR  |  
octave  |  |  |  3.8.2  |  R  |  
octave-devel  |  |  |  3.8.2  |  R  |  
octave-doc  |  |  |  |  N  |  docs are on <https://octave.org/doc/>  
octave-netcdf  |  |  |  1.0.6  |  R  |  
octave-octcdf  |  |  |  |  N  |  deprecated  
p7zip  |  |  |  16.02  |  R  |  
parallel  |  |  20190522  |  |  C  |  
pdftk  |  |  |  |  N  |  discontinued  
perl-core  |  |  |  5.16.3  |  R  |  
perl-devel  |  |  |  5.16.3  |  R  |  
perl-Image-ExifTool  |  |  |  11.7  |  R  |  
perl-XML-Parser  |  |  2.44_01  |  |  C  |  
postgresql-devel  |  |  |  9.2.24  |  R  |  
proj  |  4.9.3  |  5.2.0  |  4.8.0  |  CR  |  called proj4 in conda  
proj-devel  |  4.9.3  |  5.2.0  |  4.8.0  |  CR  |  called proj4 in conda  
proj-epsg  |  4.9.3  |  5.2.0  |  4.8.0  |  CR  |  called proj4 in conda  
proj-nad  |  4.9.3  |  5.2.0  |  4.8.0  |  CR  |  called proj4 in conda  
proj-static  |  4.9.3  |  5.2.0  |  4.8.0  |  CR  |  called proj4 in conda  
python27  |  3.7.1  |  2.7.15  |  |  C  |  
python27-alabaster  |  0.7.12  |  0.7.12  |  |  C  |  
python27-astral  |  |  1.9.2  |  |  C  |  
python27-Babel  |  2.6.0  |  2.7.0  |  |  C  |  
python27-backports-common  |  |  1.0  |  |  C  |  
python27-backports-functools_lru_cache  |  |  1.5  |  |  C  |  
python27-backports-ssl_match_hostname  |  |  1.0  |  |  C  |  
python27-basemap  |  1.2.0  |  1.2.0  |  |  C  |  
python27-biggus  |  |  0.15.0  |  |  C  |  
python27-boto3  |  1.9.67  |  1.9.188  |  |  C  |  
python27-botocore  |  1.12.68  |  1.12.188  |  |  C  |  
python27-cartopy  |  0.17.0  |  0.16.0  |  |  C  |  
python27-ccplot  |  |  |  |  P  |  
python27-cdat_lite  |  |  |  |  N  |  deprecated  
python27-cerbere  |  |  |  |  N  |  
python27-certifi  |  2018.11.29  |  |  |  C  |  
python27-cf  |  |  2.3.6  |  |  C  |  called cf-python in conda  
python27-cf-checker  |  |  3.1.1  |  |  C  |  
python27-cf-plot  |  |  2.4.10  |  |  C  |  
python27-cf-units  |  2.0.2  |  2.1.1  |  |  C  |  
python27-cf-view  |  |  |  |  N  |  no longer supported  
python27-cftime  |  1.0.3.4  |  1.0.1  |  |  C  |  
python27-chardet  |  3.0.4  |  3.0.4  |  |  C  |  
python27-cis  |  |  1.6.0  |  |  C  |  
python27-cloudpickle  |  0.6.1  |  1.2.1  |  |  C  |  
python27-cmor  |  |  |  |  N  |  groups advised to maintain own CMOR  
python27-cycler  |  0.10.0  |  0.10.0  |  |  C  |  
python27-Cython  |  0.29.2  |  0.29.12  |  |  C  |  
python27-dask  |  1.0.0  |  1.2.2  |  |  C  |  
python27-dateutil  |  |  |  |  C  |  As ""dateutil""  
python27-descartes  |  1.1.0  |  1.1.0  |  |  C  |  
python27-docutils  |  0.14  |  0.14  |  |  C  |  
python27-ecmwf-api-client  |  |  |  |  N  |  To be added soon.  
python27-emcee  |  2.2.1  |  2.2.1  |  |  C  |  
python27-enum34  |  |  1.1.6  |  |  C  |  
python27-eofs  |  1.3.1  |  1.4.0  |  |  C  |  
python27-esgf-pyclient  |  |  0.1.8  |  |  C  |  
python27-filelock  |  3.0.10  |  3.0.10  |  |  C  |  
python27-Fiona  |  1.7.13  |  |  |  C  |  
python27-geopandas  |  0.4.0  |  |  |  C  |  
python27-h5py  |  2.8.0  |  2.8.0  |  |  C  |  
python27-httplib2  |  |  0.13.0  |  |  C  |  
python27-idna  |  2.8  |  2.8  |  |  C  |  
python27-ilamb  |  |  2.3.1  |  |  C  |  
python27-ImageHash  |  4.0  |  4.0  |  |  C  |  
python27-imagesize  |  1.1.0  |  1.1.0  |  |  C  |  
python27-ipython  |  7.2.0  |  5.8.0  |  |  C  |  
python27-iris_sample_data  |  2.1.0  |  2.1.0  |  |  C  |  
python27-iris-grib  |  |  0.12.0  |  |  C  |  
python27-jinja2  |  2.1  |  2.10.1  |  |  C  |  
python27-jmespath  |  0.9.3  |  0.9.4  |  |  C  |  
python27-joblib  |  0.13.0  |  0.13.2  |  |  C  |  
python27-Jug  |  1.6.7  |  1.6.8  |  |  C  |  
python27-kiwisolver  |  1.0.1  |  1.1.0  |  |  C  |  
python27-latexcodec  |  1.0.5  |  1.0.7  |  |  C  |  
python27-locket  |  0.2.0  |  0.2.0  |  |  C  |  
python27-MarkupSafe  |  1.1.0  |  1.1.1  |  |  C  |  
python27-matplotlib  |  3.0.2  |  2.2.2  |  |  C  |  
python27-mo_pack  |  0.2.0  |  0.2.0  |  |  C  |  
python27-mock  |  2.0.0  |  3.0.5  |  |  C  |  
python27-mpi4py-mpich  |  |  3.0.1  |  |  C  |  
python27-mpmath  |  1.1.0  |  1.1.0  |  |  C  |  
python27-nappy  |  1.1.4  |  1.2.1  |  |  C  |  
python27-nc-time-axis  |  1.1.0  |  1.1.0  |  |  C  |  
python27-netCDF4  |  1.4.2  |  1.3.1  |  |  C  |  
python27-nose  |  1.3.7  |  1.3.7  |  |  C  |  
python27-numpy  |  1.15.4  |  1.15.4  |  |  C  |  
python27-packaging  |  18.0  |  19.0  |  |  C  |  
python27-pandas  |  0.23.4  |  0.24.2  |  |  C  |  
python27-partd  |  0.3.9  |  1.0.0  |  |  C  |  
python27-patsy  |  0.5.1  |  0.5.1  |  |  C  |  
python27-pep8  |  1.7.1  |  1.7.1  |  |  C  |  
python27-Pillow  |  5.3.0  |  5.2.0  |  |  C  |  
python27-psutil  |  5.4.8  |  5.6.3  |  |  C  |  
python27-psycopg2  |  2.7.6.1  |  2.7.7  |  |  C  |  
python27-pybtex  |  0.22.0  |  0.22.2  |  |  C  |  
python27-pycairo  |  1.18.0  |  1.16.3  |  |  C  |  
python27-pycodestyle  |  2.4.0  |  2.5.0  |  |  C  |  
python27-Pydap  |  3.2.2  |  3.2.2  |  |  C  |  
python27-pygeode  |  |  1.2.2  |  |  C  |  
python27-Pygments  |  2.3.1  |  2.4.2  |  |  C  |  
python27-pygobject2  |  |  3.28.3  |  |  C  |  pygobject in conda  
python27-pygrib  |  2.0.3  |  2.0.2  |  |  C  |  
python27-pygtk2  |  |  |  |  C  |  
python27-pygtk2-libglade  |  |  |  |  N  |  
python27-pyhdf  |  0.9.10  |  0.10.1  |  |  C  |  
python27-pyke  |  1.1.1  |  1.1.1  |  |  C  |  
python27-pyparsing  |  2.3.0  |  2.4.0  |  |  C  |  
python27-pyproj  |  1.9.5.1  |  1.9.6  |  |  C  |  
python27-pyshp  |  2.0.0  |  2.1.0  |  |  C  |  
python27-pyside  |  |  5.6.0a1  |  |  C  |  
python27-pyspharm  |  1.0.9  |  1.0.9  |  |  C  |  
python27-pystan  |  2.17.1.0  |  2.17.1.0  |  |  C  |  
python27-pytz  |  2018.7  |  2019.1  |  |  C  |  
python27-pyugrid  |  0.3.1  |  0.3.1  |  |  C  |  
python27-PyYAML  |  3.13  |  5.1.1  |  |  C  |  
python27-pyzmq  |  17.1.2  |  18.0.2  |  |  C  |  
python27-requests  |  2.21.0  |  2.22.0  |  |  C  |  
python27-rpy2  |  2.9.4  |  2.8.5  |  |  C  |  
python27-s3transfer  |  0.1.13  |  0.2.1  |  |  C  |  
python27-ScientificPython  |  |  |  |  N  |  only available in Python2.7  
python27-scikit-image  |  |  0.14.2  |  |  C  |  
python27-scikit-learn  |  0.20.1  |  0.20.3  |  |  C  |  
python27-scipy  |  1.1.0  |  1.1.0  |  |  C  |  
python27-scitools-iris  |  2.2.0  |  1.13.0  |  |  C  |  
python27-seaborn  |  |  0.9.0  |  |  C  |  
python27-setuptools  |  40.6.3  |  41.0.1  |  |  C  |  
python27-Shapely  |  1.6.4  |  1.6.4  |  |  C  |  
python27-singledispatch  |  |  3.4.0.3  |  |  C  |  
python27-six  |  1.12.0  |  1.12.0  |  |  C  |  
python27-snowballstemmer  |  1.2.1  |  1.9.0  |  |  C  |  
python27-Sphinx  |  1.8.2  |  1.8.5  |  |  C  |  
python27-sphinxcontrib-websupport  |  1.1.0  |  1.1.2  |  |  C  |  
python27-statsmodels  |  0.9.0  |  0.10.0  |  |  C  |  
python27-sympy  |  1.3  |  1.4  |  |  C  |  
python27-Theano  |  1.0.3  |  1.0.4  |  |  C  |  
python27-toolz  |  0.9.0  |  0.10.0  |  |  C  |  
python27-tornado  |  5.1.1  |  5.1.1  |  |  C  |  
python27-tqdm  |  4.28.1  |  4.32.2  |  |  C  |  
python27-typing  |  |  3.7.4  |  |  C  |  
python27-urllib3  |  1.24.1  |  1.25.3  |  |  C  |  
python27-virtualenv  |  16.0.0  |  16.0.0  |  |  C  |  
python27-WebOb  |  1.8.4  |  1.8.5  |  |  C  |  
python27-windspharm  |  1.7.0  |  1.7.0  |  |  C  |  
python27-wxPython  |  4.0.3  |  4.0.3  |  |  C  |  
python27-xarray  |  0.11.0  |  0.11.3  |  |  C  |  
qt-devel  |  |  |  4.8.7  |  R  |  
R  |  3.5.1  |  3.4.1  |  |  C  |  
R-devel  |  3.5.1  |  3.4.1  |  |  C  |  
R-ncdf4  |  1.16  |  1.16  |  |  C  |  
redhat-lsb  |  |  |  4.1  |  R  |  
rjags  |  |  4_6  |  |  C  |  
sqlite-devel  |  |  |  3.7.17  |  R  |  
subversion  |  |  |  1.8.17  |  R  |  
subversion-devel  |  |  |  1.8.17  |  R  |  
subversion-tools  |  |  |  1.8.17  |  R  |  
tcl-devel  |  |  |  8.5  |  R  |  
tcl-devel  |  |  |  8.5.13  |  R  |  
tcsh  |  |  |  6.18.01  |  R  |  
thea  |  |  |  |  N  |  discontinued  
tk  |  8.6.9  |  8.6.9  |  8.5.13  |  CR  |  
tk-devel  |  8.6.9  |  8.6.9  |  8.5.13  |  CR  |  
tkdiff  |  |  |  4.3.5  |  R  |  
tmux  |  2.7  |  2.7  |  |  C  |  
tree  |  |  |  1.6.0  |  R  |  
udunits-devel  |  2.2.27.6  |  2.2.27.6  |  2.2.20  |  R  |  called
udunits2-devel  
umutil  |  |  |  20130102  |  R  |  
umutil-lib  |  |  |  20130102  |  R  |  
uuid  |  |  |  1.6.2  |  R  |  
uuid-devel  |  |  |  1.6.2  |  R  |  
valgrind  |  |  3.15.0  |  |  C  |  
vim-enhanced  |  |  |  7.4.629  |  R  |  
wxGTK-devel  |  |  |  2.8.12  |  R  |  
xconv  |  |  |  1.94  |  R  |  
xemacs  |  |  |  21.5.34  |  R  |  
xorg-x11-util-macros  |  |  |  1.19.0  |  R  |  
xpdf  |  |  |  3.04  |  R  |
{.table .table-striped}",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-migration-2020#full-table-of-packages-from-jap,14239,2651
Software Overview,"JASMIN is a large platform where a range of software tools, packages and
environments are available. Many users employ software already installed on
JASMIN whilst some need to install their own tools for a particular purpose.
This page provides an overview of the software on JASMIN. It links to further
information about a range of tools and environments.
To help get you started, these have been split into categories:
- Software available to all on JASMIN analysis/batch servers
- Additional tools for compiling and building software
- Restricted software
- Server-specific software
- Data movement software
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview,611,96
Which software should I use?,"There are a lot of different options when you are trying to work out which
tools and/or environments to use on JASMIN. Here are some quick questions to
help you get started:
1\. Do you want to use NAME, JULES, MOOSE or the NAG libraries?
- If yes, see: Restricted software
2\. Do you want a workflow management tool or a graphical Linux desktop?
- If yes, see: Server-specific software
3\. Do you want tools for transferring data or migrating it to/from tape?
- If yes, see: Data movement software
4\. If you need anything else:
- See: Software available to all on JASMIN analysis/batch servers
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#which-software-should-i-use?,595,106
Software available on all sci/batch nodes,,https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#software-available-on-all-sci/batch-nodes,0,0
Data analysis and visualisation tools,"If you are looking for software packages and environments that allow you to
analyse, process and visualise data then take a look at these options:
- Jaspy software environments (Python, R and other tools)
- The ""jasmin-sci"" software environment (packages not provided by Jaspy)
- Additional packages (provided under: ""/apps/jasmin"")
- IDL (and MIDL)
- Creating your own software environments
**NOTE** : If you are using Matplotlib to visualise data please refer to the
advice on our [Matplotlib help page]({{< ref ""matplotlib"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#data-analysis-and-visualisation-tools,533,83
"Jaspy Software Environments (Python, R and other tools)","Jaspy is a toolkit for managing and deploying Conda environments that include
both Python and non-Python packages. Jaspy environments, along with the
""jasmin-sci"" environment (see below), provide the main software on the
scientific analysis servers and LOTUS cluster on JASMIN. Details of the Jaspy
environments and packages are available on the [Jaspy page]({{< ref ""jaspy-envs"" >}}).
","https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#jaspy-software-environments-(python,-r-and-other-tools)",386,56
"The ""jasmin-sci"" Software Environment","The ""jasmin-sci"" software environment is intended as a supplement to Jaspy
(see above). It contains extra software packages for use with scientific data
analysis which, for various reasons, are not provided as part of Jaspy itself.
Details of this environment are provided on the [""jasmin-sci"" software
page]({{< ref ""jasmin-sci-software"" >}}).
","https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#the-""jasmin-sci""-software-environment",345,50
Additional packages,"A number of additional packages are available under the ""/apps/jasmin/""
directory scientific analysis servers and LOTUS cluster. Details of these
packages are provided on the [additional sofware packages page]({{< ref ""additional-software"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#additional-packages,246,32
IDL,"[IDL](https://www.nv5geospatialsoftware.com/Products/IDL) stands for
Interactive Data Language. It is a licensed data manipulation toolkit made
available on JASMIN. IDL is available on the JASMIN scientific
analysis servers and LOTUS cluster. See [ IDL ]({{< ref ""idl"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#idl,275,36
Creating your own software environments,"If you intend to create your own software environments then please take a look
at the following pages:
  * [Building virtual environments on top of Jaspy environments]({{< ref ""python-virtual-environments"" >}})
  * [Sharing your JASMIN software environments with other users]({{< ref ""share-software-envs"" >}})
  * Compilers on JASMIN
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#creating-your-own-software-environments,335,46
Restricted software available on specific servers,,https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#restricted-software-available-on-specific-servers,0,0
Workflow Management with Rose and Cylc,"Rose and Cylc provide a suite of tools available for managing sophisticated
multi-step workflows. See full details on the [Rose and Cylc page]({{< ref
""rose-cylc-on-jasmin"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#workflow-management-with-rose-and-cylc,179,26
Graphical Linux desktop access using NoMachine NX,"NoMachine NX is a tool that allows users to run a virtual graphical Linux
desktop on JASMIN. See details on the [NX page]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#graphical-linux-desktop-access-using-nomachine-nx,178,26
Data movement software,,https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#data-movement-software,0,0
Data transfer,"There are numerous tools for transferring data to/from JASMIN. Please consult
the [Data Transfer Tools page]({{< ref ""data-transfer-tools"" >}}) for details.
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#data-transfer,157,21
Data migration disk/tape,"The Joint Data Migration App, or JDMA, is a flexible tool for managing
large migrations of data between a range of storage media. On JASMIN, it can
be used for migrating data to/from tape, disk and object-store. See more
details on the [JDMA page]({{< ref ""jdma"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#data-migration-disk/tape,269,47
Still have a question?,"Please consult the [JASMIN software FAQs]({{< ref ""jasmin-software-faqs"" >}}).
",https://help.jasmin.ac.uk/docs/software-on-jasmin/software-overview#still-have-a-question?,79,9
MobaXterm (windows terminal client),"Windows users are strongly recommended to connect to JASMIN using the freely
available MobaXterm This article provides information about:
- Downloading and installing MobaXterm
- Basic usage
- Setting up MobAgent to store your private key
- Additional features
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm,261,39
Versions of MobaXterm,"The instructions given below are for version 23 of MobaXterm. For other
versions please check the MobaXterm documentation.
The method of configuring MobaXterm to store your private key has changed with
different versions. The recommended method, and an alternative, are shown
below.
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#versions-of-mobaxterm,283,42
Downloading and installing MobaXterm,"Download the free Home edition of
[MobaXterm](https://mobaxterm.mobatek.net/download-home-edition.html).
There are 2 editions available:
- ""Portable"" edition (can be installed as a regular user)
- ""Installer"" edition (may need admin privileges on your machine)
Both editions should be functionally the same once installed, but your choice
may depend on what level of access you have to your Windows machine.
For the ""portable"" edition, the contents of the downloaded zip file should be
extracted to a folder (eg. on your Windows desktop) where you can double-click
the executable file ""MobaXterm_Personal_xx.x"" (where xx.x is the version
number). Note that the ""CygUtils.plugin"" file should remain in this folder as
this is used for storing settings.
Once opened, MobaXterm presents a screen like this:
{{<image src=""img/docs/mobaxterm/file-lpgGvBbrOF.png"" caption=""initial mobaxterm screen"">}}
You can use the ""Start local terminal"" button or click the ""+"" tab to open
multiple tabs with a different terminal session in each tab. However, it's
worth setting up MobaXterm so that your private key is held globally, so that
it's available to any new terminal session that you open.
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#downloading-and-installing-mobaxterm,1181,174
Enabling MobAgent to store your private key,"In order to log in to a remote host (e.g. a jasmin host) you need to present
your private key from where it's stored on your local machine. MobaXterm
provides MobAgent which can store your key for the time you are running
MobaXterm, and can then present the key for you, for any session in any tab,
so you don't have to enter your passphrase for each new tab that you open.
The video below demonstrates this process, or you can follow the screenshots
which follow:
You need to enable MobAgent in MobaXterm's _Settings / Configuration / SSH_ :
{{<image src=""img/docs/mobaxterm/file-mL5QchQaBk.png"" caption=""ssh configuration"">}}
To do this:
- Tick ""Use internal SSH agent ""MobAgent""
- UN-tick ""Use external Pageant""
- Click the ""+"" symbol to locate your private key file (e.g. id_rsa_jasmin)
- Click OK to save the settings. MobaXterm will now need to restart.
- When you restart MobaXterm you will be prompted for the passphrase associate with your private key.
{{<image src=""img/docs/mobaxterm/file-Ktmdc5zxnP.png"" caption=""passphrase prompt"">}}
Once MobaXterm has started, you can check that your SSH key has been loaded by
clicking on 'Start local terminal' and using `ssh-add -l` to list the keys currently loaded.
**IMPORTANT: in the command examples below, the dollar symbol '$' at the start
of the command line in these example represents the shell prompt as displayed
in your terminal - it does not need to be typed!**
When you type the following command in the Mobaxterm terminal, you should see output similar to below:
{{<command user=""user"" host=""mobaxterm"">}}
ssh-add -l
(out)2048 SHA256:1WgYUGSqffxJX6bWqBZvFsutN3Psjn5mcPV37r6D7vQ
(out)Imported-Openssh-Key (RSA)
{{</command>}}
Sometimes the last part of this output shows your email address, but it is
just a comment field at the end of the key, which can be ignored. The fact
that it's returned something which looks like a key ""fingerprint"", shows that your key is loaded successfully into the agent.
If you don't see your key listed in output similar to the above, please try
again: perhaps you entered the wrong passphrase? But you will need to succeed
in loading your key before you can connect to JASMIN.
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#enabling-mobagent-to-store-your-private-key,2176,347
Logging in to JASMIN using key stored in MobAgent (recommended),"As shown in the video above, once you have set up MobAgent you can connect to
JASMIN by creating a new terminal window. Click the **""Start local terminal""**
button.  
Next, try connecting to the login server:
{{<command user=""user"" host=""mobaxterm"">}}
ssh -A <user_id>@login2.jasmin.ac.uk
{{</command>}}
(replace `<user_id>` with your own JASMIN username)
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#logging-in-to-jasmin-using-key-stored-in-mobagent-(recommended),356,50
Logging in to JASMIN without storing your key in MobAgent,"MobAgent provides the most convenient way of accessing JASMIN. However, if you
want to login to JASMIN without setting up MobAgent you can do so as follows.
Click on the 'Start local terminal' button then enter the following command. The final 2 lines show the output you should see: you are prompted for your key's passphrase, then if successful, you see confirmation that the key is loaded.
{{<command user=""user"" host=""mobaxterm"">}}
eval $(ssh-agent -s) 
ssh-add ~/.ssh/id_rsa_jasmin
(out)Enter passphrase for ~/.ssh/id_rsa_jasmin:
(out)Identity added: ~/.ssh/id_rsa_jasmin
{{</command>}}
If your key is named something different, or stored at a different location
than shown above, you will need to specify its location in the ssh-add
command. Note that MobaXterm refers to windows drives as e.g. `/drives/c/`
(with forward slashes). So if you've put your key on your desktop, then the
path to that **might** be `/drives/c/Users/fred/Desttop/id_rsa_jasmin` (if ""
**fred** "" is your local username on Windows).
You will need to do this each time you open a new terminal session. To connect
to JASMIN:
{{<command user=""user"" host=""mobaxterm"">}}
ssh -A <user_id>@login2.jasmin.ac.uk
{{</command>}}
Again, you must replace <user_id> with your JASMIN username.
As you can see, the MobAgent method mentioned previously makes this a bit
easier, because it persists between sessions and you navigate to the location
of your private key using graphical tools instead of having to type the path.
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#logging-in-to-jasmin-without-storing-your-key-in-mobagent,1490,223
Additional MobaXterm features,"MobaXterm is a comprehensive application that enables many useful features
such as:
- Saved session configurations
- X-forwarding / X11 / X server ( **Not recommended on JASMIN** : see [NoMachine NX for graphical linux desktop]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}) instead)
- SSH agent forwarding
- SFTP access (with graphical drag-n-drop)
- Split-tab mode
- SSH tunnelling
- Basic Linux commands such as: `cd, ls, pwd, cat`
- Command-line transfer utilities: `scp, rsync, wget`
Please see the [MobaXterm documentation](https://mobaxterm.mobatek.net/documentation.html) for details
on these.
",https://help.jasmin.ac.uk/docs/uncategorized/mobaxterm#additional-mobaxterm-features,610,82
Processing requests for resources,"This article **is for consortium managers** and explains:
- The overall process and role of consortium manager
- How to process a request for new resources for a service, submitted by a project
- How to process a request for additional resources on an existing project's service
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources,279,47
Introduction,"Please make sure you have read the article [""Requesting resources""]({{< ref
""requesting-resources"" >}}) to understand how the process works from the
requester's point of view.
This article will show you how to process requests for resources, but also
show you what you need to consider when doing so.
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#introduction,301,48
Overall process,"The overall process for handling requests for resources from projects is
summarised as follows. It all happens via the [JASMIN Projects
Portal](https://projects.jasmin.ac.uk).
  * A **project owner** will have created a record representing a **project** for you to review
  * This will come to you for review because they have selected your consortium as the most relevant to their work. 
    * But this means that the resources they are requesting need to come out of your consortium allocation.
  * The project record should contain: 
    * A project description
    * Requests for 1 or more services. Each proposed service (e.g., a Group Workspace or a Cloud Tenancy) can have
      * 1 or more requirements for **resources**
        * For a Group Workspace service, these could be requirements for disk or tape storage
        * For a Cloud Tenancy service, these could be requirements for disk, CPU and memory resources for the tenancy
    * Once **all the requirements for a service** have been agreed with the project owner, you, as consortium manager can submit the request for provisioning by the JASMIN team. 
      * Different services on the same project can be provisioned separately: for example, we can provision the Group Workspace resources while you're still discussing what's needed for a cloud tenancy.
      * But all the requirements for a particular service (for example, disk and tape, for a Group Workspace) need to be agreed before it can be submitted for provisioning. 
      * If necessary, certain requirements can simply be rejected and excluded from the submission and can be added later.
      * Requests made by projects directly to the JASMIN team will be referred back to this process, as it's essential that we manage valuable resources in an organised manner, involving you as consortium manager to make decisions for your consortium's allocations. So this does involve active engagement on your part.
  * Once resources have been provisioned, you should be notified so that you can track the progress of the request on behalf of the project.
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#overall-process,2080,330
Role of the consortium manager,"Your task when reviewing should be to:
  * Check that the project has selected the appropriate consortium: does this activity sit within your domain?
  * **Scrutinise** the project's request for use of your allocation of consortium resources for this project. Questions to consider are: 
    * Do the proposed resource requirements sound reasonable? 
      * Have they properly considered using shared services like scratch and XFC to minimise the need for their own dedicated resources? For example: 
        * Instead of 100TB SOF for their Group Workspace, could they manage with 25TB, knowing that copious scratch space is nearly always available?
        * Could some of the 100TB go on tape first, ""streaming"" their processing so that only some fraction is needed on disk at a time?
        * Have they asked for tape resources alongside their disk space? (this would reassure you that they've considered a sensible workflow like above, but you might want to discuss with them). It's reasonable to ask for an equivalent amount of space on tape as on disk. Historically this has usually been provisioned by default anyway, but we do want to capture what the project actually plans to use.
      * Is the proposed workflow free of unnecessary duplication of data already available elsewhere on JASMIN, either in the CEDA Archive or other Group Workspaces (which can be processed in place rather than needing to be copied)?
      * Some of this information will be in the project description but feel free to contact the project owner to gather more details yourself to form your opinion.
    * Are the start and end dates realistic? 
      * You will need to reclaim your consortium's resources once a project has finished (in order to support other projects from your allocation), so it's important that these dates are agreed and regularly reviewed.
      * Does the project actually need all the requested resources initially, or could they manage with some fraction to start with?
        * ""Hogging"" disk space (or other resources), but not using it, wastes expensive resources.
        * Is there a date beyond which the data could be moved off disk onto tape, freeing up disk? The project's requirements can be modified during its lifetime to achieve this, but this should be considered (at the start) as a way to ""sunset"" the disk requirements while keeping some data still available after the active phase of the project.
        * Group Workspace storage is short-term storage for the duration of a project only. Keeping data in Group Workspace disk storage in an open-ended way is bad for a number of reasons: other projects won't have the resources they need, plus there are a number of data-sharing services attached to the CEDA Archive (such as, enabling other projects to discover the data) which make this a much better place to share data from, with all the benefits of professional data curation. The disk requirement for Group Workspaces should only be allocated for the active phase of the project where working space is needed.
      * Longer-term visibility of any data produced should be addressed by involving the CEDA Archive team at the project planning stage.
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#role-of-the-consortium-manager,3191,517
Processing a request for new resources,"Log in to the [JASMIN Projects Portal](https://projects.jasmin.ac.uk/)
This requires your JASMIN credentials (so you need to have a JASMIN account to
proceed). Two-factor authentication is used: you can opt to send a
verification code to the email address registered with your JASMIN account,
then enter that code to proceed. Check your spam folder if the message doesn't
appear.
{{<image src=""img/docs/processing-requests-for-resources/file-beGPU0FT33.png"" caption="""">}}
Follow the ""Consortia"" link at the top, to show all the consortia. The one(s)
you are responsible for will have a ""Go to consortium"" button.
{{<image src=""img/docs/processing-requests-for-resources/file-Sgzblb0QRe.png"" caption="""">}}
Click ""Go to consortium""
{{<image src=""img/docs/processing-requests-for-resources/file-ywQMwjynoE.png"" caption="""">}}
This screen has 3 tabs: we are looking at the
""overview"" tab first, showing your how much of each type of resource is
committed (provisioned) against the allocated resources for your consortium.
Go to the ""Projects"" tab. If you have any projects with outstanding items for
review, the number of projects will be indicated next to the ""Projects"" tab.
{{<image src=""img/docs/processing-requests-for-resources/file-e2cXo2Xt2L.png"" caption="""">}}
Here we can see all the projects in this consortium:
scroll down to see ""cards"" for all the projects. The tab indicated that there
were 2 to be reviewed and these are labelled here too.
Click ""Go to Project"" for the one you want to review, to see the **project
overview** screen.
{{<image src=""img/docs/processing-requests-for-resources/file-uhXOLmsJmX.png"" caption="""">}}
The ""Overview"" screen for a project gives you the
timeline of what's happened (most recent first) so you can see the description
and any comments.
Now go to the ""Services"" tab, to see what service(s) this project thinks it
needs, and what resources are requested for those services:
{{<image src=""img/docs/processing-requests-for-resources/file-YtZ08rDv8i.png"" caption="""">}}
In this case, they're just asking for a Group
Workspace, and have documented a requirement for 10 TB of SOF disk space,
between the dates shown. For now, we'll just consider how to approve that one
request (but you could encourage them to ask for tape space as well, then
approve both together).
The SOF requirement is in the ""REQUESTED"" state, meaning it's awaiting your
review, so click the ""?"" icon, to review that requirement:
{{<image src=""img/docs/processing-requests-for-resources/file-B2GlK1C4RM.png"" caption="""">}}
Here, you can see that this requirement for 10 TB SOF
of SOF disk is OK in terms of your consortium's overall allocation for SOF
(1.6 PB), and current commitments (770.2 TB or 48%) against that allocation.
But only you know what other projects are in the pipeline in your science
domain:
  * is there some big project on the horizon which will need lots of space in the near future?
  * if you're struggling for space, are there other projects which you could ask to give up some or all of their disk space, if they've finished their work?
  * if they've asked for particular types of disk space (PFS, SSD or HPOS), have they justified why? The default storage type for Group Workspaces should be SOF, but there may be reasons why others are more appropriate, e.g. 
    * HPOS (Object Storage) for visibility inside / outside of JASMIN (to be encouraged!)
    * SSD (Solid State Disk) for small file storage (but very limited amounts available, normally 100GB at a time)
    * PFS (Parallel File System) for workflows which absolutely must be able to write in parallel to the same file from multiple processes (...but there are 2 PB of scratch space available for this purpose, so consider carefully).
If you want to suggest changes to the project (e.g. you think they've picked
the wrong type) you can ""Reject"" with comments, and they can re-submit the
request.
If you're happy to approve, click ""Approve"":
{{<image src=""img/docs/processing-requests-for-resources/file-Wc5Leta8pS.png"" caption="""">}}
The SOF requirement now has status ""APPROVED"" so (as
long as there are no other requirements in ""REQUESTED"" state), you can click
""Submit for provisioning"".
If there are other requirements that have been requested, you either need to
approve them too, or reject them so that you can agree acceptable resource
request with the project owner.
{{<image src=""img/docs/processing-requests-for-resources/file-wbaUpLxykd.png"" caption="""">}}
If submitted, the requirement will then have the
status ""AWAITING PROVISIONING"" and the JASMIN team will pick up the request to
arrange provision of the resources.
{{<image src=""img/docs/processing-requests-for-resources/file-Tsra3DcRkq.png"" caption="""">}}
Once the JASMIN team has completed provisioning the
resources, the status changes to ""PROVISIONED"" and the location is confirmed:
in this case giving the path to the disk space now that's now available.
At this point, the project owner who requested the resources would also be
notified to check the status on the portal, so should be able to pick up the
location, but you may wish to check with them yourself, to track the request
to completion.
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#processing-a-request-for-new-resources,5170,756
Processing a request for additional resources,"Where a project already exists, a project owner can submit a request for
changes to resources on an existing service, or could request an additional
service (e.g. adding a cloud tenancy where there's already a Group Workspace).
Adding an additional service should work as described above, but reviewing a
request to modify resources on an existing service, is shown below:
We start from the project overview screen (so check above for steps to reach
that):
{{<image src=""img/docs/processing-requests-for-resources/file-Cm6NWP5GdB.png"" caption="""">}}
We can see in the comments that something has been requested: those comments
are attached by the project owner to provide extra context to the request.
Go to the Service tab to review further:
{{<image src=""img/docs/processing-requests-for-resources/file-wexo0BiLCL.png"" caption="""">}}
Here we can see the original 10 TB which is
""PROVISIONED"" but above it is the request for the additional 1 TB, with status
""REQUESTED"".
Click the ""?"" to review:
{{<image src=""img/docs/processing-requests-for-resources/file-Nv3hYTq2de.png"" caption="""">}}
From the consortium manager's point of view, it's the
same process as before, so go through the same steps to scrutinise the
request.
Reject the request (with comments) if you want the project owner to change
things, or approve it if you're happy:
{{<image src=""img/docs/processing-requests-for-resources/file-enxubp0Anh.png"" caption="""">}}
Now the request is marked as ""APPROVED"", and since we
have no other requests in ""REQUESTED"" state for you to review, you can click
""Submit for provisioning"".
{{<image src=""img/docs/processing-requests-for-resources/file-8rA9Xz0Auw.png"" caption="""">}}
Once you have submitted it, the request is marked
""AWAITING PROVISIONING"" for the JASMIN team to pick up.
In this case, we're adding space to the same service, so when it comes to
recording what's provisioned, the 10 TB & 1 TB ""chunks"" will be combined (in
terms of how they're recorded here), reflecting the fact that the JASMIN team
will have simply expanded the size of the (single) disk volume. This makes
sense if the project has asked for more space, but the total space is needed
until the end of the whole project. So the previous 10TB (the record, not the
actual disk) has been marked ""DECOMMISSIONED"":
{{<image src=""img/docs/processing-requests-for-resources/file-MjIM9tdrHr.png"" caption="""">}}
An alternative, which might be applicable in some
cases, is where the extra space ""boost"" is only needed for a shorter period of
time, as shown by the different end dates to the 2 requirements below. They're
both referring to the same physical storage, but the extra 1 TB space
""expires"" first.
{{<image src=""img/docs/processing-requests-for-resources/file-UtPmX7AzE1.png"" caption="""">}}
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#processing-a-request-for-additional-resources,2768,391
Processing requests for resource types other than storage,"The process for reviewing requests for other resource types, such as those
needed for cloud tenancies, is the same as above. Further examples may follow
here as needed.
",https://help.jasmin.ac.uk/docs/uncategorized/processing-requests-for-resources#processing-requests-for-resource-types-other-than-storage,169,28
How projects and resources are managed,"Resouces on JASMIN, such as storage and compute, are allocated to science
communities separated into ""consortia"". Each consortium has a manager: a
representative of that science community who is in touch with its major
activities and understands the resource requirements for projects in that
domain. Representatives of individual projects should discuss requirements
with their Consortium Manager, who is best placed to make decisions about the
allocation of JASMIN resources within that consortium. Requirements can be
documented using the “JASMIN Resource Management” tool, but need to be
approved by a Consortium Manager before being passed to the JASMIN Team for
provisioning.
[See here for further details](https://jasmin.ac.uk/users/resources-projects),
including a list of current consortia and their managers.
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#how-projects-and-resources-are-managed,819,114
Accessing the JASMIN projects portal,"The [JASMIN projects portal](https://projects.jasmin.ac.uk) provides a place
to:
- document the resources required for a project (new projects, or changes to existing projects)
- submit those requirements for review
- track the provision of those resources
Usually, you would only need to access the projects portal if you are:
- the Principal Investigator (or their delegated project manager) for a project
  - to document requirements for a project
  - to invite other individuals (with a JASMIN account) who may wish to view and/or discuss the requirements
- a consortium manager
  - to review/approve resource requirements
**Note: Please do not make requests yourself unless you are involved in the
management of the project: speak to the project or group workspace (GWS)
manager and ask them to make the request.**
These users need to log in with their JASMIN account credentials, the same as
those used for the JASMIN accounts portal. 2-factor authentication is in use,
with verification codes sent to the email address associated with your JASMIN
account (this is the same process used to access the JASMIN notebook service).
Once you have logged in, you are presented with a view of the projects where
you are named as owner or collaborator (or, for consortium managers, where you
are the relevant consortium manager. [A further guide for consortium managers
about how to process requests for resources is available [here]({{< ref
""processing-requests-for-resources"" >}})).
{{<image src=""img/docs/requesting-resources/file-CFe92vMRQV.png"" caption="""">}}
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#accessing-the-jasmin-projects-portal,1561,234
Create a project to record resource requirements,"To create a new project:
- Go to ""My Projects""
- Click ""Start new project""
{{<image src=""img/docs/requesting-resources/file-zl6tBZHWsW.png"" caption="""">}}
Enter details for the project, as described below.
A project can have several Services, such as:
- a group workspace
- a managed cloud tenancy
- an external cloud tenancy
  - [particular compute requirements*]
  - some services are not yet able to be described/requested via this tool, but will be soon.
  - please contact the helpdesk if you're not able to describe what you need.
To add the services needed for the project:
- in the panel on the right, click ""Add Service""
- Select the category of service required: in this case, we're making requirements for a group workspace, but the available options are: 
  - **Group Workspace** (for shared disk storage for a project)
  - **External Tenancy VIO** (for an external cloud tenancy on the VIO cloud platform)
  - **Managed Tenancy VIO** (for a managed cloud tenancy on the VIO cloud platform)
  - (please do not use the ""... Tenancy **MCP** "" options as these will soon be removed)
- Provide a short name for the service
- Click ""create"".
{{<image src=""img/docs/requesting-resources/file-bo7r6lG1NA.png"" caption="""">}}
{{<image src=""img/docs/requesting-resources/file-GPxShAAROa.png"" caption="""">}}
{{<image src=""img/docs/requesting-resources/file-I0n92JdcKD.png"" caption="""">}}
{{<image src=""img/docs/requesting-resources/file-kbDroJj43z.png"" caption="""">}}
A Service may have several requirements, but, for example, we could request 10
TB of SOF storage for our GWS:
{{<image src=""img/docs/requesting-resources/file-uV9ApenDrm.png"" caption="""">}}
SOF (scale-out filesystem) is the usual type of storage used for GWS volumes,
but you could also request:
- HPOS (high-performance object store available via an S3-like interface)
- PFS (parallel file system, by special request if certain workflows specifically need this)
- SSD (Solid State Disk, used for ""small files"" or ""SMF"" volumes for storing code or virtual environments to share within a GWS.
It is assumed that you've considered carefully how you will do your work on
JASMIN, with some knowledge of its services and components. You may find the
following helpful:
- Article: [Understanding new JASMIN storage]({{< ref ""understanding-new-jasmin-storage"" >}})
- [JASMIN workshop](https://github.com/cedadev/jasmin-workshop) overview talk, explaining the main services offered by JASMIN
- how your request will be [scrutinised]({{< ref ""processing-requests-for-resources"" >}}) by the relevant consortium manager.
Once created, the requirements appear in the list, along with their start and
end dates and status. This one is ""REQUESTED"".
{{<image src=""img/docs/requesting-resources/file-gg37EcPAxa.png"" caption="""">}}
{{<image src=""img/docs/requesting-resources/file-gKtZB9giSE.png"" caption="""">}}
Click ""Submit for review"" and the manager of the relevant consortium will be
notified that they need to review the request, with status updated to
""REQUESTED"".
Only a user with ""OWNER"" status on a project can submit the project for
review. It's best if one person coordinates with the consortium manager once
the outline plan has been agreed with other project contacts (see inviting
another user and joining a project, below)
{{<image src=""img/docs/requesting-resources/file-KwyoJbji2p.png"" caption="""">}}
If there are multiple requirements, make sure these are all documented so that
the consortium manager can consider them all together, in context. Just repeat
the process above for each additional requirement.
The project is marked as ""UNDER REVIEW"" while the requirements are being
agreed.
The consortium manager may approve, reject or request changes to the
requirements before they are agreed.
Once the consortium manager has agreed, the requirements are ready for
provisioning: the JASMIN team will then manage the provisioning of the
requested resources and the project contact will be notified when this is
complete and the new resources available.
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#create-a-project-to-record-resource-requirements,4016,556
Invite another user,"By default, information in the projects portal is only visible by those
nominated ""collaborators"" on the project, the relevant consortium manager, and
the JASMIN Team (or others involved in the provision of JASMIN services). To
share your plans for what's needed on a project with other individuals, you
can invite another user to the project:
- Go to ""My Projects""
- In the panel on the right, click the link with the number of current collaborators
- Enter the email address of the other user you wish to invite, and press ""Invite""
  - Although you are inviting them by email address, they must have a JASMIN account in order to access the projects portal.
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#invite-another-user,659,114
Join an existing project by invitation from another user,"If you have received an invitation code from an existing collaborator on a
project, you can use it to join a project as follows:
- Go to ""My Projects""
- Click ""Join existing project""
- Enter the invitation code which the other user has sent you.
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#join-an-existing-project-by-invitation-from-another-user,246,46
Request additional resources for an existing project,"You can add new requirements to a project once it has been PROVISIONED (but
not while it's already UNDER_REVIEW).
To add new requirements, go to ""My Projects"" and create the new requirement.
For example, if a GWS currently has 10 TB of SOF space provisioned, and the
new and an additional 5 TB of space is needed, then:
- If the GWS as a whole has the same end date, then create a new requirement for 15TB, with that end date, and submit this so that it can be reviewed.
- If it's just a temporary / short-term boost of storage that's needed 
  - consider whether scratch or XFC storage would suffice
  - create a requirement for the additional storage only, confirming the start and end dates of the new storage
  - in some cases, the end dates of the original storage will be out-of-date, so please agree new dates with your consortium manager as part of this process.
Although these examples have concentrated on storage requirements, the same
methods apply to requesting cloud tenancies. More detail on how to request
these, and additional methods for documenting requirements for compute
resources, will follow in due course.
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#request-additional-resources-for-an-existing-project,1131,196
Alternatives,"In some cases, it may not be appropriate to provide dedicated resources to
certain projects. Your consortium manager should be able to help you look at
other options. In some cases, a relevant project may already exist, and by
discussion with the appropriate manager of that project, it may be possible
for you to make use of those existing resources without the need to create a
new one. There is a certain management overhead associated with setting up and
operating each project's dedicated services, which use expensive resources, so
requests do have to be considered carefully.
The following ""generic"" Group Workspaces exist for general use by members of
these communities and often solve the problem of a small GWS needed by an
individual:
- [ncas_generic](https://accounts.jasmin.ac.uk/account/login/?next=/services/group_workspaces/%3Fquery%3Dncas_generic) : (National Centre for Atmospheric Science)
- [nceo_generic](https://accounts.jasmin.ac.uk/account/login/?next=/services/group_workspaces/%3Fquery%3Dnceo_generic) : (National Centre for Earth Observation)
- [ceh_generic](https://accounts.jasmin.ac.uk/account/login/?next=/services/group_workspaces/%3Fquery%3Dceh_generic) : (UK Centre for Ecology and Hydrology)
In these cases, the relevant consortium manager is usually the manager of the
""generic"" workspace so can approve applications for access to these workspaces
themselves.
Please consult the [list of available group
workspaces](https://accounts.jasmin.ac.uk/account/login/?next=/services/group_workspaces/)
for other options.
Another alternative, for easily accessible short-term storage for an
individual user is the [JASMIN Transfer Cache (XFC) service]({{< ref ""xfc"" >}}).
",https://help.jasmin.ac.uk/docs/uncategorized/requesting-resources#alternatives,1700,205
Working with many Linux groups,"The number-of-groups limitation - and how to work around it
",https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups,60,10
Description,"On JASMIN, users are added to Linux groups for access to the group workspaces
and CEDA datasets which they have registered to use, in addition to a couple
of standard groups granted for all users.
Type the `id` command to see which groups you are a member of. The first one
(shown with `gid=`) is your primary group, and the list starting `groups=`
contains your supplementary groups.
Although the Linux operating system allows the group list to contain a large
number of supplementary groups, certain types of filesystem are subject to a
maximum number that is supported. When such filesystems are accessed, a
truncated copy of the group list may be used while deciding whether to grant
read or write access to a given file or directory. This can mean that although
a user is a member of the group which is needed, a permissions error still
occurs, because the relevant group is being ignored. The groups which are
ignored are those with the higher numerical group IDs.
The most significant limitation affecting JASMIN users is for filesystems
which are mounted as type NFS, because this only supports 16 groups. In
particular, this applies to the group workspaces that are optimised for small
files (under path `/gws/smf`). It also applies to the home directories and
`/apps` software directories, and although with these directories it is not
normally necessary to restrict access via Linux groups, the restriction can
affect for example access to the NAG library licence file for NERC users. The
`panfs` filesystem type (Panasas group workspaces under `/group_workspaces`)
is also affected in principle, but it has a limit of 32 groups, which is less
likely to affect users.
",https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups#description,1679,279
Workarounds,,https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups#workarounds,0,0
newgrp,"The `newgrp` program is available on all machines, and can be used to choose a
particular group. For example, typing:
newgrp ukmo_clim
will start a session (sub-shell) in which the primary group ID of the process
is `ukmo_clim` (provided that you are already a member of that group). This
will ensure that, in that session, you have access to any files which require
that group. Note that it will also mean that any files and directories you
create in that session will be owned by the group which you selected (although
they can subsequently be changed with the `chgrp` command). When you exit from
the sub-shell, you will be returned to the original session with your normal
group list.
The main limitations of `newgrp` are that:
- It only works interactively, so it is not possible to use it in LOTUS jobs.
- It only affects the primary group ID, so cannot be used to guarantee access to more than one group simultaneously, because some groups on the supplementary group list might still be ignored for filesystem accesses.
Note that if `newgrp` prompts for a password, it is because you are trying to
use it to access a group that you are not a member of (and then there is no
password that you can usefully type).
",https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups#newgrp,1219,217
withgroups,"On the JASMIN scientific analysis machines running CentOS7, including the
LOTUS nodes in the `centos7` queue, a utility (written locally by CEDA) has
been added, which overcomes the above mentioned limitations of the `newgrp`
program. It is not available on the machines running RHEL6.
To use `withgroups`, you **first need the following command** (in your
interactive session or shell script):
module load jasmin-sci
Once you have done this, you can run any individual command with the syntax
`withgroups <group> <command>` followed by any commands arguments, for
example:
withgroups ukmo_clim ls /badc/ukmo-mslp/
You can also use a comma-separated list of groups if a command requires more
than one group, for example if you wanted to copy a file between group
workspaces:
withgroups gws_foo,gws_bar cp /gws/smf/foo/myfile /gws/smf/bar/
In these cases, the group list consists _only_ of the specified groups. So if
you specify a few additional groups, these should be safe from being ignored
during filesystem access, because they are no longer part of a long list.
Note that the group list in the calling session does not get modified. You
will see this if for example you type:
module load jasmin-sci    # a reminder of the setup command
id                        # ""id"" reports your whole list of groups
withgroups ukmo_clim id   # ""id"" only reports the ""ukmo_clim"" group
id                        # again, ""id"" will show you the whole group list
This means that you should use `withgroups` on every command for which it is
needed. If you prefer to use a subshell in which every command will have this
group(s) list (for similar behaviour to `newgrp`) you could start it by doing
something like:
withgroups ukmo_clim bash
(You might see from the help message that the `withgroups` command includes a
`-a` option to include all the original groups in the group list, just with
the specified ones at the front. However, this option is not recommended for
this purpose, because it turns out that filesystem access will ignore the
ordering and still truncate the list in numerical order.)
",https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups#withgroups,2090,335
Use of workarounds with python (and other) programs,"Note that there is no python module equivalent of either `newgrp` or
`withgroups`. In most cases, it is sufficient to run your **whole** python
script either inside a newgrp session or via withgroups, for example:
withgroups ukmo_clim python my_script.py
In the unlikely event that your Python program needs access to a large number
of groups, you will have to lauch external commands (using `os.system` or the
`subprocess` package) that start with the relevant `withgroups` prefix.
Similar considerations apply to code written in other programming languages.
",https://help.jasmin.ac.uk/docs/uncategorized/working-with-many-linux-groups#use-of-workarounds-with-python-(and-other)-programs,560,85
Workflow Management with rose/cylc,"This page provides is an overview of Met Office tools (Rose, Cylc and FCM)
that are installed on JASMIN for running and managing suites on the LOTUS
cluster.
 **IMPORTANT** : Users of the **JULES** land surface model are advised to log
into the Cylc server in order to launch the JULES suite.
",https://help.jasmin.ac.uk/docs/workflow-management/rose-cylc-on-jasmin,293,52
About rose/cylc,"Rose and Cylc are very useful workflow management tools. You can:
- Configure a Rose suite to work with the LOTUS batch cluster on JASMIN.
- Run a Rose suite and monitor its progress using the Cylc GUI.
Find out more
- Rose: <https://metomi.github.io/rose/doc/html/>
- Cylc: <https://cylc.github.io/doc/built-sphinx/>
Getting started with rose/cylc
The tools are installed under the following common directory which is visible
on all LOTUS nodes and the dedicated cylc server:
",https://help.jasmin.ac.uk/docs/workflow-management/rose-cylc-on-jasmin#about-rose/cylc,477,72
Add the location of the rose/cylc executables to $PATH,"export PATH=/apps/jasmin/metomi/bin:$PATH
Jobs must be scheduled from the JASMIN server: `cylc.jasmin.ac.uk`
All users with a JASMIN login account can log in to this server.
Access to the Met Office Science Repository Service has also been set up. For
information about authentication to the repositories see:
<https://code.metoffice.gov.uk/trac/home/wiki/AuthenticationCaching#JASMIN>
Following these instructions will give you access to FCM.
If you would like to run the cylc GUI then please login through the [NoMachine
servers]({{< ref ""graphical-linux-desktop-access-using-nx"" >}}).
",https://help.jasmin.ac.uk/docs/workflow-management/rose-cylc-on-jasmin#add-the-location-of-the-rose/cylc-executables-to-$path,588,74
Example rose/cylc suite,"Please see the JASMIN Workshop tutorial for a [worked example](https://github.com/cedadev/jasmin-workshop/tree/master/tutorials/tut02) of setting up a rose/cylc suite and run it on LOTUS.
",https://help.jasmin.ac.uk/docs/workflow-management/rose-cylc-on-jasmin#example-rose/cylc-suite,188,21
"Setting up the ""suite.rc"" file for use with LOTUS","For use on JASMIN, you will need to configure the `suite.rc` to run on LOTUS
(using the Slurm scheduling tool):
[[job submission]]
    method = slurm
    execution time limit = PT15M
[[directives]]
    -q = short-serial
    -W = 05:00
    -n = 1
","https://help.jasmin.ac.uk/docs/workflow-management/rose-cylc-on-jasmin#setting-up-the-""suite.rc""-file-for-use-with-lotus",246,40
Using Cron,"Cron is a very common job scheduler for linux. It allows users to run the same
command or shell script periodically. Typically it is used to automate tasks,
for example, every Monday run my script to plot last week's data. There are
many guides to using [cron and
crontab](https://www.google.co.uk/?q=cron%20crontab) (the command for loading
the cron job table).
",https://help.jasmin.ac.uk/docs/workflow-management/using-cron,363,57
Cron on JASMIN,"Generally cron is disabled on the JASMIN general access machines such as
`sci1.jasmin.ac.uk`. This is to avoid people killing the machine by setting up
lots of processing jobs when better alternatives, e.g. Lotus, are available.
However, there are times when it is appropriate to use cron and so a generic
cron service machine is provided. `cron.jasmin.ac.uk` is configured like
`sci*.jasmin.ac.uk`, except cron is enabled. Anyone who can log into `sci*`
should also be able to login to `cron.jasmin.ac.uk`. (the actual hostname of
the machine is `cron1.ceda.ac.uk` but please refer to it as
`cron.jasmin.ac.uk` wherever possible).
An additional transfer server `xfer3.jasmin.ac.uk` is equipped with `cron` for
scheduling transfers only (no processing), although other methods for
{{<link ""../data-transfer/scheduling-automating-transfers"">}}scheduling/automating transfers{{</link>}} are available.
There are a few rules of the road to using this service:
  1. **Avoid process pile up** : If a job has not finished before the cron starts the next instance of the same job then competition for resources probably means that job will also not finish. Eventually a mass of unfinished jobs will overwhelm the whole machine and it will crash. To avoid this jobs should test to see if the previous job is still running by using a lock file, or making sure the jobs timeout. The crontamer wrapper script, documented below, is available to help you implement this. 
  2. **Expect it to break occasionally** : Regardless of any measure introduced by users to stop process pile up, you can expect it to go rouge at some point. We will reboot the machine when this happens, probably without warning. **_We may remove offending jobs from the cron table but persistent offenders may be barred from using the service._**
  3. **Don't do heavy processing or data transfers on the cron machine itself**. You can submit jobs to lotus (sbatch is on cron1.ceda.ac.uk) to offload the processing resource.
",https://help.jasmin.ac.uk/docs/workflow-management/using-cron#cron-on-jasmin,1986,307
Common Cron Gotchas,"The bash shell environment when cron launches scripts is not identical to the
one when working interactively. Annoyingly the path to common tools, like
sbatch, may not have been setup so that you get an error message from cron
when it works perfectly well interactively. A way to get round this is to
source the .bash_profile in the crontab file so that the interactive
environment is used by cron.
24 * * * * . $HOME/.bash_profile; sbatch -W 12:0 mycmd.sh
",https://help.jasmin.ac.uk/docs/workflow-management/using-cron#common-cron-gotchas,457,80
Crontamer,"Crontamer is a wrapper script to implement lock file and time out checking for
cron jobs to avoid issues of ‘’’runaway’’’ jobs causing problems for everyone
(e.g. where new jobs start before old ones finish, which can cause a snowball
effect).
You can download the crontamer script from
<https://github.com/cedadev/crontamer>. It is already installed on
`cron1.ceda.ac.uk`
Use cron as normal, but include the crontamer command before the users own
script and arguments.  
{{<command shell=""bash"">}}
crontab -l
(out)## e.g. cron file entry to run job every day at 4am:
(out)0 4 * * * crontamer -t 2h '/home/users/jblogs/bin/my_repeat_script.sh -opt1 arg1 arg2'
{{</command>}}
Note: Crontamer has a number of options which can be conflated with the
options for the wrapped script. Use single quotes to make sure the script runs
with the right options.
The flow of the crontamer script is like this:
- Check for existing lock file to indicate if the script is already running. If the lockfile is there and it can see the matching process still running then it exits silently. 
- If the lock file is not there or it can't see the matching process on the system then it starts the wrapped script. 
- Periodically check the wrapped script is running. If the script fails, with a non-zero exit return code, then it can email you.
- If the script has been running longer than specified timeout (default 12hr) then it will be killed. 
Unless a named lock file is given the lock files are created in the /tmp
directory as
/tmp/crontamer.{unique_id}
These files should be cleaned up automatically, but users may need occasional
checks or find them helpful for identifying problems running their scripts.
The {unique_id} is based on a combination of the username, passed script and
arguments, enabling multiple calls of a script with different arguments to be
handled separately.
All the principles above apply whether using cron on:
- the cron server `cron.jasmin.ac.uk` (for initiating processing workflows)
- the transfer server `xfer3.jasmin.ac.uk` (for initiating automated transfers)",https://help.jasmin.ac.uk/docs/workflow-management/using-cron#crontamer,2077,332
